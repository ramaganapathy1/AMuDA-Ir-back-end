Evaluation of indoor positioning based on
Bluetooth Smart technology
R

Master of Science Thesis in the Programme Computer Systems and
Networks

Erik Dahlgren,
Hasan Mahmood
Chalmers University of Technology
Department of Computer Science and Engineering
Göteborg, Sweden, June 2014

The Author grants to Chalmers University of Technology and University of Gothenburg
the non-exclusive right to publish the Work electronically and in a non-commercial
purpose make it accessible on the Internet.
The Author warrants that he/she is the author to the Work, and warrants that the Work
does not contain text, pictures or other material that violates copyright law.
The Author shall, when transferring the rights of the Work to a third party (for example a
publisher or a company), acknowledge the third party about this agreement. If the Author
has signed a copyright agreement with a third party regarding the Work, the Author
warrants hereby that he/she has obtained any necessary permission from this third party to
let Chalmers University of Technology and University of Gothenburg store the Work
electronically and make it accessible on the Internet.

Evaluation of indoor positioning based on Bluetooth® Smart technology
ERIK DAHLGREN
HASAN MAHMOOD
©ERIK DAHLGREN, June 10, 2014
©HASAN MAHMOOD, June 10, 2014
Examiner: LARS BENGTSSON
Chalmers University of Technology
Department of Computer Science and Engineering
SE-412 96 Göteborg
Sweden
Telephone + 46 (0)31-772 1000

Illustration of Bluetooth® radio based positioning in action.
Bluetooth Figure Mark used by courtesy of Bluetooth SIG. The Bluetooth ® word mark and
logos are registered trademarks owned by Bluetooth SIG, Inc.

Department of Computer Science and Engineering
Göteborg, Sweden June 10, 2014

Abstract
Nowadays, positioning technologies are used in a wide variety of areas such as providing
driving directions and tracking valuable goods to name a few. Since the introduction
of the global positioning system(GPS), it has become a de facto standard for outdoor
positioning applications. In contrast to this, no similar widespread technique is available
for indoor positioning or in areas where GPS is unavailable. Extensive research have
been devoted to exploring the topic based on a variety of technologies such as Wi-Fi,
Bluetooth, Zigbee and ultra wideband radio. None of these have successfully made
it into a widely accepted standard, although significant progress has been made. In
2010 a completely new Bluetooth technology, referred to as “Bluetooth low energy”
or ”Bluetooth smart” was released that promises among other things ultra low power
consumption, changed radio frequency properties and a completely new software stack.
No academic work can be found that explores the usability of this new technology in
the context of indoor positioning. This Master thesis is the first project to evaluate
the suitability and the applicability of this new technology in the context of indoor
positioning. A selection of algorithms and approaches are explored, tested, evaluated
and compared in a testbed scenario designed for this purpose. Furthermore, the results
of these tests are analyzed by examining the received signal strength indicator (RSSI)
behaviour, which is the parameter used as basis for the positioning approaches. The
evaluation shows that Bluetooth smart is a viable alternative for indoor positioning which
offers widespread availability in society, reasonable accuracy and low cost deployment.
The report also provides essential advice on some important pitfalls when using the
technology for positioning applications.

Acknowledgements
We would like to thank our examiner at Chalmers University of Technology, Lars Bengtsson, for his support and guidance in this work. A special thanks goes to our supervisors
at Cybercom Sweden AB, Ulf Karlsson and Sigursteinn Reynisson for their advice and
support. Gratitude is also directed to Tom Strömberg for his support to the project,
Hans Forsberg for introducing the idea and providing interesting discussion and expertise, and all other skilled and supporting colleagues at Cybercom Sweden AB.
We would also like to genuinely express our deepest appreciation and gratitude to our
families for their encouragement and support.
Finally, a big thanks goes out to everyone not mentioned by name who has ever helped
directly or indirectly in this work.
The Authors, Gothenburg 2014-06-10

Abbreviations
AOA - Angle of arrival
API - Application programming interface
BER - Bit Error Rate
BF - Bayesian Fusion
BLE - Bluetooth low energy
BSE - Bayes static estimation
ESS - Effective sample size
GFSK - Gaussian frequency shift Keying
GLONASS - Globalnaya navigatsionnaya sputnikovaya sistema
GNSS - Global Navigation Satellite System
GRPR - Golden Receiver Power Range
GPS - Global positioning system
HCI - Host Controller Interface
ID - Identification
IRR - Inquiry response rate
ISM - Industrial Scientific and Medical
LD - Laying down
LOS - Line of sight
LQ - Link Quality
MAC - Media access control
PDU - Protocol data unit
PKF - Point Kalman filter estimation
RF - Radio frequency
RSS - Received Signal Strength
RSSI - Received signal strength indicator
SIG - Special interest group
SOC - System on chip
SU - Standing up
TDOA - Time difference of arrival
TOF - Time of flight
TPL - Transmit power level
TTL - Time to live
Tx - Transmission

Contents

1 Introduction
1.1 Background . . . .
1.2 Motivation . . . .
1.3 Research questions
1.4 Limitations . . . .
1.5 Outline . . . . . .

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

1
1
2
2
3
3

2 Bluetooth Technology
2.1 Classic Bluetooth . . . . . . . . . . . . . .
2.1.1 Discovery and pairing . . . . . . .
2.1.2 Bluetooth range . . . . . . . . . .
2.2 Bluetooth smart . . . . . . . . . . . . . .
2.2.1 Bluetooth smart stack . . . . . . .
2.2.2 Bluetooth smart modes . . . . . .
2.2.3 Discovery and pairing . . . . . . .
2.2.4 Bluetooth smart range . . . . . . .
2.3 Signal parameters . . . . . . . . . . . . . .
2.3.1 Received signal strength indicator
2.3.2 Link quality . . . . . . . . . . . . .
2.3.3 Transmitted power level . . . . . .
2.3.4 Inquiry response rate . . . . . . . .
2.3.5 Parameters in Bluetooth smart . .

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.

5
5
6
6
7
7
8
9
9
10
10
11
11
12
12

.
.
.
.
.
.

13
13
14
14
15
16
16

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

.
.
.
.
.

3 Positioning Techniques
3.1 Trilateration using RSSI . . . . . . .
3.2 Filter technology . . . . . . . . . . .
3.2.1 Particle filter for positioning
3.3 Fingerprinting . . . . . . . . . . . . .
3.4 Cell based positioning . . . . . . . .
3.5 Triangulation . . . . . . . . . . . . .
i

.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

CONTENTS

3.6

Time of flight . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18

4 Theory
4.1 Trilateration . . . . . . . . . . . . . . . . . . . .
4.1.1 Positioning using RSSI and Triangulation
4.1.2 Wi-Fi and Trilateration positioning . . . .
4.2 Particle filters . . . . . . . . . . . . . . . . . . . .
4.2.1 Robot indoor localization . . . . . . . . .
4.2.2 Bayesian Filtering Positioning . . . . . . .
4.3 Fingerprinting . . . . . . . . . . . . . . . . . . . .
4.3.1 Fingerprinting localization for ZigBee . .
4.3.2 Bayesian Fusion Using Fingerprints . . . .
4.4 Cell based positioning . . . . . . . . . . . . . . .
4.4.1 Low-latency cell based positioning . . . .
4.5 Triangulation . . . . . . . . . . . . . . . . . . . .
4.5.1 Ad Hoc Positioning System Using AOA .
4.6 Signal Parameters . . . . . . . . . . . . . . . . .
4.6.1 The reliability of RSSI . . . . . . . . . . .
4.6.2 Inquiry response rate fingerprinting . . .
4.7 Commercial systems . . . . . . . . . . . . . . . .
4.7.1 iBeacon . . . . . . . . . . . . . . . . . . .
4.7.2 Estimote . . . . . . . . . . . . . . . . . .
4.7.3 SenionBeacon . . . . . . . . . . . . . . . .
4.7.4 indoo.rs . . . . . . . . . . . . . . . . . . .
4.7.5 Quuppa-HAIP . . . . . . . . . . . . . . .
4.7.6 Insiteo . . . . . . . . . . . . . . . . . . . .
4.8 Justifying choices . . . . . . . . . . . . . . . . . .

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

19
19
19
20
21
21
23
24
24
25
26
26
27
27
28
28
29
29
30
30
31
31
31
32
32

.
.
.
.
.
.
.
.
.
.

34
34
35
36
36
38
39
39
41
42
42

6 Positioning results
6.1 System results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
6.2 Small area Scenario . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
6.3 Large area scenario . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

47
47
47
49

5 Testbed
5.1 Evaluation criteria . . . . . . . .
5.2 Test environment . . . . . . . . .
5.3 Testbed setup . . . . . . . . . . .
5.3.1 Hardware . . . . . . . . .
5.3.2 Software . . . . . . . . . .
5.4 Positioning algorithms . . . . . .
5.4.1 Trilateration algorithm . .
5.4.2 Iterative trilateration . . .
5.4.3 Particle filter algorithm .
5.4.4 Fingerprinting algorithm .

.
.
.
.
.
.
.
.
.
.

ii

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

CONTENTS

6.4

Characterization results . . . . . . .
6.4.1 Accuracy . . . . . . . . . . .
6.4.2 Calibration complexity . . . .
6.4.3 Scalability . . . . . . . . . . .
6.4.4 Liveliness and response time
6.4.5 Robustness and adaptability

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

51
52
52
53
54
55

7 RSSI analysis
7.1 RSSI characteristics for Bluetooth smart
7.2 Static RSSI measurement . . . . . . . .
7.3 RSSI vs Distance in Bluetooth smart . .
7.4 RSSI vs angle . . . . . . . . . . . . . . .
7.5 RSSI variance over distance . . . . . . .
7.6 RSSI conclusions . . . . . . . . . . . . .

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

.
.
.
.
.
.

57
57
58
59
64
68
68

.
.
.
.
.
.
.
.
.
.

70
70
70
72
73
74
74
75
76
77
77

8 Discussion
8.1 Advantages and disadvantages . . . . .
8.1.1 Advantages . . . . . . . . . . . .
8.1.2 Disadvantages . . . . . . . . . .
8.2 Suggested improvements . . . . . . . . .
8.2.1 Machine learning/self adjustment
8.2.2 Additional data sources . . . . .
8.2.3 Hybrid solution . . . . . . . . . .
8.2.4 Hardware considerations . . . . .
8.3 Proximity applications . . . . . . . . . .
8.4 Privacy aspects of positioning . . . . . .

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.
.

9 Conclusion and future work
79
9.1 Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79
9.2 Future work . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 80
Bibliography

84

iii

1
Introduction
1.1

Background

Since the introduction of GPS technology, services that rely on positioning and localization data have emerged in a rapid pace. Today positioning technologies are used in
a variety of areas such as providing driving directions, recording running routes during
training and tracking valuable goods in real-time to name a few. While GPS has become a de facto standard for outdoor positioning applications, no similar widespread
technique is present for indoor positioning or in areas where GPS is not available. The
topic of indoor positioning does not lack research: Several approaches and suggestions
based on different technologies have been developed and introduced over the last two
decades. What is common for all of them is that no approach has made any big impact
within the area. A number of systems have been commercialized, produced and installed
in different quantities but none of these have yet made a big penetration into society.
The systems are usually proprietary and used in very small scale installations based on
requirements of the specific use case, resulting in that no common universal standard
such as GPS exists in the area of indoor positioning.
One proposed radio frequency-based (RF) technique for indoor positioning is to use
Bluetooth technology and provide positioning based on signal strength parameters that
can be easily obtained. A major advantage of using Bluetooth is that it is a technology
with high penetration in society. Devices such as cellphones, tablets and computers normally come equipped with the technology as standard. The large penetration rate also
means that the required hardware is produced in large quantities, resulting in a very low
unit cost. A Bluetooth chip combined with a microcontroller is typically available for
less than 5$. Research on positioning based on Bluetooth has also made some progress
in the past years, possibly making it a viable candidate for large scale deployment in
several scenarios and applications.

1

1.2. MOTIVATION

CHAPTER 1. INTRODUCTION

In June 2010, the specification for the Bluetooth 4.0 technology was released[1]. This
specification introduced a new technology, named ”Bluetooth low energy”(BLE) or ”Bluetooth smart”. The new technology contains some major differences compared to traditional Bluetooth. A variety of new services and roles are introduced, the RF-band usage
is changed, a new software stack is introduced and as can be guessed from the name,
power consumption is greatly reduced to between 50-99% of the classic Bluetooth power
consumption[2]. A Bluetooth smart device could potentially operate for years powered
by a single coin cell battery.

1.2

Motivation

Indoor positioning based on traditional Bluetooth has been both carefully evaluated and
improved. However according to the best of our knowledge, no academic work can be
found which characterises and evaluates Bluetooth low energy in a positioning setting.
Meanwhile, commercial systems using the technology are rapidly emerging on the market
promising different performance and properties. The technology and algorithms behind
the commercial systems are often vaguely described and kept secret due to competition.
This project thoroughly evaluates and investigates the properties of Bluetooth smart
and describes its suitability and applicability for providing inexpensive widely available
indoor positioning. The project is based upon related theory about RF based positioning
techniques and systems. The relevant techniques and approaches are evaluated within
a Bluetooth smart setting in a testbed scenario set up to imitate a real world practical
scenario. The collected results are carefully investigated, analyzed and explained with
regard to properties of the Bluetooth smart technology. In addition the project provides
ideas and pointers for future work within the area.

1.3

Research questions

Based on the motivation above, the following questions have been established for describing what the project depicts:
• When is Bluetooth smart a viable choice for indoor positioning systems?
• What algorithms/technologies are best suited for indoor positioning based on Bluetooth smart with requirements on the following properties:
– accuracy
– ease of use/ease of installation
– scalability
– response time
– robustness
2

1.4. LIMITATIONS

CHAPTER 1. INTRODUCTION

• Does using Bluetooth smart for indoor positioning achieve more or less benefits
compared to related existing systems based on Wi-Fi or Bluetooth technology?
Examples of benefits could be performance increase of the aforementioned properties.
• Does using Bluetooth smart for indoor positioning introduce more limitations compared to related existing systems based on Wi-Fi or Bluetooth Technology? Examples of limitations could be performance decrease of the aforementioned properties.
• What level of accuracy and precision can be expected from a positioning system
relying on Bluetooth smart technology?

1.4

Limitations

The project has a number of limitations on the depth of the evaluation and analysis.
The project does not provide an extensive analysis of antenna design or antenna characteristics. The basic antenna properties of the testbed system are briefly mentioned but
no extensive investigation nor evaluation is performed. The evaluation of positioning
is limited to a 2-dimensional setting considering x and y-axes for coordinates in space.
Meaning that multi-storey applications requiring a z-axis to describe the height of an
object is not considered. The evaluations are performed in a static setting where environment and objects do not change position or setting during measurements. The
measurements are performed in ”real life” scenarios with furniture, competing RF technologies and other sources of obstacles or interference present. The evaluation does
however not take people into account in the scenario. This means that a human body
will never be in the way of a measurements during the evaluation, although this would
most likely be the case in an actual real life scenario. Furthermore, no power measurements or evaluation have been performed to investigate the improvement in the power
consumption. All mentioned statements regarding power consumption efficiency have
been found in related material covering the Bluetooth smart technology.

1.5

Outline

The rest of the report is structured in the following manner:
• Chapter 2 Bluetooth Technology: This chapter is allocated to give an overview
of Bluetooth technology, Bluetooth smart technology, and applicable Bluetooth
signal parameters suitable and unsuitable for use in RF-based positioning systems.
• Chapter 3 Positioning techniques: Presents and explains the most commonly
used approaches and techniques for indoor positioning.
• Chapter 4 Theory: Describes related work and literature on indoor positioning
and does also present information regarding related commercial systems.
3

1.5. OUTLINE

CHAPTER 1. INTRODUCTION

• Chapter 5 Testbed: This chapter describes the evaluation criteria used for positioning experiments, the test environment, and the hardware and software with
which the testbed is implemented.
• Chapter 6 Positioning results: Presents results from the positioning system
evaluation described in Chapter 5
• Chapter 7 RSSI analysis: Describes an investigation of the underlying RSSI
parameter and how it is affected by distance, angle and environmental properties.
• Chapter 8 Discussion: This chapter contains a discussion about the obtained
results, and what effect they would have on an indoor positioning system.
• Chapter 9 Conclusion and future work: Presents the conclusion of the evaluation and also provides pointers and advice for future work within the area.

4

2
Bluetooth Technology
2.1

Classic Bluetooth

Bluetooth is a wireless technology allowing electronic devices to perform short range
wireless communication between each other. The technology operates between 2400 to
2485 MHz divided into different channels. The specified frequencies lie within the globally unlicensed ”Industrial Scientific and Medical”(ISM) 2.4GHz band. Traditionally 79
different channels have existed with 1 MHz spacing, but the specification for Bluetooth
smart introduces the use of 40 channels with 2MHz spacing instead[3]. While the ISM
frequency band is unlicensed, the usage and development of Bluetooth technology are
regulated by the Bluetooth special interest group, or Bluetooth SIG. The group, which
has over 20 000 member companies is responsible for defining the Bluetooth specification
as well as to certify that developed products conforms to these specified standards. The
latest specification is currently at version 4.1 (Released December 3, 2013). Previously
adopted specifications can be found in[4].
The specification defines a set of protocols and properties that devices may use to communicate. Some are mandatory and producers of Bluetooth technology enabled equipment
or software must support them, while other properties are optional and manufacturers
may freely choose if they want to implement them in their products. On top of the Bluetooth technology protocols, different application specific profiles are implemented. The
profiles are standardized and described with requirements in the Bluetooth specification.
A few examples of defined and commonly used profiles are:
• Advanced Audio Distribution Profile(A2DP): A2DP profile defines how audio streaming is performed between two devices, for example playing MP3 files
from a cellphone in a wireless Bluetooth enabled headset.
• Phone Book Access Profile(PBAP): This profile defines how contact infor5

2.1. CLASSIC BLUETOOTH

CHAPTER 2. BLUETOOTH TECHNOLOGY

mation are transferred from one device to another. Examples include transferring
phone-book contacts between a cellphone and an infotainment system in a car.
• A/V Remote Control Profile(AVRCP): Defines a profile to remotely control
audio and video devices, for example sending and receiving commands such as play,
pause, fast-forward, next track etc.
All profiles defined in the Bluetooth specification are listed in[4].

2.1.1

Discovery and pairing

For two devices to be able to communicate a pairing is necessary to set up a bond
between them. In the Bluetooth technology, two device modes are supported: Slave or
master. A device in master role can potentially support up to 7 simultaneous connections
with different slaves, although supporting that many connections is not a mandatory
requirement. Before a connection is established, devices must discover each other and
specify what profiles are to be used. Devices typically only support a small subset
of all available profiles in the specification. To initiate a pairing, a master device will
continuously broadcast ”inquiry messages” which will be picked up by nearby devices that
allow connections to be established. The devices that allow a connection to be made
are named ”discoverable” and they will answer to any inquiry message with a response
message containing their name, what profiles they support as well as other technical
information. With this information the master device can continue and initiate a pairing
and establish the desired profiles. In addition connected devices can potentially change
their roles from master to slave and vice versa upon agreement.

2.1.2

Bluetooth range

Bluetooth was designed to be used in short-range applications typically reaching a few
meters. The effective range that can be practically achieved depends on several factors,
for instance parameters such as propagation, interference, attenuation, signal reflection,
antenna characteristics, transmit power, fading and obstacles. Bluetooth devices are
divided into three different classes which specify their maximum allowed output power
which in turn significantly affect the range. The different classes, power limits and
theoretical ranges are listed in Table 2.1[5].
Class

Max range

Max Transmitter output power

Class 1

100 m (300 ft)

100 mW (20 dBm).

Class 2

10 m (33 ft)

2.5 mW (4 dBm).

Class 3

1 m (3 ft)

1 mW (0 dBm).

Table 2.1: Ranges and output power of different Bluetooth classes

6

2.2. BLUETOOTH SMART

2.2

CHAPTER 2. BLUETOOTH TECHNOLOGY

Bluetooth smart

In June 2010 the specification for Bluetooth 4.0 was released. The specification did not
only introduce improvements to the already well established Bluetooth technology, it also
introduced a completely new technology: Bluetooth low energy or ”Bluetooth smart”.
This new standard is not backwards compatible with the classic Bluetooth and introduces
an entirely new stack. The new standard was introduced to facilitate communication
within a short range for devices that do not require large amount of data transfer.
Instead the main idea was to provide an efficient technology for monitoring and control
applications where data amounts are typically very low: such as sending sensor values
or control commands.

2.2.1

Bluetooth smart stack

The Bluetooth smart stack is as mentioned in the previous paragraph entirely new and
is not compatible with the traditional Bluetooth stack. It is however common that new
Bluetooth enabled devices support both the traditional Bluetooth as well as Bluetooth
smart. These are commonly referred to as ”Dual mode” or ”smart ready” devices[6]. The
Bluetooth smart stack does inherit a number of characteristics from its predecessor: The
stack is composed of two parts, the host and the controller. The controller represents
the physical layer and the link layer. It is typically a small chip with a radio, which is
quite commonly implemented in a System-on-chip(SOC) solution[7]. The host consists
of the the upper layer protocols and software and runs the following services:
• Logical link control and Adaption protocol(L2CAP): The L2CAP layer is
responsible for multiplexing data between the higher Host layers and the lower
Control link layer. It has similarities with the L2CAP protocol used in traditional Bluetooth but has been optimized and streamlined for Bluetooth smart.
The Bluetooth smart-L2CAP protocol works in a best-effort manner providing no
retransmission or flow control as opposed to traditional Bluetooth. Furthermore it
does not provide segmentation or reassembly since in Bluetooth smart, the higher
layers are required to only send packets with sizes that fit into the L2CAP maximum payload size.
• Attribute protocol(ATT): The ATT protocol is used to send attributes between
two devices communicating with each other. An attribute can be described as a
sort of data-structure which GATT profiles use to send and receive data.
• Security manager protocol(SMP): The SMP protocol handles key exchange
and encryption tasks when links are set up. The procedure to establish a connection
is done in a number of steps that require several key exchanges to take place.
• Generic attribute profile(GATT): GATT is a framework that describes different services and profiles. The profiles are standardized by Bluetooth-SIG and
provides specifications for data formatting when communicating with the application layer. Each GATT-profile is designed for a specific functionality. Some
7

2.2. BLUETOOTH SMART

CHAPTER 2. BLUETOOTH TECHNOLOGY

examples of profiles adopted by Bluetooth-SIG are Glucose profile, Heart Rate
profile and Proximity profile. A full list of adopted profiled is listed in[4]. The
GATT profiles use attribute/value pairs which are predefined for each profile. The
attributes are then handled by the ATT protocol.
• Generic access protocol(GAP): Defines procedures used for pairing and linking
with other devices. The procedures are generic and the application layer can then
implement different Bluetooth smart modes, see Paragraph 2.2.2.
An illustration of the entire Bluetooth smart stack is presented in Figure 2.1. The
communication between the host and the controller is similarly to classic Bluetooth
performed by a standardized host controller interface (HCI) protocol.

Figure 2.1: Block diagram picturing the Bluetooth smart stack

2.2.2

Bluetooth smart modes

A new addition in the Bluetooth smart stack compared to traditional Bluetooth is the
support for a completely new mode. When using Bluetooth smart for certain applications it is no longer necessary to do a pairing to be able to exchange data. Instead, a
”broadcast” mode is supported where data can be sent in the advertisement channels
without establishing a connection. In Bluetooth smart a total of 4 different modes are
supported: Central, Peripheral, Broadcaster and Observer. A complementary mode to
the already mentioned Broadcaster role is the Observer role that receives the data that
the Broadcaster transmits. The Central role which is similar to the traditional Bluetooth
master role is designed for more sophisticated devices which initiate and manage several
8

2.2. BLUETOOTH SMART

CHAPTER 2. BLUETOOTH TECHNOLOGY

connections. The Bluetooth smart specification states that a Central role device may
support up to infinite simultaneous connections against different peripheral devices. This
is an improvement of the specification compared to traditional Bluetooth which supports
maximum 7 connections. Although in reality, typically only a small number of simultaneous connections are supported. A peripheral device is typically a simple device that
can only handle one active connection at a time against some central device. The peripheral and central device roles mean that the Bluetooth smart controller must provide
support for both master and slave roles. Although a specific device does not have to
support both of them. The different roles allow segmentation of the stack which allows
for small lightweight devices to be created, which could for example only support the
peripheral role. A device may support a single, several or all of the specified roles, but
only one can be active at a time.

2.2.3

Discovery and pairing

The Bluetooth smart specification defines two different approaches to perform discovery
of connectable nodes: active and passive scanning. In passive scanning, a central device
passively listens on the advertisement channels to capture advertisement PDU packets
transmitted by connectable devices. In active scanning, the central device similarly to
passive scanning listens for advertisement PDU packets. When receiving a PDU packet,
the device may examine what modes the advertising device supports. If the PDU packet
indicates that the device is connectable or scannable, it may send a scan request packet
to the device asking for more information. In Bluetooth smart, three dedicated advertisement channels have been defined. 37, 38, and 39 [8], which have been specifically
allocated in the frequency spectrum to minimize collision with the most commonly used
Wi-Fi channels 1, 6 and 11. This change in advertisement behaviour means that discovery of devices may complete much faster since it is no longer necessary to scan the entire
frequency spectrum. In addition to this improvement, The Bluetooth smart technology
also allows to define how frequently advertisement is set to take place. Devices may advertise as seldom as once every 10 seconds or as fast as every 20 millisecond. This means
that the time it takes to discover a device is related to the advertisement interval. A
complete overview of the Bluetooth smart frequencies and channels is presented in Figure 2.2. Similarly to traditional Bluetooth, an adaptive frequency hopping mechanism
is used to counter interference and fading. A Gaussian frequency shift keying(GFSK)
modulation is used to select which data channels are to be utilized.

2.2.4

Bluetooth smart range

The range of Bluetooth smart is similarly to traditional Bluetooth dependent on transmit
power as well as different interference and obstacles in the environment. Although Bluetooth smart was primarily designed for low energy usage, transmit power up to +10dBm
is supported. Typically Bluetooth smart devices operate on 0dB or less resulting in a
peak current consumption of <15mA. Using the maximum +10dBm transmitting power
gives a theoretical range of >300m, while the more commonly used 0dBm transmit power
9

2.3. SIGNAL PARAMETERS

CHAPTER 2. BLUETOOTH TECHNOLOGY

Figure 2.2: Overview of Bluetooth smart channel spectrum

gives a theoretical range of about 50m[9]. The effect of this power classification actually
means that, despite its name claiming ”low-energy” consumption, Bluetooth smart has a
longer effective range than traditional Bluetooth in the maximal power mode[10]. This
is mainly explained by the simpler modulation scheme used by the radio combined with
a more restricted packet size.

2.3

Signal parameters

In order to perform RF-based positioning, some form of characteristic is required for
providing reference values. This section presents the various signal parameters available
within classic Bluetooth and/or Bluetooth smart technology. Other applicable technologies to perform indoor positioning are discussed in Chapter 3.

2.3.1

Received signal strength indicator

The received signal strength indicator(RSSI) is an indication of the signal strength experienced by the receiver of a Bluetooth PDU. The value is a signed 8-bit integer value
which for Bluetooth smart varies between -127 to 20dBm, where an increasing value
indicates a stronger signal. The value can be retrieved both while scanning for devices
as well as during an active connection with another device. An important difference between classic Bluetooth and Bluetooth smart related to this parameter is how the RSSI
can be obtained. In classic Bluetooth two different variants was possible. The very early
versions of Bluetooth only allowed to retrieve the parameter during an active connection
between two devices. Later specifications(1.2 and later) allowed to retrieve the param-

10

2.3. SIGNAL PARAMETERS

CHAPTER 2. BLUETOOTH TECHNOLOGY

eter during inquiries, e.g without establishing a connection beforehand. In Bluetooth
smart this is further improved by providing RSSI also when passively receiving advertisements. The possibility to retrieve it during an active connection is still preserved.
To convert RSSI to distance, several algorithms have been proposed. Where almost all
of them rely on the fact that some reference value is known beforehand, examples of this
could be Tx-power level of the transmitter or measured RSSI at a fixed known distance.

2.3.2

Link quality

Link quality(LQ) is a parameter that is available in traditional Bluetooth when a connection between two devices is active. The parameter is an bit unsigned integer which is most
commonly related to the average bit error rate (BER). The parameter spans the entire
space of the integer and thus varies between 0 to 255 where a higher number corresponds
to a better link. The value is updated continuously as packets are received, meaning
that the parameter is available at the receiving end. In practice, this means that both
ends will have access to it since communication usually goes both ways. There is however no guarantee that both ends experience the same LQ. The Bluetooth specification
documents do not specify how the BER is mapped to a LQ-value, the implementation
of this is defined as vendor specific.

2.3.3

Transmitted power level

Class 1 Bluetooth devices with a maximum power level of +20dBm provide the foundation for yet another possible parameter to link against distance called Transmitted
power level(TPL). The Bluetooth specification mandates that devices with Tx power
between +4 to +20 dBm compulsorily have to perform power control. The reason for
this is twofold, partly the power control is used to conserve energy when the transmitter
is capable of using high power for radio output. Partly the power control is used to
mitigate interference. Similar to RSSI, TPL is represented by an 8-bit signed integer.
The TPL is measured in dBm and will as a result have a maximum value of +20dBm.
The minimum value is not defined, rather it is vendor specific. However, the Bluetooth
specification does advice that class 1 devices use power control even for values below
-30dBm [11].
The core of this TPL variable is thus that Bluetooth chips with high output power
scale down the Tx effect to save power when the link is good. Example of such a case
could be when the communicating devices are close to each other-when the distance later
grows the device will increase its TPL to compensate. Based on this, it could be possible
to derive a distance metric. A factor that negatively impacts the precision of TPL as parameter is that it has different step sizes for adjustment between 2 to 8 dBm. This means
that if a device performs power control between +20 to -60 dBm and has a step size of
4, only 20 unique identifiers will be available for mapping to a distance((60+20)/4).

11

2.3. SIGNAL PARAMETERS

2.3.4

CHAPTER 2. BLUETOOTH TECHNOLOGY

Inquiry response rate

A suggested parameter for performing indoor positioning based on Bluetooth is the Inquiry response rate(IRR)[12]. The parameter is not something defined by the Bluetoothspecification or received in Bluetooth messages. Instead the suggestion is to use the
characteristic of Bluetooth where inquiries are made to discover nearby devices. The
nearby devices, which are set to discoverable mode will respond to such a request with
an inquiry response message. The idea is that, in each location the inquiring device
will receive responses from different nodes and also receive different number of responses
from each node. Together these two parameters form an attribute that should possibly
be unique for each position in the area where positioning is to be deployed. A positioning
system employing this methodology is described in more detail in Paragraph 4.6.2.

2.3.5

Parameters in Bluetooth smart

In this section a number of signal parameters that could serve as potential candidates
for a positioning system were described. The listed parameters are mainly based on traditional Bluetooth since no studies of Bluetooth smart in the context of positioning exist
to this date. When it comes to Bluetooth smart, the choices immediately become more
limited since the protocols and stack have changed significantly. In Bluetooth smart it is
still possible to set up a connection between devices but this active connection is different from a traditional Bluetooth connection. While in classic Bluetooth the connection
is always up and connected, in Bluetooth smart the taken approach is to put devices
in sleep or passive mode whenever possible. The master device has control of how and
when the slave is allowed to transmit. This means that neither LQ or TPL are normally available parameters. LQ is not defined for Bluetooth smart and will thus never
be available for a positioning system based on the technology. TPL is not necessarily
available either, instead it is quite common that devices use a fixed Tx power level. It is
however still possible for a user application to perform TPL if it is desirable. Bluetooth
smart hardware will typically support reprogramming the Tx power during operation,
resulting in the possibility for users to implement a TPL mechanism manually if needed.
A good parameter to decide on what power level to use is however required.
RSSI is still available and easily accessible in Bluetooth smart, both during a connection
as well as when receiving broadcasts or performing scanning. It is also the parameter
within Bluetooth that has received the most attention and consensus to be the one best
suited for positioning applications even though it is not optimal. Especially in more recent research where inquiry RSSI is available[13]. The connection based RSSI in classic
Bluetooth proved to be an unfavourable parameter[11] since power control mechanisms
adjusted Tx power during active connections, causing the value to almost always return
the value 0 dBm. Since the devices aimed to always stay within an optimal power range
called ”Golden Receiver Power Range”(GRPR)[14]. This is however a factor no longer
used for Bluetooth Smart, here the GRPR is not used and RSSI will reflect the power
that the receiver experiences without interference from power adjustments.
12

3
Positioning Techniques
In this chapter, the most commonly used algorithms and approaches for indoor positioning systems are presented and reviewed. RF-based positioning techniques can roughly
be divided into six approaches, trilateration, filter based technologies, fingerprinting, cell
based positioning, triangulation and Time of flight(TOF). In trilateration, distances to
at least three beacon nodes have to be obtained in order to estimate a position. In filter
based technologies, multiple positions are generated continuously and filtered based on
observations from different inputs to the system. In fingerprinting, a map is divided into
a grid and different attributes are associated with each grid-cell. In cell based positioning, a specific sub-set of beacon nodes is discoverable in each interesting area segment
of the environment. The triangulation approach is based on getting angles to or from
some known references and use them to calculate a position. TOF is used for measuring
the time a signal takes for travelling to or from a reference point to the device being
positioned and the distance is estimated accordingly. Similar to trilateration, at least
three reference points are needed. All of these techniques are explained in an easy to
understand fashion in this chapter.

3.1

Trilateration using RSSI

Trilateration is one of the most old and renown methods used in determining or estimating locations. It requires measurements of distances between the object for which
a position is to be determined and a minimum of three reference points. The three or
more reference points are considered as centers of three/several circles and the distances
are treated as radii of these circles. The relative or absolute position then becomes the
intersection point between these circles. As a result, an overdetermined system of at
least three circle equations and two common unknown values (x, y) is obtained. Thus,
least square approach is employed to estimate the position of least squared error.

13

3.2. FILTER TECHNOLOGY

CHAPTER 3. POSITIONING TECHNIQUES

In the context of wireless based positioning, the first step toward positioning is to measure distances to at least three known reference positions. In most positioning systems
these reference points are made up of beacon nodes or access points. The distances can
be estimated based on conversion of wireless signal parameters. Popular examples of
such a parameter are RSSI or TOF. These measurements combined with knowledge of
the beacons coordinates can form the basis for trilateration.

3.2

Filter technology

Filter based technologies are a mathematical methods used for predicting or estimating
a hidden or unknown variable given some observations from the system known as observable variables. The hidden variable in the context of positioning is the position of
the mobile node, while the observable variables for example can consist of: Measured
distances to references, previously estimated position, sensor inputs such as compass or
gyroscope and reference data such as orientation or movement. While the approach is
not a concept dedicated to positioning, but rather used in a great variety of applications,
it is very well suited for usage in positioning applications. The really useful property of
the method is that it has the ability to fuse together several different data sources as
input to estimate the hidden variable for output. A good example of this is presented in
[15], An approach relying on an ultrasound positioning system combined with odometry
readings achieves great accuracy and tracking abilities by combining data from both
observable reference systems.
Several different mathematical concepts implementing filters exist where the two most
commonly used are Kalman filter[16] and Monte Carlo filter[17], which is usually referred
to as just ”particle filter”. In this report the emphasis is put on particle filters mainly
because its advantage of being simpler to implement, it also has other advantages not
directly specific to this work such as ability to represent multi-modal distributions and
reduction of memory usage requirements compared to grid based approaches[14].

3.2.1

Particle filter for positioning

Within particle filters, thousands of particles are randomly and continuously generated
during runtime, which in the context of indoor positioning are representations of positions. Thus, the distances or differences to each of the reference beacons or reference
values/data can be calculated. Based on the observable variables, the particles that are
unlikely to represent the current position are filtered out while particles likely to be true
representations of the position are selected for calculating the estimation. The filtering
process is achieved by giving weights to all particles based on how reasonable the particles values are taking observable variables into account. Gradually, most of the particles
will assume negligible weights and will thus no longer contribute to the estimation, while
few particles will have significant weights and contribute largely in the system. To mitigate this problem, the particles with high weight are resampled while those of negligible

14

3.3. FINGERPRINTING

CHAPTER 3. POSITIONING TECHNIQUES

weights are not. Meaning that probable particles are duplicated while unlikely particles
are removed from the system.
At initiation, no observed data is available and the first generated particles will as a
consequence often be uniformly randomly distributed all over the map. Later, particles are generated based on the weights of earlier particles by duplicating those of high
weights only. When the number of different particles decreases significantly, new particles are generated as in the first sampling step. Formally speaking, the objective of a
Particle filter is to compute the density of the posterior as p(xk |z1:k ). It means, computing the position xk = [x y θ]T at time t, given the estimated positions z1:k at times prior
to t. This is done recursively in two steps: position prediction and position updating.
In the position prediction step, if the previous estimation p(xk−1 |z1:k−1 )is available, the
current prediction can be calculated as in equation (3.1) and (3.2)
Z
p(xk |z1:k−1 ) = p(xk |xk−1 ,z1:k−1 )p(xk−1 |z1:k−1 )dxk−1
(3.1)

If a Markov model of order one is assumed, then p(xk |xk−1 ,z1:k−1 ) = p(xk |xk−1 ), and
the equation (3.1) becomes (3.2)
Z
p(xk |z1:k−1 ) = p(xk |xk−1 )p(xk−1 |z1:k−1 )dxk−1
(3.2)

The predicted position is the probability density function or the current likelihood of the
particle xk including the coordinates and the orientation, given the previous estimated
position, its orientation, and the previous trilaterated position(assuming distances to
reference nodes are used).
While in the position update step, the position is updated to be available for use in
the estimation of next iteration. This is done based on equation (3.3)
p(xk |z1:k ) =

1
p(zk |xk )p(xk |zk−1 )
η

(3.3)

Where η = p(zk |z1:k−1 ) is a normalizing constant.

3.3

Fingerprinting

This approach is performed by dividing a map into segments or grids. The approach
consists of two phases. At first, a training phase or ”offline phase” is performed to associate each segment or grid cell in the map with some unique attributes to break the
symmetry among them. In the context of wireless positioning, these attributes can be
signal parameters, such as RSSI, IRR or LQ. In this phase, attributes are measured and
15

3.4. CELL BASED POSITIONING

CHAPTER 3. POSITIONING TECHNIQUES

assigned to each segment or grid cell. For example, if RSSI is used as an attribute, An
average of RSSI values per beacon node is computed in each segment. Each fingerprint
then consists of several RSSI averages and the position of the map segment or the grid
cell that the fingerprint belongs to. In this way, a fingerprint database is constructed.
In stage two, an online phase is carried out where the actual position estimation is
performed. Within which, a mobile node tries to determine its position based on the
database values. Every time a mobile node wants to find its position, it collects measurements of the same kind of attributes stored in the offline phase and compare them
against the values that are stored in the database. For example, in case when the RSSI
parameter is used as attribute, the mobile node collects RSSI values from all the beacon
nodes in its range and compares them to the fingerprints that are stored in the database.
The position in question will be the one that is associated with the fingerprint of the
best match or the geometric median of the positions of the K-closest n fingerprints.

3.4

Cell based positioning

Similar to the previous approach, this method consists of two phases, a training phase
and an online phase. The beacon nodes are deployed in a way that makes each segment
of the map covered by a different set of beacon nodes. In the training phase, the beacon
nodes that cover each segment are registered and associated with it in a database. While
in the online phase, the mobile node scans for any beacon node in range and stores the
identifications of the discovered beacons. The discovered set is compared to other sets
stored in the database and the best match is selected. In this approach, signal parameters can be utilized to break the symmetry among several segments that are covered by
the same set of nodes. As an example, if two segments are covered by the same beacon
nodes but with different signal strengths, the symmetry between these segments can be
broken based on the signal strength.
The database search can be optimized by setting up some roles and conditions. For
instance, if the coverage area of a beacon node is known to be within a bigger coverage
area of another beacon node, then both nodes must be in the discovered set given that
the first beacon is discoverable. On the other hand, if it is known for two beacon nodes
that their coverage areas do not intersect, then they cannot be in the same discovered
set. Thus, having this information about the network and the discovered set, the search
can be optimized.

3.5

Triangulation

Another approach of positioning estimation is determining the position of an object or
a mobile node based on the angle of arrival(AOA) of wireless signals. There are several
methods of determining AOA by a receiving node, for instance, by equipping the nodes

16

3.5. TRIANGULATION

CHAPTER 3. POSITIONING TECHNIQUES

with a directional antenna, an antenna array, a compass model, or two ultrasound receivers. Measuring the angle of arrival at the receiver requires that the receiver has to be
aware of a reference axis, against which, the angle of an estimated straight line passing
through the sender and the receiver is measured.
Assuming that the angles of two incoming signals from two beacons of known positions can be determined, the position can be calculated by some mathematical effort.
The simplest way of calculating a position in two dimensional environment is as follows:
after determining the angle of arrival from two beacons of known positions (x1 ,y1 ) and
(x2 ,y2 ), the position (x,y)can be solved by Equations 3.4 and 3.5, where θ1 and θ2 are
the angles of arrival from beacons 1 and 2 respectively [18].
y − y1
x − x1
y − y2
tan(θ2 ) =
x − x2

(3.4)

yi − xi tan(θi ) = y − x tan(θi )

(3.5)

tan(θ1 ) =

Another triangulation method involves three beacon nodes, which are assumed as vertices of a triangle. Knowing the positions of the three beacon nodes and the angles of
arrival of their signals at a mobile node located inside the triangle, the mobile node
can determine its position. In comparison to trilateration, triangulation measures angle
of arrival of beacon node’s signals instead of measuring distances to the beacon nodes.
After knowing the beacon node’s position and measuring the angle of arrival of the received signals at the mobile node, what remains is to calculate the position. The position
can be determined as the intersection point of three circles where each of them passes
through a pair of adjacent beacon nodes and the mobile node. Least square error is
also an effective tool in this kind of triangulation since in most cases angle of arrival
measurements are not exact.
Triangulation can be reduced to trilateration in the following manner: For any pair
of adjacent beacons of the three beacons that form the triangle, the angle of intersection
at an interior node that is formed by two lines where each of them passes through a
node of the adjacent nodes can be calculated based on the angles of arrival at the interior node. Then, the position of the interior node can be determined somewhere on a
circle that passes though the two adjacent beacons and the interior node. Given that the
positions of the beacons are known, the circle’s center can be determined. Finally, the
distance between the interior node and the center node can be calculated and utilized in
trilateration. Thus, three distances and beacon positions are calculated, which is exactly
what is required for executing the trilateration method[19].
To make triangulation applicable in indoor localization where RF-technologies such as
17

3.6. TIME OF FLIGHT

CHAPTER 3. POSITIONING TECHNIQUES

Wi-Fi or Bluetooth are used, customizing the hardware, or more specifically the antenna
is necessary. It is important to mention that LOS between the mobile node and each of
the respective beacons against which angle of arrival is to be calculated is necessary. By
using a compass, angle of arrival can be calculated more accurately since the orientation
of a mobile node can be determined.

3.6

Time of flight

This approach utilizes the propagation time of electromagnetic signals between two
nodes. TOF works by estimating the distance between two nodes by counting the time
required for a signal to travel from a node to the other. The travel time is the difference
between the time when the signal is sent and the time when the signal arrives. Having
in mind that RF-signal speed is close to the speed of light in vacuum( 29.98cm/ns), the
distance can be calculated as the speed and travel time are known/can be determined.
Using this approach in a Time of Arrival fashion requires synchronizing the transmitter’s and receiver’s clocks with very high precision since each nanosecond difference will
introduce an error of 0.3m.
If Time Difference of Arrival(TDOA) is used, two transmitters sends their signals to
a receiver that wants to determine its position. Clock synchronization between the
transmitters and the receiver is not required. Instead, the clocks of the transmitters
have to be synchronized as tight as possible and for as long as possible[18]. Another way
of using TDOA is by having the node that wants to calculate its position as the transmitter and the beacons as receivers. Also in the latter case, the receivers (beacons) need
their clocks to be synchronized. After calculating the distances to at least three beacons,
this approach can be followed by the trilateration method to determine a position.

18

4
Theory
In order to evaluate Bluetooth smart as a solution for indoor localization, several academic reports, scientific papers, and articles that focus on indoor positioning using WiFi and classic Bluetooth with different approaches have been extensively studied. This
chapter is devoted to describe and discuss this related material. They are categorized
based on the underlying positioning theory and approach in use by respective work. The
chapter is concluded by presenting the choices made for this project based on the results
discovered herein.

4.1

Trilateration

With regard to the trilateration based positioning. Two high quality related scientific
reports [20] and [21] have been selected. They are described respectively in detail in the
following subsections.

4.1.1

Positioning using RSSI and Triangulation

In this subsection a Bluetooth based positioning system[20] is presented. In the presented
system a new addition to the Bluetooth 2.1 specification was utilized. The addition is a
new Host controller Interface(HCI) command called Inquiry With RSSI. The new HCI
command allows for retrieval of RSSI values of all discoverable Bluetooth devices in
range without the need to perform connection establishment beforehand. In the report,
this interface command is called by an Android OS device that is to be positioned. The
testing area is defined as a 6x8 meter rectangular room and the reference beacon nodes
consist of four Bluetooth enabled Android mobile phones positioned in the four corners
of the room. To obtain distances based on the measured RSSI the mathematical model
in equation (4.1) is used.
RSSI = −(10n log10 d + A)
19

(4.1)

4.1. TRILATERATION

CHAPTER 4. THEORY

d = 10

A−rssi
10∗n

(4.2)

A is here the absolute energy in dBm, which is the average RSSI value measured at
the distance of one meter in LOS to the node. The n-variable is the propagation constant which is environment dependent. By estimating A as the average of several reads,
coupled with reading the RSSI at predefined distances d, the propagation constant n can
be solved. Because of the fluctuations in RSSI values, the average of several RSSI reads
in each distance is substituted in (4.1) to get the propagation constant n. In the event
that different values of n are obtained for each distance, n is calculated as the average
of all obtained n values.
After determining the necessary constants, the distances to the beacon nodes can be
obtained by rewriting the equation as equation (4.2) and using it for trilateration to
solve the position of the mobile node. In the paper, three position estimation methods
are used and compared. Firstly positioning based on a mathematical concept of Least
square estimation using matrices is used. Secondly, Three-border positioning, which is
referred to in most books and scientific papers simply as Trilateration as explained in 3.5
is used. Finally, we have Centroid positioning, which calculates the center of a polygon
surrounded by the circles when there is more than a single intersection point between
circles. In the last mentioned method, the mobile node is assumed to be outside the
intersecting circles but in an area surrounded by them. This area forms a polygon, in
which the vertices indicate the intersection points and the center of the polygon becomes
the estimated position of the mobile node. According to the results and the plotted values, an accuracy of about 0.6 meter is achieved without considering the effect of the
human body. A separate test in the work concluded that RSSI values drops by about
6-8 dBm when the LOS is obstruted by a human body.

4.1.2

Wi-Fi and Trilateration positioning

A Wi-Fi trilateration based indoor positioning system is presented in [21]. The distance
is calculated based on the percentage of signal strength from beacon nodes experienced
by a mobile node. Higher percentage indicates that the position of the mobile node is
close to a beacon node, while lower percentage indicates the distance to the beacon node
is farther away. The mathematical model shown in (4.3) is used to calculate distances
based on the percentage of received signal strength.
di = p(1 − mi )

(4.3)

Where di and mi are the distance and the percentage for beacon node i. The variable p
is the maximum range of beacon i.

20

4.2. PARTICLE FILTERS

CHAPTER 4. THEORY

After calculating distances between the mobile node and each of the beacon nodes in
range respectively, trilateration is used to estimate the position in two dimensions. Thus
a system of linear equations for two variables can be established. This system consists of
at least three circle equations, where radii and center points are the calculated distances
and the positions of the beacon nodes respectively. The circle equations are linearized
before solving the position.

4.2

Particle filters

Particle filters are a recurring mathematical concept that is often used in different positioning applications and scenarios. In this section two high quality scientific papers
presenting positioning performed with the aid of particle filters are described.

4.2.1

Robot indoor localization

A robot localization system that includes trilateration combined with a particle filter
is presented in [14]. Moreover, the report uses a novel approximation method called
iterative trilateration, for solving overdetermined systems. The distances are similar
to previously described work calculated based on RSSI and equation(4.2). The system
consists of four online steps. The trilateration approach means that no training phase
is required but some signal parameters are needed for calibration. In the first step,
the mobile nodes that should be positioned obtain RSSI measurements from beacons in
range using Inquiry With RSSI. In step two, the system estimates distances to the beacons based on RSSI to distance conversion. Then in the third step, using a trilateration
method referred to as iterative trilateration, the position of the mobile node is estimated.
Finally in the last step, a particle filter is executed taking into account the estimated trilateration positions from the previous steps with a motion model derived from the robot.
In more detail, iterative trilateration consists of several steps and the goal is to solve
an overdetermined system of equations iteratively, where the error is expected to be
minimized in each iteration. The first step is to construct circle equations based on data
from at least three beacons, this is done mathematically as described in equation (4.4).

(x − xi )2 + (y − yi )2 = d2i

(4.4)

di , xi , and yi are the estimated distance based on RSSI to distance conversion and
the coordinates of beacon i respectively. Then matrices are constructed based on these
equations, where the hidden variables are: s = (x2 + y 2 ), x , and y. Ignoring the first
variable results in a linear system of equations which is simpler to solve for retrieving
the estimated coordinates xe , and ye of the position. Then the absolute error vector of
the calculation can be obtained based on equation (4.5). This vector is recalculated after
21

4.2. PARTICLE FILTERS

CHAPTER 4. THEORY

each iteration in the iterative trilateration but divided by di .


p


|fi | = di − (xi − xe )2 + (yi − ye )2 

(4.5)

By using the error vector and Taylor series approximation, the step size of the adT
−1 T
justments (∆x, ∆y) can be calculated as ∆x
∆y = (B B) B f where B is calculated as
in equation (4.6). The error vector together with a reduction factor s are used to update
the estimated coordinates after each iteration. The reduction factor is used for convergence purpose and is decided based on practical results, which in [14] is determined to be
0.05. Thus, new xe and ye are calculated by xe = xe +s∆x and ye = ye +s∆y respectively.



B=



√

(x1 −xe )
(x1 −xe )2 +(y1 −ye )2

..
.

√



(y1 −ye )
(x1 −xe )2 +(y1 −ye )2 

..
.

(xi −xe )
√
(xi −xe )2 +(yi −ye )2

(yi −ye )
√
(xi −xe )2 +(yi −ye )2






(4.6)

The theory of particle filtering is applied by using Monte-Carlo Localization iteratively.
First, an initial set of samples or particles are generated randomly. Then weights are
given to the particles based on how close they are to the trilateration position. The
weights are normalized after every update step so that the sum of all weights is equal
to one. This followed by a prediction step, where each particle is moved based on the
previous position and a control vector from the robot’s motion model.
It is important to mention that the motion model predicts the next position based
on a control vector of [d θ1 θ2 ], that is, rotation of θ1 units followed by d number of
steps then rotation of θ2 units. After that, the weights are recalculated in the same way
as in the first time. As a result, some particles lose weight when their probability of
being likely the actual position decreases. If a particle weight becomes negligible, it will
not be resampled or contribute to the position estimation in the system. To reduce the
computational load on the system and to overcome the problem when the number of
particles contributing to estimating the position becomes very small a threshold on the
number of different particles that contribute in the system is set. When the number of
these particles becomes less than the threshold, the system generates new particles by
duplicating particles of high weights and discarding particles of negligible weights. An
accuracy of 0.427 ± 0.229 meters is claimed to be achieved in a scenario measuring 6x8
meters.

22

4.2. PARTICLE FILTERS

4.2.2

CHAPTER 4. THEORY

Bayesian Filtering Positioning

An indoor Bluetooth positioning system based on particle filter and RSSI with the title
Bayesian Filtering for a Bluetooth Positioning System is introduced in[22]. In the system a mobile node collects RSSI values from several beacons within range, followed by
calculation of distances to the beacons using the mathematical relationship from equation (4.7).

RSSI(d) = RSSI(d0 ) + 10n log (

d
) + Xσ
d0

(4.7)

RSSI(d) and RSSI(d0 ) are here the RSSI values at distances d and d0 respectively,
d0 is a reference distance, n is the propagation constant, and Xσ is a normal distributed
noise with zero mean and standard deviation of σ.
The first step within the particle filter is as always initialization, N particles are generated with random states and equal weights wi for each particle i. The state consists
of position, velocity, and direction. The initial weights are calculated as wi = 1/N .
As the particle filter is run iteratively, weights are updated in each iteration based on
a dynamic model. Two different dynamic models are tested, one without velocity and
another which takes into account the velocity of a human being.
Each particle’s position is updated by a Gaussian distribution random number generator and a time interval. In addition, the velocity is considered when updating the
direction. For instance, When a person using the system begins to walk, any direction
is possible. Whereas when the velocity increases to finally reach 1.3m/s, which in the
article is considered the maximum velocity of a human. The trajectory is forced to follow
a straight line. The motion model step is followed by an update step, where the weight
wi (t) of each particle i at time instance t is updated based on the normalized weights
at t − 1 and the likelihood of the current estimated position using equation (4.7). After
that the weights are normalized to wi (t) based on the current calculated weights. The
mathematical models for weighting and normalizing steps are performed according to
equations 4.8 and 4.9 respectively.

wi (t) = wi (t − 1)p(z(t)|xi (t))

(4.8)

wi (t)
wi (t) = PNp
j=1 wj (t)

(4.9)

These steps are followed by a resampling step. During resampling, the same number
23

4.3. FINGERPRINTING

CHAPTER 4. THEORY

of particles generated at the beginning will be regenerated. This step is required since
when the system runs, most of the particles will gradually lose their weights and will thus
no longer contribute usefully in the position estimation, possibly leading to erroneous
estimation. Resampling is done by duplicating particles of high weight and ignoring
particles of very low weight. To determine whether resampling is necessary or not, the
concept of effective sampling size described in equation (4.10) is applied to calculate and
compare the size of effective samples to a threshold. If the result Ne f f is less than the
threshold, resampling is required. After this step, the position, the orientation, and the
velocity are estimated by recalculating the weighted sum of the positions, orientations
and velocity respectively that are given by the particles.
Np
Ne f f = PNp
2
i=1 w i (t)

4.3

(4.10)

Fingerprinting

Two fingerprinting based localization systems which both rely on signal strength data
as characteristic[23][24] are reviewed in this section.

4.3.1

Fingerprinting localization for ZigBee

In [23], an indoor localization system based on ZigBee Wireless sensor networks and fingerprinting is presented. The system consists of three phases, a fingerprinting database
creation phase, a feature identification phase, and the actual position estimation phase.
In the first phase, Received Signal Strength(RSS) values are collected in each position
where a fingerprint is desired. Each fingerprint consists of x and y coordinates and RSS
values of the beacons within range. Then the whole area is divided into subareas. In
the second phase, a unique RSS based feature is associated with each subarea. For instance, a feature of a subarea is the range of RSS values of the nodes within this subarea.
Finally, in the estimation phase the mobile node collects RSS values to select the most
similar subarea based on the subarea feature. For instance, a subarea is selected if the
collected RSS values are within a certain RSS range if we choose the selected feature
to be RSS range. After selecting the subarea, three fingerprints with least difference to
the collected RSS measurements within the subarea are selected. Then the position is
calculated based on the positions of the three selected fingerprints.
The system is tested in two environments with three beacons in each. One of them
is (41.5 x 11.5) meters with walls and obstacles, and the other is a sport hall with
dimensions of (30.5 x 11.3) meters. Fingerprints are collected in 70 and 60 distinct locations in the first and the second mentioned environments respectively. Then, the area is
divided into subareas either manually or autonomously. In the manual way, a subarea is

24

4.3. FINGERPRINTING

CHAPTER 4. THEORY

selected manually and the system is designed to check for a common feature. Whereas
if the division is autonomous, the area is divided randomly into several subareas. The
last mentioned method is applicable only in open environments and cannot be used in
complex environments where obstacles and non-uniformly distributed objects exist. If
a common feature exists, the selected area will be accepted and considered as subarea.
If no common feature exists, the selected area will be reduced and analysis to find a
common feature starts again. The report concludes that an accuracy between 1 to 3.5
meters is possible to achieve.

4.3.2

Bayesian Fusion Using Fingerprints

A method called Bayesian fusion for indoor localization using Bluetooth and fingerprinting is proposed in [24]. As the proposed method utilizes fingerprinting, it consists of two
phases, training or offline phase, and position estimation or online phase. In addition,
it utilizes a motion model. In the same manner as other RSSI based approaches, RSSI
measurements are collected at several reference points in the training phase to build the
fingerprint database. Each fingerprint that refers to a position consists of the coordinates
of the center of that position together with beacon information for all the beacons in
range. Each beacon information entry consists of the RSSI value of that particular beacon, the statistical mean and the variance obtained from the RSSI values of that beacon.
In this way, a radio map is constructed for the area that should be enabled for positioning.
In the online phase, a mobile node powered by a USB connection connected to a laptop
by a serial port is used. The mobile node collects RSSI measurements while moving and
sends them to the laptop via the serial port. The sent information is processed by an
application on the laptop that estimates the positions based on the mentioned methods.
When calculating the position, two approaches are used, static Bayesian estimation and
estimation with a motion model. In static Bayesian estimation, the position is estimated
based only on the current RSSI measurements that are collected from beacon nodes in
range. When the motion model is utilized, earlier positions and the velocity are applied
in the calculations. When initializing the estimation a uniformly distributed prior such
is used since no previous data is available in the firs iteration
The proposed method of Bayesian Fusion (BF) is compared to both Bayes static estimation (BSE) and point kalman filter estimation (PKF). These estimations are based
on Gaussian distributions and the results become Gaussian density functions. To use
BF and PKF, an initial position is required, which is supplied by using the first obtained position from BSE. In the experiment, the estimated positions in each of the
three aforementioned methods are compared to the real position that is obtained by a
high accuracy GPS system for evaluation purposes. According to the attained results,
the accuracy of using BSE is about 5 meters. When using PKF, an improvement of 0.1
meters is observed. Whereas, the accuracy of the proposed BF method is 4.7 meters on
average. In comparison between all methods, the accuracy of BF is better than both
BSE and PKF with about 0.4 meters and 0.3 meters respectively.
25

4.4. CELL BASED POSITIONING

4.4

CHAPTER 4. THEORY

Cell based positioning

In this section a cell based localization system[25] is reviewed and explained.

4.4.1

Low-latency cell based positioning

In [25] an indoor positionung system that is based on the visibility of beacons is presented. The system consists of several short-range beacons that are deployed in an indoor
environment in a way such that each beacon covers a specific segment. The coverage
range of the beacons is very limited, typically reaching only a few meters. Making it
very likely that a moving user will discover different beacons in a short time while moving.
In addition, geometric and topological relations are represented in the system as a
location graph, where vertices represent locations and edges represent connectivity or
neighborly features between locations and associated with weights equal to the distance
between the adjacent vertices. Two vertices are connected by an edge if there is a direct
route between their locations that does not pass through any other location. In addition, the ranges of the beacons are expressed as sets of vertices that represent locations
that the beacons cover and are connected by hyperedges. Thus a beacon hypergraph is
constructed. By combining the location graph and the beacon hypergraph, a beacon map
is generated.
Furthermore, a path between two locations is represented as a sequence of locations
at a sequence of discrete time points, with fixed time intervals between them. Thus each
two locations that are separated by only one time interval are adjacent. Each mobile
device contains a map of interesting locations and beacon identifications. Determining
the location of a device is done by using the beacon map, the previous position, and
the visibility of the beacons. By taking into consideration the adjacency relationship
between the locations on the map, earlier position fixes are utilized in current position
estimation and the current estimated position is utilized in the subsequent estimations.
In order to optimize the beacon visibility probing time and cost, a probing plan is
introduced and expressed as a binary tree that is arranged based on the probability of
traveling from a location to another and the probability of a location being in range of a
beacon given that it is in the range of another beacon. Several approaches to design the
binary tree are presented in the report. Based on the example used by the authors, the
most optimized approach is something based on so called balanced plans. Related work
on the optimization of cell based positioning systems is presented in [26]. The cited report focuses on the problem of beacon placement decision and presents a solution based
on a greedy approach.

26

4.5. TRIANGULATION

4.5

CHAPTER 4. THEORY

Triangulation

Determining the position of a node using Triangulation requires measuring the angle
of the arrived signal, referred to as ”Angle of Arrival”. One related paper using the
concept has been selected. The selected paper is described and explained in the following
subsection.

4.5.1

Ad Hoc Positioning System Using AOA

One of the triangulation based positioning systems that utilizes Angle of Arrival in a
ad-hoc network is presented in [19]. The network in this system consists of ad-hoc nodes
that are able to communicate directly only with their immediate neighbor nodes within
their range. Further, at each node, angles can be determined against the node’s reference
axis, which identifies the heading or orientation. Landmarks are nodes that are aware of
their positions and headings based on external references such as manual configuration.
Two angle measures are used in the report at each node: bearing and radial. Bearing is
the angle of arrival that is determined at the receiver, or in which angle the receiver sees
the sender. Whilst, radial is the reverse of bearing but at the sender, in other words, in
what angle the sender sees the receiver. In this system, not all of the nodes are aware
of their positions and their orientation.
For a node to be able to calculate its position, it needs to determine the angle of arrival
of signals from its direct neighbours. Neighbors may also be assessed by their neighbors
to calculate their positions and orientation by getting information about neighbours’
orientations. A node can determine the angle of arrival from two neighbours and find
out one angle of the triangle constructed by the node and its two neighbours. Also, a
node can find out its orientation if it is aware of the orientation of one of its neighbors.
As a result, nodes will find their orientations and positions gradually by propagating
landmarks information. For a measurement of bearing at a node to be forwarded, the
node needs two neighbors that are neighbors of each other to be present. Some error
avoidance is also applied, for instance, applying TTL on the propagation of packets
that contain orientation information. A node determines its position by calculating the
intersection point of three circles that are determined by the angle of arrival and the
landmarks. More details about triangulation is presented in 3.5.
The evaluated system, an ad-hoc network consisting of 1000 nodes was evaluated. All
of the nodes were capable of measuring AOA and only a small part of them had initial
awareness of their positions. To make the experiment more realistic, Gaussian noise was
applied to AOA measurements. Worthwhile to mention is that the system was tested
with static nodes, where the nodes were fixed or moved a negligible distances.

27

4.6. SIGNAL PARAMETERS

4.6

CHAPTER 4. THEORY

Signal Parameters

This section reviews two different articles regarding what parameters are suitable to use
for a Bluetooth based positioning system. More sources and parameters are described
in Paragraph 2.3

4.6.1

The reliability of RSSI

Valuable effort has been put on evaluating the reliability and applicability of using the
RSSI parameters for indoor positioning. In [27] a thorough evaluation is performed examining the suitability of using RSSI as parameter for positioning. The hardware that
was used in the evaluation is a Texas Instruments CC2420 chip. The mathematical
model used is in fact the same as (4.1). The A and n constants were calculated using
two approaches. In the first approach, the constant A was calculated in the same way
as before, namely by measuring RSSI at a distance of one meter. By using A in the
mathematical model with different pairs of measured RSSI values and distances, several
values of n could be obtained, the average of them was inserted in the mathematical
model when calculating distances based on RSSI. When A and n were calculated, a
reference curve of the relation between RSSI and distance was established.
In the second approach, a linear relationship between RSSI and a distance dependent
value x = (−10) log10 d was established and inserted in equation (4.11)
RSSI = nx − A

(4.11)

Later, for different RSSI and x pairs, a polynomial curve fitting model was used to
compute the values of n and A. A test of the effect of human body on RSSI was also
carried out and showed that the sensitivity of RSSI increased as the relative distance
decreased. Moreover, the RSSI value was also examined while moving away from a beacon node with an average speed of 1.4m/s up to a maximum distance of 27.5m. Then
a mathematical relation between RSSI and the distance was established. This relation
was applied when calculating distances based on RSSI values. The relation took into
account the time when the test began and ended and the time when the RSSI was read
as shown in (4.12). Having in mind, tmax, tmin, t(i), and RSSI were known, distance
d(i) could be calculated.
d(i) =

RSSI
t(i)
tmax − tmin

(4.12)

Several RSSI values were read at different distances and points in time, whereafter
distances were calculated and compared to the actual distances in order to evaluate the
reliability of RSSI. Four approaches were carried out to process and analyze the collected
28

4.7. COMMERCIAL SYSTEMS

CHAPTER 4. THEORY

data. At first, by plotting the raw sampled data, it was shown that the RSSI could not
be used as a distance indication due to its high fluctuation. Secondly, by taking at each
time point the average of all the previously collected RSSI values. The result of this
approach showed that the collected data samples were smoothed, but result was still
not accurate enough. In the third approach, the previous method was used but instead
of treating all the previous collected samples evenly, different weights were given to the
sampled RSSI values. Higher weights were given to previous samples which were closer
to the sample that is to be calculated. The result of this approach showed that the distance could not be determined based only on RSSI due to large differences between the
calculated distances and the actual distances. Finally, by predicting the sample at the
next time point using curve fitting of all the previous collected samples. According to
the outcome of this approach, the error margin of the calculated distances is minimized
as the time went by and the mobile node moved further away. In the end, the authors
concluded that it is unsuitable to determine distance based only on RSSI measurements
due to the high and unpredictable fluctuation in the calculated distances vs RSSI and
the large errors obtained for calculated distance vs actual distance.

4.6.2

Inquiry response rate fingerprinting

Another parameter which does not have connection to signal strength is inquiry response
rate(IRR). In [12] Bargh et al describe a system which provides room level precision with
an IRR-fingerprinting approach. The IRR is defined by the authors as: ”the percentage of
inquiry responses to total inquiries”. The nature of Bluetooth is that a device scanning
for nearby devices continuously broadcasts inquiry messages as described in Section
2.1.1. A number of these inquiries will be responded to by different discoverable devices
in the vicinity. This functionality is then utilized to create a map of the area that shall
support positioning where the unique fingerprint is based on the fact that this IRR will
be different for different positions. When calibration is performed, an online phase is
carried out to do the actual position estimation. During the positioning phase, inquiries
are again performed to get measurements. These measurements are compared to the
fingerprints in the database and the difference is calculated and used with KullbackLeibler divergence[28] and the related but modified Jensen Shannon divergence[29] to get
a position estimation. The result of the system is a positioning approach which achieves a
98% accuracy of providing the correct position on a room level. The mentioned accuracy
is achieved provided that the room in question is fully covered by nearby Bluetooth
beacons and that the device being positioned remains stationary for a duration of 3
minutes.

4.7

Commercial systems

The development of Bluetooth smart and related applications has made a big leap in
the past two years. Currently there exist commercial products on the market that
at least partly rely on Bluetooth smart technology to perform indoor positioning. The

29

4.7. COMMERCIAL SYSTEMS

CHAPTER 4. THEORY

commercial systems are divided, both with respect to which technology is used to provide
positioning but also with respect to the use case. Some are focused on providing a
positioning system with the aim to provide good characteristics for such an application.
While other systems are more concerned with ”proximity” rather than actual positioning.
In these systems, it it not strictly necessary to provide an exact position with x and
y coordinates(or latitude/longitude). Instead, focus is put on location awareness, for
example if a user is near a store, or if the user are standing right next to an article
inside the store. In either case, the technology can then be used to provide the user
with relevant information. For instance, popping up a message offering some discount
to attract the user into the store. Or if the user is standing next to some article, provide
the user with detailed technical data/video/reviews to enhance the shopping experience.
Some of the existing systems also combine both these applications (as well as adding
others, such as customer movement tracking) and offer a complete solution with both
positioning, location aware services as well as tracking.

4.7.1

iBeacon

iBeacon is the name of Apple Inc’s trademarked positioning technology based on Bluetooth smart technology[30]. The system is not only concerned with location estimation
but also interaction and engagement for retail applications as the most commonly cited
use case. The system can detect when a user carrying another Bluetooth smart enabled
device such as a smartphone is in the vicinity. It can also send a notification or a message
to the device, for example to offer a special discount depending on what department in
a store the user resides in. The technology is not only designed for retail purposes and
can be used in a variety of other contexts such as museums, airports, and sport events to
name a few. The beacons are not primarily designed to provide high precision localization, instead distance estimation to each beacon is considered. The system defines three
different range areas, Immediate (a couple of centimeters), near (a few meters) and far
(10+ meters). The positioning is typically made against a single beacon and will thus
provide an approximate position in a large area if several iBeacons are deployed. The
technology is also used as basis in systems that aim to provide high precision positioning.
Examples of such systems are listed in paragraphs below. Although developed, trademarked and patented by Apple, the technology is also available for use with Google’s
competing Android operating system as well as other systems with support for Bluetooth
smart. The only requirement (so far, might be subject to change) is that a registration
has to be made with Apple’s MFi-program[31].

4.7.2

Estimote

Estimotes[32] is similar to the iBeacon system and does in fact use the licensed iBeacon
technology. The system consists of Bluetooth smart-chips wrapped in waterproof soft
silicon casing. With the motes come an application programming interface(API) which
developers can use to easily develop their own tailored applications and use cases. The
motes have the same properties as described for iBeacons and are mainly marketed
30

4.7. COMMERCIAL SYSTEMS

CHAPTER 4. THEORY

towards retail solutions. The vendor does state that high precision localization is not
the primary goal. Instead the range areas defined for iBeacon are used to give an estimate
location of where in a building a user is located given that the beacon position is known.

4.7.3

SenionBeacon

SenionBeacon is a positioning product from SenionLab[33]. The company provides indoor positioning systems which rely on sensor fusion. The SenionBeacon is a Bluetooth
smart chip which a user installs in the area that shall support indoor positioning. Then
a calibration app is used by the customer to collect data samples within the area. The
data together with a map are sent to SenionLab which provides the customer with an
API and an indoor positioning app that customers can further develop to suit their
needs. The SenionBeacon, although built on iBeacon technology (the beacon, much
like Estimote uses iBeacon technology), has focus on providing high precision real-time
positioning. This is achieved by a combination of a fingerprinting-based localization system using Bluetooth smart or Wi-Fi combined with sensor data obtained from sources
such as accelerometer and compass. The calibration app which the customer uses collects a database of fingerprints that SenionLabs uses to create calibration data for the
positioning system.

4.7.4

indoo.rs

Indoo.rs provides a similar system as SenionBeacon with a number of differences. All of
the tools needed to create, maps, positioning, etc. are already built and the customers
will use the tools themselves to create a positioning system. Much like the SenionBeacon,
the system depends on either iBeacons for a Bluetooth smart implementation or Wi-fi.
It does also rely on the fingerprinting approach where sampling and measurements are
required before the system can be used for positioning. Indoo.rs guarantees an accuracy
of <5m radius in 95% of the cases[34]. The company also adds that accuracy can be
inexpensively improved by adding more beacons and states 2m as a potentially achievable
accuracy.

4.7.5

Quuppa-HAIP

HAIP is an indoor positioning system that uses Bluetooth smart as the core technology
and exists in two different variants[35]. The first is a mobile-centric system that analyze
RSSI parameters to determine a position. An app developed for cellphones broadcasts
a special Bluetooth smart request, which causes all nearby HAIP-locators (Bluetooth
smart beacons) to respond to the inquiry. When the app receives the response, a request
is sent to a locator database server that responds with the position of the discovered
beacons. The information about the locator position together with the RSSI parameters which were received in the broadcast response allow the app to estimate a position.
Quuppa, the company behind the products claims an accuracy of 5-10m is achieved by
the system.

31

4.8. JUSTIFYING CHOICES

CHAPTER 4. THEORY

The second variant of the system, is a network-centric solution which also uses Bluetooth smart for sending radio packets and offers much better accuracy. Quuppa states
that customers can expect 0.3-1m accuracy which is significantly better than all related
systems as of today. This technology, however, is not standardized yet and requires special tags to be functional. The system does not rely on signal strength, instead angular
estimation is used where the locator’s beacon is equipped with an antenna capable of
determining the angle of arrival of incoming radio packets. This angle together with
information about locator position and the known height of the tag allow the system
to estimate a position with good accuracy. The only requirement for the positioning to
work is that the tag should not deviate in height of more than 1m.

4.7.6

Insiteo

Insiteo is a french company which has been working with indoor localization since 2009.
The company has several interesting technology approaches pipelined, where the newest
addition is an indoor-GNSS(Global navigation satellite system) with hardware that retransmits GPS and Galileo signals indoor. The new system requires almost no setup
and calibration work while providing high precision accuracy better than 1 meter[36].
The system will also work without these GNSS repeaters and is then similar to systems
like indoo.rs and SenionLab. RF-signals such as WiFi and Bluetooth smart are fused
together with internal sensors such as accelerometer, compass and gyro in a smartphone
to provide indoor positioning with high precision and responsiveness. The system supports multi-storey buildings and Insiteo claims to achieve an accuracy of 2 meters or
better. Insiteo also combines the positioning service with several other business oriented
use cases such as geofencing, location aware push-messages and visitor monitoring.

4.8

Justifying choices

This section explains and motivates the decisions and choices that have been taken based
on the literature review including scientific papers, Bluetooth smart documentation, and
commercial products. The area of RF based indoor localization is rich with respect to
documented studies and information although not in the context of Bluetooth smart.
The only references of Bluetooth smart based positioning are the several existing commercial systems promising different properties.
Based on the information presented in Chapter 2. It is appropriate to conclude that
using RSSI as parameter is the most suitable selection. Of the available parameters,
RSSI is the one with the most examined relation to distances. RSSI is also obtainable in
Bluetooth smart by simply receiving a broadcasted message. In other words, the choice
of RSSI will allow connectionless positioning possibly supporting multiple nodes without
increasing RF spectrum demands.

32

4.8. JUSTIFYING CHOICES

CHAPTER 4. THEORY

When it comes to the matter of selecting positioning approaches it seems like a reasonable decision to pick trilateration as one of the approaches since it is one of the simplest.
Further, the literature review reveals that the concept of iterative trilateration could be
an interesting choice. No literature uses the approach straightforwardly, instead it is
combined with a particle filter, which fuses it with other sensor data. It would therefore
be interesting to test it alongside traditional trilateration and see how much improvement it possibly adds. When it comes to the other approaches, two of them stand out
when it comes to usage and presented results, namely particle filters and fingerprinting.
Both of the concepts are used in a wide variety of systems and implementations, of which
some are mentioned in the literature review. Thus fingerprinting and particle filter are
added to the list of interesting positioning approaches to be evaluated in a Bluetooth
smart setting. Another advantage of selecting these systems is that comparison against
similar systems that uses other technologies such as traditional Bluetooth or Wi-Fi is
simplified.
Some algorithms of course have to be eliminated for the evaluation. Some are eliminated because they do not offer adequate performance such as cell based approaches
and IRR-fingerprinting, which both only target room level accuracy. Others are eliminated since they would be infeasible to actually implement in a Bluetooth smart testbed.
Specifically the AOA and TOF approaches approaches are left out. The motivation behind this is that AOA requires advanced hardware modifications adding a directional
antenna or an array of antennae which is beyond the scope of this work. When considering TOF, the distance between two objects is calculated based on the time the signal
takes to travel from one object to the other by multiplying it by the signal speed. Since
signal speed is similar to the speed of light traveling in vacuum, which is about 0.3m/ns
an extremely precise clock synchronization would be required. Something which is not
expected to be feasible using inexpensive Bluetooth smart hardware in the price range
of a few US dollars per unit.
How the aforementioned approaches are implemented, tested and evaluated is described
in Chapter 5.

33

5
Testbed
This chapter describes the evaluation criteria for evaluating Bluetooth smart based positioning systems as well as the configuration and architecture for the testbed setup used
for evaluation. Four different positioning algorithms are evaluated: trilateration, iterative trilateration, a particle filter, and a fingerprinting approach. Technical details and
explanations are provided for each approach.

5.1

Evaluation criteria

To evaluate positioning based on Bluetooth smart technology, We define a set of evaluation criteria which positioning will be evaluated against. A number of important
characteristics can be defined in the context of indoor localization and different types
of systems comply in different degree with these characteristics. The characteristics selected as important for indoor positioning in this report are listed below:
• Accuracy and Precision - A positioning system should provide good accuracy,
where the user with high probability and precision can locate himself in the environment. We emphasize that the definition of accuracy is not synonymous with
the definition of precision. Definitions of both concepts can be found in[37].
• Calibration complexity - The system should be as easy as possible to install
and setup. If a lot of effort is required for the system to be operational, it is not
deemed to have good calibration complexity.
• Scalability - The system should allow for easy expansion into several rooms and
areas, for example if the system is installed in a certain room or area, it should
require as little effort as possible to expand the area. This criterion also governs

34

5.2. TEST ENVIRONMENT

CHAPTER 5. TESTBED

the ability for the system to support several simultaneous users. E.g if the system
supports expanding from 5 to 50 simultaneous users.
• Liveliness and response time - Defines how responsive the system is, for real
time tracking the update rate for the positioning needs to be quite high with at
most a few seconds between each update.
• Robustness and Adaptability - A positioning system should preferably be able
to cope with changes in the environment without requiring extensive reconfiguration or experiencing performance degradation. Examples include when furniture
is moved or when an empty configured area is filled with a lot of people.
Accuracy and precision can be measured quantitatively by calculating the exact error
for each estimation. In the evaluation of Bluetooth smart in a positioning context the
following data will be presented:
• Average error for each approach in each scenario.
• Standard deviation of estimation errors in each approach and scenario.
• Largest error in estimation.
• Smallest error in estimation.
• Precision confidence, e.g with what precision is a certain accuracy achieved. The
defined errors in accuracy presented is <2m, <3m, <4m, <5m and >5m.
The other four characteristics are more difficult to evaluate strictly with numbers and
statistics. Each of them will instead be analyzed individually based on the perceived
performance in relation to the relevant characteristic. Each score will be analyzed and
motivated in relation to properties of Bluetooth smart technology and/or relation between properties of the positioning approach and properties of Bluetooth smart. It is
important to emphasize that all the characteristics listed are treated independently from
each other. This means that even though the system provides poor accuracy, it could
still achieve high performance for all the other characteristics. It is therefore important
to specify and reflect on which characteristics that are important to consider for a specific system. This project does not perform evaluation for a specific use case, rather it
performs evaluation on a broad level with several characteristics. A use case may after
all hold all of these criteria, or only a subset in high regard.

5.2

Test environment

The evaluation is performed in a typical office environment at the premises of Cybercom
Ab’s Gothenburg office. Two different scenarios are tested, a small scale scenario in a
rectangular open plan office environment measuring 8x11 meters and a larger scenario
35

5.3. TESTBED SETUP

CHAPTER 5. TESTBED

consisting of an entire wing of the office in the shape of a triangle measuring 20.5x16x25.5
meters. In both scenarios the areas is furnished although the type of furniture differs
somewhat. The open plan office contains desks, chairs and filing cabinets while the wing
consists of a large kitchen and an adjacent living room furnished with couches, stand
tables, a conference table and kitchen furniture. A picture of each test area is presented
in Figure 5.1. The overview floor plans are presented in Figure 5.8. The radio spectrum
in the area is not free from competing technologies, a number of Wi-Fi networks are
active in the area and it is possible that other Bluetooth enabled devices are active
within the premises. The environment that in no way is free from noise or obstacles
represents a typical real life scenario in which an indoor positioning system could be
deployed where furniture and radio transmitters are expected to in a non-negligible way
affect the system performance.

5.3

Testbed setup

The system used for evaluating the positioning approaches can be divided into two parts,
hardware components and software components. This section provides a description of
the components and decisions on implementing each of the two parts.

5.3.1

Hardware

The main hardware required for evaluation is the reference Bluetooth smart nodes to
be deployed as beacons in the test environment and a mobile node to gather data to be
used for positioning algorithms. Both these components are described below.
5.3.1.1

Bluetooth smart beacons

To facilitate the beacons, Bluetooth smart chips combined with microcontrollers, software stacks and RF-components including antennae are required. Currently several
different System on chip(SOC) solutions including all the required parts are available
from electronic component vendors. The reason to use dedicated embedded systems
hardware instead of using easily accessible Bluetooth smart enabled smartphones is that
smartphones do not yet support the Bluetooth smart broadcast mode which is particularly suitable for usage as beacons. The choice of Bluetooth smart-chip fell on Bluegiga’s
BLE112[38] chip with an integrated 8051 microcontroller complete with an assembled
0.7mm ceramic antenna. The reason for choosing this particular SOC was threefold:
(1) It enables really easy development of simple applications with a proprietary script
language called BGScript. While several of the competing SOCs require a proprietary
compiler from IAR Systems[39]. (2) The size of the chip is (18.15x12.05 mm) which
makes it relatively easy to work with in respect to soldering and assembly. (3) The chip
comes with excellent documentation and support.
To be able to work effectively with the relatively small SOC, the decision was made
to construct a Printed Circuit Board(PCB) to allow easy access and handling. The PCB
36

5.3. TESTBED SETUP

CHAPTER 5. TESTBED

(a) Open plan office scenario

(b) Office wing scenario

Figure 5.1: Visual representaion of the two test areas

37

5.3. TESTBED SETUP

CHAPTER 5. TESTBED

Figure 5.2: Breakout circuit board schematic

(a) Circuit board design

(b) Printed circuit board

Figure 5.3: Breakout board for BLE112

also allowed to mount capacitors in recommended places to improve battery performance[38].
The schematics of the PCB and a figure demonstrating a completely assembled beacon
can be seen in Figures 5.2, 5.3(a), and 5.3(b).
5.3.1.2

Mobile node

To collect data broadcasted by the beacons, a mobile node is necessary for retrieving
the desired RSSI measurements. The easiest solution was determined to be using a
smartphone with Bluetooth smart support. By coincidence, one of the authors had a
Sony Xperia ZR (C5503) running android 4.3 with support for Bluetooth smart. It was
decided early that calculations and evaluation should be performed on a PC, the reason
for this is described further in the paragraph below but as a result of this decision, a PC
is also a necessary hardware component in the testbed.

5.3.2

Software

The software in use by the testbed can be divided into three parts, Bluetooth smart
beacon application, mobile node application(s) and PC applications implementing positioning approaches combined with data gathering code. The beacon’s application is
implemented using BGScript. The same application is used throughout all evaluations
in this report. The objective of the application is simple, broadcast advertisements peri-

38

5.4. POSITIONING ALGORITHMS

CHAPTER 5. TESTBED

odically with a customized time interval which in the tests performed is set to every 0.25s.
The mobile node application is an android application which exists in two simple variants. Its task is to scan for Bluetooth smart beacons within range, register the measured
RSSI value for each beacon and forward the data via Wi-Fi to a PC for analysis and
estimation. The reason why several versions exist is because the gathering of RSSI values
are different for different applications in the testbed. The first version of the application
simply scans for devices within range for a specific time interval. When the scan time
interval is reached, data consisting of all discovered beacons MAC addresses together
with the measured RSSI for each one is sent in a packet to a PC. A second version of
the application does almost the same thing as the first, except that instead of sending
data when the scan completes, the application performs several scans and then sends the
average of the gathered RSSI for each node based on all the scans in a packet. How many
scans to perform when constructing the average value is configurable, but will typically
be 20 for offline/configuration purposes and 5 for online/positioning purposes.
The last part of the software suite is the program running in the PC which is used
to perform the actual positioning estimations and calculations. The software tool used
for data collection, implementing algorithms, evaluation and visualizing results is Matlab. Matlab receives UDP packets sent from the mobile node containing beacon IDs
and associated RSSI values and then runs the applicable code. The reason for using
Matlab instead of executing algorithms and evaluations directly in the android device is
due to implementation complexity. Matlab is a high level tool with extensive support
for implementation of complex systems, support for saving data in several formats, API
calls for common mathematical functions and competent tools to create visual reports
and elements such as graphs or defining maps with coordinate systems.

5.4

Positioning algorithms

This section presents the four implementations of positioning algorithms that are evaluated.

5.4.1

Trilateration algorithm

The simplest approach to do positioning is to use the trilateration algorithm to estimate
a position. The algorithm requires knowledge of the beacons positions to be known by
the mobile node or the application that performs positioning. It also depends on measuring the distance to each beacon to be able to determine the position. The theory behind
this approach is described in Paragraph 3.1 and a flowchart of the algorithm is shown
in Figure 5.4. To estimate distance against a node based on measured RSSI, Equation
5.1 is used.

39

5.4. POSITIONING ALGORITHMS

CHAPTER 5. TESTBED

RSSI = −(10n log10 d + A)

(5.1)

A and n are the absolute energy in dBm and the propagation constant respectively. The
Equation 5.1 is rewritten to get the distance as output since we will be able to measure
the RSSI value. The resulting Equation 5.2 is written as:

d = 10

A−rssi
10∗n

(5.2)

Which is the same equation seen in 4.1.1 and several other related reports.
Trilateration in this approach is combined with least square error estimation since trilateration generates an overdetermined system that is recommended to be solved precisely
using the least square error method.

Figure 5.4: RSSI based trilateration algorithm. Distances are calculated based on RSSI,
A, and n using Equation 5.2. x is the number of pairs, which is a customized value

40

5.4. POSITIONING ALGORITHMS

5.4.2

CHAPTER 5. TESTBED

Iterative trilateration

As a further step towards a possibly more accurate positioning approach is to use the
principle of iterative trilateration. To use this method, an initial estimation is required
as the first input in the first iteration, which can be calculated using trilateration a
single time. In each iteration the previous estimated position is updated. In addition,
the difference between the RSSI based distance measurement and the distance calculated based on the estimated coordinates is calculated for each beacon. Based on these
differences and by using Taylor series approximation, the adjustment to the previous
estimation can be calculated. The calculated adjustment is multiplied by a reduction
factor before calculating the new estimation for convergence purpose. The steps of iterative trilateration are shown in Figure 5.5. All details regarding iterative trilateration
and the mathematics behind it are described in Paragraph 4.2.1.

Figure 5.5: Iterative trilateration

41

5.4. POSITIONING ALGORITHMS

5.4.3

CHAPTER 5. TESTBED

Particle filter algorithm

A Matlab implementation of a particle filter based on the theory and the concepts explained in Chapter 4 has been utilized. The observable variables are the distances to the
beacons that are calculated based on RSSI. At the other end, the hidden variable is the
position of the mobile node. Compared to other related work that utilizes compasses or
motion model that give observation about the orientation, the orientation information
is generated randomly without utilizing a compass or a motion model. By randomly
generating several thousands of particles and then testing each particle for likelihood
of being accurate or not based on the observation variables, weights are given to each
particle. Particles that are likely to be accurate given the observations are awarded high
weights, whilst those that are unlikely to be accurate given the observations are awarded
low weights. The likelihood is determined as follows: The mobile node collects RSSI
from each beacon and calculates the distance to each beacon based on RSSI. At the
same time, distances between each particle and each beacon are calculated. By comparing the distances of each particle to each beacon with the distances calculated based on
RSSI the weight is determined. A small difference in distances will result in high weight,
while a large difference will result in low weight. The filter is executed recursively over
time and as a result most of the particles lose almost all their weight. Which leads to
the effect that they do not contribute to the positioning estimation. On the other hand,
some particles gain more weight, which results in making them contribute significantly
in the estimation process.
Consequently, the system may end up in a situation where there are very few contributing particles. By deciding a threshold on the number of contributing particles and
weights, the aforementioned issue can be resolved. When the number of the significant
particles decreases below a certain limit, new particles can be generated and old ones
discarded. This step is called re-sampling. Equally importantly, no re-sampling is required if the number of particles is above the threshold, which attenuates the load. In
addition, Gaussian noise is applied on the measurement estimation and move processes
to account for uncertainty. A flow chart that illustrates the general steps of the particle
filter in this project is presented in Figure 5.6.
In each recursion step, the quantity of particles of considerable weight is tested to check
whether to generate new samples or not. Each sampling or re-sampling step is followed
bya weighting step and a normalization step, where weights are normalized for comparison purpose. In addition, in each recursion step, particles are moved in random
directions and get new positions. Later, the most probable particles to be accurate are
considered as basis for determining the position of the mobile node.

5.4.4

Fingerprinting algorithm

Indoor positioning using fingerprinting is similar to a ”look up process”. A mobile node
collects some RSSI values and then searches a database for some data that satisfies the
42

5.4. POSITIONING ALGORITHMS

CHAPTER 5. TESTBED

Figure 5.6: Particle filter

same characteristics as the measured data. A database needs to be available before any
positioning is performed. Thus, this approach requires two phases, a training phase and
a positioning phase. Before the database can be created, the map of the indoor environment where the system will be deployed must be divided into several segments. It
can be divided symmetrically into grids, or asymmetrically by selecting some interesting
locations on the map. By deploying the beacons in a way that guarantees best coverage
and signal strength diversity, the performance in terms of accuracy and precision can be
increased. A description of the fingerprint algorithm for both training and positioning
phases is presented in Figure 5.7
In the training phase, at each segment or cell the RSSI values of all the beacons in range
are collected. A fingerprint thus consists of the coordinates of the center of the segment
or the cell and the RSSI values, where each of them is the average value of several reads
and associated with a MAC address or ID that belongs to different beacons. As a result,
a database that consists of the fingerprints is constructed. This is done simply by placing
a mobile node at the center of these locations or cells for a reasonable period of time
while an application that is run on the mobile node collects RSSI values. The mobile
43

5.4. POSITIONING ALGORITHMS

CHAPTER 5. TESTBED

(a) Training phase

(b) Positioning phase

Figure 5.7: Fingerprinting flowchart

node is an Android device explained in 5.3.1.2. A flowchart that illustrates the general
steps of the training phase is shown in Figure 5.7(a). The number of fingerprints and
the number of beacons in each fingerprint depend on the environment. On the laptop
a Matlab application receives the sent data and appends them to the database. The
database is located in a text file that can be updated by the Matlab application. Whenever the training phase is completed and the database is constructed, the online phase
and the positioning process can be started.
In the positioning phase, a mobile node that wants to estimate its position needs to
44

5.4. POSITIONING ALGORITHMS

CHAPTER 5. TESTBED

collect RSSI values of all the beacons in range in the same way as in the training phase.
The RSSI collection can be done in two ways, collecting single a RSSI value per beacon,
or computing the average of several measurements per beacon. Choosing which method
to be used depends on the real-time requirements and the update interval requirement.
A flowchart that illustrates the general steps of positioning phase is shown in Figure
5.7(b).

(a) Office room

(b) Living room

Figure 5.8: Environments where fingerprinting has been deployed

To determine the position of the mobile node, the gathered data and each of the fingerprints in the database are compared. Figures 5.8(a) and 5.8(b) show where fingerprints
have been recorded in the two different environments. The comparison is done by computing the total difference between the gathered data in the online phase with each of
the fingerprints in the database according to equation (5.3).
n q
X
Dif fi =
(RSSIkonline − RSSIkof f line )2

(5.3)

k=1

where Diffi is the difference between a fingerprint i and the online gathered data, n is
the number of RSSI values in each fingerprint, which is a common value for all of the
fingerprints in the database, and k is the beacon unique identifier. The next step is
to calculate the coordinates of the mobile node. This is done by selecting the nearest
45

5.4. POSITIONING ALGORITHMS

CHAPTER 5. TESTBED

x neighbours among the fingerprints, which gives the least x Diff s. In the event that
each fingerprint contains the coordinates of the cell or the segment that it is associated
with, the position of the mobile node will be determined as the position of least total
of distances to the positions of the selected fingerprints. More specifically, the x and y
coordinates of the mobile node are the geometric median of the x s and ys of the selected
fingerprints respectively.

46

6
Positioning results
6.1

System results

This chapter presents the results from the testbed evaluations described in Chapter
5. Two different scenarios was tested, one small 8x11m office room and one large
20.5x16x25.5m triangle lounge inside the office building.

6.2

Small area Scenario

The four selected positioning approaches have been tested in 10 different positions in
the office scenario, see Figure 5.8(a). In each position, 20 positioning estimations are
done where each estimation is calculated based on the average RSSI value from all beacons in the vicinity. To calculate each single estimation, the average RSSI is based on
5 single measurements. This means that each average error (AvgErr) and standrad error deviation (StErDe) is derived from 100 datapoints (20 unique position estimations).
Finally the average error and error deviation combining all positions for each approach
is calculated. The reason for using the average RSSI instead of basing the analysis on
single readings is to mitigate the effect of fluctuation in RSSI values. The results of the
measurements are presented in Table 6.1. It is important for analysis purposes to know
that LOS is always guaranteed in this scenario.
In addition to the average error in estimations, the least and the worst error for each
approach and position are presented and compared to each other. The result of this
comparison is presented in Table 6.2 to give a view of outliers for each approach.
As can be concluded from the Tables 6.1 and 6.2, the results differ in accuracy significantly between approaches but also from position to position for the same approach.
When it comes to the small Office scenario, the conclusion that can be drawn is that the

47

6.2. SMALL AREA SCENARIO

Coord.

Iter.

CHAPTER 6. POSITIONING RESULTS

Particle.

Tril.

FP

(X,Y)

StErDe

AvgErr

StErDe

AvgErr

StErDe

AvgErr

StErDe

AvgErr

(8.9,3.6)

0.318

5.744

0.107

2.446

0.068

2.426

1.285

2.401

(8.8,2.1)

0.316

7.063

0.064

3.670

0.081

3.230

0.763

4.002

(6.9,2.9)

0.478

4.209

0.031

1.870

0.152

1.421

0.505

3.037

(6.9,5.9)

0.616

4.656

0.132

3.356

0.839

3.312

0.620

1.553

(5.3,1.3)

0.269

3.227

0.137

2.130

0.386

2.417

0.832

2.421

(3.7,4.8)

0.691

2.481

0.303

1.087

3.130

3.042

0.775

1.914

(5.6,6.4)

0.346

2.556

0.067

1.813

0.237

1.898

1.042

3.039

(1.9,4.8)

0.319

1.799

0.168

3.626

1.129

4.758

1.451

3.846

(2.9,2.9)

0.354

1.030

0.033

1.971

0.215

2.502

0.895

3.023

(2.1,7.0)

0.876

4.214

0.338

1.404

2.297

3.716

1.111

2.319

Total

0.458

3.6980

0.138

2.337

0.853

2.872

0.928

2.756

Table 6.1: Standard error deviation and average error of 4 approaches in 10 different positions in a room with size of 11x8 meters, where Iter means iterative trilateration, Particle
means particle filter, Tril means trilateration, FP means fingerprinting, StErDe means standard error deviation, and AvgErr means average error. The first two columns are the real x
and real y coordinates

particle filter approach provides the best accuracy and least estimation error in comparison to the other approaches. The worst approach with quite significant margin is the
iterative trilateration approach.
Finally the confidence of different accuracy intervals are presented in Table 6.3. This
table confirms the previous conclusion which presented the particle filter approach as
the one providing best performance with regard to precision and accuracy. It is worth
pointing out that the trilateration and particle filter appraoches provide similar results
for the different intervals.

48

6.3. LARGE AREA SCENARIO

Coord.

CHAPTER 6. POSITIONING RESULTS

Iter.

Particle.

Trilat.

FP

(X,Y)

Best

Worst

Best

Worst

Best

Worst

Best

Worst

(8.9 , 3.6)

5.149

6.467

2.307

2.718

2.247

2.503

0.985

4.866

(8.8 , 2.1)

6.403

7.720

3.555

3.849

3.072

3.374

1.905

5.218

(6.9 , 2.9)

3.276

5.176

1.759

1.905

1.050

1.633

1.782

3.821

(6.9 , 5.9)

3.366

5.784

3.020

3.548

2.356

5.479

0.801

3.593

(5.3 , 1.3)

2.844

3.910

1.969

2.551

1.194

2.908

2.150

4.854

(3.7 , 4.8)

1.359

3.671

0.208

1.361

0.752

13.169

0.880

4.213

(5.6 , 6.4)

2.035

3.157

1.737

2.056

1.557

2.275

1.099

3.883

(1.9 , 4.8)

0.784

2.344

3.343

3.914

3.527

8.153

0.778

5.459

(2.9 , 2.9)

0.316

1.875

1.912

2.032

2.128

2.875

1.819

4.772

(2.1 , 7.0)

3.775

7.710

0.878

1.889

0.369

8.825

1.278

6.032

Table 6.2: distances between best and worst estimated positions and the actual positions
in 10 different positions in a rectangular room with dimensions of 11x8 meters, where Iter
means iterative trilateration, Particle means particle filter, Trilat means trilateration, and
FP means fingerprinting. The real coordinates are presented in the first column

Error in estimated position
Algorithm

<2m

<3m

<4m

<5m

>5m

Iter

21.4%

50%

64.3

78.6%

21.4%

Tril

21.4%

50%

71.4%

85.7%

14.3%

Particle

28.2%

67,5%

92.5%

100%

0%

FP

21.4%

50%

64.3%

85.7%

14.3%

Table 6.3: Confidence for positioning accuracy in 8x11m office scenario

6.3

Large area scenario

Similarly, to the small area scenario tests has also been performed in a larger environment, see Figure 5.8(b). The new environment is a triangle shaped room with an area
of 202± 2 square meters. The room is partially separated by a wall in the middle. The
setup is presented in Figure5.8(b) where the mentioned wall is marked by a yellow line.
Five beacon nodes are placed in the positions represented by red circles. Similar to the
small office scenario in 6.2, the standard error deviation, average error, best and worst
estimated positions and accuracy confidence are presented in Tables 6.4, 6.5 and 6.6

49

6.3. LARGE AREA SCENARIO

CHAPTER 6. POSITIONING RESULTS

respectively. Important to note for analysis purposes is that in this scenario, LOS is not
guaranteed. Instead it is often the case that at least one beacon is hidden behind a wall
or some other obstacle.
According to the the results in this scenario, the fingerprint approach gives with signifCoord.

Iter.

Particle.

Trilat.

FP

(X,Y)

StErDe

AvgErr

StErDe

AvgErr

StErDe

AvgErr

StErDe

AvgErr

(2.9,14.0)

0.424

8.042

0.416

12.888

1.670

7.906

2.837

3.810

(1.2,12.0)

0.628

8.281

0.205

9.853

0.349

7.571

1.352

3.623

(1.3,8.0)

0.343

1.127

0.159

7.519

0.191

5.747

0.249

1.936

(14.5,3.2)

0.251

8.542

0.089

9.053

0.243

6.463

0.856

2.632

(4.0,9.0)

0.448

3.083

0.139

6.540

0.825

3.176

0.826

1.858

(4.0,5.0)

0.416

3.322

0.441

3.461

0.364

2.963

0.878

4.202

(7.1,9.0)

0.298

6.610

0.168

6.378

0.156

1.584

1.110

2.568

(10.2,4.1)

0.166

4.431

0.088

3.019

1.053

3.360

0.654

1.331

(10.3,8.5)

0.604

8.425

0.174

7.130

0.598

2.893

1.759

1.815

(7.1,4.0)

0.401

1.939

0.326

3.164

1.270

3.622

1.949

3.350

Total

0.398

5.398

0.221

6.901

0.672

4.529

1.247

2.713

Table 6.4: Standard error deviation and average error of 4 approaches in 10 different
positions in a triangle shaped room with with an area of about 202 square meters, where
Iter means iterative trilateration, Particle means particle filter, Trilat means trilateration,
FP means fingerprinting, StErDe means standard error deviation, and AvgErr means average
error. The real coordinates are presented in the first column

icant margin the best accuracy and precision amongst the tested approaches. The worst
approach is no doubt the particle filter which gives an average error in estimation close
to 7m. The results are further confirmed looking at the confidence for different accuracy intervals. The particle filter does only provide accuracy better than 5m in 24%
of the estimations while the same accuracy is achieved in 85% of the estimations for
fingerprinting.

50

6.4. CHARACTERIZATION RESULTS

Coord.

Iter.

CHAPTER 6. POSITIONING RESULTS

Particle.

Trilat.

FP

(X,Y)

Best

Worst

Best

Worst

Best

Worst

Best

Worst

(2.9,14.0)

7.324

8.744

11.857

13.251

5.738

13.924

0.233

11.281

(1.2,12.0)

7.296

9.156

9.511

10.168

6.865

7.975

1.147

6.981

(1.3,8.0)

0.395

1.724

6.986

7.657

5.360

6.044

1.538

2.142

(14.5,3.2)

8.134

8.895

8.795

9.209

5.911

6.880

1.344

3.870

(4.0,9.0)

2.411

4.159

6.113

6.655

0.087

3.755

0.745

3.569

(4.0,5.0)

2.555

3.992

2.042

3.755

2.102

3.422

2.553

6.846

(7.1,9.0)

5.850

7.064

5.822

6.512

1.366

2.052

0.547

5.548

(10.2,4.1)

4.054

4.788

2.799

3.171

2.437

6.399

0.477

3.184

(10.3,8.5)

7.471

9.511

6.822

7.491

1.307

3.905

0.583

6.816

(7.1,4.0)

1.065

2.579

2.095

3.492

2.034

8.381

0.233

6.893

Table 6.5: distances between best and worst estimated positions and the actual position
in 10 different positions in a triangle shaped room with an area of about 202 square meters,
where Iter means iterative trilateration, Part means particle filter, Tri means trilateration,
and FP means fingerprinting. The real coordinates are presented in the first column

Error in estimated position
Algorithm

<2m

<3m

<4m

<5m

>5m

Iter

7.7%

23.1%

21.1%

46.2%

53.9%

Tril

7.7%

7.7%

38.5%

61.5%

38.5%

Particle

7.7%

21,5%

22.7%

23.5%

76.5%

FP

23.1%

69.2%

84.6%

84.6%

15.4%

Table 6.6: Confidence intervals for positioning in 16x20.5m scenario

6.4

Characterization results

Based on the evaluation criteria in Chapter 5.1 the following subsections describes the
achieved results and conclusions for each of the characteristics. Each characteristic is
evaluated and motivated based on the properties of Bluetooth smart technology and
properties connected to each positioning approach. For each category a five-point score
system is used: Excellent, Very good, Good, Fair, Poor. Excellent of course means that
an approach provides great performance for the characteristic and Poor would respond
to very bad performance for the characteristic. If further mapping between a score and

51

6.4. CHARACTERIZATION RESULTS

CHAPTER 6. POSITIONING RESULTS

the characteristic is required, it is defined for each subsection respectively.

6.4.1

Accuracy

Several interesting conclusions can be found in the performed measurements. First of all,
no single approach provides the best results for both scenarios. In the small scenario with
LOS, the particle filter approach achieved the best performance with regard to accuracy
and precision whilst in the large scenario the fingerprint approach outclassed the other
tested approaches. Interesting to notice is that the fingerprinting approach was the only
one who scored a quite consistent performance with an average error of 2.7m in both
scenarios. The other approaches experienced significant performance degradation in the
larger scenario where LOS was not guaranteed. Interestingly the iterative trilateration
approach which was tested mainly for comparison with standard trilateration performed
worse in both scenarios. The performance related to particle filter is also interesting,
in the small scenario with LOS it was the best approach while in the large scenario
it attained the worst performance. The results on a five-point scale: Excellent, Very
good, Good, Fair, Poor is presented in Table 6.7. The mapping are defined as follows:
Excellent: <2m, Very Good <2.5m, Good: <3m, fair: <4m and Poor: >5m.
Accuracy and precision performance
Algorithm

Small scenario

Large scenario

Iterative trilateration

Fair

Poor

Trilateration

Good

Poor

Particle filter

Very good

Poor

Fingerprinting

Good

Good

Table 6.7: Accuracy for different positioning approaches

6.4.2

Calibration complexity

Considering the calibration complexity criteria, a common calibration process among all
of the tested approaches except fingerprinting is the fact that they require calculation of
the propagation constant and the average RSSI in dBm at 1 meter before putting the
system into mission. This is because all these approaches are dependent on converting
the measured RSSI value into a distance. This calibration step can be considered very
lightweight and could possibly be automated in production. Measuring the RSSI at one
meter to determine A and later do a couple of more measurements at different distances
to find an acceptable value for n. Both of these values can later be programmed into the
advertisement message, putting minimal effort for central configuration of the system or
the need for keeping a database to store these values. The only thing the positioning
really has to know about the reference beacons is their position in the scenario. Since
52

6.4. CHARACTERIZATION RESULTS

CHAPTER 6. POSITIONING RESULTS

all beacons require manual configuration, the performance is not considered excellent. It
would have been more advantageous if all beacons could be deployed with the same configuration. But nevertheless the conformance with the complexity characteristic must be
considered very good for all the three approaches requiring the same configuration effort.
When it comes to the fingerprinting approach the picture is a bit different. This approach requires quite significant manual effort which not necessarily can be automated
very easily. An entire map consisting of unique characteristics, which in this project is
Average RSSI for different locations needs to be created. This configuration step is not
considered complex or complicated but it is time consuming. The configuration can be
simplified, collecting fingerprints directly in a smartphone and measuring coordinates
with for example a laser range finder. As a result the calibration performance for fingerprinting can be considered adequate since even if it is demanding in comparison with
the other approaches, it is not a factor that in itself would hinder the deployment of a
fingerprinting based positioning system. The calibration performance for all approaches
are listed in Table 6.8.
Calibration performance
Algorithm

Score

Iterative trilateration

Very good

Trilateration

Very good

Particle filter

Very good

Fingerprinting

Fair

Table 6.8: Score related to calibration for different positioning approaches

6.4.3

Scalability

The scalability characteristic can be divided into two separate parts. One that concerns
how the system would be able to scale with regard to the number of users. E.g how complex would it be to scale from 5 to 50 to 500 simultaneous users? The other part is how
well and easy will the system scale if the configured area is to be expanded into multiple
rooms or a larger area. The resulting scalability performance for all the approaches and
properties are listed in Table 6.9.
The first property regarding support for an increasing amount of users is the same
for all approaches. All approaches relies on reading RSSI values from advertisements
for position determination. This is done by passively scanning for advertising beacons
as described in Paragraph 2.2.3. Since the scanning is passive, an increasing amount
of users will not have any effect on the system or the RF-spectrum. Resulting in an
excellent compliance with this property for all approaches.
53

6.4. CHARACTERIZATION RESULTS

CHAPTER 6. POSITIONING RESULTS

The second property related to scalability does introduce some differences between approaches. Again the fingerprinting approach stands out compared to the others which
have common performance also for this characteristic. In the case of fingerprinting, if the
covered area should be expanded new beacons will be deployed and the database with
fingerprints has to be expanded to also cover the new areas. The problem here comes
in the case where beacon coverage areas overlap. This would render the old database
entries a poor match, especially if the overlap is large. As a result, it might be the case
that the entire configuration would have to be done from scratch. A fact which compensates for this disadvantage, is the fact that expanding the approach to cover several
rooms or a larger area instead of only the one already configured will not result in any
performance degradation for accuracy and precision. From the tests performed it can
be concluded that lack of LOS will not affect the system negatively. These properties
combined for the fingerprinting approach leads to the conclusion that the conformance
to the scalability characteristic can be considered fair for fingerprinting.
When it comes to expanding the other approaches to cover a larger area than what
is already configured, the amount of effort is at first sight minimal. The only operation
required would be to update the application with the positions of the newly deployed
beacons. There is however a pitfall for this property which is not directly connected to
scalability although it has a major impact on this characteristic. The fact that when
LOS is no longer available the accuracy of the system decreases significantly. This means
that if beacons are deployed in new neighboring rooms, a device positioning in an existing room will acquire the RSSI through the wall resulting in significant performance
degradation. Something which is exactly what was seen in the large tested scenario in
the testbed. As a result, trilateration, iterative trilateration and particle filter can all be
considered having poor performance in conforming to the scalability characteristic.
Scalability performance
Algorithm

Increase in number of users

Area expansion

Iterative trilateration

Excellent

Poor

Trilateration

Excellent

Poor

Particle filter

Excellent

Poor

Fingerprinting

Excellent

Fair

Table 6.9: Score related to scalability for different positioning approaches

6.4.4

Liveliness and response time

The response time of the system is defined as how fast new position estimations can be
generated. Since all tested approaches rely on the same data for calculating a position,
54

6.4. CHARACTERIZATION RESULTS

CHAPTER 6. POSITIONING RESULTS

all tested approaches achieve the same conformance with respect to this characteristic.
In Bluetooth smart, three dedicated advertisement channels are defined: 37,38, and 39
[8]. The time it takes to find all beacons in the vicinity is as a result of this dependent on
with what time interval the beacons are programmed to perform advertisement. Since
the beacons can advertise several times per second, a very good response time can be
achieved. Collisions in the radio spectrum are handled automatically on a low level
by the Bluetooth stack described in Paragraph 2.2.3. As a result, no issues related to
collision was observable in the tests. It was possible to discover all testbed beacons
and gather RSSI measurements as well as discover other beacons not belonging to the
testbed in less than a second. Resulting in a very good conformance to the Liveliness
characteristic. The results are outlined in Table 6.10.
Response time performance
Algorithm

Liveliness and response time

Iterative trilateration

Very good

Trilateration

Very good

Particle filter

Very good

Fingerprinting

Very good

Table 6.10: Score related to response time for different positioning approaches

6.4.5

Robustness and adaptability

When it comes to adaptability and robustness, all the approaches again share the same
property of relying on RSSI. The evaluation of this characteristic is thus completely
related to the robustness of RSSI. It is worth mentioning that fingerprinting does not
rely on RSSI exactly in the same way as the other approaches which relies on converting
the measured RSSI into a distance. But both approaches will be very sensible to eventual
fluctuations in the RSSI parameter.To be able to draw conclusions for this characteristic
it is thus required to further evaluate the RSSI properties. The result which is based on
the analysis performed Chapter 7 is that all approaches has poor conformance with the
robustness characteristic. The result is outlined in Table 6.11.

55

6.4. CHARACTERIZATION RESULTS

CHAPTER 6. POSITIONING RESULTS

Robustness performance
Algorithm

Robustness and adaptability

Iterative trilateration

Poor

Trilateration

Poor

Particle filter

Poor

Fingerprinting

Poor

Table 6.11: Score related to robustness for different positioning approaches

56

7
RSSI analysis
This chapter presents the characteristics for measured RSSI values which is central when
performing localization with Bluetooth smart technology. The section begins with a
brief description of what characteristics are expected in relation to related work and
literature on RF-based positioning. This is followed by measurements and results from
several settings: investigating of RSSI behaviour in a static setting, RSSI in relation to
distance, angle and variance over distance. To characterize the RSSI readings for Bluetooth smart a testbed is set up to measure values for different scenarios. Two Bluegiga
BLE112[38] chips powered by coin cell batteries with full power(3.3V) is programmed
to send an advertisement packet every 500ms. Two different units with MAC-addresses
”00:07:80:78:8C:EE” and ”00:07:80:78:8C:3E” are used to mitigate any temporal disturbances or chip deficiencies. The packets are received by the Sony Xperia ZR smartphone
described in5.3.1.2. The RSSI value is sent from the smartphone over Wi-fi to a laptop
running Matlab where data is aggregated and processed.

7.1

RSSI characteristics for Bluetooth smart

Based on conclusions from related work, it is expected that RSSI values are not necessarily a good indicator of distance between a positioning beacon and a ranging device.
Some literature suggest that RSSI in traditional Bluetooth is in fact a very poor measure of distance[27], while other work concludes that it is in fact quite acceptable[13].
Even with the changes introduced in the Bluetooth smart stack compared to traditional
Bluetooth, it is expected that the characteristics could be quite similar. Based on results
from traditional Bluetooth it is expected that RSSI values for Bluetooth smart will have
the following characteristics:
1. RSSI values for a device in a static setting (device is not moving), are not giving
static readings, instead the values differ within a limited interval.

57

7.2. STATIC RSSI MEASUREMENT

CHAPTER 7. RSSI ANALYSIS

2. There exists a correlation between distance and the average RSSI value measured
in a static setting with increasing distance.
3. The variation of measured RSSI-values increase with distance to the node aginst
which measurement are performed.
4. A formula of the form:
RSSI = −(10n log10 d + A)

(7.1)

exists where constants A and n can be determined to give a reasonable relation
between RSSI and distance.

7.2

Static RSSI measurement

To be able to draw conclusions from measured values in different settings, a baseline
needs to be established to determine how much values differ when measurements are
performed in a static setting where no external factors are changed. This will give an
approximation of how much multipath propagation, interference in the radio spectrum
and similar disturbances affect the measured results. Related literature[14] suggests that
individual RSSI readings tend to vary quite significantly. To counteract this effect, a
number of RSSI-values are collected and then the average of these values are calculated
and presented. Measurements are performed at a distance of k meters where k=1,3,7.
At each distance 20 average values are calculated where each average value is composed
of 30 measurements. The results are presented in Figure 7.1. From the results it is
observable that average RSSI has small variations when no external factors are changed.
To get a usable metric, the variance and standard deviation for the measured RSSIvalues at each distance are calculated. The formula used to calculate the standard
deviation is presented in Equation 7.2, where x is is obtained using Equation 7.3. The
observant reader will recognise this as the definition for the corrected sample standard
deviation. From the results, it can be observed that the variance and standard deviation
are quite small and that the measured average RSSI are quite similar even though single
measurements vary quite significantly.
v
u
N
u 1 X
s=t
(7.2)
(xi − x)2
N −1
i=1

v
u
N
u1 X
x=t
(xi )
N
i=1

58

(7.3)

7.3. RSSI VS DISTANCE IN BLUETOOTH SMARTCHAPTER 7. RSSI ANALYSIS

(a) Variance of measured RSSI at 1m

(b) Variance of measured RSSI at 3m

(c) Variance of measured RSSI at 7m

Figure 7.1: RSSI variance in static settings

Distance

Variance

Standard deviation(σ)

1m

0.1541

0.3925

3m

0.2950

0.5431

7m

0.7847

0.8859

Table 7.1: Variance and standard deviation for static measurements

7.3

RSSI vs Distance in Bluetooth smart

To investigate the relation between average RSSI and distance, measurements are performed at k meters where k=(0, 1, 2, 3...19, 20). At each distance 30 samples are
collected for each node. The orientation of the device is kept static during the entire
experiment and thus only distance is changed. The measured values are presented in
59

7.3. RSSI VS DISTANCE IN BLUETOOTH SMARTCHAPTER 7. RSSI ANALYSIS

Figure 7.2. Here it is observable that 30 unique sample values are not obtained at each
distance, instead the same RSSI is measured several times at each distance, represented
by different edge colors. The collected average for each position k is calculated with
Equation 7.4
m
1 X
xi
(7.4)
m
i=1

Where m is the number of collected values and xi is the measured RSSI value. The result
is presented in Figure 7.3. It can be observed that as predicted, each location shows a
great variance in measured RSSI values. When looking at the calculated average for the
different distances, a quite unfavorable result is found. Between 1 and 3 respective 4
meters, the curve follows the predicted behaviour where the signal strength is decreasing
almost linearly with distance. However after 3 respective 4 meters, the curve makes a
sudden veer and the measurements are suddenly increasing and starts flipping up and
down.
To rule out any chip related problem such as antenna placement, antenna design and
similar hardware specific factors, the same measurement are also performed with another chip model, Bluegiga BLE113[40] which is based on a different core system(Texas
instrument 2541, compared to BLE112s: Texas Instrument 2540). The measurements
of average RSSI in relation to distance are presented in Figure 7.4. A similar behaviour
is observed with different peaks and dips when the distance increases. It is however
necessary to emphasize that the characteristics have a slightly better, more positioning
friendly slope than what was observed for the TI 2540-chip. It is not necessarily well
suitable for accurate positioning resulting in coordinates. But from the graph it is possible to estimate the distance between the beacon and the measuring device at least with
coarse precision which can be seen in Figure 7.6. Similar to the distance classification
used by the the Estimote system[32].
This of course presents a great challenge and means that two of the expected characteristics does not hold. Characteristic 2 and 4 does not hold since a nice correlation
between distance and RSSI will not be possible to find. The measured results allow a
RSSI value to potentially correspond to two or more locations. For example, an RSSI
measure of -65dBm could with the BLE112 chip correspond to 6.5, 7.5, 9.3, 13.0, 14.5,
16.1, 17.9, and 18.2 meters as shown in Figure 7.5. It is easy to conclude that between
5-20 meters there exists no clear correlation between distance and RSSI. The RSSI reading oscillates between -60 and -75 during the entire distance. This means that in the
end, it would be impossible to find constants for A and n in characteristic 4 such that
the formula can fit the measured results.

60

7.3. RSSI VS DISTANCE IN BLUETOOTH SMARTCHAPTER 7. RSSI ANALYSIS

(a) Variance of measured RSSI of node 00:07:80:78:8C:EE

(b) Variance of measured RSSI of node 00:07:80:78:8C:3E

Figure 7.2: RSSI measurements for two Bluegiga Bluetooth smart nodes

61

7.3. RSSI VS DISTANCE IN BLUETOOTH SMARTCHAPTER 7. RSSI ANALYSIS

Figure 7.3: Average RSSI versus distance

Figure 7.4: Average RSSI for TI2541 Bluetooth smart-chip

62

7.3. RSSI VS DISTANCE IN BLUETOOTH SMARTCHAPTER 7. RSSI ANALYSIS

Figure 7.5: Diagram showing RSSI of -65dBm corresponding to several distances

Figure 7.6: Distinguishably different distance zones can be defined for the BLE113 chip

63

7.4. RSSI VS ANGLE

7.4

CHAPTER 7. RSSI ANALYSIS

RSSI vs angle

In the previous section the relation between RSSI and distance was explored. During all
the measurements, the angle between the beacon and the smartphone was constant at
0 ◦ . For a positioning system, it is also important to know how much the angle between
devices could affect the RSSI readings. The beacons are expected to be deployed on
walls or in the ceiling inside a building and positioning against them will be performed
with 360 ◦ of freedom. A report related to this project[41] expresses that the angle does
have a non-negligible effect on RSSI measurements. To investigate how large variance
the angle introduces we use a test area shown in Figure 7.7. The BLE112 Beacon
is used with two different orientations: Standing up (SU) and Laying down (LD) as
displayed in Figures 7.8(b) and 7.8(c). The Beacon is placed statically in the test area
and the smartphone is moved around the beacon in 360 ◦ as shown in Figure 7.8(a). The
smartphone is always kept at a fixed distance of k meters from the Beacon. Measurements
are performed for k=1,3,7 meters. This results in 8 measurements with different angles
for each orientation(SU,LD) with a difference in angle of 45 ◦ between each position. As
the test-setup in previous section, an average of 30 values in each position is calculated.
To mitigate any temporal environmental effects, each measurement is performed 3 times.
In the results only one of the measurements rounds are presented to save space, but
the measurements can easily be repeated with similar results. The measurements are
presented in 3 figures, one for each distance in Figures 7.9(1m),7.10(3m) and 7.11(7m).

Figure 7.7: Test area for orientation measurement’s

Looking at Figure 7.9 reveals great differences in RSSI related to different angles. For
SU orientation, 90◦ and 270◦ stand out with much weaker signal than the other angles
64

7.4. RSSI VS ANGLE

CHAPTER 7. RSSI ANALYSIS

(a) Angle orientation

(b) LD position

(c) SU position

Figure 7.8: Chip orientation for angle vs RSSI measurement

for the same orientation. In LD orientation, 0◦ , 180◦ and 135◦ stand out with much
weaker signal strength than other measured angles. Comparing the two orientations
at the distance of 1m reveals significant differences when the orientation changes. The
differences are well above the amplitude of any coincidental variations. The variance
and deviation for measured averages have been calculated in Table 7.2.
The results at a distance of 3 meters are presented in Figure 7.10 and show distinctly
different values. Here the variance and deviation between both angle and orientation are
much smaller. No angles significantly stand out for any of the orientations and also the
differences between orientations are quite limited. But looking at the calculated variance
and deviation in Table7.2 still reveals that they are well above the corresponding values
for background noise/interference/multihop influences measured in the static setting. It
appears that the angle has a considerable impact also at a distance of 3 meter, although
it is significantly smaller than what was observed for 1 meter.
The results from measurements at a distance of 7 meters confirm the findings from the
two previous tests at 1 respective 3 meters. The difference between angle and orientation
does have an impact on the RSSI reading, The result is presented in Figure 7.11. It is
necessary to emphasize that the variance between RSSI in LD-orientation at 3 meters is
65

7.4. RSSI VS ANGLE

CHAPTER 7. RSSI ANALYSIS

Figure 7.9: RSSI results for different orientation and angle at 1m distance

significantly smaller than any of the other obtained results and does not position itself
far away from background interference measured in the static measurements setup in
Paragraph 7.2. The difference for SU-orientation is in line with the results of the 3
meter measurements. The conclusion that can be drawn from the angle measurement
evaluation is that the angle does impact the average RSSI measurement, especially for
a close distance where the difference in values are large. When the distance increases
the difference between values decreases, both between angles and between orientations.
They still however make a non-negligible impact on the readings which is in line with
expected results based on findings in related literature.

Distance and orientation

Variance

Standard deviation(σ)

1m LD

17.3543

4.1658

1m SU

37.5078

6.1244

3m LD

5.3501

2.3130

3m SU

5.9025

2.4295

7m LD

1.6180

1.2720

7m SU

5.4198

2.3281

Table 7.2: Variance and standard deviation for different angle measurements

66

7.4. RSSI VS ANGLE

CHAPTER 7. RSSI ANALYSIS

Figure 7.10: RSSI results for different orientation and angle at 3m distance

Figure 7.11: RSSI results for different orientation and angle at 7m distance

67

7.5. RSSI VARIANCE OVER DISTANCE

7.5

CHAPTER 7. RSSI ANALYSIS

RSSI variance over distance

One of the predicted characteristics for RSSI was the variance in measured values in
static settings increases with distance. To validate whether this is the case we use data
collected in Paragraph 7.3 and calculate the deviation and variance for each distance.
The calculated Variance and deviation is presented in Table 7.3. A visual representation
of the measured values was presented in Figure 7.2. From the results it can immediately
be established that variance of values does not increase with distance. Instead the variance similar to the average RSSI oscillates up and down when the distance increases.

Distance

Variance

Standard dev(σ)

Distance

Variance

Standard dev(σ)

1m

2.8517

1.6887

11m

19.7023

4.4387

2m

3.4299

1.8520

12m

30.0517

5.4819

3m

11.9644

3.4590

13m

2.3920

1.5466

4m

28.8374

5.3701

14m

6.1946

2.4889

5m

40.5621

6.3688

15m

3.8724

1.9678

6m

9.2057

3.0341

16m

23.3575

4.8330

7m

11.1540

3.3398

17m

2.1609

1.4700

8m

5.4713

2.3391

18m

14.8057

3.8478

9m

14.9437

3.8657

19m

9.9644

3.1566

5.1506

2.2695

20m

2.2862

1.5120

10m

Table 7.3: Variance and standard deviation for different distances

7.6

RSSI conclusions

The results from the RSSI measurement experiments in this chapter reveal several challenging and unfavorable characteristics for RSSI as parameter to perform positioning.
A relation between distance and RSSI is only observable when a beacon and the positioning device are very close to each other. After the first meters, the values oscillate
up and down for quite a long distance. The same behaviour is observed when Tx power
is decreased in the beacons, the same pattern is observable, although the duration is
decreased. Furthermore properties such as angle and obstacles have major impact on
measured values. Combining these characteristics means that RSSI for positioning is
not a very robust parameter. Comparing measurements in different scenarios such as
Paragraph 7.2 and Paragraph 7.3 also reveals that even for the same distance, the mea68

7.6. RSSI CONCLUSIONS

CHAPTER 7. RSSI ANALYSIS

sured RSSI can vary significantly when the environment is changed. Meaning that not
only will the RSSI depend on factors within the positioning system such as angle and
distance to beacons, but also if the environment such as walls, furniture and ceiling are
changed (e.g one room has walls out of plaster, another room has lots of windows). The
Measured values will vary greatly.
There is also an observable difference in measurement from different devices even if
they have exactly the same design. in Paragraph 7.3 two different devices show similar
trends, but the measurements against the different devices at exactly the same distance
vary significantly in amplitude. It is easily observable that different chips with the same
design will have difference in measured RSSI between them, since RF-devices are highly
sensitive to even minimal irregularities in chip construction[42]. This means that if two
chips of the same type is used, they will likely not give exactly the same results even if
all external conditions are the same.
The results from the RSSI investigation disclose that trilateration based positioning,
where a distance is needed to calculate a position in a Bluetooth smart system seems to
be a poor approach unless the area is very small and the distances fall within the linear
distance/relation part of the curve. This explains the results from Chapter 5 well. Algorithms and approaches which rely on a correlation between RSSI and distance are likely
to achieve poor results simply because no such correlation when the distance increases
exists. Coupled with, sensitivity for changes in environment, orientation, and obstacles
renders such approaches less favourable.
The characteristics, although at a first glance appearing discouraging do however seem
to enable fingerprinting based approaches to positioning quite well. It is observable that
within an environment where calibration is made, measurements will not vary greatly.
This is observed in Paragraph 7.2 where measurements could be repeatably performed
with similar results. This means, a database of fingerprints could be saved and used
for positioning since values at a certain position do not change significantly over time.
The approach would still be vulnerable to changes in environment, node failures and
broken LOS. But since positioning is based on a radio map and not conversion of RSSI
to distance it can be explained why this approach achieves much better and consistent
results than trilateration and distance based algorithms.

69

8
Discussion
This chapter provides a discussion of questions related to indoor positioning based on
Bluetooth smart technology, its pros and cons, its applicable use cases as well as limitations and possible improvements.

8.1
8.1.1

Advantages and disadvantages
Advantages

From the evaluation it is clear that the use of Bluetooth smart technology in the context
of indoor positioning brings several advantages compared to previous attempts made
with traditional Bluetooth. One of the major improvements is the introduction of the
new Bluetooth smart mode ”Broadcasting” or advertisement which was described in
Chapter 2.2.2. The new feature makes it easy to implement a system which would scale
in satisfying manner when the number of clients increases. If the system is supposed
to work with a mobile centric architecture, the deployed beacons within the building
would simply need to broadcast their messages within a defined interval. All clients in
the vicinity can then intercept these messages and base their positioning either directly
on the received RSSI which is available when the message is received, or combine the
RSSI with extra data which can be sent in the payload of the message. The mobile
nodes perform passive scanning, meaning that the radio spectrum will only contain the
advertisement messages from beacons. Comparing this with the traditional Bluetooth
technology that requires all mobile nodes to perform active scanning, and all beacons
to explicitly respond to each inquiry trivially, leads to the conclusion that the Bluetooth smart technology is a much better suited candidate technology than traditional
Bluetooth. This development is very convenient in the context of indoor positioning.
Different approaches and technologies developed with traditional Bluetooth started with
different connection based solutions where the mobile node had to connect to beacons
to get access to parameters for performing positioning. When inquiry based RSSI was
70

8.1. ADVANTAGES AND DISADVANTAGES

CHAPTER 8. DISCUSSION

available, this presented another improvement since scalability would be better when
no connections needed to be set up, also the accuracy was significantly improved since
the GRPR could be avoided. The new modes and radio definition of Bluetooth smart
further improve the suitability for a positioning application.
Another Bluetooth smart characteristic which is related to the effect on the radio spectrum is the defined advertisement channels, which are specified to 37, 38, 39 in the
Bluetooth smart tecnology. From the experiments conducted in this project it can be
concluded that the discovery time for finding reference beacons can be considerably
shortened compared to Traditional Bluetooth. With traditional Bluetooth requiring
10.25 seconds for a complete scan and 4-6 seconds in practice for finding most nodes.
Bluetooth smart can easily be configured allowing mobile nodes to find beacons in less
than a second. This is a major advantage if responsiveness and real-time tracking capabilities are desirable within a system. It is also a characteristic which can be used
to improve precision of a Bluetooth smart positioning system. Since the quick update
rate allows for a system to collect an average of several individual values and perform
positioning on the average value. Instead of performing it on single values individually
which for Bluetooth and other RF technologies has the property of oscillating considerably.
Another factor speaking for Bluetooth smart within an indoor positioning setting is
its widespread global penetration in devices and in society. This is not an improvement from traditional Bluetooth which has an even deeper penetration in society and
devices. Bluetooth smart is however a technology which is being rapidly integrated in
different areas of society as well as in different devices. A clear example of this is the
fact that almost all high and middle end smartphones today, independent of manufacturer or operating system comes equipped with built in Bluetooth smart module. This
is a major advantage in several ways. First, the fact that the technology is widespread
and mass-produced means that unit costs are very low(1-5$/unit). Even if hundreds or
thousands of units are necessary to complete a big indoor positioning installation, the
hardware costs could be considered very reasonable or even inexpensive. In addition to
the fact that hardware is inexpensive, the fact that the small amount of power required
to power the beacon can be provided for years by a coin cell battery. Means that, a system could easily be deployed even in areas where supporting infrastructure is missing,
such as, power outlets, network equipment, etc. The widespread penetration also imply
that deploying a system based on any smartphone platform means that the solution can
be quickly deployed and available to almost all users today.
Furthermore the smartphone approach also means that a number of other sensors will be
available to improve the positioning systems performance. Smartphones normally come
equipped with sensors such as gyroscope, accelerometer and compass which provide data
that is very useful in a positioning context. This is in fact something that is widely used
in leading commercial systems in the market today, which was previously described in

71

8.1. ADVANTAGES AND DISADVANTAGES

CHAPTER 8. DISCUSSION

section 4.7.

8.1.2

Disadvantages

Based on the findings in this project, it can be established that Bluetooth smart does
not add any new disadvantages for usage in a localization context. Compared to traditional Bluetooth, it seems that only advantages and improvements are added. This
does however not mean that there are only advantages of using Bluetooth smart as technology for developing indoor positioning solutions. This project does reveal a number
of undesirable properties with the technology, which need to be carefully considered if
anyone wishes to use it in a positioning context.
The two most apparent problems are the lack of relation between RSSI and distance
and the problems related to robustness. Both these properties have a major impact on
both accuracy and precision. This implicates, careful consideration is needed when planning to use a system based on Bluetooth smart technology. This project has established
that an accuracy of a few meters is possible to achieve using only Bluetooth smart RSSI.
Meaning that usage in applications requiring very high accuracy, such as robotics, may
be unfitting. This is further motivated by the fact that robustness to interference or
changes in the surrounding environment are very low. Both conducted experiments in
this work as well as related work suggests that signal strength parameters in RF-based
solutions are very sensitive to obstacles and/or changes in the environment.
Another problematic factor depending on what technology and algorithms are used to
implement a Bluetooth smart positioning system is scalability. If a trilateration or distance based approach is used which relies on only knowing positions of reference nodes
and presence of LOS, scalability is after careful consideration not very good as described
in Paragraph 6.4.3. The fingerprinting/radiomap approach does also suffer from quite
serious scalability problems although it was deemed a bit better than the distance based
approaches. The problems with the approach are several. The first is how to handle an
expansion of a system after initial configuration have been performed. Problems are very
likely appear in areas where beacons overlap each others coverage areas. An example of
this has been constructed in Figure 8.1. in 8.1(b), a fingerprinting system has been deployed and reference data has been collected in areas marked with yellow triangles. Now
looking at 8.1(a), where the plan is to extend the reach of the positioning system. It is
notable that several of the newly deployed beacons overlap in their coverage with the old
beacons. This means that several of the old fingerprints in the twofold covered area will
be quite wasted. The fingerprints in this area is represented in Figure 8.1(a) by black
triangles. A fingerprint collected at any location in the twofold covered area will now
has major differences to any fingerprint in the database. A possible solution could be
engineered in two ways, either perform recalibration of most or all of the system, which
is resource consuming especially for large systems, or deploy the new beacons in such a
way that overlap between old and new beacons are minimized, which is difficult to do
in practice. Neither of theses approaches are optimal since both imply either significant
72

8.2. SUGGESTED IMPROVEMENTS

CHAPTER 8. DISCUSSION

(a) After expanding the calibrated area by
adding new beacons and deciding new fingerprinting positions

(b) The already calibrated area where the
training phase is already finished

Figure 8.1: An illustration of fingerprinting based positioning system before and after
expantion where the covered areas by the beacons overlap each others.

amounts of manual work or the introduction of significant error vectors. As an example,
selecting the second approach of minimizing radio overlap means that an area is introduced between the old and the new area where system performance can be expected
to be significantly degraded, see Figure 8.1(a). The radiation pattern for an antenna is
rarely symmetric, which combined with effects of multihop and reflection, means that it
is very difficult to draw a line where a beacon coverage area ends. This means that both
uncovered areas as well as twofold covered areas are likely to exist between a new and
an old fingerprinting database, resulting in degraded performance in terms of accuracy
and precision. The same problem is present also in the case when a reference node fails.
This project has demonstrated that different chips with exactly the same design and
implementation have small but not insignificant differences. For a system which relies
on radiomap/fingerprinting technology, this could result in performance degradation.

8.2

Suggested improvements

In the section above, advantages and disadvantages of a Bluetooth smart based positioning system was listed and discussed. In this section some possible improvements and
solutions for listed problems are presented. The focus of this project has been entirely
on the evaluation of a system based solely on Bluetooth smart without any other technologies, furthermore not all possible algorithms and techniques to mitigate potential
problems have been discussed in detail since the number of such solutions are immense.
In this section, a number of such techniques and suggestions are briefly described to

73

8.2. SUGGESTED IMPROVEMENTS

CHAPTER 8. DISCUSSION

allow the reader to get an understanding of the available options and opportunities.

8.2.1

Machine learning/self adjustment

One of the major disadvantages of fingerprinting based positioning approaches is the
poor scalability, how to handle failed nodes and how to handle changes in the environment. The problem has its root in the fact that the database or map that is the core
of the solution is static, it is thus only valid at configuration time and for as long as no
changes or failures occur. To mitigate this problem, the suggestion is to make use of machine learning approaches and neural networks. An example of system with redundancy
is presented in [43]. The system does not really manage all of the mentioned problems
but it clearly demonstrates a usable principle for dealing with them. By adding redundant nodes the ability to mitigate node failures naturally improved. A possible extension
to this described in several related papers suggests to make a positioning systems selfcalibrated or self-adjusting. By adding a new calibration mode to beacons in addition
to the positioning/broadcasting mode used for localization the system can be designed
to continuously recalibrate itself. This is not a small technical challenge and will likely
require a fully connected infrastructure for all nodes in the system as well as a connection
to the database containing all calibration data. The idea is that the system recalibrate
itself all the time and updates the database with reference data. The solution could be
implemented either by deploying dedicated calibration nodes in the system which will
require more nodes. It could also be provided if nodes support the ability to change between modes. Which makes it possible for a positioning node to switch into a calibration
node temporarily to update the system’s database. The idea for a system with these
mentioned properties has been suggested in several papers although to the best of our
knowledge, no system exists today which satisfies the requirements well.

8.2.2

Additional data sources

A popular approach already extensively used to improve performance of indoor positioning systems is to fuse data from several sources and sensors into the positioning
determination. This approach is commonly used by the state of the art commercial
systems today and is also a principle widely used in academic projects on indoor positioning. The idea is a viable option for improving the performance of several key
characteristics for positioning applications such as accuracy, precision and responsiveness. The topic of sensor fusion and related mathematical foundation and models such as
Bayesian theory[44], Kalman[16] and Monte-Carlo[17] -filters are already well established
and large amount of literature and material is available on the topic. The concept is to
use several different data sources to calculate the actual position. Even though some of
the sources temporarily deliver bad data, an example in the Bluetoth smart case could
be an obstacle preventing LOS measurement, the system will still be able to estimate a
fairly accurate and precise location since Bluetooth smart is only one of several inputs
to the system.

74

8.2. SUGGESTED IMPROVEMENTS

CHAPTER 8. DISCUSSION

Another advantage of this approach besides increased performance, is the fact that the
potential additional data sources are widely available today. Wi-Fi, which is a commonly
used secondary radio parameter or primary when using Bluetooth smart as secondary, is
widely deployed in today’s society. This makes it easy to incorporate it in a positioning
system, since the infrastructure is most likely already deployed. Other potential and
highly available data sources are different kinds of sensor data such as compass, gyroscope and accelerometer. These sensors are available both individually if the plan is to
create the positioning system entirely from scratch with construction of both hardware
and software. They are also commonly available and already integrated in most modern
smartphones today making it easy to access them and obtain the relevant data. The
data delivered by the sensors can be used to get information about heading, acceleration
and movement which can be useful for calculating and estimating the position.

8.2.3

Hybrid solution

A quite interesting approach which could be worth investigating would be to create a
hybrid system of the fingerprinting approach and the particle filter. But instead of using
the full fingerprint approach, use a cell based approach. The result would be a system
which would use a database and a single beacon with quite low Tx power in the middle
of each room that should support positioning. The positioning process would work in
two phases, first determining a room level position based on the database and weak cell
beacons. Followed by a more high accuracy position determination by running the particle filter against several powerful deployed beacons in the specific room. This would
solve complexity problems for both the fingerprinting approach and the distance based
approaches. Since no real fingerprints would have to be configured. Instead the database
would consist of information mapping a specific room to a specific cell beacon, combined
with information about which powerful beacons have LOS for the room in question and
should thus be used for position estimation by the particle filter. The complexity for
the distance based approaches is solved since the system will now only perform measurements against nodes with LOS, and not take nearby nodes which transmits through
walls or obstacles into account.
Although the solution might provide a significant performance increase related to both
accuracy, precision, complexity and scalability. It is not a quick fix suitable in all applications. There are still some problems since the approach will not work if rooms are
very large. The evaluation performed in this report showed that for a 8x11 meter room
with LOS, a particle filter based approach was superior to the fingerprinting approach.
However, if the room gets bigger and distances end up beyond the linear relationship
found for the first meters when the distance between nodes increases. It would no longer
achieve better results since there is a lack of relation between distance and RSSI at larger
distances. Looking at the RSSI evaluation in Chapter 7, it is possible to at least expect
a nice property when Tx power is increased. For the BLE112 chip with transmit power
of 3dBm, a linear relationship existed between 0 to 4 meters. The same relationship
was true for the BLE113 chip which has a lower Tx power of 0dBm, with the difference
75

8.2. SUGGESTED IMPROVEMENTS

CHAPTER 8. DISCUSSION

that the linear relationship existed only between 0 to 1.5 meters. The Bluetooth smart
specification allows for Tx power up to 10dBm and if the same pattern can be observed,
it is possible that the distance with linear or almost linear relationship can be extended
several meters. Allowing deployment in larger rooms.
It is necessary to emphasize that this is a theoretical hypothesis, but it could be an
interesting topic to investigate for increasing Bluetooth smart positioning performance.

8.2.4

Hardware considerations

A very interesting approach that has been found during this project but not practically
evaluated is the possibility to design hardware which would improve Bluetooth smart
for use in a positioning context. Most commercial systems as well as academic research
have put a lot of effort on software and algorithm development. During the project two
important factors related to hardware was found, at first it was concluded that RSSI
measurement which is the parameter used in the evaluation varies greatly between different hardware and chips. The difference is not only observable between hardware with
different design and configuration, it is also indeed observable between hardware with
the same manufacturer and exactly the same design and configuration. This needs to
be carefully considered while designing a localization system based on Bluetoth smart
technology. This is also a characteristic that is actually considered in the iBeacon technology covered in Paragraph 4.7.1. The trademarked technology which actually describes
a GATT-service, contains the parameter A, which is the measured RSSI at 1 meter as
described in Paragraph 4.1.1 in the payload, which the iBeacon nodes broadcast.
The second important factor related to hardware was the fact that a specialized hardware solution seem to outperform all ”software-heavy” solutions which relies on sensor
fusion and RSSI values. In Paragraph 4.7.5 a system able to determine AOA is described
which provides performance that exceeds both commercial Bluetooth smart solutions as
well as academic research based on Bluetooth and/or Wi-Fi. This implicates that a more
hardware based solution could be a viable alternative. The knowledge about antenna
arrays and the principle of determining AOA has made good progress in the last couple
of years[45] and may be an interesting possibility.
Another more theoretical idea which surfaced during the project is to perform localization based on TOF or TDOA. It is important to emphasize that this is only in the
idea stage and no practical evaluation of the possibilities with relation to Bluetooth
smart exists. Although other systems exists which successfully relies on TOF/TDOA
such as GPS. The reason why it might be a plausible idea is the fact that high precision
embedded atomic clocks are being introduced on the market[46]. If the clocks in systems
allow for synchronization with precision of a few nanoseconds, TOF could, at least in
theory be a possible alternative for a high accuracy Bluetooth smart indoor positioning
system.

76

8.3. PROXIMITY APPLICATIONS

8.3

CHAPTER 8. DISCUSSION

Proximity applications

An application that is related to localization and positioning is the concept of proximity
detection and location awareness. It is not really positioning in the sense of providing
exact coordinates or an exact position in a reference geographical coordinate system.
But it is highly current in the context of the Bluetooth smart technology and also rather
simple to implement. The application is interesting because in many cases it is not
necessary to know an exact location, instead it is fully sufficient to know roughly in
which area something is located. This thesis concludes that Bluetooth smart is highly
suitable for such applications. While using Bluetooth smart-RSSI for high accuracy
positioning has several challenges, using it for coarse distance estimation is simple. In
chapter 7, the properties of RSSI in relation to distance was thoroughly explored. The
result confirms the properties that for example the popular iBeacon technology promises.
Separation of distances in three zones: immediate, near and far can be easily made no
matter which hardware is used. It is also a very popular approach to combine location
awareness/positioning with different kinds of information services. This is of course
something for which Bluetooth smart also is a very suitable technology. With the changes
in the stack and the introduction of, for instance, the broadcast mode with voluntary
data payload, it becomes easy to think of a location aware application running on a
smartphone. Depending on distances to beacons and some unique IDs embedded in the
advertisement messages, the system will present the user with different information or
data, which it can fetch online or from a database in the application itself.

8.4

Privacy aspects of positioning

An important topic related to positioning and location awareness is the matter of privacy. With the prospect of including indoor positioning functionality in smartphones and
gadgets to enhance and provide services for users in retail, museums, hospitals, industry
and airports to name a few. It is important to clearly elaborate on how this data is and
can be used or shared. Positioning systems can potentially provide users with improved
service and experience, but the same data can also be used by others to perform live
tracking and monitoring of the users.
A distinct example of such a use case is when deploying an indoor positioning system in
a shopping mall. The system will help a user navigate within the premises and might
also offer advantageous discounts and offers. But the entity controlling the application
can potentially also perform real-time tracking of the user and in detail map the users
movements and behaviour. The privacy topic is not new and positioning services such
as GPS and GLONASS are already able to track users and devices outdoors with high
accuracy and precision. A key aspect is thus to make users aware about how positioning
data is used.
Returning to the smartphone scenario, if an application demands access to high precision
77

8.4. PRIVACY ASPECTS OF POSITIONING

CHAPTER 8. DISCUSSION

positioning data from GPS or coarse position data based on cell tower information. A
user can clearly understand that the location will in some way be shared with the entity
behind the application. If an application instead just demands access to use the smartphones built-in Bluetooth chip, it might not be as clear to understand that this could
allow high/coarse precision tracking and monitoring capabilities. The same reasoning
can also be further extended, just because the application provides positioning abilities
locally for the user, it will not automatically make the user aware that the application
at the same time provides both the entity behind the application and potentially third
parties with information about movement and behavior.

78

9
Conclusion and future work
This chapter presents the conclusions reached by the evaluation and does also provide
some advice for future work that would be of interest in the area.

9.1

Conclusion

Indoor positioning based on Bluetooth smart technology has been tested and evaluated
based on several known algorithms in the area of positioning. The goal was to evaluate
the suitability and the applicability of using Bluetooth smart technology in the context
of indoor positioning. Furthermore tests where performed to analyze RSSI behaviour
in indoor environments. The practical experiments were preceded by a comprehensive
study of earlier research in RF based indoor positioning. The conclusion of the evaluation is that Bluetooth smart can be considered a viable candidate solution depending
on the requirements. The approach can deliver accuracy of a few meters with relatively high precision which is enough to facilitate navigation and tracking of humans
and goods. The response time is good or even excellent with the changes done to the
RF properties. The deployment is simplified by low cost of beacons combined with the
fact that no extra stationary infrastructure needs to be deployed, since beacons run for
years on batteries. A couple of pitfalls was also discovered during the evaluation which
will be important to consider before deploying a system. In particular, the utilized RSSI
parameter has poor correlation with distance, making distance dependent approaches
unsuitable. This can be surmounted by relying on characteristic based approaches at
the cost of deployment complexity. The exhibited sensitivity of RSSI also results in low
robustness to environmental changes regardless of positioning algorithm. In the end,
it can be concluded that Bluetooth smart introduces several improvements to inexpensive indoor positioning. Faster response time, independence from fixed infrastructure,
advertisement support and power efficiency are important and worthy to mention improvements. Particularly in static scenarios where the environment does not change and

79

9.2. FUTURE WORK

CHAPTER 9. CONCLUSION AND FUTURE WORK

an expansion of the system is not forthcoming.

9.2

Future work

Even though the evaluation was done according to plan, several improvements could be
added if the time and the budget would have permitted. Some limitations in Bluetooth
low energy and Bluetooth in general are caused by implementations done by vendors.
An example of this is the filtering behaviour of discovered nodes by the Bluetooth smart
module in the Android smartphone. In the phone, the onLeScan method does not report
the same device multiple times in the same scan even if the advertisement interval is
really small. A potential improvement in the future is to have a mobile node as an independent module or a customized system rather than a mobile phone which does impose
limitations in the lower layers.
Another potential improvement that can provide significant improvements could be to
evaluate a Bluetooth smart based positioning system using AOA. This can be achieved
by customizing hardware such as using directional antennas or an antenna grid. The
performed literature study seems to support such an approach
Another related topic of great interest would be to evaluate strategies for beacon positioning. We have seen that both the amount of beacons used as references as well as
their position affect primarily the accuracy and precision of the positioning. A formal
strategy for good beacon positioning would be a helpful tool.
A related concept to beacon placement is the hybrid solution discussed in Paragraph
8.2.3. It would be interesting to combine a characteristic based approach with the distance based approach, to potentially introduce a significant performance increase for
several characteristics in Bluetooth smart based positioning. Especially if the systems
were to be deployed in a scenario with not too many large open areas.
Finally the topics of scalability and deployment complexity could benefit largely by
future evaluation and development. Machine learning approaches and data fusion algorithms to allow simple deployment, expansion or repair of deployed systems could
improve RF based positioning significantly.

80

Bibliography

[1] Specification of the bluetooth system, Tech. rep., Bluetooth special interest group,
version 4.0 (may 2010).
[2] B. SIG, A look at the basics of bluetooth technology (May 2014),
URL http://www.bluetooth.com/Pages/Basics.aspx (Accessed 2014-05-26).
[3] L. E. Frenzel, Bluetooth low energy finally earns some respect, Electronic Design
59 (10) (2011) 23, copyright - Copyright Penton Business Media, Inc. and Penton
Media, Inc. Aug 11, 2011; Last updated - 2012-02-27; CODEN - ELODAW; SubjectsTermNotLitGenreText - United States–US.
URL http://search.proquest.com/docview/923610018?accountid=10041
[4] Bluetooth-SIG, Specification adopted documents (March 2014),
URL
https://www.bluetooth.org/en-us/specification/adoptedspecifications/ (Accessed 2014-03-18).
[5] I. Bluetooth SIG, Radio architecture,
URL https://developer.bluetooth.org/TechnologyOverview/Pages/Radio.
aspx (Accessed 2014-05-06).
[6] J. Donovan, Bluetooth goes ultra-low-power, Tech. rep., Digi-Key corporation, (Accessed 2014-06-09) (December 2011).
URL http://www.digikey.com/en/articles/techzone/2011/dec/bluetoothgoes-ultra-low-power
[7] C. Gomez, J. Oller, J. Paradells, Overview and evaluation of bluetooth low energy:
An emerging low-power wireless technology, Sensors 12 (9) (2012) 11734–11753.
[8] E. Mackensen, M. Lai, T. Wendt, Bluetooth low energy (ble) based wireless sensors,
in: Sensors, 2012 IEEE, 2012, pp. 1–4.
[9] M. Galeev, Bluetooth 4.0: An introduction to bluetooth low energy—part 1 (July
2011),

81

BIBLIOGRAPHY

BIBLIOGRAPHY

URL hhttp://www.eetimes.com/document.asp?doc_id=1278927 (Accessed 201406-09).
[10] R. Nilsson, B. Saltzstein, Bluetooth low energy technology and healthcare, Tech.
rep., Connectblue Inc, (Accessed 2014-06-09).
URL http://www.connectblue.com/press/articles/bluetooth-low-energytechnology-and-healthcare/
[11] A. Hossain, W.-S. Soh, A comprehensive study of bluetooth signal parameters for
localization, in: Personal, Indoor and Mobile Radio Communications, 2007. PIMRC
2007. IEEE 18th International Symposium on, 2007, pp. 1–5.
[12] M. S. Bargh, R. de Groote, Indoor localization based on response rate of bluetooth
inquiries, in: Proceedings of the First ACM International Workshop on Mobile
Entity Localization and Tracking in GPS-less Environments, MELT ’08, ACM, New
York, NY, USA, 2008, pp. 49–54.
[13] F. Subhan, H. Hasbullah, A. Rozyyev, S. Bakhsh, Analysis of bluetooth signal parameters for indoor positioning systems, in: Computer Information Science (ICCIS),
2012 International Conference on, Vol. 2, 2012, pp. 784–789.
[14] A. Raghavan, H. Ananthapadmanaban, M. Sivamurugan, B. Ravindran, Accurate
mobile robot localization in indoor environments using bluetooth, in: Robotics and
Automation (ICRA), 2010 IEEE International Conference on, 2010, pp. 4391–4396.
[15] H. Bao, W.-C. Wong, An indoor dead-reckoning algorithm with map matching, in:
Wireless Communications and Mobile Computing Conference (IWCMC), 2013 9th
International, 2013, pp. 1534–1539.
[16] M. S. Grewal, dawsonera (e-book collection), Kalman filtering: theory and practice
using MATLAB, Wiley-Blackwell, Oxford, 2008.
[17] A. Haug, Bayesian estimation for target tracking, part iii: Monte carlo filters, Wiley
Interdisciplinary Reviews: Computational Statistics 4 (5) (2012) 498–512.
[18] S. Goswami, Indoor Location Technologies, Springer New York, 2013.
[19] D. Niculescu, B. Nath, Ad hoc positioning system (aps) using aoa, in: INFOCOM
2003. Twenty-Second Annual Joint Conference of the IEEE Computer and Communications. IEEE Societies, Vol. 3, 2003, pp. 1734–1743 vol.3.
[20] Y. Wang, X. Yang, Y. Zhao, Y. Liu, L. Cuthbert, Bluetooth positioning using
rssi and triangulation methods, in: Consumer Communications and Networking
Conference (CCNC), 2013 IEEE, 2013, pp. 837–842.
[21] N. A. Mahiddin, N. Safie, E. Nadia, S. Safei, F. Engku, Indoor position detection
using wifi and trilateration technique, The International Conference on Informatics
and Applications (ICIA2012).
82

BIBLIOGRAPHY

BIBLIOGRAPHY

[22] J. Rodas, C. Escudero, D. Iglesia, Bayesian filtering for a bluetooth positioning
system, in: Wireless Communication Systems. 2008. ISWCS ’08. IEEE International
Symposium on, 2008, pp. 618–622.
[23] T. Alhmiedat, G. Samara, A. O. A. Salem, An indoor fingerprinting localization
approach for zigbee wireless sensor networks, CoRR abs/1308.1809.
[24] L. Chen, L. Pei, H. Kuusniemi, Y. Chen, T. Kröger, R. Chen, Bayesian fusion for
indoor positioning using bluetooth fingerprints, Wireless Personal Communications
70 (4) (2013) 1735–1745.
[25] S. Chawathe, Low-latency indoor localization using bluetooth beacons, in: Intelligent Transportation Systems, 2009. ITSC ’09. 12th International IEEE Conference
on, 2009, pp. 1–7.
[26] S. Chawathe, Beacon placement for indoor localization using bluetooth, IEEE, 2008,
pp. 980–985.
[27] Q. Dong, W. Dargie, Evaluation of the reliability of rssi for indoor localization,
in: Wireless Communications in Unusual and Confined Areas (ICWCUCA), 2012
International Conference on, 2012, pp. 1–6.
[28] J. Shlens, Notes on kullback-leibler divergence and likelihood, CoRR abs/1404.2000.
[29] B. Fuglede, F. Topsoe, Jensen-shannon divergence and hilbert space embedding, in:
Information Theory, 2004. ISIT 2004. Proceedings. International Symposium on,
2004, pp. 31–.
[30] ibeacons bible, Tech. rep., Andy Cavallini, Gaia-Matrix, version 1.0 (April 2014).
[31] I. Apple, Mfi program enrollment- frequently asked questions (May 2014),
URL https://mfi.apple.com/MFiWeb/getFAQ.action (Accessed 2014-05-13).
[32] O. Puchta, Estimote- rssi, range, zones, and distance accuracy (April 2014),
URL https://community.estimote.com/hc/en-us/articles/201029223-RSSIRange-Zones-and-Distance-Accuracy (Accessed 2014-04-16).
[33] SenionLab, Senionlab- solutions,
URL http://www.senionlab.com/solutions (Accessed 2014-06-02).
[34] Indoo.rs, Frequently asked questions (April 2014),
URL http://indoo.rs/questions/ (Accessed 2014-04-04).
[35] J. Caeyman, Quuppa - makes high accuracy indoor positioning commercially available (November 2013),
URL http://www.in-location-alliance.com/files/ILA/ILA_Munich_Quuppa.
pdf (Accessed 2014-05-28).

83

BIBLIOGRAPHY

BIBLIOGRAPHY

[36] A. Masson, Insiteo -towards a fully global system? (March 2010),
URL http://www.application-days.eu/presentations/day2/lbs/8.insitio.
pdf (Accessed 2014-05-12).
[37] J. Nikhilesh, B. Rupal, Accuracy vs. precision,
URL http://www.diffen.com/difference/Accuracy_vs_Precision (Accessed
2014-03-14).
[38] Ble112 data sheet, Tech. rep., Bluegiga Technologies, (Accessed 2014-02-10) (May
2013).
URL
http://www.mouser.com/ds/2/52/Bluegiga_Technologies_BLE112_
Datasheet-293747.pdf
[39] IAR-Systems, Iar embedded workbench for 8051,
URL http://www.iar.com/Products/IAR-Embedded-Workbench/8051/
cessed 2014-03-14).

(Ac-

[40] Ble113 data sheet, Tech. rep., Bluegiga Technologies, (Accessed 2014-02-10) (Nov
2013).
URL http://www.mouser.com/catalog/specsheets/Bluegiga_Technologies_
BLE113_Datasheet.pdf
[41] D. Scheerens, Practical indoor localization using bluetooth, Master thesis (2012),
University of Twente.
[42] S. Lucyszyn, Advanced RF MEMS, Cambridge University Press, 2010.
[43] M. Altini, D. Brunelli, E. Farella, L. Benini, Bluetooth indoor localization with
multiple neural networks, in: Wireless Pervasive Computing (ISWPC), 2010 5th
IEEE International Symposium on, 2010, pp. 295–300.
[44] H. B. Mitchell, Bayesian Decision Theory, Springer Berlin Heidelberg, Berlin, Heidelberg, 2012, pp. 273–293.
[45] L. Mailaender, S. Affes, M. Juntti, M. Pesavento, Advances in angle-of-arrival and
multidimensional signal processing for localization and communications, EURASIP
Journal on Advances in Signal Processing 2011 (1) (2011) 1–2.
URL http://dx.doi.org/10.1186/1687-6180-2011-94
[46] Quantum sa.45s csac - chip scale atomic clock, Tech. rep., Microsemi Corporation,
(Accessed 2014-05-28) (January 2014).
URL
http://www.microsemi.com/document-portal/doc_download/133305quantum-sa-45s-csac

84

