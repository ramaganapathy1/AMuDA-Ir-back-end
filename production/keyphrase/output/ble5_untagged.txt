indoor localization based on response rate of bluetooth inquiries mortaza s bargh robert de groote telematica instituut p.o  box 589  7500an enschede the netherlands +31  0  53 485 0443 telematica instituut p.o  box 589  7500an enschede the netherlands +31  0  53 485 0445 mortaza.bargh @ telin.nl robert.degroote @ telin.nl provoked by predefined events   from single-target to multi-target  i.e  interrelating several targets among each other   from selfreferencing to cross-referencing  i.e  other users requesting a users location   and from content-oriented to application-oriented  i.e  richer applications developed around user location   1   abstract location is considered as the most important and relevant context information  bluetooth technology  being a common feature of commercial mobile devices  is a  or the  key technology that is pervasively available nowadays  there has been not much success in using bluetooth technology for indoor localization  mainly due to the limitation of the technology  using the context management frame  cmf  infrastructure deployed in our office building  we have designed  implemented and evaluated a bluetooth based indoor localization solution that determines the locations of stationary mobile users at a room level  the solution is based on the inquiry response rate of bluetooth technology  this approach does not require establishing any connectivity between bluetooth devices  further  since the solution is infrastructure and network-based  it does not require mobile devices to be upgraded in any way in order to be localized  the results of experiments show that our solution has 98 % accuracy in rooms with full bluetooth sensor coverage  when the target device being stationary for 3 minutes  location determination is the main component of the systems that deliver lbss  for outdoor environments global positioning system  gps  provides an effective solution to determine location of gps enabled mobile devices  for indoor environments  however  such an effective solution does not exist  as a result  indoor location determination is an active area of research nowadays  in this contribution we consider an indoor localization solution that relies on bluetooth technology that  being a common feature of mobile devices  is a pervasive technology currently  most bluetooth based solutions rely on network characteristics like received signal strength  rss   bluetooth rss  specified as rss indicator  rssi  and link quality  lq   is not a reliable measure considering the heterogeneity of bluetooth hardware in available devices  this is partly resulting from an imprecise definition of rss in the bluetooth standard  2   obtaining bluetooth rss  moreover  generally requires establishing connectivity between corresponding devices  this requires users to maintain their devices in connectable mode  which is considered unsafe by most users  categories and subject descriptors c.2.4  computer-communication-networks   systems distributed applications distributed general terms our location determination method is a fingerprint-based localization solution that relies on only the response rate  rr  of bluetooth inquiries  this just requires mobile devices to be in discoverable mode  according to this approach  every location is fingerprinted by inquiry rrs  irrs  of bluetooth sensors installed in a multi-floor building  after obtaining the irr of a target device to be localized  our system uses relative entropy measure  i.e  kullback-leibler function  and its extension  i.e  jensen-shannon distance measure  to estimate the location of the target device  we evaluated the performance of the solution by carrying out some experiments in an infrastructure deployed in our entire office building  the accuracy of our location estimation is almost 98 % in a room where all neighboring rooms have bluetooth dongles  note that this performance was obtained when different device types were used for the fingerprinting of rooms  and the target device to be localized differed from those devices used for room fingerprinting  during our experiments  moreover  the target device was relocated in the test room every hour  our solution aims at determining location at a room level  which is a meaningful granularity for a wide range of indoor applications  moreover  our approach does not require any upgrade to mobile algorithms  measurement  performance  verification keywords indoor localization  bluetooth  response rate  office buildings 1 introduction location based services  lbss  have resurrected in recent years due to several important developments like emergence of gpscapable mobile devices  introduction of web 2.0 platform  and deployment of wireless broadband wireless services  1   there are also a number of paradigm shifts that have contributed to resurgence of lbss  namely  from reactive to proactive  i.e  permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page  to copy otherwise  or republish  to post on servers or to redistribute to lists  requires prior specific permission and/or a fee  melt08  september 19  2008  san francisco  california  usa  copyright 2008 acm 978-1-60558-189-7/08/09  $ 5.00 49 infrastructures  i.e  preferably require no upgrade of user terminals  need no excessive hardware installation  and use existing technologies   impose low power consumption on mobile terminals  and use low cost infrastructure  6   as mentioned in  6   zigbee and bluetooth are two technologies that impose low power consumption on mobile terminals  it is  however  bluetooth technology that has been deployed pervasively nowadays and it is considered to be the fastest growing technology since the internet or the cellular phone  see pp  xiii  7   having no mobile terminal upgrade has guided us to adopt an infrastructure-based and network-based approach  as categorized in  2   in such an approach a target device to be localized must be in discoverable mode and almost all of localization process is delegated to bluetooth infrastructure  i.e  to bluetooth access points and the backend server  as described in detail in section 3   devices to be localized and it inflicts low power consumption on mobile devices due to its reliance on bluetooth technology  the rest of the paper is organized as follows  section 2 gives some background information over existing localization approaches and our bluetooth based solution  section 3 describes our solution in detail  section 4 provides the results of our evaluation of the proposed solution  finally section 5 presents our conclusions and future research directions  2 background 2.1 localization approaches localization systems can be divided into two categories  processing based and fingerprint based  processing based systems use techniques like lateration  angulation  dead reckoning and proximity detection  see  2  for references  for example  the famous gps uses lateration and angulation techniques to derive the coordinates  i.e  position  of gps devices  these techniques process different parameters of radio signals like rss  angle of arrival  time of arrival  and time difference of arrival  processing based systems generally rely on dedicated software/hardware and they are not much effective indoors  indoor environments affect the propagation of wireless signals non-deterministically due to sever multi-path effects  dead-spots  noise and interference  3   as a result  it becomes infeasible to construct a simple and accurate model of indoor signal propagation which is required for the techniques mentioned  2.3 challenge and opportunity the process of establishing connectivity between two bluetooth devices relies on inquiry and paging mechanisms  the inquiry mechanism allows the inquirer to discover the bluetooth enabled devices in its neighborhood  the inquirer transmits a series of inquiry packets and the discoverable bluetooth device  which periodically scans for inquiries  eventually replies with a frequency hop synchronization  fhs  packet  the fhs packet contains all information that the inquirer needs to establish a bluetooth connection with the scanning device  e.g  device class and type   then  the paging mechanism is used to find out the services that a target device provides  to this end  the inquirer pages the target device using information obtained during inquiry  if the target device scans for paging  it replies  subsequently a connection is established between the two devices and the inquirer retrieves information about the services provided by the target device  after this the connection is generally shut down  using the information obtained during paging  the inquirer establishes another connection towards the target device with appropriate quality of service requirements  fingerprint based systems capture fingerprints of all known locations  these fingerprints are  pre-recorded  measurements of network characteristics in the corresponding locations and they can be considered as signatures of those locations  for localization of a target device  the momentary network characteristics of that device are examined with respect to the radio map  i.e  collection of location fingerprints  and most likely location is determined  the network characteristics used for fingerprinting include rss  access point id  and rr  a taxonomy of fingerprint based approaches is presented in  2   scanning devices can choose for two modes  discoverable and connectable  being in discoverable mode is enough for the inquiry mechanism  for establishing connectivity  however  scanning devices must choose for connectable mode which implies also being discoverable  the user acceptance barrier to maintain devices in discoverable mode is lower than it is for connectable mode  therefore  we require for target devices  i.e  those to be localized  to be just discoverable  rr is one of the network characteristic that is not well-explored for fingerprinting  it is defined as the frequency of received measurements over time from a given base station in  2  or the percentage of times that a given access point was heard in all of the wifi scans at a specific distance from that access point in  4   rr approaches proposed so far are used in combination with rss for localization with wifi technology  3   4  and with bluetooth technology  5   in this paper we design and evaluate a fingerprint method that relies on only irr fingerprints of bluetooth technology  our approach uses inquiry response rate as the sole network characteristic to fingerprint locations and localize target devices  every ts = 10 seconds bluetooth access points  i.e  the inquirers called dongles from now on  obtain a list of discovered object devices  the bluetooth irr is defined as the percentage of inquiry responses to total inquiries  replied by a discoverable target device and sent by a dongle that are located at a specific distance from each other  2.2 motivation and principles our work is motivated by the design of a location based application called colleague radar that locates coworkers in our office building  the application aims at locating users at room-level where users are assumed to be stationary for a while  e.g  the person being in her/his room or in a meeting room for a few minutes or more   this means that tracking users  in realtime  is not required for the application  many fingerprinting solutions are based on rss and access point id  recent findings indicate that rss should be used as a weak indicator of distance for indoors  4   cheng et al  4  explored wifi rr as a new metric for location estimation and found out that there is a strong relation between distance and rr  compare figures 2 and 3 in  4   we investigated the relation of irr and distance for bluetooth in our office  our test was carried out in on the other hand  successful and widely deployable indoor localization systems must integrate smoothly with existing 50 the system distinguishes between different types of bluetooth devices  dongles and mobile devices  bluetooth dongles are the inquiring sensors that are plugged in to the pcs of users  since these machines have a fixed location  only desktop pcs were used   the locations of these dongles are known  mobile devices are being discovered by the inquiring dongles  and can be further distinguished into two categories  reference devices and target devices  reference devices are mobile devices for which the location is known a-priori  since they are known to have been at a particular location at a particular point in time  target devices are devices for which there is no a-priori location information  it is the task of the bluetooth positioning system to estimate the location of the target devices by comparing their observed fingerprints with the  pre-recorded  fingerprints of the reference devices  little homogeneity exists among the bluetooth mobile devices  while the dongles are all of the same type  three locations  a room with a dongle  the hall outside the dongle room and a room across the hall  all irr measurements were carried out at points 2 meters apart on a straight line  both walls between the rooms and the hall were thin  however  there was a wide metal bookshelf behind the wall between the hall and the room across the hall  table 1 summarizes the test results and shows how irr decreases with increasing distance  each row of table 1 reports the average and variance of irr measurements measured every 5 seconds for 20 minutes  thus 240 samples   where every irr sample is the rr of the last 50 inquiries  table 1 measured irr with respect to distance location of the object device distance of devices average of irr variance of irr in the room of the bluetooth dongle 2m 97 % 1.8 in the hall outside the dongle room 4m 97 % 1.2 6m 99 % 1 8m 94 % 1.4 10 m 86 % 4.6 12 m 74 % 9.6 14 m 67 % 4.6 in room across the hall 16 m null null 18 m null null the bluetooth localization system architecture is shown in figure 1 schematically  this architecture encompasses the main system components in the central machine and does not include dongles connected to remote pcs  as shown in figure 1  room fingerprints are derived during training and  pre  stored in a database  on the other hand  the location fingerprint of a target device is detected in real-time and fed to a location estimator that compares it with room fingerprints one by one  the best match determines the location estimate of the target device  this estimate is fed to the colleague radar application  our system determines user locations when the users are stationary for a few minutes  if the target device moves between rooms  our location determination system does not give any particular location as an output  however a subcomponent indicates that the user is moving  this subcomponent is out of scope of this paper  to the best of our knowledge  there is no prior work that bases its location estimation process solely on the irr parameter  we adopted an irr based approach for two reasons   i  rss in bluetooth  e.g  rssi or lq  can not be obtained reliably due to the fact that power aspects are not standardized in detail  2  ; and  ii  obtaining rrs in bluetooth v1.1  based on which our dongles were manufactured  requires establishing connectivity between devices  an operation that is against our requirements  an irr based approach faces the challenge of a target device being detected by many bluetooth dongles of the surrounding rooms  in the rest of paper we propose a method that eliminates the location uncertainty imposed by the irrs of multiple bluetooth dongles  room fingerprint detection radio map  room irr fingerprints  location fingerprint detection location estimation location estimate movement detection figure 1 system architecture  3 approach 3.1 infrastructure and system 3.2 solution our bluetooth positioning system was implemented on top of an existing context management framework  cmf   the cmf is a publish-subscribe system where remote machines run so-called context-sources which publish contextual information to central machines that have subscribed to that type of context information  the location determination takes place in a central component called location estimator that subscribes to all bluetooth contextsources  bluetooth context-sources run inquiries periodically  and send the results of these inquiries to their subscriber as soon as an inquiry has completed  an inquiry result is a list of bluetooth addresses that were discovered by every bluetooth context source  in our setting  inquiries have a fixed length of 5.12s  and are started every ts=10s  let  d1  d2   dm  denote the set of the dongles installed on users pcs  we assume these pcs are located at topological locations  i.e  rooms  of the building  generally one in every room  this constitutes a dynamic sensor network connected through ethernet  dynamicity comes from the fact that users pcs can come and go as users log in and log out their systems  fingerprints indicate the spatial density of bluetooth cells in each room in that  given a room   a  which subset of dongles detect a discoverable mobile device in the room ; and  b  how often they discover the device  these are a function of rss  the geometry of the building  etc  we have two fingerprint types  training 51 fingerprint tk associated with room-k  k=1   k  and location fingerprint l associated with a target device  let  ik1  ik2   ikm  be the number of times that in a training window of wt seconds dongles  d1  d2   dm  have detected the reference device of room k further  let nt be number of inquiry done by these dongles in wt seconds  note that all dongles inquiry at a fix rate of every ts=10 seconds  thus nt given wt is independent of k   then  the training fingerprint tk is defined as a vector  tk =  tk 1  tk 2    tkm  =  = ik 1 ik 2 i     km  nt nt nt t log m || tkm  jm j n jm +  1 m  log t  ikm nt nt ikm 1  d  l || m  + d  tk || m   2 4 evaluation to evaluate the performance of our solution we conducted two tests in two rooms of size 4m6m in our office building  these rooms are called room-1 and room-2 from now on  our office building has 4 floors and each floor has about 20 rooms  room-1 was located in floor 2 and surrounded by rooms all with dongles  i.e  rooms on the right  left  top  and below had bluetooth dongles   room-2  on the other hand  was located in floor 3 and surrounded by rooms with and without dongles  i.e  rooms on the right and below had no bluetooth dongles   we refer to room-1 and room-2 as rooms with full and partial coverage  respectively  j1 j2 j     m  nt nt nt in each room we put a target device in 6 positions  for about one hour in each position  these positions were at least one meter apart and considered to be the most likely user locations  i.e  of room residences and visitors   the test rooms as well as all the surrounding rooms  12 and 14 rooms in total  were fingerprinted for the duration of the test  these fingerprints were obtained using dedicated reference devices that were  a  other than the target device and  b  of 4 different types  bluelon bt-002 body tags  htc-p3300 and 9000 and nokia e61 and n70  p  x  q  x  the kl divergence or relative entropy has the following interpretation  if a source produces symbols x according to distribution p  x   then a data compression scheme that uses p  x  to compress a sequence of such symbols will result in optimum entropy rate h  p  = p  x  log p  x  bits per symbol on x we carried out location estimations every 5 seconds for the target device in room-1 or room-2  using kl and js divergence measures  the estimation performance is evaluated based on estimation accuracy that is defined as the percentage of times in which a method gives the correct location estimate with respect to total number of estimations  the estimation accuracy can be determined for the most likely estimate and for 2 most likely estimates  i.e  that either of the rank 1 or rank 2 estimate is correct  and so on  we refer to these accuracy measures as top-1 or top-2 accuracy  respectively  average  if the data compression scheme uses another distribution q  x  instead of p  x  to compress the same sequence  then the result will have d  p||q  bits more on average  note that kl divergence is not a distance measure in that d  p||q  d  q||p   our approach approximates the location of the target device with the location of the closest room  the output of such a localization process must have minimum deviation or distortion from the real room where the user is physically  the physical/real location is characterized by l  thus our location estimate is room-k such that d  l||tk  is minimized  or  in figure 2 two graphs  1st and 3rd from top  show the top-1 accuracy of the kl scheme for the test in room-1  given two training window sizes of 5 and 30 minutes  i.e  wt=5 and 30  and as a function of localization window size wl  the training fingerprints for the graphs of figure 2 were obtained in the beginning of the test day  for wl 2  the accuracy of the kl method is almost 100 %  arg min  klk  = arg min  d  l || tk   k m =1 m =1 where m = 0.5  l + tk   note that  unlike kl divergence  js divergence is a distance measure in that jsd  p||q  = jsd  q||p   6   the location estimation component in figure 1 determines the location of the target device by finding the room fingerprint that best resembles the observed location fingerprint  this can be considered as a classification problem  the difference measure used in our system is based on the concept of information gain  calculated using the kullback-leibler  kl  divergence  for two probability mass functions p  x  and q  x   kl divergence is defined as  x jm  n jsd  l || tk  = let  j1  j2   jm  be the number of times that in a localization window of wl seconds dongles  d1  d2   dm  have detected a target device  then  assuming the same inquiry rate nt  the location fingerprint l is defines as  d  p  x  || q  x   = p  x  log m because in practice we determine location fingerprints using rather small training and localization window sizes  i.e  wt and wl   it is possible for some dongles to miss the replies of reference or target devices  this causes the kl measure to deviate enormously  therefore we have adopted its modified version called jensen shannon  js  divergence  6   defined as  each element tkm of tk  m=1   m  can be considered as an empirical binary distribution with parameter ikm nt  similarly  l =  l1  l2    lm  =  m d  l d  l || tk  = k to calculate klk  we assume independence between the binary random variables corresponding to the outputs of dongles given the location of a target device  then  the kl method  however  is sensitive to training data and partial dongle coverage  for example  its accuracy becomes about 7783 % if we use a different training data set in each hour or it 52 wl=3 and wt=10  for both tests  the accuracy of top-2 estimate is 100 %  becomes about 14-45 % if we do estimation in room-2 with partial coverage  therefore we adopted the js method whose performance is shown by two graphs  2nd and 4th from top  in figure 2 for the same training set  as can be seen from figure 2  the accuracy of js is slightly lower than that of kl  in all graphs mentioned so far  i.e  all graphs in figure 2  figure 3 and two bottom graphs of figure 4   we have used two different devices as a reference device to collect training data and as a target data to collect localization data in each room  in our experiments  moreover  the target device was moved every hour with respect to the reference device  if  in addition to training data  we used the rest of the data collected from the reference device for localizing the same reference device the approach commonly used in literature e.g   8  then we would have a top-1 estimate accuracy of almost 100 %  such performance indications are shown by top 2 graphs in figure 4 for the js method  using the same device for training and localization is often not realistic ; therefore  we have chosen to present our results based on a realistic case where training and localization devices differ  should in practice training and localization device be the same  our js based scheme achieves 100 % accuracy of top-1 estimate for both full and partial coverage even if wt=5 and wl=1.5  105 accuracy  %  100 95 90 85 80 kl 30 ' training kl 5 ' training js 30 ' training js 5 ' training 75 1 2 3 4 105 localization window  minutes  100 95 figure 2 accuracy of js and kl methods for training window sizes of wt = 30 and 5 minutes  accuracy  %  90 graphs of figure 3 show the performance of the js method when we used fresh training fingerprints obtained in the beginning of every hour  note that the training data was excluded when doing location estimation  the result shows minor sensitivity of js method to change of training data  especially for wt = 30  85 80 75 70 65 js 3' js 3' js 3' js 3' 60 55 105 50 localization  full coverage  same device localization  full coverage localization  partial coverage  same device localization  partial coverage 45 5 100 10 15 20 25 30 accuracy  %  training window  minutes  95 figure 4 accuracy of js method in two rooms with full and partial converge for wl = 3 minutes  90 5 conclusion and future work 85 80 js 30 ' training js 5 ' training js 30 ' fresh training js 5 ' fresh training in this paper we proposed a bluetooth based localization solution that works well when there is a high spatial density of bluetooth sensors  this means that it is suitable for multi-floor buildings with overlapping bluetooth cells  the solution is a fingerprinting approach that exploits the inquiry response rate of bluetooth technology  as such the solution does not require any upgrade of mobile devices and only requires these devices to be in discoverable mode  the solution was implemented and tested  the test results showed that the solution achieves top-1 estimation accuracy of 98 % and 75 % when there was full sensor coverage and partial sensor coverage  respectively  for this performance  the training and localization window sizes were 3 and 10 minutes  respectively  i.e  wl=3 and wt=10   75 1 2 3 4 localization window  minutes  figure 3 accuracy of js method with updated training data for wt = 30 and 5 minutes  for the js method  the effect of partial bluetooth dongle coverage is shown in figure 4 this figure  unlike previous ones  depicts accuracy for a localization window size of 3 minutes  i.e  wl=3  as a function of training window size wt  the bottom two graphs of figure 4 show the results of the top-1 estimate for duration of 260 minutes for the tests in room-1 and room-2 with full and partial coverage  respectively  for these graphs the training periods are chosen in the beginning of each test day  and the data obtained in the rest of each day is used for location estimation of the target device  as we observe  the accuracy of the js method for top-1 estimate in room-1 and room-2 is 97.82 % and 75 % for currently we are working on a number of issues and extensions  the impacts of interference and mobility on the rr are needed to be further studied and ways to deal with a time-variant rr are to be investigated  one approach hereto is to obtain and use fresh fingerprints  this solution direction  however  makes sense if one devises localization methods that work well with short fingerprints  the current approach of fingerprinting locations by 53 using dedicated reference devices  moreover  is infeasible when the number of locations is high  a better approach would be to automatically obtain these fingerprints  we are currently investigating whether the dongles used to record the fingerprints can be used as reference devices as well  this basically involves devising a control mechanism  i.e  control protocol and logic  that switches dongles between two modes  a mode where they are inquiring and one where they are discoverable  7 references  1  bellavista  p  kpper  a  helal  s 2008 location-based services  back to the future  journal of ieee pervasive computing  vol  7 issue 2  pp  85-89  april-june 2008   2  madhavapeddy  a and tse  a  2005 a study of bluetooth propagation using accurate indoor location mapping  in proceedings of the seventh international conference on ubiquitous computing  ubicomp 2005   beigl m et al   eds    lncs 3660  105 120 2005 dongles compatible with bluetooth v1.2 standard are able to provide also the rss of inquiry responses  it is important to investigate how much our scheme is improved if also the rss information of bluetooth inquiries is used for location determination  another interesting extension to examine further is to fuse the bluetooth sensor information with other types of sensor data  since our infrastructure  i.e  cmf  is providing contextual information from multiple sources  combining these sources could aid the location determination  should this combination allow the system to accurately determine the location of a target device  then the observed fingerprint of the target device could be used as a room fingerprint and added for the already existing fingerprints for that room   3  kjrgaard  m.b  2007 a taxonomy for radio location fingerprinting  in proceedings of the third international symposium on location and context awareness  loca 2007   springer lncs  vol  4718  pp  139-156   4  ladd a.m  bekris  k.e  rudys  a  kavraki  l.e  and wallach  d.s  2005 robotics-based location sensing using wireless ethernet  journal of wireless networks  january 2005  volume 11  number 1-2  p.p  189-204   5  cheng y.-c  chawathe  y  lamarca  a  krumm  j  2005 accuracy characterization for metropolitan-scale wi-fi localization  in proceedings of the 3rd international conference on mobile systems  applications  and services  mobisys 2005   seattle  washington  usa  2005  pp  233245 an interesting direction is to get some more insight into the impact of our approach on the mobile phones in terms of power consumption  the power consumption of a mobile device being inquired continuously will increase as the frequency of inquiries or the number of inquirers increases  on the other hand  a higher number of inquirers or a higher inquiry frequency will yield a more responsive system and possibly better  more accurate  fingerprints  an interesting research question is how the estimation accuracy relates to the power consumption of the mobile devices   6  mahtab hossain  a.k.m  hien nguyen van  yunye jin  wee-seng soh  2007 indoor localization using multiple wireless technologies  in proceedings of the ieee international conference on mobile adhoc and sensor systems  mass 2007   8-11 oct 2007  pp  1-8   7  fuglede  b and topsoe  f 2004 jensen-shannon divergence and hilbert space embedding  in proceedings of international symposium on information theory  isit 2004   27 june-2 july 2004  pp  31  6 acknowledgments this work is part of the freeband awareness project  http  //awareness.freeband.nl   freeband is sponsored by the dutch government under contract bsik 03025 the authors would like to thank niels snoeck  martin wibbels  markus jevring and maarten wegdam for their assistance in preparation of the infrastructure and for their helpful comments   8  bray  j  sturman c.f  2001 bluetooth  connect without cables  prentice hall ptr  2001   9  haeberlen  a  flannery  e  ladd  a.m  rudys  a  wallach  d.s  kavraki  l.e  2004 practical robust localization over large-scale 802.11 wireless networks  in proceedings of the 10th acm international conference on mobile computing and networking  mobicom 2004   philadelphia  pa  september 2004  acm  pp  70-84  54 