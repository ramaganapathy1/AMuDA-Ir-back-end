extreme-range rfid tracking chris paget ivegotta @ tombom.co.uk / @ chrispaget presented at blackhat usa 2010  las vegas  synopsis  if you think that rfid tags can only be read a few inches away from a reader you have n't met epc gen2  the tag that can be found in enhanced drivers licenses  this 900mhz tag is readable from 30 feet with off-the-shelf equipment  without amplifying the signal from a commercial reader i was able to equal the previous defcon record of 69 feet  and with less than $ 1000 of equipment i achieved considerably further than that  this talk covers everything you 'll need to know to read federally-issued rfid tags at extreme ranges and explores the consequences to personal privacy of being able to do so  intro to epc gen2 most modern rfid systems work on the principle of inductive coupling  a coil of wire in the reader transfers power to a coil of wire in the tag using a magnetic field  in much the same way as a transformer  magnetic fields are often referred to by ham radio operators by the name near field since field strength drops off very sharply with distance  as an inverse cube relationship  this is usually the primary limiting factor on rfid read range  enter epc gen2  epcglobal is a worldwide rfid standards organization whose specifications cover the vast majority of tags issued in the 900mhz band  correctly referred to as class 1 generation 2  gen2 is compatible with all previous classes and generations of 900mhz tags ; more importantly though  it does not use a magnetic field to transfer power to the tag  gen2 is much more akin to radar than it is to more traditional inductive rfid ; the reader is a true radio transmitter while the tags return data to the reader by changing how much of that transmission they reflect  i.e  they modulate their coefficients of reflectivity   since gen2 is based on radio and radar technologies we can use techniques from these domains to drastically improve the range at which tags can be read ; for an initial benchmark  a retail device will read tags at 30+ feet without modification  gen2 is a very active and widely-used technology  gen2-compliant tags are currently being issued as part of the western hemisphere travel initiative ; this includes the us passport card  the nexus  fast  and sentri border-crossing cards  as well as the enhanced drivers licence that is currently being issued by several us states and many canadian provinces  many supply chains also make use of gen2 ; while walmart is the best-known  many other retail chains are also deploying gen2-based systems and it is fair to say that gen2 is a common technology  several high-level variants exist which offer minor improvements to the basic gen2 specification but they are largely compatible with each other ; any gen2 reader should be able to read most gen2 tags  radar  iff  and the radar range equation since gen2 tags work in much the same way as radar it is sensible to have an understanding of radar to begin with  the word radar is an acronym for radio direction and ranging ; it works by bouncing radio waves off a distant object  a high-power transmitter  typically with a rotating dish  sends out a narrow beam of rf energy ; by timing how long it takes for this energy to be reflected  and by knowing the direction the dish is pointing  it is possible to calculate the direction and range of the target object  iff  identification of friend or foe  is a system built on top of radar  sometimes called secondary radar  while modern iff transponders operate without radar  iff was originally designed to return data to a radar ground station which identified the aircraft  this data was returned by electronically changing the efficiency with which the aircraft absorbed or scattered incident radio energy ; by returning more or less of the signal to the ground station it is possible to transmit digital data  a good analogy is that of the plane itself the plane can tip from side to side  controlling how much of the wing surface area is facing the radar station  and hence how much rf energy is reflected back   iff does the same thing electronically ; it is this mechanism that is used by gen2  since the operation of gen2 rfid is based on a radar system  the same mathematics as radar can be used  with some limits  to determine read range of gen2-based system  neglecting real-world effects for a moment  the purest form of this mathematics is the radar range equation  g r g t 2 p r r max = pt 4 2 source  thingmagic  http  //bit.ly/bknok  in this equation  rmax is the upper limit on read range gr and gt are the gain of the receive and transmit antennas is the wavelength of the frequency in use pr is the power output from the reader pt is the threshold power at which the signal can be received  i.e  the sensitivity of the receiver  i 'll revisit what this all means later but for the moment it 's important to note two things  1 gen2 read range is derived from the square root of transmitted power 2 gen2 read range is derived from the square root of antenna gain  in other words  if we increase either the output power of our transmitter or the directional gain of our antenna  we should expect to see the square root of that gain as a range increase  for example  if we go from 1 watt of rf power to 100 watts  we would expect to see a 10x increase in read range  10 being the square root of 100   of course the real world is far more complex than this  but it 's a good first-pass approximation  clearly we can scale gen2 read range by increasing both transmitter power and antenna gain ; first we must define the mathematical relationships involved  decibels  db  dbm & dbi  this paper will assume that the reader understands the basic mechanics of decibels  which i believe is common among technical folk  if not  i recommend reading the wikipedia page ; it explains them far better than i can  since decibels represent just the ratio between two quantities  it is sometimes useful to define one of those terms in a consistent manner  power is typically represented in units of dbm  where the reference unit is 1 milliwatt  1 watt of power then becomes 30dbm ; one hundredth of a milliwatt becomes -20dbm  and so on  the gain of an amplifier  and the loss of an attenuator  are typically expressed in db  so calculating an rf chain is reduced to simple addition and subtraction  20dbm  a hundred milliwatts  into an amplifier with gain of 30db  one thousand  becomes 20+30=50dbm  or one hundred watts  antenna gain is usually represented in terms of dbi  where the reference unit is an isotropic radiator a so-called perfect antenna that radiates energy evenly in every direction  antennas usually focus rf energy in specific directions ; if you are standing in this beam looking at the antenna you will see a stronger signal than you would from the same transmission power into an isotropic radiator  since the radio waves are focused towards you   this is where antenna gain comes from ; by focusing the radio waves in one direction the signal appears stronger  dbi is the gain that an antenna will give you compared to an isotropic radiator  again on the logarithmic decibel scale  combining these three units is trivial and results in a measurement called the eirp the effective isotropic radiated power  if we connect our previous 50dbm transmitter to a 10dbi antenna we get an eirp of 50+10=60dbm  or 1 kilowatt there 's only 100 watts of power being emitted  or 100w pep   but it would take 1 kilowatt of power into an isotropic radiator to achieve the same signal strength  ham radio in order to start running powerful transmitters into big antennas  it is essential to first obtain a license from the fcc  amateur radio  or ham radio  licenses are easy to obtain  with the examination questions published freely and a mere $ 15 to take the test  us amateur licenses come in three classes  technician is the easiest with general and extra coming afterwards  each level confers additional transmitting privileges across the amateur bands while requiring additional knowledge to pass the test  that said  online study guides  such at that http  //kb0mga.net/exams/  are easily enough for anyone who simply wishes to memorize the answers in a cram session  i 'd recommend taking the time to actually read up on anything that you do n't understand so that you can pass the exams from knowledge ; you 'll learn a surprising amount very quickly and will appreciate the extra knowledge when you come to put it into practice  gen2 tags operate in the 902-928mhz band under the fcc 's industrial  scientific and medical  ism  rules  this band is not generally used by hams for exactly this reason  it 's very noisy due to ism  but it is nonetheless an amateur band ; equipment is readily available to licensed amateurs in the us  by operating under ham radio rules we incur a number of technical rules  primarily  restricted to 1500 watts of rf power  that 's pep  not eirp   restricted to 50 watts within 241km of white sands  new mexico  no kidding  no restrictions on eirp or antenna gain station must identify itself every 10 minutes and at the end of transmission  there 's a lot more restrictions but those are the essentials of the technical rules ; we 've got a 1500w maximum into as big an antenna as we can find  and we have to morse out a callsign every 10 minutes  stage 1  antennas an easy first step  and a good test of the radar range equation  is to fit a commercial reader with larger antennas  two yagis were purchased  one for the transmitter and one for the receiver  ; they were chosen to be as high gain as possible to yield the maximum return  however  since the rfid reader being used initially  a symbol xr400  is an ism-band device it is designed to reject foreign antennas ; it does so by measuring the dc impedance of the output line  at radio frequencies the antenna has an impedance of 50 ohms  however a 10k resistor soldered inside the antenna provides an uncommon impedance for which the reader can check  a typical dc impedance for an antenna would be either open-circuit or short-circuit   in order to bypass this protection  two steps were needed  first  a 10k resistor was soldered across the antenna connector inside the casing of the reader  this convinced the reader that a legal antenna was connected  making it constantly supply power to the port this could be damaging if there is no antenna connected  so from this point on care must be taken not to power the reader on without an antenna  secondly  the antennas chosen used a loop-type active element which at dc is effectively a short-circuit ; this short-circuit overrides the 10k resistor and the reader again disables the port  for this reason a 902-928mhz ism-band filter must be installed between the reader and the antenna ; in addition to presenting the necessary open-circuit to the reader  which at dc will now only see the 10k resistor  this has the added benefit of reducing any out-of-band emissions  using these techniques and a pair of 13dbi yagi antennas  costing around $ 100 from http  //bit.ly/cdelvf   i was able to increase the read range on a commercial reader from its standard 30 feet  according to what we learned from the radar range equation earlier there should be an increase in range corresponding to the square root of the increase in antenna gain ; since decibels are a logarithmic scale we can take a square root by simply halving  the stock antenna has 6dbi gain and i replaced it with an antenna that has 13dbi gain for an increase of 7dbi ; when we halve this  to take the square root  according to the radar range equation  we should expect to see a range increase of 3.5db  or a factor of 2.24 given the standard read range of 30 feet  which we made sure to validate beforehand  this comes out to 67 feet ; in my tests i successfully read tags in this configuration at a little over 70 feet  this will probably be the configuration used for the on-stage demo during blackhat  where i'll hand out several hundred tags to test on-stage for you to verify in person  while this is a convenient configuration technically  it is also somewhat breaking the rules  you should n't modify ism-band equipment like this unless you 're prepared to fully operate it under a new license  in this case an amateur license   and that means that you need to identify the station every 10 minutes  this is virtually impossible for commercial ism gear since it hops frequency too rapidly this is required under fcc rules and prevents us from even being able to even tune in a second transmitter  given this i took the only reasonable approach  kept on-air time to the absolute minimum that was required  often only seconds   kept transmission power to an absolute minimum  at all times measured to be less than the original output power of 1 watt   and used remote areas for testing wherever possible  stage 2  transmitters and amplifiers at this stage i chose to discard the commercial reader  instead relying on a software-radio implementation using the usrp  the software at http  //bit.ly/9fcduv is both a gen2 reader and a gen2 sniffer implemented using gnu radio ; while the usrp is a general-purpose device and lacks some of the rf characteristics of the commercial reader  it does allow for precise control to be taken of the output frequency  i was able to use a second transmitter  tuned to the same frequency  to effectively overwrite the gen2 signal at regular intervals  allowing me to identify the station and comply fully with ham radio rules  the simplest transmitter i was able to find was an im-me  a $ 20 instant-messaging device aimed at tween girls which has become popular among hackers due to its wide functionality and lack of firmware security  using a lightly-modified version of travis goodspeed 's im-me morse code transmitter  http  //bit.ly/ce3fwf   we created an automated callsign generator tuned to the same frequency as the usrp  while this complicated the rf chain somewhat  in order to match power levels between the usrp and the im-me  it did at least assure my compliance with fcc rules  in order to ensure that the morse code from the im-me was stronger than the gen2 signal from the usrp  i measured the output of both using a spectrum analyzer  yielding a figure of 5dbm for the imme and 20dbm for the usrp  i therefore added a 16db attenuator to the usrp output  bringing it to 4dbm  below the im-me  and mixed the two signals together using a standard power combiner  at this stage i had a combined signal that carries both the gen2 signal from the usrp and a station id from the im-me  at around 6dbm peak intensity  since the two do not combine exactly   now that my transmissions are correctly identified  i can introduce power amplifiers up to the legal limit of 1500 watts  to start with i purchased a 70 watt amplifier from http  //bit.ly/dvhfnr for $ 400 ; in radio terms this is a significant amount of power and is easily capable of creating rf burns  it is also near the limit of my current antennas  100w  for a very reasonable price tag  but comes with a small problem  rf amplifiers do not generally come with volume knobs ; in order to get maximum power out of an amplifier you must put a specified amount of power on the input  in this case 20mw  13dbm   since our gen2 driving signal is at only 4dbm this placed a significant limit on output power and therefore read range  solving this problem is relatively simple with another amplifier ; $ 50 from http  //bit.ly/bifzjb buys a tiny preamplifier with 18db gain  16.5dbm output power  and frequency ability far beyond the 900mhz band in use  in order to saturate the power amplifier we require 13dbm output from the preamp ; given its 18db gain this means -5dbm at the input  or around 10db less than the output from the power combiner  by adding and removing attenuators of various sizes beyond the minimum 10db i was able to control the output from the power amp  allowing range to be incrementally increased as testing progressed  testing and results in addition to powering the tag  the reader must be able to receive a response from it  during testing  we noticed an interesting artifact that allowed us to easily determine whether the read range we had achieved was limited by the transmitter  i.e  not providing enough power to turn on the tag  or the receiver  i.e  not able to pick out the return signal from the noise   the two situations proved easy to tell apart due to the nature of the tags power consumption  like most silicon devices  gen2 tags require an initial burst of electricity  known as startup current  to power on before dropping down to a lower operating power  since the power available to the tag is directly related to the distance between the tag and the reader  by carefully controlling the tag distance at around the point where signal is lost we can distinguish two different situations  read range is limited by transmitted power  in this case  the tag is unable to gather enough power to operate and switches off  it then requires a significant decrease in range to turn back on  to give it the necessary startup current   after which range can be increased again until power is again lost it exhibits read range hysteresis  read range is limited by receiver sensitivity in this case  the tag remains constantly powered and transmitting but travels in and out of range of the receiver  there will be a clearly-defined point beyond which the tag can not be read  and before which the tag will always read no read range hysteresis is present  by examining the read range for hysteresis effects  it is easy to determine the effective limit to read range and compensate accordingly  in the first case simply adding output power will be sufficient ; in the second case we found several solutions to be equally effective in different test scenarios  add a low-noise amplifier  lna  between the antenna and the receiver  increase the received signal strength  add an ism-band filter between the antenna and receiver / lna  decrease out-of-band noise  increase the receive antenna gain  limit the directions and polarizations that are received  increase transmitted power  increasing the reflection from the tag  there are other types of interference that we can do little to prevent technically  but can sometimes take procedural steps to remedy  these include  in-band noise such as other ism stations  this can be reduced by choosing a location that is far from other ism transmitters and relatively isolated  such as a canyon in the desert  ; also careful channel selection and filtering within the software radio implementation will greatly assist  receiver sensitivity can not be increased beyond a practical limit of around -110 to -140 dbm without extreme measures such as cryogenic cooling  while preamplifiers are useful up to a point  to improve on the sensitivity of the usrp   their returns diminish rapidly  transmitter crosstalk is inevitable due to the nature of gen2  in that it transmits and receives on the same frequency at the same time  this can be minimized by spacing antennas far apart and by carefully separating rf paths ; it also helps to examine antenna plots to minimize offaxis lobes in critical directions  beyond this there are some highly advanced analogue and dsp techniques that can be used to precisely pick modulated signals out of strong carrier signals ; these are beyond the scope of this paper and a ee degree is recommended  clutter is caused by reflections of the transmitted energy from other objects in the area that are not rfid tags  and even the atmosphere itself  as range is increased clutter also increases  eventually to the point where it entirely swamps the signal from the tag  again  a clean testing environment is essential  with a large anechoic chamber providing ideal conditions   ground interference  some of the transmitted signal will inevitably be sent downwards towards the ground  to be reflected back up again at the tag  which will again reflect some down towards the ground   this multipath interference will cause a blurring of the signal at both the tag and the reader  eventually degrading it to the point where one or other can no longer comprehend  increasing the height of the antennas above ground will decrease this effect  as will choosing a testing location with a conductive ground to absorb the downward energy  seawater is almost ideal   atmospheric effects will degrade the signal far faster than predicted by theory  since air is not entirely transparent at 900mhz  high altitudes  where the air is thinner  will help  with the vacuum of space being near-perfect  curvature of the earth will eventually factor in at extremely long ranges ; uhf is not reflected by the ionosphere  unlike hf which can bounce all the way around the world   this means that line-of-sight is required for best results  and at extreme ranges an increase in altitude will be required to compensate  the final read range obtained by this system will be announced during the presentation  according to the radar range equation  square-root relationships with power and antenna gain  and comparing to the retail equipment  30dbm into 6dbi of antenna == 30 feet range   our results can be predicted  we used 48.5dbm  70w  of rf into 13dbi of antenna for a power gain of 18.5dbm  an antenna gain increase of 7dbi  and an expected range increase of  18.5+7  /2 = 12.75db  all compared to the reference retail reader   applying our reference standard of 30 feet  and naively assuming all other things to be equal  this gives us a predicted final read range of 565 feet ; you 'll have to attend the presentation to find out how it turned out in real life ! range predictions given that the radar range equation holds true for gen2  we can make some predictions about the read range capabilities of systems far bigger than the one we have built  first  let us consider what could be assembled at reasonable cost and operated within the confines of amateur radio rules  legal-limit power amplifiers are rare and expensive at uhf frequencies  but they can be built using modern parts without too much difficulty  generally  large power amplifiers  like the one in this system  break apart an input signal into several parts  each of which is amplified separately then recombined  in this way  many small amplifiers can be used to build a single very large amplifier at significantly reduced cost  large antennas to handle the power are also available ; http  //bit.ly/dx2pmd is a suitable loop yagi that can be stacked into a 2x2 array for power handling of 2000 watts overall and gain of 26dbi  the entire combination of power amp and antenna arrays can be assembled for less than $ 5,000 with a predicted read range of 12,000 feet a little over 2 miles  next we consider military systems  the us navy  and several other countries  use a radar system called an/sps-49  this system operates on the 851-942mhz band  supplying 280 kilowatts of peak power into a parabolic dish that is 24 feet wide by 14 feet high  approximately 35dbi at 900mhz  applying the radar range equation as before gives a predicted read range of 80 miles for this system  finally  we must consider the theoretical limit for such a system  the largest parabolic dish in the world is the 300-meter arecibo radio observatory ; at 900mhz this dish has an effective gain of around 70dbi  applying a legal-limit amateur radio transmitter  as is sometimes allowed  of 1500 watts to this dish gives a read range of around 317 miles well into the range of low-earth orbit  in reality there are several factors which limit the read range to far less than these maximums  and one of the most fundamental may lie in gen2 itself  there are strict timing requirements placed on both the reader and the tag  with both sides abandoning communication if timeouts are reached  ironically  this timing restriction may be the ultimate self-imposed limit on gen2 read range a 10-mile read range  for a 20 mile round trip  takes about 100 microseconds  so we still believe that reading rfid tags from more than a mile away is entirely possible  impact on personal privacy in order to consider the effect that our research has on personal privacy  we made several assumptions  epc gen2 tags can be read from at least 500 feet  epc gen2 tags are ubiquitous  found in product labels and identity documents  an attacker only has access to a system similar to ours  not the systems described above  given these assumptions  which we feel are reasonable   we created a list of scenarios to illustrate how this technology can be abused  this list quickly grew beyond anything that could be presented in a paper ; we present only our top 10 to be clear  these are not theoretical attacks that could be achieved if the technology were advanced ; these are instead attacks that are entirely viable with the equipment we have assembled for less than $ 1000 and nothing more  we assume a read range of 500ft from a vehicle-mounted solution  an angular resolution of 15 degrees  the beamwidth of our antennas   and epc gen2 tags in high-valued items at stores and standard-issue identity documents in all of the following scenarios  10  targetted burglaries given the prevalence of gen2 in identity documents in many locales  it becomes possible to also detect people  by the nature of their attachment to id   a two-part attack becomes possible  the attacker sweeps an affluent neighbourhood late at night looking for gen2 identities  he plots their location on a map  and uses these to determine the homes of people carrying gen2based documents  the attacker returns on successive nights looking for the same tags  when he notices that a tag is missing  he knows that the tag corresponds to a drivers license which corresponds to a person  if the tag is n't there then the owner of the tag is n't there either  and it is likely safe to break in  9  shipping chains gen2 tags are commonly used to label inventory  both in bulk  containers  and small-scale  upc   a long-range tag reader can also function as a long-range tag writer and a long-range gen2 sniffer  this allows the attacker to sniff the unlock and kill codes for the tags used to track inventory  and then reprogram them  he may interfere with many levels of the supply chain in many different ways ; introducing duplicates  changing tags  or simply disabling all tags from very long range  the author is not in a position to speculate as to the consequences of such actions  but would expect the result to be significant given the sheer level of gen2 deployment at all stages of the supply chain  8  targeted terrorism gen2 is relatively common in identity documents such as enhanced drivers license and the us passport card  different issuers of gen2 tags  such as different states  use different prefixes for their tag id numbers allowing  for example  a group of americans to be identified from long range  assuming they are carrying their standard identity documents  terrorist acts can then be targetted so as to affect maximum damage upon us citizens  as identified by their drivers licenses  7  spot the tourist tourists are commonly targeted by muggers since they tend to carry large amounts of currency and other valuables  given that a gen2-based identity document identifies the state of residence of its owner  it becomes possible to identify people from specific states and hence find tourists to mug  6  big spenders many retail chains  such as walmart  use gen2 to tag high-value items  both for stock control and for security  if the tags are not properly disabled at the till  which can be easily arranged by the attacker   he can identify shoppers leaving the store who have high-value goods they have just purchased  if he wishes  the attacker can tour the store with a mobile reader beforehand to find the id numbers of specific products he wishes to target ; when he sees a shopper leaving with his chosen tags  or other high-value tags   he follows the person home and obtains the goods however he chooses  5  retail havoc stores use gen2 for stock control as well as security  conducting inventory by sweeping the shelves with a mobile reader  if an attacker can sniff the unlock and kill codes from an in-store reader  which is possible with our equipment  he can reprogram or destroy tags on goods as he sees fit  tricking the in-store computers into taking any action he wishes based on a non-existant excess or shortage  4  4th amendment hell a read range of 500+ feet makes it possible to scan for gen2 tags in the majority of a typical urban block with a single pass from the main street  while technically dangerous to do so  exposing the public to high levels of rf energy   such a search could potentially find people  from their id   stolen goods  from their labels   or any other item that can be tagged with a 2 x 2 adhesive label  it is technically feasible to scan an entire city for a credit-card sized rfid tag in a single day with only a handful of mobile stations  3  ultimate stag prank gen2 tags can easily be purchased in bulk ; for $ 100 on ebay we bought 1,500 to hand out at blackhat  if someone knew in advance that a vehicle would soon be crossing the us border  such as for a vacation or business trip   a bulk order of tags can be pre-programmed with id numbers from known edl and pass ranges  these tags can then be hidden around the vehicle before it approaches the readers at the border ; once again i 'm not in a position to speculate on the results but i would expect the border guards to be very curious why the mule has a thousand passports in his trunk  2  sniffing underwear gen2 is increasingly being used to tag articles of clothing  often sewn into the garments themselves  it is relatively easy to walk around a store with a mobile gen2 reader and catalogue which tags correspond to which articles of clothing  if the tags identify specific articles of clothing in sufficient detail to satisfy a major international corporation  then they also provide sufficient information for a potential stalker to  i do n't really want to think about what  1  mall surveillance this attack deserves the number 1 slot for one simple reason i believe that it could be turned into an entirely viable business plan that 's legal in a majority of us states  install a box just inside each of the doors to a large mall  containing a low-power gen2 reader as well as high-power readers for every other type of rfid tag imaginable  credit cards  passports  access cards  etc   as shoppers enter the doors and are forced to walk within range of the readers  all available rfid information is read and correlated together  any gen2 tags  such as a drivers license  can then be used to track the shopper as they walk around the mall ; just a handful of readers in a large shopping mall and you can track the entire mall population in realtime  the resulting data can include  name credit card details  card numbers  expiry date  number of cards found  etc  home state route taken through the mall any pauses in movement  such as to look in a window  details of purchases made corresponding details for other co-operating malls additional information  such as home address  from co-operating stores obtaining data on shoppers in such granular detail would be of significant value to marketers and other data miners ; it all becomes possible because of gen2 's long-range nature and the fact that it is currently employed to provide a unique identifier for a person  ironically  the defense against all of these attacks is both very simple and widely supported  by civil rights groups and industry groups alike   remove rfid tags from identity documents  and require companies to disable tags when products leave the store  easy  huh ? 