planning an indoor navigation service for a smartphone with wi-fi fingerprinting localization author  e-mail  justin stook justinstook @ gmail.com supervisor  professor  reviewer  ir  edward verbree  tud  prof dr ir  peter van oosterom  tud  dr corn van elzakker  ut-itc  version  final   1.6 august 18th  2011 msc thesis indoor navigation with wi -fi fingerprinting |2 dedicated to my father may he navigate well in an unknown world to us selamat jalan the wisest men follow their own direction euripides  484 bc 406 bc  msc thesis indoor navigation with wi -fi fingerprinting |3 prologue navigation has become booming business recently  well-known navigation services  such as tomtom  garmin and google navigation  are dominating the market for outdoor  road based navigation  the fact that such applications are able to determine a location on a platform has always fascinated the author  simple location determination is further utilized in specialized applications and functions  such as sportypal  which logs the movements and interpolates several units  or the geotagging of photos  and so  this further piqued the interest to investigate matters in the indoor environment  as one has to look beyond what one sees  however  navigation as a word can also be used as a metaphor to describe one mans life journey  how can one navigate as a human being ? on the paths of life  one has to navigate through a web of complicated matters by fulfilling expectations and by making decisions that will influence your future  decisions might be based on past experience and/or knowledge  there is no turn back option  and things might heavily alter the path of life in unforeseen circumstances  both positive and negative  navigation is then based on the abstract level  the author  too  almost navigated towards another direction  unforeseen circumstances in the private life forced him to choose a different flow than intended  the result is this thesis project  in which much time and effort has been put  the author hopes that the thesis is readable and understandable  he hopes that every wise man should follow his own direction and that as such  navigation applications will contribute in making those decisions  justin stook acknowledgements i would like to thank the following persons who helped me with my thesis research  geert wirken for his advice and excellent help op java programming we have spent a lot of time together tackling the problems ! mehmet yildirim from the tu berlin  for providing me excellent help as well  with the location determination scripts  as well as helping me out to get familiar with the android environment  gavin brown from the tu berlin  for providing me new insights of this domain  my supervisors edward verbree and peter van oosterom for their endless patience and who always believed i could do it  and provided me extensively feedback i could use  joel haasnoot for his advice and help on java programming  my family and friends who  mentally  supported me to accomplish this feature  msc thesis indoor navigation with wi -fi fingerprinting |4 table of contents summary                                              9 list of abbreviations and acronyms                                11 terminology                                            12 positioning vs localization and accuracy vs precision                        12 building geometry                                           14 part 0  introduction                                       15 1 introduction                                          16 1.1 the research topic                                         16 1.2 contents of this thesis                                       17 2 goal  objectives and scope/limitations                             19 3 research questions                                       21 part i  theoretical framework                                  23 4 sensor techniques                                       24 4.1 why gps can not be used                                     24 4.2 other sensor techniques compared                                25 4.3 general background of wi-fi                                   28 4.3.1 use of spread spectrum                                    28 4.3.2 frames / layers                                        30 4.4 general strengths and weaknesses                                31 5 positioning techniques                                     33 5.1 five techniques                                          33 5.2 fingerprinting elaborated                                     35 5.3 building constructions influencing fingerprinting                         36 5.4 using signal strengths to locate                                  37 6 navigation                                           39 6.1 what is navigation ?                                        39 6.2 navigation principles                                       39 6.2.1 general principles                                       39 6.2.2 certainty and route confirmation                               40 6.3 navigation algorithms                                       40 6.4 navigation infrastructure                                     40 6.5 spatial referencing                                        41 7 building an application using standards                             43 conclusion part i                                         44 part ii  theory and application                                  45 8 the user involved                                        46 8.1 user profiles                                            46 8.2 user needs in this project                                     46 8.2.1 personal information                                     47 8.2.2 human centred preferences  requirements                          47 8.2.3 service related information and preferences                         47 8.2.4 device related information and preferences  requirements                  47 9 user allocation  gateway services                                49 9.1 components of the gateway                                   49 9.2 site surveying and positioning                                   49 10 directory and geocoding services                               51 10.1 directory services                                        51 10.2 geocoding services                                        52 msc thesis indoor navigation with wi -fi fingerprinting |5 11 modelling and attributes                                   53 11.1 modelling the indoor environment                               53 11.2 non-usage of geometry                                     54 12 visualization  presentation services                              55 12.1 users and general constraints and limitations                          55 12.2 presentation services by the ogc                                56 12.3 acknowledgement of 3d modelling and 3d visualization                    56 12.4 cartography of text                                       56 12.5 initiatives to a text based indoor navigation application                    59 13 navigation services                                      60 13.1 navigation elements of the ogc                                 60 13.2 mandatory parameters                                     60 13.3 generating navigation guidance                                 61 14 architecture  functional and technical design                         64 conclusion part ii                                         67 part iii  implementation results                                 68 15 surveying and databases                                    69 15.1 site survey preparation                                     69 15.1.1 measure points                                       69 15.1.2 measuring and determining suitable fingerprints                      70 15.1.3 fingerprinting methodology used in this project                      73 15.2 databases and information storage                               75 15.2.1 generalities                                         75 15.2.2 the database in the application                               76 16 location determination algorithms                              81 16.1 two methods of location determination being used in this thesis              81 16.2 geocoding and reverse geocoding                              91 16.3 location determination and geocoding in java                        91 16.4 navigation algorithm                                     93 17 layout and results                                       96 17.1 layout configuration                                       96 17.2 testing the application                                     100 17.2.1 application validation                                   100 17.2.2 criteria of location check and test performances                     100 17.2.3 indoor wi-fi navigation testing                              106 17.3 remarks and conclusions on the application                          108 part iv  conclusions                                      .109 18 final conclusion                                       .110 19 reflection  discussion  limitations and recommendations                  ..112 19.1 limitations in general                                      112 19.2 regarding the application                                   113 19.3 regarding the localization methodologies                           113 20 additional remarks on privacy and legal issues                        115 20.1 personal information                                      115 20.2 mac as personal information                                  115 20.3 coverage                                            115 references                                           ..117 annexes                                             121 a tables and scripts                                         122 a.1  table of overview possible sensor technologies for location based services         122 a.2  navigation flows                                       124 a.3  database contents                                      126 msc thesis indoor navigation with wi -fi fingerprinting |6 a.4  database samples                                       128 a.5  codes for location determination                               130 a.6  codes for navigation algorithm  dijkstras algorithm                     134 b background literature                                       138 b.1  background information on pedestrian movements and navigation algorithms       138 b.2  mobile cartography and the user                               140 b.3  background information on cartographic rules                        142 c results                                               144 c.1  scan results for location estimation                              144 c.2  scan results for route prediction                               145 list of figures and tables main thesis figure 1 accuracy and precision                                     12 figure 2 interrelation of the chapters                                  18 figure 3 gps positioning on the road and in a maze to simulate indoor navigation          25 figure 4 normal versus spread spectrum                                28 figure 5 dsss messaging                                         29 figure 6 channels of the 2.4 ghz for ofdm                               30 figure 7 frames of a 802.11 signal                                    30 figure 8  802.11 frames and its coding                                  31 figure 9 allocation methods                                       34 figure 10 an example of fingerprinting                                 35 figure 11 position  35.629535  139.879818   bayside station  tokyo  japan              42 figure 12 user profiles defined by etsi  2010                              47 figure 13 nodes and edges representation  topological dual space                   53 figure 14 fingerprinting objects and navigation                             54 figure 15 example text output using text visualization and variances                 59 figure 16 routing  guidance  orientation                                62 figure 17 architecture of this indoor navigation application                      64 figure 18 functional and technical design of the application                      66 figure 19 screenshot of the eclipse environment                            69 figure 20 photo of wing 2 and wing 3 of the otb building                       70 figure 21 screenshot of reconfigured rssi scan                             71 figure 22 graphical representation of indoor model  graph  with correct orientation         72 figure 23 graph layer on photo                                     73 figure 24 time aspect of fingerprinting                                 73 figure 25 temporal aspect of fingerprinting  bar chart  for given location fid=3210         74 figure 26 database relations                                       75 figure 27 matching live fingerprints with recorded fingerprints using snapping tolerances      83 figure 28 flow scheme of location determination for count method with search space        86 figure 29 visual representation of count method upon walking around  desirable simulation     87 figure 30 exclusion of access points to narrow down search space                   90 figure 31 main screen  input and autocompletetextview                       96 figure 32 settings screen                                        99 figure 33 navigation screen  output of a route                             99 figure 34 new database method  using coverage areas instead of storing best signals        101 msc thesis indoor navigation with wi -fi fingerprinting |7 figure 35 first scan results  grouped by match  specified by location  fingerprint  node  12 nodes  wing 2+3                                                 102 figure 36 first scan results  grouped by match  specified by location  wing 3 nodes        103 figure 37 second scan results grouped by match  specified by location  wing 3 nodes      105 table 1 overview selection of possible techniques for localization                   27 table 2 properties of ieee802.11 protocols                               28 table 3 swot analysis of wi-fi and wi-fi fingerprinting                        32 table 4 mobile phone constraints                                    55 table 5 parameters navigation services                                 61 table 6 temporal aspect of fingerprinting  table view                          74 table 7 sample database on signal strengths on two different locations                82 table 8 sample database on location information                           82 table 9 sample database on room information                             82 table 10 example of received signal strengths                             83 table 11 example of determination of range signal strengths                     84 table 12 example of comparing recorded and received signal strengths                84 table 13 localization methods  count method versus sum of squares method            88 table 14 outcome of counts and sum of squares                            88 table 15 scenario for bad reception for ss method                           89 table 16 overview of test nodes for location checks                         101 table 17 scan results attempt 1                                    103 table 18 scan results attempt 1  wing 3 only                             104 table 19 scan results attempt 2  wing 3 only                             105 table 20 results of route confirmation results within wing 3                     107 box 1 a xml example for ogc directory services                            51 box 2 example of utilizing text for recognizable objects                         56 box 3 example of sql statements in xml  creation and population of database table         76 box 4 snippet overview of databasehelper.java  getting the contents from database tables from xml files                                                 77 box 5 snippet overview of mainscreen.java  creation of entry fields and actions upon tapping buttons                                                  78 box 6 snippet overview of roomlist.java  populating an entry field with a directory service     79 box 7 snippet overview of queries for searching for nodes within the search space          92 box 8 snippet overview of routecalc.java                                95 box 9 xml file of the main screen                                    98 annexes figure ap  1 shortest paths in buildings                                139 figure ap  2 reichenbacher 's context model for mobile cartography                140 figure ap  3 bertin 's geographic variables                               142 table ap  1 extended overview of sensor techniques used for allocation of receiver         123 table ap  2 ogc navigation flows                                   125 table ap  3 database  fingerprint locations                              126 table ap  4 database  connectivity                                   126 table ap  5 database  room information                                126 table ap  6 database  poi information                                 127 table ap  7 relation of graphic variables and visual isolation                     143 table ap  8 information perception of cartographic information                   143 table ap  9 scan results for all locations  best 10 macs in vicinity                  144 msc thesis indoor navigation with wi -fi fingerprinting |8 table ap  10 scan results for wing 3 locations  only routers from same floor registered       144 table ap  11 scan results for 3 series of 5 different routes in wing 3                 145 box ap  1 sample database for table_location                             128 box ap  2 sample database for table_mac                               128 box ap  3 sample database for table_connectivity                           129 box ap  4 sample database for table_rooms                              129 box ap  5 sample database for table_poi  unused                           129 box ap  6 overview of code for location determination  mainscreen.java and navigation.java    133 box ap  7 code for dijkstraalgorithm.java                               135 box ap  8 code for graph.java                                     135 box ap  9 code for vertex.java                                     136 box ap  10 code for edge.java                                     137 msc thesis indoor navigation with wi -fi fingerprinting |9 summary one possible way to determine a position in the indoor environment is by using  the reflection and absorption of  signal strengths  also called multipath  from wi-fi routers  by recording the signal strengths in dbm over time at a certain position  a fingerprint can be created  these fingerprints can be unique in the sense that it is possible to distinguish positions  however  multipath are both a bless and a burden  the set of signal strengths are made because of the reflection and absorption  but at the same time  they are prone to changes in time  since at a position  signals can be received directly and indirectly  in this sense  it is not possible to record unique fingerprints at each single spot consistently  since the differences would not be significant to distinguish  in this thesis  research has been done on how to make use of fingerprints in a smartphone based indoor navigation application  which uses fingerprints as a positioning technique  and which does not uses geometric maps or coordinates as a guideline  since the fingerprints are directly translated to relative locations  such as room 2.200  the method of positioning has been changed to localization instead of positioning  the focus is on the confirmation of the appropriate location regarding the requested route in topological sense  a user traverses a route constructed by nodes and edges without any explicit coordinates  the framework of the open geospatial consortiums  ogc  open location services  openls  has been used a guideline to set up a prototype  parameters can not be used  since those involve maps and wgs84 coordinates  while the project aims at the non-geometric features  signal strengths from a set of media access controls  mac  which transmits the wi-fi signals  have been recorded at 40 locations at the otb research centre in delft  in the application a scan will be compared to the recorded signal strengths and if there is a match  the location will be returned  this location is being matched with the requested route and it is possible to tell whether the user is at the correct location or not  as with the nature of multipath  one has to take into account the matching signal has to be within a range of the recorded signal  if the recorded signal was -65 dbm  sufficient search space has to be created around this signal  in this project  a search space of +4 dbm and -4 dbm has been proved sufficient  this means that a live signal of -67 dbm would provide a matching location  since this is within range of the original recorded signal  -69 < rssi < -61   the strength of this methodology is that it is easy to maintain a database with the recorded signals  although the recording  or site surveying  is rather time consuming  and the macs can be easily replaced or removed  multipath itself is inherent to changes in the time domain  which results in delays upon live tracking  as such  the fingerprint database requires a frequent update  another strength is that there is no need for additional data processing  since there are no maps needed  there is a fast processing  as a certain degree of map matching does not apply here  from the results  it was visible that it is highly recommended to store only mac addresses with their signal strengths  which are in the same physical space as the location fingerprint  as it improved the returning results on location predictions  moreover  upon surveying  it is recommended to use the same class of receiver as the application is to be installed  scan results obtained from high-end receivers can be considered as incompatible with scan results obtained from a medium-end receiver such as a smartphone  it is most likely the survey results from the latter will match the live results  as a result  a disadvantage is that separate fingerprint databases needs to be recorded for specific devices  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 10 further improvements are suggested regarding the translation  geocoding  of the fingerprint locations to absolute positions based on coordinates  allowing graphs or maps to be displayed   using extensions of smart navigation  as now  neutral directions have been used  and by distinguishing certain user properties  such as navigating through restricted areas  navigation for disabled users  or time of arrival estimations   in the developed prototype  room has been reserved for extensions such as these  the database for mac and locations can also be placed on a server  rather than in an inherent database included in the application  for up scaling towards a large coverage area  issues will remain regarding the privacy of mac addresses  since it is not allowed to record mac addresses along with location information in several countries  as it is possible to trace identifiable persons  which contradicts legalities  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 11 list of abbreviations and acronyms 3g a-gps aoa ap api bssid cell-id dbm dsss fhss gps ieee ieee 802.11 ir irda lan los mac mimo ofdm ogc openls poi rfid rss  i  sql ss ssid toa umts uwb wi-fi wlan xml third generation mobile telecommunication assisted gps  see gps  angle of arrival access point application programming interface basic service set identifier  same as mac in value cell identification decibel miliwatt direct sequence spread spectrum frequency hopping spread spectrum global positioning system institute of electrical and electronics engineers see wlan infrared infrared data association local area network line of sight medium/media access control  same as ssid in value multiple input multiple output orthogonal frequency division multiplexing open geospatial consortium open location services point of interest radio frequency identifier received signal strength  indication  structured query language sum of squares service set identifier time of arrival universal mobile telecommunications system ultra wide band wireless fidelity wireless lan  see lan  extendible markup language m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 12 terminology positioning vs localization and accuracy vs precision a distinction can be made between positioning and localization  haenselmann  2005  uses the following definitions  positioning is the determination of a location with absolute  global  coordinates  such as  35.629535  139.879818   localization is the determination of a location with relative coordinates  such as room 5.12  and depends on the scale as such  e.g  a large room could be subdivided in smaller particles  in this research  these two words are often mixed in use  when they are used in the context of describing a sensor technique  both refer to the same style of location determination  however  in the event these terms are used as a noun themselves  they are referring to their respective trait  in this perspective  the use of accuracy and precision  in combination with these techniques has also a distinction  as defined by the bipm  2008   *accuracy is the degree of  closeness of agreement between a measured quantity value and a true quantity value *+  *precision is the degree of  closeness of agreement between indications or measured quantity values obtained by replicate measurements on the same or similar objects under specified conditions  a high accuracy means that measurement points  in this case location points  are close to the aimed target area  a high precision means that the measurement points together are close to each other this is displayed in figure 1  where the purple dots represents the allocation of the gps receiver  and the red dot represents the actual position  this research is mainly focused on the accuracy being used  rather than the precision of the measurements of the signals  figure 1 accuracy and precision m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 13 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 14 building geometry in this thesis the combination of words building geometry is consistently being used  this can refer to  creating geometry  building as constructing  the geometric features of a construction  the dimensions of a construction  in this thesis  the second definition is being used  building geometry refers to the dimension of the building as information and not to the development of geometric features itself  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 15 part 0  introduction contents 1 introduction 2 goal  objectives and scope/limitations 3 research questions this thesis has been subdivided in five parts  part 0 with the general context of introduction  goal and research questions ; part i with the main theory  part ii with application oriented theory  part iii with the application implementation and empirical research  and part iv in which the thesis will be concluded  in this part 0  this report starts with a topic introduction and the structure of the thesis in chapter 1 chapter 2 continues with a description of the goal  objectives and the scope  and limitations  of the research  chapter 3 follows with the research questions  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 16 1 introduction in this chapter the research topic  1.1  and the contents  1.2  of this thesis are described  1.1 the research topic recent studies  kolodziej & hjelm  2006 ; zhang et al  2010 ; dovis et al  2010  have shown the market in outdoor location based services  lbs  has increased over the past decade  with the use of a variety of sensor techniques  such as the global positioning system  gps   bluetooth  ieee 802.11 wireless local area network  wlan  also called wi-fi  and the universal mobile telecommunications system  umts  and its generations in data transfer  e.g  3g & 4g   software equipped mobile devices are capable to request and display vital on-the-fly information  gps is the prime technology being used for these applications  examples are the car navigation  in the form of tomtom or garmin installed on independent devices and google navigation on cell phones  store locations requests  albert heins appie   or friend finders  google latitude   lbs allows on-the-fly navigation and service information  on-the-spot advertisement and notifications possibilities and other location related information  but are primarily outdoor  while the indoor possibilities have been neglected somehow  manodham et al  2008  p 296   one can think of navigating through a large stadium  a convention centre  an office complex or a railway station  but the application of indoor location information can also be used for robotics  for example  indoor lbs especially proves its worth in emergency rescue or incident management  where high position accuracy is needed under difficult circumstances however  gps services have their limitations  which include a low accuracy in densely built environments and no available services at all inside buildings  indeed  there has been  and still is  ongoing research about how these techniques can be improved  kolodziej & hjelm  2006  zhang et al  2010 ; yim et al  2010 ; dawes & chin  2010 ; woo et al  2011  to name just a few   this research also focuses on the indoor navigation  despite the constraints of the current techniques and applications  existing sensor technologies and existing software can be enhanced to cater these difficulties  at the moment  wi-fi technology seems to be the most promising technique to detect indoor locations  although it has some weaknesses regarding its positioning accuracy  the question is whether it is possible to develop an indoor navigation system  which makes use of existing wi-fi technology  furthermore  one has to deal with the target user  user profiles   to determine what support of applications and/or services is desirable  as this affects the general design of a service  as with sensor technologies  one must also take the objects and materials in account  as signal penetration behaves different for plywood than for concrete bunkers  this research concerns about 1  the wi-fi fingerprinting technique and 2  the indoor navigation itself  from the latter  the focus is on how to use fingerprints to confirm where the user is  and whether the user is still on track in the context of the requested route towards the target  as this confirmation is part of navigation  although various studies have dealt with wi-fi allocation processing as stated in ibrahim & ibrahim  2010   the novelty of this research that it will be strictly focused on the aspect of certainty and confirmation for civilian use  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 17 the end product is a prototype for indoor navigation to be used on a smartphone  in particularly on an android based device  the prototype can be used to navigate from one place in a building  to another place in a building  without having knowledge of the complex  1.2 contents of this thesis first the objectives will be explained in chapter 2 following these objectives  the research questions will be discussed in chapter 3 the content body of this thesis is divided into three parts  in part i  the theoretical framework and background will be described in a full literature review  in chapter 4  some explanation about possible sensor techniques is provided  it also elaborates more on the principles of ieee 802.11  wi-fi  technology  chapter 5 enhances this with positioning techniques  including fingerprinting  chapter 6 deals with the navigation context  which forms another fundamental part of this research  chapter 7 continues with the open location standards  openls  of the open geospatial consortium  ogc   which can be used as a framework to develop a prototype  part ii concerns with the application of the theoretical frame and is thus a mixture of both theory and practical issues and relies largely on a literature review  but allows room for ideas of the developing application  chapter 8 deals with the application requirements  by dealing what is desirable  this is the part where the user preferences or user profiles will be stressed  chapter 9 continues with connecting the sensor technique with an application  in which the ogc on openls calls this gateway servicing  chapter 10 deals with the implementation of navigational services  including algorithms and the use of ogc/openls  in particular the directory and geocoding services  chapter 11 follows with the modelling of the indoor environment  chapter 12 proceeds with the output presentation of the chapters 8-11 and emphasizes on the visualization  chapter 13 combines the previous chapters on the question how the navigation application can be constructed  chapter 14 described how the architecture looks like  part iii emphasizes on the results and provides detail on the prototype being exploited  which will be discussed in the chapters 15  surveying methodology and results as well as database issues   16  localization methodologies  and 17  layout and results   finally  part iv closes the thesis with the final conclusion in chapter 18 a reflection in the form of discussion on limitations and recommendations are to be found in chapter 19 in addition  remarks on privacy and legal issues form an epilogue in chapter 20 figure 2 displays how the chapters interrelate to each other  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 18 figure 2 interrelation of the chapters m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 19 2 goal  objectives and scope/limitations the goal is to investigate whether it is possible to use wi-fi fingerprinting technology as a positioning technique for indoor navigation  which relies on the framework of the open location services standards  and which does not necessarily utilizes geometric features  the focus is on assessing the use of fingerprints as a confirmation tool  which will be incorporated in an application prototype  the development of a prototype itself is subject to various factors which have to be taken into account  such as building material which will affect the wi-fi signal strengths and thus the positioning of the user  user profiles described by etsi  2010  as a total set of user-related information  preferences  rules and settings influences the development of a service as well  thus  the following objectives have been set for this project  regarding the theoretical context  it must become clear why wi-fi technology is being used  and why not other technologies  what infrastructural requirements are needed to develop this  what the target user and goal of the application should be  how it can be possible to build a system  regarding the application development  an application must be build  which its framework shall be based on the ogc standards for open location services  openls   suits the user profile and goal of the application  including the end visualization and style of interaction   includes a method to actively utilize the route confirmation aspect of navigation  regarding the service deployment the application will have to be tested and demonstrated on a mobile device  to check if the positioning accuracy is acceptable  a site survey and positioning model will be carried out  the project is carried out in the otb building in delft  in particularly  only the ground and first floor will be used  to determine if it is possible to navigate in the vertical dimension  and to make sure the prototype will work in a relative small area  the data and software being used will be dependent on the target area  however  further research will be conducted about the database  server and spatial referencing system at a later stage  yet  the proposed platform will be a htc desire z android 2.2.3 smartphone  the scope of the project is limited to wi-fi localization technology and its application in an indoor location based service  in particular  the focus is on the navigation side  where the question is how you can navigate from a to b if a and b are named locations inside a building ? this means that anything else is beyond the scope and will not be discussed  which includes other possible sensor techniques  economic viability and market deployment  privacy matters and an extensive positioning accuracy and positioning precision estimation  however  for the latter  an evaluation is proposed  to verify and demonstrate the usefulness of the created software  this means it is not the intention to m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 20 modify existing accuracy and precision algorithms  finally  inverse indoor positioning  as in placing wi-fi access points just outside the building to determine the position inside as described by de la roche et al   2010  has been acknowledged as a possible allocation technique  but is regardless beyond the score of this proposal as research in this field is relatively new and a significant uncertainty exist in various aspects  more about wi-fi functionality is described in chapter 5 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 21 3 research questions from the previous chapter  the following main research question has been derived  is it possible to develop an indoor navigation service for a mobile platform  based on the use of only wi-fi fingerprinting technology and the framework of the open location services standards  but without using building geometry ? from the main research question  the following sub research questions can be posed  how can wi-fi be used in mobile indoor navigation ? o this research question addresses the motivation of the chosen localization technique/approach  there are multiple techniques possible  but upon answering this question  it will become clear why wi-fi technology has been chosen in favour of other techniques  and how wi-fi fingerprinting localization actually works  o part of navigation is the regular check whether the user is still at the right place  this assumes a route is present  route confirmation is a fundamental aspect in this sense  the question is how wi-fi fingerprints can handle this  how can an existing infrastructure be used and modified for indoor navigation ? o creating a new infrastructure is in the first place considered extremely time consuming as the thesis research is constraint by time limits it is not desirable to create it  therefore  minor modifications to the infrastructure are ought to be more realistic  e.g  readjusting router access points placements  in the end  it will become clear what infrastructure is needed  and how the different components are linked together  o this also includes the use of some sort of reference system  where traditional outdoor absolute  x  y  z or  ,h  reference systems are being used  the indoor environment requires a coordinated based scale of detail  hence the outdoor referencing system is considered unsuitable  however  a true reference system can be neglected if the emphasis is on the fingerprints as a confirmation tool  since each position has a unique set of fingerprints  one only need to know if the receiver is at the right position as that has been told  how can the creation of an application be possible  without using building geometry ? o this question features the inclusion of two problems that in general mobile users will face  and must be addressed in the creation of the application  first  the limited accuracy of the position  even when the position deviates significantly from the true position  the question is if this information still can be used  and how  how can an application be created without the inclusion of building geometrical features  but solely fingerprints ? second  on a mobile device  smart designing is a key factor as well  since the device has limitations in data transfer and data visualization  due to device limitations such as screen size and processing time  what are the benefits of using the framework of open location service standards in an indoor navigation application ? o it is time consuming to implement an own set of standard procedures  instead  existing standards for open location services from the open geospatial consortium will be used upon designing the application  as it contains a large knowledge and expertise base  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 22 however  the main question implies that a possible prototype will deviate from using the standards themselves  therefore only the main aspects are probably a guideline upon developing a prototype  how does a framework of openls fits into a prototype which does not follow the parameters themselves ? how can these modified for indoor use ? which types are there ? are there already existing datasets and if yes  how are they being used  how can wi-fi fingerprinting determine a location which does not utilize geometric features  and how can it be implemented in an application as such ? o a final question deals with how wi-fi fingerprinting can be used as a localization technique  upon surveying  one ends up with a comprehensive database  but how exactly can that information being used to reconvert it to location information ? o as there is no geometry  it is difficult to tell a user to turn left or right as such  since there is no orientation aspect  yet  a route which has been calculated from a node-and-edge based network is still suitable for navigation  although the network does not contain any coordinates  this means that the importance and usage of a topological network plays a key role upon answering this research question  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 23 part i  theoretical framework contents 4 sensor techniques 5 localization techniques and fingerprinting 6 navigation 7 open location services by the open geospatial consortium in this part  the pure theoretical contents are described  chapter four describes several sensor techniques which can be used  it elaborates on why wi-fi is being used  thus attempting to answer the first research question how can wi-fi be used in mobile indoor navigation ? chapter five continues with the localization techniques  with fingerprinting being the central method  next  in chapter six  the navigational issues are considered  general thoughts of navigational algorithms  as well as the necessary equipment and reference systems are included here  which leads to an answer of the second research question how can an existing infrastructure be used and modified for indoor navigation ? finally  in chapter seven  the use of standards is discussed  in particular the standards as set by the open geospatial consortium  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 24 4 sensor techniques this chapter deals with the sensor techniques  section 4.1 describes briefly why gps is not suitable for the indoor environment  section 4.2 continues with alternatives for gps  while section 4.3 picks up wi-fi as a technique to be used in this thesis  section 4.4 closes with a general overview of wi-fi  4.1 why gps can not be used at the moment  global positioning system  gps  or more general  global navigation satellite system  gnss  and the concept of cell identification in the more mobile telecommunication systems  such as gsm and 4g  are the most dominant modes of techniques being used to determine the location of a compatible mobile receiver in the outdoor world  with the use of those signals  services can be deployed  such as retrieving information where a receiver is located  one of those services is navigation  gps is suitable for the outdoor navigation  as the navigable spaces are wide enough  the accuracy positioning of gps is between 6 and 12 meters 95 % of the time  the problem is that the reception of the gps signals is bad in densely build areas  including the indoor environment  gps has been enhanced in accuracy  but the accuracy positioning is still insufficient indoors  as it can not solve the multipath interference  which is the reflectance  scattering  of the signal via objects  manodham et al  2008   this is caused by the requirement of the line-of-sight  los  of gps in order to function  when a user is spending time indoors  the gps signals will not be able to penetrate through obstacles  depending on the material and volume of the object  signals can be completely absorbed  reflected  or even when it does penetrate the obstacle  the signal possible come out weaker   swangmuang & krishnamurthy  2008   since gps requires line-of-sight  another issue that has been mentioned is the high power demand of gps receivers  and that gps often behaves unpredictable regarding its propagation conditions  with the result that the true location of the user deviates significantly than desired  dovis et al  2010   finally  gps performs poorly in the vertical position  as stated above  accuracy between 6 and 12 metres is mostly reached for the outdoor environment  which is sufficient for its location based services  indoor  that same accuracy is not wishful  as 1-2 metres is needed  to prevent the user to be allocated on the wrong floor  or in the wrong room  the 3d environment is thus extremely important for indoor location based services  if a closer look can be taken on the outdoor navigation services  one can see some discrepancies  too  the user usually finds itself at some distance of the modelled environment  it might be possible the entire road network is modelled as a large network of nodes and edges with geometry  the navigation software allocates the users location somewhere on the network  the accuracy is important to provide the user with a list of directions  an accuracy of 10 metres would be sufficient in the context of car navigation  the allocation of the users position on the network meets the requirement  as displayed in the left half of figure 3 the gps of the user will not be allocated improperly on the road to the south  however in a maze with high walls  and narrow paths  a higher accuracy than 6 meters is needed  in order to navigate properly  if the sensor and the service do not meet the desired accuracy  both might not be usable at all  as displayed in the right half of figure 3  where the user will be prompted to turn right  while there is no turn at all  one could compare this simulation with an indoor environment  the aim is to ensure at least an accuracy of 2 metres to navigate the user  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 25 gps is thus unsuitable for the indoor environment  in the next chapter  other sensor techniques are being described  with the emphasis on wi-fi technology  figure 3 gps positioning on the road and in a maze to simulate indoor navigation 4.2 other sensor techniques compared indoor signal measurement is difficult  since the majority of the signals hardly  or can not  penetrate through objects  but are being reflected instead  other factors that decrease the reliability and accuracy includes the hardware of the transmitter  construction objects such as walls and doors  including their material  variations in temperature and humidity that might disturb signal strength  access constraints due to opening hours or security zones  and human activity  mehmood et al  2010  p 1220 ; lim et al  2010  p 406   kolodziej & hjelm  2006   manodham et al   2008   lim et al   2010  and woo et al   2011  outlines a variety of sensor technologies that might be used for localization  amongst these  infrared  ultrasound  radio frequency identification  rfid   ieee 802.11  wi-fi  and ultra wide band  uwb  are commonly named techniques  infrared  ir ; and the extended infrared data association  irda  technology allows easy positioning due to id matching of devices  but due to its short range and lineof-sight requirement  it is not a suitable system for localization  radio frequency identification  rfid  makes use of tags and readers  which allow fast read/write data communication  but there is no real localization and positioning involved  ultrasound technology  based on emitting sound pulses  is using the response time to determine a location  but it can not countermeasure the problem of multipath effects and its weakness to environmental noise  bluetooth is forwarded as a solution  since it is capable of high speed data transfer  within an acceptable range  but since the entire network is portable  positioning can be difficult  ultra wide band  uwb  offers fast  low-power and large capacity data transfer  and has similar traits as both bluetooth as wi-fi  the advantage is that it is capable of very precise localization  near 15 cm  but it is rather expensive  finally  the ieee 802.11  wi-fi  technology of data exchange proves to be the most balanced  as the signal range of around 30-40 meter indoor is acceptable and its economic viability is stable  the technology is still being developed  with the current state of 802.11n reaching up to an indoor range of about 91 m  and an outdoor range of 182m  ibrahim & ibrahim  2010   however  the localization accuracy at its current state is not sufficient and today there is still research to be conduct regarding which filters should be applied  another weakness is that in larger buildings a large amount of transmitters needs to be installed  although the same applies to the other techniques  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 26 despite of each technologys shortcomings  wi-fi is considered the most attractive alternative to gps for indoor usage  as its range is at a fair level  32 m   and wi-fi is widely available in many places  which saves significantly time and effort in arranging an infrastructure  nevertheless  it is also possible to combine the different technologies in one application  for instance  an application that is capable of toggling between gps  bluetooth and wi-fi at will  however  it is not the goal of this thesis doing so  although it might serve as a recommendation for future work  a brief summary of the technologies and techniques is shown in table 1 a full overview is found in the annex  table ap  1 the allocation techniques  also known as the positioning techniques  are further described in chapter 5 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 27 technique  a  gps range / accuracy accuracy  6.0 m  10.0 m gsm / umts range  35.0 km range  0.7 m 2.5 m ir irda range  2.5 m rfid active passive ultrasound bluetooth ultra wide band  uwb  ieee 802.11  wi-fi  range  100 m range  1.5 m 2.0 m accuracy  3.0 cm 1.0 m range  100 m accuracy  10 m 20 m range  50 m  cap  accuracy  15 cm 4 m range  32 m  indoor  95 m  outdoor  accuracy  1m5m remarks + low barrier entry  slow computation and processing time  very susceptible to reflectance and multi-paths + globally available  cell-based accuracy  short range of detection limits infrastructure  no penetration of materials / multipath  line of sight  signal can be disturbed easily same method as ir  yet with higher speed allocation meth  * trilateration + high-speed response time + read/write capabilities  no communication network  no allocation information cell-id  no penetration of materials / multipath  extremely sensitive to environment + high speed data transfer  positioning via triangulation  no objects into account   explicit links between devices required  its mobility also limits positioning and topology + multipath immunity/high precision  + high speed data  nearly 10xwi-fi   not everywhere legal  economically expensive + large scale available over the world + economical viable  high power consumption  slightly multipath susceptible trilateration table 1 overview selection of possible techniques for localization table based on manodham et al   2008  and kolodziej & hjelm  2006  and lim et al   2010   see also table ap  1 for a full overview *the allocation  positioning  methods are further explained in chapter 5 cell-id signal strength cell-id cell-id trilateration signal strength trilateration signal strength trilateration signal strength m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 28 4.3 general background of wi-fi wi-fi is the common name for the standard framework of a wireless local area network  wlan   as set up by the 802 committee of the institute of electrical and electronics engineers  in fact  the official name is ieee 802.11 the commonly standards that are being used are the 802.11b  802.11g and the 802.11n versions  the contents below are based on the ieee 802.11-2007 document  which can be retrieved at their website http  //standards.ieee.org/about/get/802/802.11.html  4.3.1 use of spread spectrum ieee 802.11 technology makes primarily use of modulation techniques in the 2.4 ghz industrial  scientific and medical radio band  ism   or in the lesser used 5.0 ghz band  the radio waves make use of the spread spectrum modulation technique  which means that the generated carrier waves are over the full frequency domain  thus wider than the information signals  as displayed in figure 4 there is a transmitter  usually a router  and a receiver  usually a computer or mobile device  the modulation technique for the 802.11 depends on the version being used  as displayed in table 2 figure 4 normal versus spread spectrum image derived from kessler  2006  802.11 frequency  ghz  a b g n 2.4 3.7  5.0 2.4 2.4 2.4  5.0 bandwidth  mhz  data rate per stream  mbit/s  20 20 20 20 20 40 1  2 6  9  12  18  24  36  48  54 5.5  11 6  9  12  18  24  36  48  54 7.2  14.4  21.7  28.9  43.3  57.8  72.2 15  30  45  60  90  120  135  150 allowable mimo streams 1 1 1 1 4 4 modulation technique dsss  fhss ofdm dsss ofdm  dsss ofdm table 2 properties of ieee802.11 protocols source  ieee  2011  and wi-fi alliance  2009  the original 802.11 and subsequent 802.11a are no longer in use today  the original 802.11 made use of infrared technology  the frequency hopping spread spectrum  fhss  or the direct sequence spread spectrum  dsss   but was rather slow due to its low data rate  the 802.11a has become m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 29 obsolete as well  because the signals of the orthogonal frequency division multiplexing  ofdm  modulation technique at the frequency of 3.7 ghz and 5.0 ghz could not penetrate well through walls  despite their higher frequency and their higher data stream  the 802.11b and the 802.11g are nowadays commonly used protocols  again operating at the 2.4 ghz frequency  knowing that interference with appliances in the same frequency  such as microwaves and bluetooth  still occurs  using the dsss at this frequency ensured a reliable working  the main differences between the b and the g protocols are the levels of data rates  and the modulation techniques of ofdm in addition  yet instead of the 3.7 or 5.0 ghz level  at the 2.4 ghz level   finally  the 802.11n was based on prior protocols  and by allowing multiple input multiple-output antennas  mimo   wi-fi alliance  2009 ; ieee  2011   this means that more than one transmitters and receivers are being used to increase capacity  the frequency hopping spread spectrum  fhss  is the transmitting of radio wave signals that constantly change between the frequencies  for the originally ieee 802.11  this was less suitable  even though the security is rather high  because it is hard to intercept these  both the 802.11b and 802.11g make use of the dsss modulation technique  with 802.11g also capable of using the ofdm technique  the 802.11n explicitly uses the ofdm  also at the 2.4 ghz  in dsss  waves are being send  a pseudo noise  pn  code symbol  a chip  is being transmitted  which is shorter and faster than an information bit  the data transmissions are being multiplied with a noise transmission  which is a sequence of 1 and -1 values  at a frequency higher than the original signal  a receiver can use the same pn sequence to reconstruct the data signals  this is displayed in figure 5 figure 5 dsss messaging image derived from kessler  2006  ofdm for 802.11 divides the 2.4 ghz band in 14 channels  each with a width of about 20-22 mhz wide  and 5 mhz apart  not all channels are available  legal  in each country  such as the 14th channel  which is only available in japan  in figure 6  an example is provided  within that channel  conventional data is being sent  the advantage of this technique is that it can switch to other channels in case problems are detected that interferes with the signal  such as bluetooth or microwaves due signal loss despite being closely located to the access point  most importantly it is m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 30 possible to use overlapping channels for signal transmittance  countering selective fading unlike the case being for a single channel  intini  2000   figure 6 channels of the 2.4 ghz for ofdm image derived from intini  2000  4.3.2 frames / layers the signals that 802.11 broadcast  contain frames  or also called layers  each frame contains a multiple access control  mac  address  in combination with the received signal strength  expressed in dbm  it is possible to estimate how close an access point is  the ieee 802.11 documents specifies in great detail what the wide array of the exact contents  the wi-fi virtual laboratory led by thomas sturgeon  2011  graphically explains briefly what a signal contains  as displayed in figure 7 ; while intini  2000  explicitly visualize the coding in figure 8 for wi-fi fingerprinting  the only information that is required is the information in the management frames  since the signals are only being used to determine a location  and not to transfer data  fingerprinting is described in the next chapter  among other techniques  figure 7 frames of a 802.11 signal screenshot taken from the wi-fi virtual laboratory  sturgeon et al  2011  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 31 figure 8  802.11 frames and its coding source  intini  2000  4.4 general strengths and weaknesses wi-fi system is low-cost and low-entry  wi-fi access points are nowadays widely available  the main strength is that it is able to partly penetrate through objects  however  some weaknesses are the security  easy to intercept  unless further encrypted  and interference with other applications in the same frequency  such as bluetooth and microwaves  although this depends on the channel being used in the case of ofdm  limited data bandwidth is considered another limitation  lim et al   2010  for example noted the decrease of data transfer speed and bandwidth during office hours  in table 3  a summation of the swot analysis can be found  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 32 swot strengths aspect 1 low-cost and low-entry 2 able to penetrate walls in where gps fails weaknesses 3 in available spaces  fairly good available signal strengths 4 specific location fingerprints available  5 susceptible to variations in signal strength due to time 6 earthbound based  requires more infrastructure 7 multi-path influenced by present objects 8 might interfere with other appliances in the 2.4 ghz ism 9 site surveying and registering time consuming 10 mac address related prone to changes opportunities threats 11 security is weak 12 speed decreases with traffic 13 fingerprinting does not require geometric surveys 14 fingerprinting only necessary at selected places 15 bluetooth  bt  or ultra wideband  uwb  might overtake wi-fi for positioning 16 privacy related elements might block registration of macs and thus fingerprinting table 3 swot analysis of wi-fi and wi-fi fingerprinting remark 1 widely available at affordable prices 2 although effect is depleted after thick layers  such as thick concrete walls 3 due to multi-path  good signal differentiation ; up to 100m 4 coverage of entire building  if access points are well placed 5 a recorded fingerprint can not exactly be reproduced 6 for fingerprinting  more access points are needed  unlike satellite based 7 the more objects there are  the more differentiated the fingerprints will be 8 for example bluetooth and microwaves 9 must be repeated for interior and movement changes  and for each building 10 if system fails  or when access point fails  mac can not be used  11 only applicable to data transfer 12 only applicable to data transfer 13 time and effort can be saved on mapping 14 it is not necessary to measure every n meter ; only at places with important topological meaning or at least where fingerprints look different  15 bt rather stable  uwb powerful in better catering multi-path + better range  16 issue of registration of private macs limitation to public buildings only m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 33 5 positioning techniques in the various literature studies  the word localization is being used to determine a position  however  in this research the term allocation  method  is being preferred  since it does not explicitly refer to an absolute or relative location  unless stated otherwise  see also the terminology at the beginning of this thesis research  5.1 five techniques different methodologies based on signal metrics can be used to allocate devices  although there are more allocation techniques available  woo et al   2011   zhang et al   2010  and kolodziej & hjelm  2006  distinguished five main methods  using  a  cell identification  b  angle of arrival  triangulation   c  time of arrival  trilateration   d  time difference of arrival and e  received signal strength categories  also called fingerprinting  a  with cell identification  cell-id   transmitters  or  access points  are dividing an area in tiles  or cells  within those cells  the receiver can be detected  however  this method is imprecise  because it is hard to determine where in the cell the receiver can be spotted  b  the angle of arrival  aoa  determines the position of the user by measuring the angle towards the receiver from the transmitter  woo et al  2011   the transmitters must be capable of calculating such information  this can be done with directional antennae  yet  the method is unreliable  since it is prone to multi-paths  plus it requires the line of sight to detect the receiver  which is hard to counter in the harsh indoor environment  zhang et al  2010 ; kolodziej & hjelm  2006   in the extension of the aoa  triangulation can be done to map an entire region  based on the angles  c  time of arrival  toa  measures the exact distance by using the travel time of the signal from the transmitter to the receiver  using the equation r = time x speed  where speed is a constant  only time needs to be measured to determine the exact location r  zhang et al  2010   however  in order to get more accurate results  synchronization of the receivers is needed  d  toa requires synchronization of both transmitters and receivers  whereas the time difference of arrival  tdoa  requires synchronization of the receivers  woo et al  2011   both methods belong to the trilateration group  as it involves the intersection of the radii of the transmitters  zhang et al  2010   e  lastly  the received signal strength  rss   also called fingerprinting  where a radio map is being created  there is an offline and an online phase  also called the training phase and tracking phase  the offline phase of fingerprinting is determining the signal characteristics of a given point and storing it in a database  the online phase is picking up the signal characteristics and compares it with the database  so that the place can be determined  ideally  a filter is needed to increase the positional accuracy and estimations of the locations  even though the reflection and absorbance of the signals have been taken into account  kolodziej & hjelm  2006 ; woo et al  2010   figure 9 presents an overview of the localization techniques mentioned  figure 10 presents a more comprehensive illustration of the offline phase of fingerprinting  in the online phase  the device attempts to match the signal characteristics with its position and is in this way able to determine where it is located  in the next sections  the emphasis is on fingerprinting as a technique  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 34 figure 9 allocation methods illustrations are based on woo et al   2011   m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 35 figure 10 an example of fingerprinting based on woo et al   2011   this is a pure theoretical illustration ; in reality the signal strength distribution heavily depends on present objects  and overlapping coverage areas  in this figure  only the radio maps of access points a and d are displayed ; in reality all radio maps together form one overview  as can be seen  this placement of wi-fi access points might not be the most efficient one  5.2 fingerprinting elaborated recent studies  jan et al  2010 ; lim et al  2010 ; yim  2008  have shown that fingerprinting is a fundamental method of indoor allocation  even though the level of accuracy is not at its desired level of approximately 2 metres  because of its relative robustness to handle multi-path effects  still  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 36 various challenges exist  as soon as objects have moved  which includes the presence of peoples   the fingerprints might alter  in addition  the timestamps of the received signal strength  rss  is not constant over the day  in public buildings for instance  the rss is about 5 dbm less during office hours  from approximately 9 am to 6 pm   which could influence the fingerprint database  but not too much  lim et al  2010   since the data layer of wi-fi is needed  in order to create a fingerprint database  one must be able to log the signal strengths throughout the entire building  with the help of data logging services  dawes & chin  2011   that might cause problems in case of sealed off zones  various studies have introduced different filters for improving positioning on maps directly  yim et al   2010  used an extended kalman filter to improve the accuracy of the wi-fi positioning during the offline fingerprinting phase  the kalman filter basically reduces the noise in locational determination  however  the use of kalman filters is disputed by various authors  chiou et al   2009  developed an alternative method for fingerprinting  which is called adaptive positioning but it still makes use of the kalman filter  jan et al   2010  suggested that a particle filter would be better instead of a kalman filter  since a kalman filter is a linear model  suitable for linear environments  however  the real world is usually not a linear build environment  jan et al   2010  and dawes & chin  2011  however found out that bayesian map matching algorithms have difficulties in environment with high variable transmitters and fingerprinting  rss  values  they also showed that in the same fingerprinting phase  the accuracy is highest  when nearest neighbour filters are applied  the nearest neighbour assumes that a specific point that has to be measured is most likely similar  or at least close in value  to the most nearby points  depending on the weight  roos et al  2002   an extensive offline/training phase will be carried out in the study area  and after that  the online/tracking phase will be tested for its accuracy  this will be taken into account for the evaluation of the application  as the user allocation will be used for the navigation  it is not the goal of the research to fully assess the accuracy of wi-fi fingerprinting  however  as a final remark  it is possible to determine signal strengths in the vertical position as well  if the router is attached to the ceiling  the received signal strength is a bit weaker near the floor  however  since it is unlikely for persons to keep their receiver at near 2 metres or at 0.1 metres above the floor  this research will only conduct a survey at the height of near 1 metre  which should be the height of the users to keep their phone in their hands  in addition  since it is not the aim of the study to enhance positioning accuracy  instead  localization is considered   a real map matching does not take place  due to high variations in signal strengths caused by multipath  the fingerprint database needs to be updated frequently  and it might be reproduced for a variety of devices  since a high-end wi-fi receiver perceives signal strengths to be stronger than low-end wi-fi receivers  5.3 building constructions influencing fingerprinting as already pointed out  gps suffers significantly from radio wave propagation  jan et al  2010   signals are unable to penetrate buildings  and even if they do so  the signal strength significantly decreases  although wi-fi belongs to the same category of frequency  the uhf  ultra high frequency  which is between 300mhz and 3 ghz   wi-fi is better able to cater the propagation as it is in the higher  longer range of the frequency  wi-fi at 2.4 ghz  although 802.11n is capable of using the 5.0 ghz band  and gps l1 on 1.5-1.6 ghz and l2 on 1.2 ghz  ibrahim & ibrahim  2010   this does not mean it can perfectly handle this problem  not only intensive use of the access point of wi-fi influences the signal strength  and thus fingerprinting  but so does the building constructions  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 37 klukas et al   2004  studied the effects of building materials on the uhf signals and found evidence aluminium tissues and concrete  cinder block objects interferes the signal strength  a loss of 10-15 dbm for aluminium objects and even 20-26 dbm for cinder block objects  this is in contrast of the plywood and gyprock  where in both cases a power loss of between 0 and 2 dbm was found  a combination of the latter two materials resulted in moderate power loss of 5-10 dbm  this temporal aspect has been left out  in theory  an object can receive a signal via the line-of-sight  directly   but also via reflectance of other objects  indirectly   in this case  the receiver did receive a signal  but it was either delayed  indirect signal  or it was a weaker signal  direct signal   in addition  ibrahim & ibrahim  2010  found out that the signal strength also sharply drops after a distance of 20m  this means that  regardless of the building construction and materials used  the placement of the wi-fi access points should be placed at a proper distance from each other  to ensure the fingerprinting results will not be heavily influenced  prone to alterations  by misplacements  combined with the signal propagation as described by klukas et al   2004   great care has to be taken as well for the placement next to specific types of walls or ceilings as such  in figure 10 for example  the walls of the elevator shaft might contain a thicker coating than normal  resulting in lower signal strength  5.4 using signal strengths to locate the fingerprinting method itself is not new  as various  msc  researchers have tried to use various filters upon location detection directly projected on maps  and at each possible location  mostly  attempts have been made to calibrate the position in the indoor space  lee  2007  addresses the paradigm of fingerprinting by converting discrete signal strength values to continuous values and implements various probabilistic filters to increase location determination for constant tracking at each single space  de koning  2010   albeit with gsm signals outdoors instead of wi-fi signals indoors  first correlates signal space with euclidean space and implemented variations on the weighted nearest neighbour filter  to retrieve location information  yim et al   2010  proposes a similar combination with weighted nearest neighbour filters and trilateration  but concludes that an extended kalman filter would provide better results  milioris et al   2010  proposed an analysis in which the distances in terms of signal strength of the training phase were compared with the tracking phase  and in addition  a multivariate gaussian filter has been used to do so  although attempts have been made to calculate mean errors  the idea of comparing them with each other itself is sound  finally  shum et al   2011  have chosen a method to determine positions without filters  also by comparing differences in signal strengths in the training and tracking phases  but then apply a least sum of square methods  which has been regarded very promising  in this thesis project and prototype  a similar approach to shum et al   2011  has been chosen  as with the lack of geometry  no direct map matching algorithms can be implemented  resulting in the fact that no filters  such as the kalman or weighted nearest neighbour  can be used  in addition  it is not the aim to pinpoint exact locations of the entire space  as it is assumed that locations which are very close to each other have similar fingerprints  this is why locations have been chosen and recorded  in which the fingerprints can be clearly distinguished from each other  as that was the assumption of shum et al   2011  similarly  however  the text format outputs being provided  can be geocoded into real world coordinates  to do so  two methods have been proposed  a count method  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 38 which only counts the number of matches  and a least sum of squares method as proposed by shum et al   2011   these methods have been chosen in the first place because there is no map matching which implies there is no need in exact positioning  and in the second place to underline the simplicity of the application  these two methods are described and compared in chapter 16.3 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 39 6 navigation in this chapter general theory about navigation and its required infrastructure are described  which includes the general thoughts about navigation  6.1   as well as the importance of certainty and route confirmation  6.2   algorithms  6.3   required infrastructure  6.4   and spatial referencing  6.5   6.1 what is navigation ? navigation is the process of monitoring and controlling the movement of a craft or vehicle from one place of another bowditch  this statement from nathaniel bowditch  2002  is still applicable  navigation can also be described as going from source a to destination b  while knowing where you are from  what to expect on your way  while being in motion from source to destination  or differently said  while the source is moving towards a fixed destination   it assumes that a start and destination is known  and that one has to go from start to destination via a certain path  present-day navigation is no longer solely based on the position of human interference with the eye line-of-sight such as in watch towers  celestial processes or dead reckoning  today  navigation can be fully done without the use of any direct human interference  such as radio  radar and satellite navigation  as with these modern navigation techniques  going from a to b itself is no longer the main subject  but the question is rather how one should going from a to b and how one would retrieve information along the way  the aspects of monitoring and controlling is very important  with a rapid emerge of applications which utilizes navigation for information  ranging from tracking and tracing parcels  to chip-tagged products leaving unauthorized a shop  resulting in ringing alarms at the front gate of that same shop   in short  navigation requires information on  where the user is  start location  ; where the user would like to go  destination   which can be queried from an address  coordinate  points of interest  or a combination  this is strongly related to the use of user profiles to steer the end user ; and how the user should go from start to destination  the information of the navigation itself  as well as information along the way  such as the availability of an atm  depending on the user preferences and user profile  this is the path  and can be configured according to the wishes of the end user  such as the shortest or fastest path  6.2 navigation principles 6.2.1 general principles in order to perform a navigation service  a start point  an end point  the navigable space  the network    re  orientation and directives are required  all locational information between start and end point can be used for this desire  such as attributes of the start and end point which can be queried  fastest or shortest route  although pedestrian routes do not differ much regarding this aspect  unlike motorized transport  since the velocity of the walking user is usually constant   characteristics of the route in-between and its orientation  all of these sets need to be modelled somehow  kolodziej & hjelm  2006   mention the fundamental inclusions of the following procedures  input module for start and destination of user ; m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 40 route database with positions and connections  route network map  ; o topology and structure is coupled to this route database ; it is not absolutely necessary to have coordinates  however  route calculation module  using the route database and algorithms such as dijkstras shortest path algorithms ; presentation of the route guidance  list of directives   as soon as a route has been calculated  a list of directives and a map can be constructed  the route will be dependent on what the profile and wishes of the users are  for instance  the user is a guest in a large power plant  and can not enter all zones due to security restrictions  another example is disabled person  who can only take the elevator  this will clearly influence the route  either way  the application has to keep track in which phase the user is currently at  kolodziej & hjelm  2006  approach this in such way  that each directive in the list has a start and an end ; as soon as the end has reached  the directive will be removed from the list  and the next directive will start  this will continuously loop  until the destination has been reached  6.2.2 certainty and route confirmation indoor  the user has a wide array of recognition points available  since the indoor environment is very detailed  the user easily passes his destination or important turns  the user can not constantly watch his mobile screen for confirmation  the user wants to have a level of certainty  in navigation  one fundamental technique is to check whether the user is still at the assigned route  the receiver will pass through certain points and if the position matches the predicted point  confirmation is being sent to the application the user is on route  if this is not being the case  a recalculation has to take place  in this thesis  the fingerprints can be considered as such check points  6.3 navigation algorithms the navigation itself is calculated via navigation algorithms  with various optimizations  such as the shortest  fastest or cheapest route  in order to implement a navigation algorithm  the navigable space needs to be converted to a graph  compromised with nodes and edge  along with its topology  in a study of shortest path algorithms  lu & lai  2006  confirmed the robustness of dijkstras shortest path algorithm  even though the shortest routing depends on the structure of the road network  the paths that are possible in a building are not much different  even though there are no large physical entities hindering  such as rivers or mountains  the buildings structure influences the travel time  a building with two dead ends like structure does not contribute to a short path availability  see also annex b.1  for background on pedestrian movements  6.4 navigation infrastructure for indoor navigation utilizing wi-fi fingerprinting as a positioning technique  it is required there are multiple access points  or wi-fi routers  are available  in the study area  the otb building in delft   no changes will be made to the placements of the routers  as in reality  not always precise coverage occurs  despite it is desirable to do so  each access point is designated with a media access control  mac  address  thus having unique transmitters  those can be used to determine the position  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 41 6.5 spatial referencing a spatial referencing system is needed to properly maintain the locations of the various entities  room 329 might be on the third floor in an educational institute  but in a large  single level hotel complex this is not the case  positioning can be done absolute  positioning of the user is relative to a reference position  or relative  user depends his location on other objects nearby   kolodziej & hjelm  2006   in the outdoor navigation  a simple absolute referencing longitude-latitude is sufficient for the user  although the user would prefer a relative referencing system  such as a street with a house number  or a system which supports map backgrounds in which the user can recognize objects  especially in the indoor environment  the 3d aspects should not be neglected  which is why a position accuracy of 2 metres should is desirable  multiple objects can be on the same horizontal dimension  yet on a different vertical dimension  proper geocoding  x  y  z  is thus necessary for each space  with this context  cell id positioning  absolute  as shown in figure 9a  page 34   is most likely  a coordination or reference system can be added to each access point  or to each floor  as access points on the same floor usually have the same z-value  the only thing that is required is a switch between the reference systems  however  cell id positioning is rather inaccurate  since it does not tell where exactly the user within the cell is located  reference positioning in the form fingerprinting as described in the previous chapters  is a welcome solution instead  since the accuracy is higher  even though the positioning algorithms are not yet at the desired shelf-like level of accuracy  the deviation of two meters is still considered to be useful  as the user is still able to navigate properly  kolodziej & hjelm  2006   mention that in reality  relative referencing is better understandable  going right or left is in a humans mind easy to understand  unlike going west or east  as one usually does not have a clue what the orientation is  the same applies to the positioning  building a  wing b  room 2.10  second floor  prevails over position  35.629535  139.879818 ; figure 11  in the human perception  in this context  it is possible to make a set of geocodes from the components of the body  so they can be distinguished from each other  but it is required to recode them again for the end product  this means that spatial referencing will be mostly done relatively  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 42 figure 11 position  35.629535  139.879818   bayside station  tokyo  japan source  google maps  2011  the signal strengths of the fingerprinting can be used as a standalone  relative reference system  each fingerprint has its own location  a position can then be assigned to that location  a reference location  0,0,0  can be assigned to one corner of the building  or perhaps even a little bit outside the building  the exact locations can be recoded to relative positioning parameters  such as < building >  < wing >  < floor >  < room >  since the goal is to allocate a user using this method  we speak of localization instead of positioning  see terminology   more about not using an absolute reference system  and geometry  is being discussed in chapter 12 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 43 7 building an application using standards an application will be made on a smartphone  which should be able to connect via 802.11/wi-fi in the first place  the application shall be installed on a htc desire z device  which uses the android 2.2.1 operating system  it is possible to build an application according to existing frameworks  in this thesis research  the aim is to make use of the framework of the open location services  openls  from the open geospatial consortium  ogc   the ogc has standards for mobile applications which uses a geomobility server  which is a service on a server  where applications can request various services and obtain responses which can be used in applications  the geomobility server is capable to produce maps and routes  as well as accessing other databases via the internet  geomobility makes use of the following five core services  ogc  2008a   1 directory services  what do you want to find  and where is it located ?  2 gateway services  the localization of the user on the service/network  3 location utility/geocoding services  the transformation of a location in readable parameters  such as from address to longitude/latitude in decimal degree and vice versa  4 presentation services  the visualization of the results on the device  5 route/navigation services  the navigation from origin to destination  the parameters and attributes of these services are described in the ogc document opengis location services  openls   core services  however  most of these parameters require the presence of geometric maps and  by default wgs84  coordinates  as maps are not present in the intended application  only the framework of the geomobility server openls can be useful  in the sense they provide a structure on which services should be present in an application  and how they are interrelated  the same services can be utilized  but with different parameters  for navigational purposes  the ogc  2010  recommends that at least three factors should be present in the model  and therefore the application   1  localization technique and localization infrastructure  which has been discussed in the chapters 5 and 6   2  mode of transport  walking ; elevators only etc    by using user profiles  to be discussed in chapter 10  and  3  navigation constraints  partly resulting from data and modelling issues  as well as spatial referencing  which has been discussed in general in chapter 7  and will be further discussed in chapter 14 from these three components  the navigation engine can be carried out  in the next part of this thesis research  the open location services are being described in more detail  along with how it shall be implemented in this project  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 44 conclusion part i how can wi-fi be used in mobile indoor navigation ? the ieee 802.11 technology is synonym to wireless internet  also called wlan  wireless local area network  or wi-fi  wireless fidelity   the technology makes use of the 2.4 ghz industrial  scientific and medical band  and uses spread spectrum modulation  in the transmittance of wi-fi  multiple layers are being broadcast  for wi-fi fingerprinting  only the header of the power management layer is necessary  which contains information about the header information  and the signal strength  wi-fi is already widely available and installed in many public and private buildings  fingerprinting is the process of position determination  using the received signal strength at one point  this can be stored for each point  at given heights  although in this research only the height of about 1 metre above the floor is considered  once collected in a database  the application can check at which position the receiver is  and thus position the user  a major drawback of fingerprinting is that it requires extensive surveying  and that multi-paths works too efficient  since human bodies and closed doors are intervening the path of the signal strength characteristics  an important aspect of navigation is the confirmation of the user being at the route  if the user gets confirmation  the user can continue to follow his route  if not  an alternative route needs to be calculated  the fingerprints can be considered as check points  in which this thesis will elaborate in the next chapters  how can an existing infrastructure be used and modified for indoor navigation ? indoor navigation is different than outdoors  since pedestrians usually do not vary too much in speed  making the shortest path also the fastest path  in addition  absolute positions such as  long  lat  are unsuitable for indoor navigation  as the level of detail is different  although these details still can be used for maps once the indoor locations are being geocoded  new reference systems with a  0,0,0  can be used at the background  while they remain unknown to the user  relative reference systems are for better use  such as < building >  < wing/section >  < floor >  < room >  in a logical order and sorted  these differences from outdoor navigation are the most important directives for indoor navigation  we then speak of localization  as we use a relative position  instead of an absolute position  applications can be built based on the open location standards  openls  set by the open geospatial consortium  ogc   a navigation service can be developed around directory services  gateway services  geocoding services  presentation services and navigation services  in this research  the gateway service is strongly connected with the wi-fi technology and fingerprinting positioning  information about what is available in the indoor environment can be found in the directory services  and geospatial queries can be combined with it  as soon as that information is geocoded according to the geocoding services  the navigation service can thus start if these are combined  the final visualization or presentation is being described in the presentation services  in which another important aspect needs to derive from outdoor navigation  indoor navigation requires much more detail  hence  a different approach is needed for the final visualization  especially since the navigation also comes on a small screen  where normal cartographic rules differ from large screen maps or paper maps  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 45 part ii  theory and application contents 8 the user involved user profiles 9 user allocation  gateway services 10 input  directory services and geocoding services 11 modelling and attributes processing and modelling the indoor space 12 processing visualization 13 navigation services as output 14 architecture in this second part  theory and application are made concrete  this part focuses on the application of theory within the to be developed prototype  with the wi-fi technology and fingerprinting methods  a navigational application can be created  with the use of the ogc framework for location services  first  in chapter 9  one must know what the target user is  what one can do and what one can expect  as soon as these user requirements are known  one can further develop the application  in chapter 10  the link between the sensor technology and the application is made  in terms of ogc location services  this includes the gateway services  thus in chapter 11  the directory and the geocoding services are addressed  to make sure fundamental information can be queried and stored  it is important where the points of interests are  the uniqueness of this project is that it does not use building geometry for navigation and the indoor modelling  chapter 12 emphasizes this aspect  chapter 13 continues with the presentation and visualization of the before mentioned contents  chapter 14 deals with the core service of navigation itself  and its extensions  finally  chapter 15 altogether displays the architecture  which includes the functional and technical design  emphasizing all chapters  in the end  the research questions how can the creation of an application be possible  without using geometry ? and what are the benefits of using the framework of open location service standards in an indoor navigation application ? can be answered  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 46 8 the user involved upon building an application or product  it is important to know what your target user is  and what the user would like to do with it  for instance  it does not make sense to provide directions along motor highways if your user is a pedestrian  creating an application is not any different  this is why there is a variety of location based services available on the market  which utilizes various sensor technologies  from trackers to navigators  from compasses to tagging software  it allows applications to become flexible  as it adapts itself to the user preferences  8.1 user profiles it is also possible to install a module in an application that automatically recognizes the users habits and characteristics each time the application is being used  the aim of such automated modification is to serve the user by supplying information that will most likely pique the interest  examples are the customized ads in googles gmail  where advertisement is closely related to the users e-mail contents  this is being described as user profiling  wu et al   2009  describes this as the characteristics and the relationships of the different users being used  although the european telecommunication standards institute  etsi  2010  better describes user profiling as a module which formally captures the user requirements  preferences  *+ and deploys those profiles *+  covering explicitly users desires  they are going even further  by defining user profiles as a total set of user-related information  preferences  rules and settings  which affects the way in which a user experiences terminals  devices and services  user profiles are different from user requirements  as user requirements involves the desire of user in technical fashion in the development of the product  rather than the adaptability of user profiles in the actual usage of the product  8.2 user needs in this project in this project in particular  the goal is to guide a person in a public building with its mobile device from the entrance to a given destination  the aim in this project regarding user profiles  is to develop such module within the application at a simple level  id est storing the information that is being inserted  so that in future events the application is able to predict what settings the user most likely wants  from the final definition the etsi gave   1  personal information   2  human centred preferences   3  service related information and preferences  specific information-feed for the service  and  4  device related information and preferences  all belong to the user profile  ultimately  it is desirable to create an application that is able to read device information  making the application suitable for a multitude of platforms  but in this project this will be limited to the capabilities of the android 2.2.3 htc desire z device  since it is the test bed  this results in the focus of user profiling in the user personal information  preferences and service preferences  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 47 personal information resources  describe things that may human centered be referenced preferences by rules or by other settings e.g  alerting service related information and preferences cadences  set of members of a group  pointers to device related sound files  information and preferences figure 12 user profiles defined by etsi  2010  8.2.1 personal information in this project  the person is modelled with the following properties  see also usher & strawderman  2010  for extensive research on characteristics on pedestrians   the user has limited information about the indoor environment  this means that the output of the application should compromise clear descriptions and overviews about what to do  8.2.2 human centred preferences  requirements  the following characteristics will co-determine the application regarding the preferences of the user the user is provided with a simple overview of how the application should work  the user wishes to get directions to walk towards the destination  the user wishes to get confirmation whether the user is on route or not  8.2.3 service related information and preferences combined with the human centred preferences  the service related information and preferences aims at the possibility to adapt the application to the user  this means that  the application allows a customizable feature that influences the whole concept  or  that the user can change settings of the application and adapt it to its situation  8.2.4 device related information and preferences  requirements  finally  the device related information and preferences are coping with hardware constraints  the application needs to fit accordingly  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 48 the user uses a htc desire z smartphone model  with android  api level 8  2.2 or higher   the application should run on a platform with fast processing  short processing time   the application allows a touch screen interface  the application utilizes wi-fi technology and must be enabled  an example of using user profiles is illustrated by foerster  2010  about map usage  a map of a specific region is the same  but the contents being displayed for a geologist is different than for an urban planner  the map is adapted according to the user  some background information about maps being adapted on mobile devices has been provided in annex b.2  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 49 9 user allocation  gateway services differences between indoor and outdoor navigation includes the sensor technique  gps versus nongps  and the scalability  the destination in the outdoor world are usually points of interests  while indoor navigation could be seen as a subset or complement of the outdoor world  meaning that a single point of interest  building  possibly contains other points of interests as well  these points of interests need to be carefully maintained  since a large amount of attributes can be coupled to these points of interests  which can help the user to navigate inside buildings  the localization of the user in the indoor environment can be further used and integrated in location based services  which is being described in this chapter  further details about the building itself needs to be mapped  and the rest depends on what the service provider would like to offer  jan et al  2010 ; see also the remaining chapters of this part ii   9.1 components of the gateway the positioning and point placement of the user to the location service  the gateway service  is perhaps the most challenging part of the project  as different algorithms applies to wi-fi positioning  kolodziej & hjelm  2006   propose the following steps need to be done  in order to secure a decent gateway service  site survey performance  signal strength model / fingerprinting database  creating the positioning model calibration access point placement and configuration tracking maintenance rights  due to changes over time  since it is the aim of the thesis to make a working prototype with existing access points  only the site surveying is being discussed  it is not the intention to fine tune the access point placement  since the main research question is whether it is possible to develop a wi-fi fingerprinting application without using geometric properties  9.2 site surveying and positioning site surveying is the preparation phase of fingerprinting  a database will be constructed with the specific fingerprints  it is possible to conduct this phase in the three dimensional space  by measuring in vertical positions as well  however  since most people hold their phone around the 1 metre height  only measurements at this corresponding height take place  at each floor  the temporal aspect has to be acknowledged  since the fingerprint can change over time  because a receiver can obtain signal strengths directly via a line-of-sight  but also indirectly  via reflectance  the multipath   the process of measuring has thus to be repeated at various time slots  the specific fingerprints will be assigned to a label  which actually includes other information about what is present at that place  such as recognizable objects  plants  pillars  inboxes  and signs   this process is similar as illustrated in figure 10  page 35   in this thesis  position is considered synonym for a fingerprint  since the fingerprint can contain already information about its environment  real m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 50 map matching and geometry are not required as such  it is therefore not possible to create a positioning model  in chapter 11.2  more background is given on the non-usage of geometry  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 51 10 directory and geocoding services the reason why these two services are in one chapter is that they are closely related to each other  in the sense they are both concern information about data  the directory services provides information about a place or object  whereas geocoding services provides information about what the location is  10.1 directory services the ogc  2008a  describes a directory service as  a  service  providing  subscribers with access to an online directory to find the nearest or a specific place  product or service  this implies that a user can use a search engine to find something with or without explicit location specifications  users might find a place  product or service by providing specific or explicit properties  which is called pinpointing  alternative  they can use spatial queries to find the nearest place  product or service  called proximity  both pinpointing as proximity require the following minimal information  a property of the point of interest  such as a unique id  name  description  absolute location the relative location information to the point of interest  such as nearest to me  within 500 metres  the ogc  2008a  provides specific directory request parameters  the only mandatory parameters include  although this depends on the nature of the query  in which other values can be stated as mandatory   poiproperties  in which a listing is provided  that can be used to do the search  keywords  name  in which characteristic values are stored  such as the reference object  the name and the type  value  in which the information can be reflected to the user  an example is illustrated in box 1  in which the question is asked where the nearest copy machine is being searched  while making use of a relative location statement  where is the nearest copy machine of where i am  room 1.002  ? < directoryrequest > < poilocation > < nearest > < poi id= '' 1 '' > < poiattributelist > < poiinfolist > < poiinfo name= '' poi name '' value= '' room 1.002 '' > < /poiinfolist > < /poiattributelist > < /poi > < /nearest > < /poilocation > < poiproperties directorytype= '' campus '' > < poiproperty name= '' type '' value= '' machine '' > < poiproperty name= '' subtype '' value= '' copy '' > < /poiproperties > < /directoryrequest > box 1 a xml example for ogc directory services the provided output is list of points of interests with the distances  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 52 this assumes that upon developing the application  at least a database with retrievable information for the interest of the user should be populated  10.2 geocoding services in order to make locational queries possible  it is necessary the various points of interests needs to have information on their position  also called geocoding  the other way around is called reverse geocoding  the geocoding is usually carried out on the background  since the services need to know exactly where the point of interest is located  and the user usually does not know on which absolute position he is  as soon as the point of interest has been traced and located in the absolute reference system  it will be translated back to the user in named locations  such as aisle 1 for geocoding services  the following parameters are mandatory  address  which can be inserted the returning value would be a position  x  y  z  for reversed geocoding services  the following parameters are mandatory  position  x  y  z   which is the starting position of the user which can be inserted  in terms of absolute positions  the returning value would be an address  street  number  in our iindoor environment  it is unlikely one can insert position information on its own  since a fingerprint is being used  unless the user knows exactly what fingerprint he or she is going to insert  it is not possible  the returnable responses for geocoding services that are possible include the following  numberofaddresses  so that the user might choose from matching addresses  if there are multiple matches  e.g  if one inserts commission room  it is possible that there are 3 commission rooms  address  which matched the inserted address  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 53 11 modelling and attributes 11.1 modelling the indoor environment the indoor environment can be modelled in many ways  dependent on what the service is aimed at  the importance is that one must know the level of granularity should be  as it is the goal of this project to let users navigate in buildings to a room  the accuracy level should be a room and not a part of a room  shelf-like accuracy   unless the target is a very large space  a node and edge structure like has been proposed by kolodziej and hjelm  2006  and the ogc  open geospatial consortium ; 2010  to model the environment for indoor navigation  especially the ogc highlights the importance of the relation between the nodes and edges  especially in the larger rooms and corridors  it is therefore recommended to break larger rooms in smaller segments ; the ogc calls this partitioning  the vertical dimension can also be part of the model  as shown in figure 13 in fact  this way of modelling resembles of remodelling the topological dual space as the node-relation-structure  ogc  2010   which can be used for the navigation service  the dual space can be described as a model of the space in terms of linkages  which resembles a graph  the topological dual space explicitly preserves the topology of the graph  it is hard to tell whether rooms are neighbouring  since there is little information about the size and distance of the environment  unless extra information can be added to the graph  therefore  attributes can be assigned to both the node as the edge  those attributes can be used for locational queries  in which the user can start its navigation in the first place  this also includes non-navigable spaces for specific users  such as bumps for wheelchair users  which in turn can be used to determine alternative routes  figure 13 nodes and edges representation  topological dual space  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 54 11.2 non-usage of geometry unlike the outdoor navigation  data on indoor locations is not widely available  there are no vendors for networks such as falkplan and teleatlas  and not all companies are willing to provide floor plans for public use  or even if there is a provision  it might be possible that not everything is covered to keep it secret  this might cause less accuracy  or missing data  although this might change in the future  in fact  the geometry does not necessarily have to be used in order to deploy the navigation service  indoor  a user only needs to know whether he is still on route  going from a to b going on route  there are significant recognizable objects present  such as plants  pillars  postal boxes or paintings  which provides help to confirm the user is in the right direction  for this  only fingerprints are an absolute necessity  the requirement is that the fingerprints should be distinguishable from each other and attached to pois  those fingerprints can be stored in a database and can be coupled with attributes  recognizable objects  about what is present at that place and organized in the graph  these attributes can be displayed on the screen in text or image  if the user can see those objects  as the screen tells them  the user can be certain he is at the right place  if the user reaches a node where a vertical movement can be made  information about possible stair climbing can be returned as well  this whole process is illustrated in figure 14 figure 14 fingerprinting objects and navigation the above implies that there is no geometry necessary  but this means that topology is indispensable  as indoor pedestrian navigation  see chapter 7  has the opportunity to recognize the space in multiple ways through present objects  it is not necessary to plot the entire floor plan  a fingerprint is sufficient  the only information the pedestrian can have  is how to go from one end to another  however  future extensions include the overview of the graph  so that the user can see at least the route on screen  another extension is the estimated time of arrival  which  however  the travel time variables significantly  as this depends on the user profile  some users need more effort to open a door  while others need more effort upon climbing a staircase  this suggests that only information about the edges is necessary  and not about the geometry surrounds it  as long as the topology remains  the result is to be found in figure 22  and is discussed in chapter 16 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 55 12 visualization  presentation services in this chapter  the visualization and representation aspects are discussed  as standard cartography deviates on mobile platforms  first generalities on small screen cartography are discussed in 12.1 in 12.2 some technical information on visualization is related to the ogc standards on presentation services  finally  in 12.3  some comments are made about 3d visualization and explained why this is not part of the thesis  12.1 users and general constraints and limitations a decent visualization is necessary to communicate the proper information to the user  the user is most likely not interested in the underlying principles  but in the end product  small mobile screen require a different visualization than paper maps or large computer screens  nagi  2004  distinguishes constraints on both the device-end as the network ends  as displayed in table 4 category constraint comment display infrastructural constraint device screen size usually very small display device resolution usually very limited display device colour range low range  although depends on device interaction device input opportunities interaction device output capabilities limitations of input fields  although depends on screen & resolution usually restricted due to limitations in processing performance network connection performance network latency performance device & network device & network limited storage performance processing power slow in contrast to regular  wireless  internet  unless device has a wi-fi data connection newer generation mobile phones allows larger capacity with the expansion of  micro  sd-cards restricted in the sense it does not equal normal computer-like processing speed table 4 mobile phone constraints table is based on nagi  2004   although the information in table 4 is dated from 2004  with performance and display related constraints being partly solved or relieved  still  the display and interaction categories remain important limitations on the end visualization  the cartography largely depends on the displaying capacities of the device  the larger the scale of a map  the more detail is needed  on a small screen  this is considered challenging to overcome this problem  yet  the better the resolution  the better the application can overcome this challenge  a low resolution smartphone might display text labels or symbol too large  for instance  nagi  2004   newer generation smartphones are able to scale the display ; in that sense this barrier has overcome  with the use of zooming options  one can toggle through different levels of details ; however this usually takes a lot of processing  when dynamic zooming is being used  this means that for each scale a different data set and data representation is being visualized  which is a smooth zoom in fact  this can also be done in steps  static stepped zooming  or static linear  no new data sets being visualized m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 56 at all   either way  this demands a lot of processing time for both the device as the network  nagi  2004   12.2 presentation services by the ogc the presentation service of the ogc  2008a  makes use of web mapping services  wms  and web feature services  wfs  to display on demand maps  however  since there is no geometry  only static figures  images  topological network graph without coordinates  maps  can be visualized instead  as there is no active and adaptive map viewing system  the parameters which belong to the presentation services are all not applicable for the purpose of this thesis research  12.3 acknowledgement of 3d modelling and 3d visualization although developments of 3d modelling and 3d visualization are still ongoing  it is decided in this research the visualization remains on the 2d or the 2.5d plane  as the focus is on the confirmation of positions  and not the visual representation  however  the acknowledgement of 3d visualization is important in future enhancements on the screen  even though the presence of flyovers or overpasses in the outdoor world is missing indoor  pedestrians still needs to deal with vertical movements along staircases and elevators inside buildings  dllner et al   2007   suggests that 3d visualization of objects or buildings certainly improve recognition patterns of users  which will further improve the navigation process  it is not necessarily to make photo realistic representations  but 3d sketch-based commands are already sufficient  in addition  utilizing the camera function of smartphones  augmented reality  placing layers of information on top of the visible environment  belongs to another possibility which can be incorporated in the application  12.4 cartography of text the well-known outdoor large points of interests in the form of buildings do not apply to the indoor context  however  instead  smaller points of interests are present  simple room destinations can be translated to concrete goals and information  for example  room 1.001 can be an information point for administration  and room 1.002 contains a copy machine  the visualization for the indoor navigation follows thus the same rules and relations as described in the previous two sub sections  however  as a result of not using the geometry for the modelling  chapter 11   no maps can be displayed  it is possible to provide the user with a graph or with simple listed text to direct the user  instead  the necessity of a map thus disappears  although this assumes there is a significant amount of recognizable objects present  the presentation of the service could be as follows  box 2   1  2  3  4 keep keep keep move straight as you pass a copy machine straight as you pass inboxes straight as you pass room 1.011 to your left  up one floor  box 2 example of utilizing text for recognizable objects the advantage of no cartography  maps  means that time and effort can be saved for deploying the application on a larger scale  as one only needs to determine the fingerprints  as hsu  2001  points out  text usually takes longer to process for the user  which can be considered as a disadvantage  ideally  the text should be as short as possible  and supported by icons  the sub sections below will discuss the underlying principles of text usage and text visualization as a whole  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 57 text visualization from the general cartographic rules  special attention is provided to the text visualization in this paper first  although kraak & ormeling  2003  only describe the rules for text usage on maps  the same rules can be used for general text emphasis without maps  text is able to show levels of importance between words/names  by creating variation in  highlights  using boldness or italics ; font face/style  using different fonts to distinguish texts from each other ; font size  to emphasize the  non  -importance of words ; font spacing  to emphasize the  non  -importance of words ; font colour and/or font colour background ; upper and lower case  by creating a contrast on what should be read  again  colour can be used to differentiate text on maps  but also on non-maps  the same limits on colour perception apply  a maximum of approximately 7-8 colours can be used to ensure the reader is able to select the most important information from a line of text  text attractiveness and uniform design the screens on mobile phones thus has limited space  and although the scaling on screens have been improved over the last years for smartphones  the emphasis on information visualization remains a significant contribution to an application  aside from what the application does  roto & kaikkonen  2003  found out that the topmost information on a page or interface got the highest priority  since it is first item perceived  in a study on the user perception of web pages interface  hsu  2011  researched the attraction of elements on a webpage and listed them from best attractive element to least attractive  1  2  3  4  5  6  7  8  9  10  11 title/logo image information display/presentation willingness to read colours structure attraction layout usability hyperlink readability of texts as can be seen  the importance of text is rated low  suggestions on images  colours and layout are better rated in contrast to texts  rank 10 and 11  aside from the aspect willingness to read   however  when it comes to the functionality  texts were provided more important ; better than the title or logo  text has to be readable to obtain knowledge as such  and hsu  2011  found evidence that the texts m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 58 are in general better perceived when the layout of the text follows the webpage or application standard design  which has to be uniform  this does not differ from location based applications  variation in text elements in their context michailidou et al   2008  also underlined the aesthetics of text visualization in webpages and applications  they acknowledge the importance of using clean  clear  and symmetrical design  in which bullets and buttons can further enhance the readability of text  as with the general cartographic rules  further refinements can be shown  using text variation in colour  size and style  wang & chen  2003  provided evidence that important text can be distinguished within the main text  by placing extra space on both sides  in which they call this jump length  a minimum distance of 0.35 cm to 0.70 cm has been considered effective if the distance is too long  the text would appear to be discontinued  in which users perceive as disturbing  too large holes in the text   text colour usage wang & chen  2003  researched in particular the combination of colours on screens  for both texts as backgrounds  they stated that colours have to be carefully chosen when they need to be combined  two extremes of the colour spectrum have to be avoided  such as red and blue  as they provide the user from a visual discomfort  more important is the luminance contrast between background and text colours  as they are perceived much better  for example  the combinations of black-on-white  white-on-black and blue-on-yellow were better read than red-on-white  blue-on-white and green-onwhite  although the combinations are dependent on the condition of the screen  as well as the suns illumination outdoors  moving text wang & chen  2003  also investigated the effect of using motion and speed of text  and they found that moving text in application has little impression on the user  in fact  users were tempted to ignore the moving text  which has also been acknowledged in a study by albrecht-buehler et al   2005   moving text in applications should not be too slow  but not too fast either  in order to maintain the attention of the user  in combination with background and colours  one has to ensure the background should not be disturbing to read the texts themselves  if the motion is too slow or too fast  or if the background and colours makes it hard to read  change blindness  ignorance of texts  thus ignorance of information and ignorance of the application  is being the case  which has to be avoided  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 59 12.5 initiatives to a text based indoor navigation application based on the above sections  an indoor navigation application  which is based on a small screen  and does not utilize geometric maps  but solely text display for directions  a few recommendations can be made regarding the output  the interface must be adaptive to the user  the interface itself has to be uniform in layout  a contrast in colours  luminance  has to be guaranteed  in order to let the user perceive the information correctly  blue-on-yellow has been proposed  to the top of the screen  the most important information has to be displayed  o this coincides with the current location and the target destination  when it comes to the output of text directions  orientation aspects have to be distinguished from the body  there should be a limit to the motion of text text scrolling should be made possible otherwise  text size can be considered as well  the proposed indoor navigation application is as follows  1  2  3  4  5  6  7  8  9  10  11 the device automatically detects where the position is  this position is made visible on the top of the screen  the user has to insert a specific start or current location and destination  the user has to navigate from one end to another  the device calculates a route  the user sees his current position on the top of the screen  the user sees if he is on route/off route directly below that position information line  the user sees his destination and the estimated time of arrival  the user sees a list of directives below that on/off route information  the first line of the directives is placed in a bigger text size  the subsequent lines are in a different colour and size  to emphasize the importance of the first direction output  12 in any of the lines  information about directions can be made in a separate colour or style  13 in any of the lines  information about orientation objects can be made in a separate colour or style  14 bullets or numbers have to be used to indicate steps  for example  current location  near room 5.99 on route | heading to  exit  coming from the stairs  walk straight towards room 5.97  to the left you see glass works  to the right you see a coffee machine   turn right  you see an elevator  take the elevator to ground floor  from the elevator turn left  exit the building figure 15 example text output using text visualization and variances m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 60 13 navigation services the navigation engine is another vital part of navigation as a whole  the ogc  2008b  enhanced their route services with the navigation services  with the assumption that the user is looking for more than solely a route  such as the reconfirmation of their progress  and editable features  a brief description of the navigation services from the ogc is in section 13.1 section 13.2 deals with the mandatory parameters to be used in a possible navigation service  the full overview can be found in ogc  2008b   section 13.3 concerns with the generation of route descriptions  13.1 navigation elements of the ogc the ogc  2008b  listed 30 possibilities determining or influencing the course of the user  in which the following are considered to be the most important  the full list can been found in table ap  2  core navigation  o specification of route preferences o specification of origin and destination point o determination of position o route calculation using user profile/preferences o presentation of route o route guidance extensions of rerouting  o by detour  with traffic information o by waypoints  as defined by the user o by getting off route o by change of route settings and preferences in this thesis  getting off route piques the most interest  this process assumes that the user have to be tracked  to determine whether the user is on or off route  thus  the confirmation of the users position plays a fundamental role in this aspect  in the case of fingerprinting as a positioning technique  routing is made possible by linking the fingerprints with each other and the user has to pass each point  fingerprint  on the route to stay on route  the navigation client should tell whether the user is on or off route  by comparing those fingerprints with each other  it is not the aim of this thesis to extensively describe all parameters and specifications of the navigation application itself  the ogc  2008b  provided all exact inclusions in the document of navigation services already  in the next section  only the mandatory parameters are briefly discussed  13.2 mandatory parameters the ogc  2008b  states that map matching is the method of determining where the mobile device has moved in the navigable network based on the devices previous location  s  and data about the devices motion from external input  such as  but not limited to gps   map matching is strongly related positioning  since a position is needed in order to determine where the user is  the ogc  2008b  describes recommends hard lat-long coordinates in the wgs84 reference system  but this can not be implemented for the interior of a building  instead  fingerprints in the context of a topological graph are a possible solution  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 61 at specific points on the navigable network  attributes  conditions and relationships  i.e  prohibited manoeuvres and directions  needs to be assigned  ogc 2008b   in order to provide the user directions  this means that entries and exits are also part of this  in table 5 below  the most important parameters are displayed  a full overview can be found in the document navigation services of the ogc  2008b   route requests routeplantype parameter routehandle extendedrouteplan boundingbox routeguidancerequest firstbucketsize priority provideroutehandle distanceunit mandatory yes yes no no no yes no no short description request information about the route specifies criteria route determination rectangular area of route return of turn-by-turn route instructions  text  stores directions in a list  bucket  priority of requests return of a route handle unit for measuring distance waypointlist avoidlist yes no list of waypoints along the route list of areas  locations and features in which the route should avoid passing through the criteria upon which a route is determined cost criteria ordered list of links and node travel costs for the path display of where the route navigation is now reference to the route stored at the navigation server describes overall characteristics of the route extendedroutecontrol costcriteria routelinkandcost firstbucket routehandle routesummary table 5 parameters navigation services routecontroltype* route response* yes yes yes no no no source  ogc  2008b   * more parameters are included  but these include vehicle information and actual traffic information  which does not apply to indoor navigation in general  as derived from table 5  the control of the route  including the waypoints is fundamental for the navigation  in order to navigate  one must include navigable points along the way  and assign costs to it  these costs can be used to inform the user about time and distance estimations  13.3 generating navigation guidance in this thesis research  a simple navigation algorithm  using dijkstras shortest path route  can be used for navigation instead  as the intention of the thesis is to use solely the framework  the parameters in table 8 have to be transformed in java  see chapter 16   however  before using the parameters  thoughts on how the route descriptions  the guidance  have to be explained first  when no maps are preserved  it is challenging to determine orientation aspects  upon travelling from node a to c via b  it is hard to tell from solely a graph whether one has to turn left  right or keep straight  as one can flip the graph  for instance  it is then important to assign orientation aspects to a connectivity database  when nodes  the fingerprints  and edges  connectivity information between fingerprints  can be stored  it is then important that the application should take the current and predicted positions into account  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 62 when the current and predicted  or the previous and current  position is known  the application can then predict on how the orientation can be helpful  in figure 16  a route has been calculated from node 2004 to node 2012 upon travelling from the first nodes  from node 2004 to node 2002 is basically straightforward  it implies that going from node 2004 to node 2003 is straight on  and the user has then turn left  however  there is no explicit implication that this graph is mirrored  perhaps going from node 2003 to node 2002 is a turn to the right  when storing orientation information between two links  one can not add left or right  since it depends on where the user is coming from  in the inverse route  the turn 2003-2004 is right  instead of straight on  it is useful to store information of the current or previous location  the predicted location  or both  in a table  one could store the route 2004-2003-2002  with 2004-2003 straight  previous location was 2005  and 20032002 as a turn to the left  while 2002-2003-2004 deals with a 2002-2003 straight  previous location was 2007  and 2003-2004 as a turn to the right  figure 16 routing  guidance  orientation however  there are many routes possible  and the question is how to program the orientation aspect  one possible solution  is by pre-programming every single possible list of route descriptions  as described above  another possibility is to store unique location  object information  without using orientation terms  such as turn towards the floor sign  although it is difficult to state  when there is no geometry involved  it is then important that the object information has to be stored along with the fingerprint or with the connectivity information  or both   in the case from travelling from node 2004 to node 2012  the following can be constructed   2004  pass through the doors   2003  turn towards plant   2002  walk towards sofas   2007  pass the reception   2009  pass anneke van cootenzaal   2011  turn towards statue   2012  destination reached  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 63 in this sense  no orientation  as in  head north/south  turn left/right   or rather  neutral directions are being used  only in the vertical direction  explicit orientation directions can be stated  go up/go down   next  the application has to check the current position of the user constantly  if the user finds itself on or near the provided nodes  then this must be confirmed  if not  re-routing has to be done  in which the user should be warned  at the same time  the application can already predetermine which nodes can be detected  it is therefore useful that the application should only get nearby nodes  fingerprints   for instance  the application should at least eliminate outlying nodes  if one traverses in the route from node 2004 to node 2012  then the application should not detect the user at node 2005  node 3005 or node 3205  after passing node 2009  for example  in the next chapter  an architectural overview is being presented  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 64 14 architecture  functional and technical design with the use of the services and user information  the final architecture can be determined  which is displayed in figure 17 below  the described core services in the chapters 9  10  12 and 13 are embedded in the centre of the architecture  based on the principles mentioned in chapter 11  as they deal with the processing of the application  the application itself is constructed in java with android  and is located at the heart of the architecture  the positioning feed is derived from the position determination equipment ; in this case  this is the wi-fi receiver of the smartphone  figure 17 architecture of this indoor navigation application derived and edited from ogc  2008b  the location contents form the database of the application  this also includes the fingerprints  as the application itself is standalone  there is no server needed  the application constantly links to the inherent databases  which contains information on rooms  pois  which are combined with fingerprints and their connectivity  the application itself makes use of the wi-fi receiver of the smartphone  which is processed by a wi-fi extended library  also in the java environment  the client  the graphical user interface  the gui  finds itself at the top of the architecture  as it can request the information from the application  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 65 the functional design allows seeing what the user can do with the application  based on the documents of the ogc  2008a and 2008b  and the visualization described in the chapters 9-14  both the functional as the technical design is displayed in figure 18 ideally  only a database with directions and inherent information about the fingerprints themselves are necessary  the fingerprints directly link to the locational information  and the route information  the functional design is explained as follows  in the figure  in red denotes actions to be taken for the technical properties of the prototype   1 the user has to make sure wi-fi is enabled  in the case the inherited databases are placed on a server  the user has to make sure a 3g or wi-fi connection is enabled  so that the databases can be downloaded  3g is necessary if the user can not establish a wi-fi data connection  2 the route preferences have to be stated via the user profile  by default  this has been set to a normal pedestrian  with a guest status  this implies that certain areas are restricted  unless stated otherwise  the user can change this by clicking the settings button  3 the user can then define the departure  the current location is being displayed  which helps the user orientate  the user have to define the departure location by typing  selecting  a predefined location  4 the user has then to define the destination  the same categories are possible as for the origin  as assumed before  the user does not have knowledge about the indoor positioning  nor the addresses  other than room numbers   which makes it impossible to pinpoint an exact location  as the application also does not use maps  it is not possible to pinpoint it on a map  5 optionally  a via-point can be inserted  the same categories as the destination can be chosen  with the addition that it can be set as an inclusion  or exclusion  in the case of an inclusion  the route given will prompt the user to navigate to this first set point  in the case of exclusion  the route will take into account it is not desirable to pass this point at all  an example is the exclusion of a certain segment  which is now restricted due to refurbishments  6 now  the user can plan the route  by touching the plan button  7 a list of directives will be provided  each direction has information about what is visible at that point  so the user can see himself whether he is at the right position or not  in addition  it will be visible if the users location matches the predicted fingerprint  8 in a possible extended application  the user is capable to modify the presentation  which contains the text display  speech engine and most importantly  a confirmation setting  this can be done by reserving a section on the screen which shows a green approval or red disapproval sign or something similar  alternatively  this can be spoken as well  in addition  a graph can be displayed  but this depends on whether a graph will be included of the building  for now  the focus is on text directives  the map can be used  for instance  to display the entire route  at this stage  it will be possible to still adjust the route preferences  as well as the inclusion and/or exclusion of certain areas  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 66 figure 18 functional and technical design of the application m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 67 conclusion part ii how can the creation of an application be possible  without using geometry ? the user would like to navigate from one source to destination  indoor  the user has points of recognition available  as the level of detail is higher than outdoor  the user can thus check whether a navigation application provides correct information  if the application makes use of the surroundings  as the focus is on utilizing fingerprints only  instead of using geometry  positioning and representation are provided a different context  fingerprints can be coupled to recognizable objects at that place  a real  x  y  z  positioning  as stated in the terminology  is then not necessary  as user is only interested if he is at the right place at that time  since there are no obvious addresses in the vicinity  with exception of numbered rooms  in addition  pedestrians have specific characteristics  and thus minute estimations are hard to tell  since a user might need more time to climb the stairs or to open a door  this implies that geometry is not required  as long as information about connecting fingerprints is preserved  as with the level of detail surrounding a user  a simple text list is considered sufficient  as long as it includes information about recognizable objects  however  a weakness is that there is no clear direction or orientation  left/right  possible  since there is no geometry  instead  neutral descriptions in combination with recognizable objects have to be provided  this assumes that the user constantly has to carefully watch the real environment because of the high detail  in the case graphs or floor plans are provided  one must consider the constraints and limitations of the small screen and processing speed  how can the use of the framework of open location service standards be implemented in the indoor navigation application ? each component of the location services can be used in the technical design  the most important feature is the gateway service  where the users location as picked up by the wi-fi receiver  has to be compared to the fingerprints database  the user itself can define the constraints and preferences  which determines the route handling  upon entering information on origin or current location  destination and the inclusion or exclusion of via points  information can be transformed via the directory and geocoding services  this information can be further processed  with the navigation service  however  since the aim of this thesis is not to use geometry at all  large parts of the parameters of the openls standards can not be implemented  therefore  only the framework will be used instead of the parameters  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 68 part iii  implementation results contents 15 surveying and databases 16 location determination algorithms 17 layout and results in this third part  the final output is being discussed  first  the methodology of surveying as well as the creation of the database is discussed in chapter 15 two different location determination algorithms based on fingerprinting are then assessed in chapter 16 finally  in chapter 17  the test results on location determination and navigation will be discussed  in the end  it is possible to answer the question  how can wi-fi fingerprinting determine a location which does not utilize geometric features  and how can it be implemented in an application as such ? the conclusion is directly provided in part iv  as it further discusses the results related to it  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 69 15 surveying and databases android applications are composed by using at least two languages  extensible markup language  xml  for the layout and interface  and java for the functionality  on top of the java  a separate android library is installed  resulting in an adapted version of java to android  additional libraries  such as an extended wi-fi library  can also be attached  this application is no difference  and also utilizes the same style  as programmed in eclipse  figure 19   first  the interface was designed in xml  screenshots are made via the emulator  which does not support wi-fi detection however  only the real device does so   the xml files can be portrayed at the client side of the application  with the server side being the inherited chain of java files and databases  as there is no remote server for this prototype  figure 19 screenshot of the eclipse environment chapter 15.1 first discusses the methodology of surveying and chapter 15.2 continues with the database implementation  15.1 site survey preparation 15.1.1 measure points the surveyed locations are parts of the ground  first and second floor of the otb building at delft university of technology  in particularly  the otb building wings 2 and 3  as wing 1 is reserved for another department of the university  as the office spaces in these wings can be locked  these are the only restricted areas in the test bed  in wing 3  at the ground  first and second floor  twelve points on each floor has been assigned a fingerprint  to ensure the fingerprints can be compared with each other regarding signal strengths  which allows a proper snapping  if the fingerprints would be too similar to each other  distinguishing the locations would be very hard  see also 16.2.3   differences are obtained because of receiving direct and indirect signals due time  which are being caused by multipath effects  the points were measured in the aisles of the wings  at specific places  such as in front of the elevator  near the toilets  and on junctions of connecting office rooms  figure m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 70 20 shows a photo of the location ; figure 22 displays the graphical representation of the measured points  figure 20 photo of wing 2 and wing 3 of the otb building 15.1.2 measuring and determining suitable fingerprints an asus k72j laptop  equipped with an atheros ar9285 wireless network adapter  has been used to register the signal strength in the first test runs  signal strengths are expressed in a negative value of signal loss and noted with the unit dbm  the signal strengths were measured with the inssider 2.0 software  which could be downloaded at http  //www.metageek.net/products/inssider/  inssider 2.0 is able to register all received signal strengths  at a given interval  along with their unique mac address  the uniqueness is necessary to distinguish access points with the same ssid  as otherwise measuring using ssids will result in collated signal strengths  at each location  a scan has been carried out for ten seconds  registering at a 1 second interval  those locations were then tagged with location information  and merged into one file  in the second test runs  new measurements have been performed  but instead of using a separate device to measure the fingerprints  the same device as the application is being used  the smartphone instead of the laptop has been used to do so  this is further elaborated in chapter 16 the ten seconds scan  with a 1 second interval is necessary to determine stable  average signal strength  since the signal strengths can fluctuate in a short time  as displayed below in figure 21  for instance at fid=201  this has later been converted to fid=3201  to note the fingerprint is located in wing 3   from the first record  the signal strengths at this point changes between -43 dbm and -49 dbm  caused by the reception of both direct and indirect signals due multipath effects  it also detects the stability of access points  at a given location  if at least four out of ten are present  this can be considered as relatively stable  this will eliminate unstable access points  which are usually outlying routers  the information is first being stored in a sql database from microsoft access  in android  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 71 each database table can be stored in a separate xml file  using sql statements instead of database tables  this conversion has been done as shown in annex a.4  the next step is filtering the weak signals  it is possible that at a given location  a fingerprint consist of 30 mac-addresses  in which the majority are below a rssi of -80 dbm  it might be the case they will not appear in a scan at another given time  on the other hand  rssis higher than -70 dbm are most likely to be constantly present  even then  it is possible that at a measured location the signal strength always remains relatively weak  for example  always lower than -70 dbm   in this process  it has been chosen that the 10 strongest signals picked up  will determine the position  or to be more precise  the fingerprint  an unedited example is provided in figure 21  ordered by location  then by average rssi from highest to lowest  as can be seen  there are duplicate ssids  but there are different macs  also the number of detected signals within ten seconds changes  do note that the location naming  fid  were preliminary in this figure  the final fids have been assigned as visible in figure 22  full graph  and figure 23  part of the graph on top of a photo   figure 21 screenshot of reconfigured rssi scan in this figure  temporarily constructed location and fid tags have been generated  the values rssi1-rssi10 represents measurements within ten seconds  where the number of rssi depicts the second  as displayed in the figure 21  within ten seconds  using an interval of one second  rssis from several routers  mac+ssid  at specific locations  location/fid  are measured and recorded  these results in a maximum of ten values  rssi1-rssi10   from these values an average can be calculated  rssi_avg   m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 72 figure 22 graphical representation of indoor model  graph  with correct orientation m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 73 figure 23 graph layer on photo 15.1.3 fingerprinting methodology used in this project because the wi-fi signal carrier is not consistent itself  it is hard to identify a location without a fixed signal strength  signal strengths vary over time  caused by multipath  and these signal strengths themselves are not consistent on top of that  however  by averaging the signal strength values  and by creating a search space  a range  around this average  it is still possible to predict a location  this is the methodology being used in this project  this is illustrated in figure 24  a recorded fingerprint deviates in signal strengths when it is compared at a later time stamp  at the x-axis  the signal strengths are plotted for one fingerprint  other fingerprints are being measured simultaneously  which can be plotted at the z-axis in the figure below  figure 24 time aspect of fingerprinting m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 74 at time stamp 1  at a specific location  a certain amount of signal strength is being received  which has been obtained directly  at time stamp 2  at the same location  the amount has been changed  because it received the signal strength delayed because of the multipath effect  for example  in figure 25/table 6  at location 3210  there is a given signal from mac 00:1a  a2  fa:0e  b0 of -72 dbm at time stamp t1  which is received directly  at time stamp t3  it received a delayed signal strength caused by multipath of -78 dbm  after a while  it receives another value of -74 dbm at t7  to counter these differences  an average has been taken based on 10 time stamps  mac ssid fid avg t1 t2 t3 t4 t5 t6 t7 t8 t9 t10 00:1a  a2  fa:0e  b0 eduroam 3210 -75,2 -72 -72 -78 -78 -78 -78 -74 -74 -74 -74 table 6 temporal aspect of fingerprinting  table view  figure 25 temporal aspect of fingerprinting  bar chart  for given location fid=3210 values in both figure 25/table 6 are in dbm  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 75 15.2 databases and information storage 15.2.1 generalities in this prototype  the database is stored in the application  as android allows doing so with sqlite  android developers  2011   if a large scale service deployment could be realized  a large database can ideally be stored on a server  in which the user needs a connection to obtain information  since the database of the prototype is rather small  it is not necessary to work with a remote server  this results in a standalone mobile application  originally  several database tables have been proposed  which included information about location  fingerprints and general separated   connectivity  location related information  points of interests and room-specific information   and personal information  however  personal information is heavily restricted due to privacy and legal issues  in combination with locational information  in the final prototype  the personal information has thus been left out  this issue is further discussed in chapter 18 moreover  the table_poi has been merged with the table_rooms  as ideally  pois have to be assigned with the same location fids  this decreases probabilities in data redundancy as well  another prototype restriction is the availability of selected buildings  in a large scale service deployment  the user is able to browse through various buildings  at given addresses and places  since the prototype only contains one building  the option to search for locations in other buildings than the otb has been disabled  more discussion is to be found in chapter 19  limitations  in figure 26  an overview of these relations and database tables can be seen  along with their data type written in capitals  the database fields are further explained in annex a.3  with the exception of the table for persons  since that has been omitted  see chapter 20 on discussion on privacy issues   table_mac has become an independent table  and only shows the mac address along with their rssi  at given locations  which is joined by the original location table  figure 26 database relations m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 76 the most important fields include the location id from the table_location  which is used in any other table  this coincides with the fingerprint  as the fingerprint is the node itself  the table_location states the address  location  and type of location  whether this is an exit  a room or stairs as such   the table_connectivity provides information on the connection between the fingerprints ; each link or edge has a unique id  the connection id  or the cid   and states whether it traverses over objects  as well as which objects are to the left or to the right  in the overview above  the fields which are underlined are truly used in the prototype  this effectively means that any double field in other database tables can be removed  decreasing the data redundancy  15.2.2 the database in the application the database has been inserted as sql statements in separate xml files  as databases in android can be configured as such  in box 3 below  an example of a xml file is shown  < sql > < statement > create table if not exists table_rooms  rid integer primary key  fid integer  room_name varchar  50   wing integer  floor integer  building varchar  50   department varchar  50   office varchar  50   room_type varchar  50   restricted boolean   < /statement > < statement > insert into table_rooms values  2002,2008  'survey room',2,0  'otb '  ''  'room '  'computer room',1  ; < /statement > < statement > insert into table_rooms values  2004,2008  'grote vergaderzaal',2,0  'otb '  ''  'room '  'commission',1  ; < /statement > < statement > insert into table_rooms values  2006,2009  'anneke van cootenzaal',2,0  'otb '  ''  'room '  'commission',1  ; < /statement > < statement > insert into table_rooms values  2007,2010  '0.070  secretary  ',2,0  'otb '  ''  'work office '  'office',1  ; < /statement > box 3 example of sql statements in xml  creation and population of database table as such  an xml document can be filled with statements  in which those statements can be read in the java file again  other examples are included in the annex a.4  the database can be read with the use of a java class databasehelper.java which utilizes the xml/sql statements  it is up to the programmer to define which fields can be used for which purpose  the fields that the user gets to see  are the room names  and the object information  which is stored in the table_connectivity  object_left and object_right  and table_location  loc_prop   the room name is coupled with a room id  rid   which is combined with a specific location  fid   the user gets to see a reverse geocoded specific location  a specific fingerprint  mac+rssi from the table_mac   can be found  which is then looked up in the database table  which room and location belongs to that fingerprint  in box 4 below the database is called from the databasehelper.java file  in this file  the parsexmlfile  r.raw.roomsdata  db  ; states that the xml file  which contains sql statements  roomsdata is to be used as a database  this coincides with the contents of the table_rooms as shown in box 3 the statement nodelist statements = doc.getelementsbytagname  `` statement ''  ; explicitly tells that the sql statements can be found in the xml document  which has the tags < statement > m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 77 public class databasehelper extends sqliteopenhelper  public static final string database_name = `` rooms '' ; protected context context ; public databasehelper  context context   super  context  database_name  null  1  ; this.context = context ;  @ override public void oncreate  sqlitedatabase db   parsexmlfile  r.raw.roomsdata  db  ; parsexmlfile  r.raw.connectiondata  db  ; parsexmlfile  r.raw.macdata  db  ; parsexmlfile  r.raw.poidata  db  ; parsexmlfile  r.raw.locationdata  db  ;  private void parsexmlfile  int id  sqlitedatabase db   string s ; log.i  `` dbhelper ''  `` executing sql statements ''  ; try  // toast.maketext  context  `` 1 ''  2000  .show   ; inputstream in = context.getresources   .openrawresource  id  ; documentbuilder builder = documentbuilderfactory.newinstance   .newdocumentbuilder   ; document doc = builder.parse  in  null  ; nodelist statements = doc.getelementsbytagname  `` statement ''  ; for  int i=0 ; i < statements.getlength   ; i++   s = statements.item  i  .getchildnodes   .item  0  .getnodevalue   ; db.execsql  s  ;   catch  throwable t   toast.maketext  context  t.tostring    50000  .show   ; log.e  `` dbhelper ''  t.getmessage    ;   @ override public void onupgrade  sqlitedatabase db  int oldversion  int newversion   db.execsql  `` drop table if exists table_rooms ''  ; oncreate  db  ;   box 4 snippet overview of databasehelper.java  getting the contents from database tables from xml files the database can be further used for input for the client  in the main screen  the user can select and enter rooms and locations from the table_rooms to calculate a route  the mainscreen.java is shown in box 5 the setcontentview  r.layout.main  ; refers to the fact that the main.xml document has to be used as layout  then  there are two fields which need to be connected to the database  in where the client has to provide information on where the client wants to go  and what the clients departure place is  this can be done by using an autocompletetextview  which is an extension of android  where the user have to type something  which will be automatically completed by a list  so that the user can select an item from the list  this is being recalled with  autocompletetextview dep1 =  autocompletetextview  findviewbyid  r.id.inputdeparture  ; roomlist roomlist = new roomlist  this  ; arraylist < string > items1 = roomlist.getallrooms   ; m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 78 however  it must explicitly state which fields are required to display  then  a separate java file needs to be written  which is shown in box 6 box 5 snippet overview of mainscreen.java  creation of entry fields and actions upon tapping buttons m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 79 public class roomlist  protected sqlitedatabase db ; protected cursor cursor ; public roomlist  context c   log.i  `` roomlist ''  `` creating db ''  ; db =  new databasehelper  c  .getwritabledatabase    ;  public arraylist < string > getallrooms    // log.i  `` roomlist ''  `` query execute ''  ; cursor cursor = db.rawquery  `` select rid  room_name from table_rooms ''  null  ; arraylist < string > rooms = new arraylist < string >   ; // log.i  `` roomlist ''  cursor.getcount   + '' amount found ''  ; if  cursor.getcount   > = 1   while  cursor.movetonext     rooms.add  cursor.getstring  1   ;   cursor.close   ; return rooms ;   box 6 snippet overview of roomlist.java  populating an entry field with a directory service a query must be formed first  in order to populate the autocompletetextview fields  first this field  an array list  must be formed  which is done by public arraylist < string > getallrooms    next the query will be summoned and filled in the array list  with  cursor cursor = db.rawquery  `` select rid  room_name from table_rooms ''  null  ; arraylist < string > rooms = new arraylist < string >   ; then this step will be repeated for the entire database table  which is done by  if  cursor.getcount   > = 1   while  cursor.movetonext     rooms.add  cursor.getstring  1   ;   cursor.close   ; return rooms ; this way  the autocompletetextview fields are fully populated  both departure and destination can use the same array list  a message will be briefly shown  how many rooms are added  toast.maketext  this  `` amount of rooms loaded  `` + items1.size    toast.length_short  .show   ; m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 80 however  upon confirming the fields  one must be certain that there are no empty fields  or that the same records are being used for departure as destination  as soon as the client clicked on the button to calculate a route  this is solved with  public void onclick  view v   if  v.getid   == r.id.buttonnavigationstart   textview inputdeparture =  textview  findviewbyid  r.id.inputdeparture  ; textview inputdestination =  textview  findviewbyid  r.id.inputdestination  ; if  inputdeparture.gettext   .length   == 0   toast.maketext  this  `` please input departure ''  toast.length_short  .show   ; return ;  else if  inputdestination.gettext   .length   == 0   toast.maketext  this  `` please input destination ''  toast.length_short  .show   ; return ;  else if  inputdeparture == inputdestination   toast.maketext  this  `` departure and destination is the same ''  toast.length_short  .show   ; return ;  if  false    intent n = new intent  this  navigation.class  ; startactivity  n  ;  else if  v.getid   == r.id.buttonsettings   intent s = new intent  this  settings.class  ; startactivity  s  ; as the following java codes checks if the field is empty  if  inputdeparture.gettext   .length   == 0   toast.maketext  this  `` please input departure ''  toast.length_short  .show   ; return ; in this prototype  the decision has been made not to combine the current location with an input field for origin point  to allow the user to calculate a route in advance  without being on the present spot  this might be useful if the user would like to prepare his route  rather than finding out on the fly  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 81 16 location determination algorithms the prototype resembles three major functionalities  1 the determination of a location ; 2 routing between pre-determined locations or current location with destination ; 3 route confirmation during the navigation  the routing itself is pre-determined in the sense that the user is able to type and select specific locations  but the application only accepts predefined locations  this is comparable with planning railway journeys  where there are only a limited number of stations to travel between  the user can only use a railway station from a database  in the prototype  the user can only select rooms or pois and the user does not necessarily need the sensor to calculate a route  this can be useful if the user is planning ahead  the route confirmation information is then not usable  from here  it is desirable to combine two major functionalities in a fourth aim  4 to navigate between locations  where the current location is constantly adapted to the users situation  as the user sees the current location constantly at the top half of the screen  section 16.1 describes which types of location determination is being used in this thesis  section 16.2 continues with the translation of the obtained locations  while section 16.3 continues with how the previous sections were programmed  finally  section 16.4 deals with the aspect of navigation and route confirmation  16.1 two methods of location determination being used in this thesis method 1  count method with search space one possible method to determine the location  is by picking up the signal strengths in negative dbm per mac address  these values have to be compared to a recorded database  in which location information can be returned  this results in the following algorithm  1 pick up signal strength on the fly  within 1 second   2 snap signals within a range of n dbm  3 compare the live received signal strengths with the signal strengths ranges in the database  which is a range query   count the number of matches per fid  4 return the location id of the highest match  based on the location id  return additional information from other tables as well  5 if there are multiple matches  take both  6 to prepare and speed up the prediction of the next location  eliminate outlying locations  see also chapter 14.3   the databases that will be used are displayed below  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 82 first  the existing databases on signal strengths  fid 3001 3001 3001 3001 3001 3001 3001 3001 3001 3001 mac 00:1a  a2  c0:0e:85 00:1a  a2  c0:0e:82 00:1a  a2  fa:0f  a0 00:1a  a2  fa:0f  a2 00:1a  a2  fa:0f  a4 00:1a  a2  fa:0f  a5 00:1a  a2  fa:39:90 00:1a  a2  fa:39:92 00:1a  a2  fa:39:94 00:1a  a2  fa:39:95 rssi -74 -75 -59 -60 -60 -59 -41 -49 -49 -48 fid 3002 3002 3002 3002 3002 3002 3002 3002 3002 3002 mac 00:1a  a2  fa:0f  a0 00:1a  a2  fa:0f  a2 00:1a  a2  fa:0f  a4 00:1a  a2  fa:0f  a5 00:1a  a2  fa:25:40 00:1a  a2  fa:25:45 00:1a  a2  fa:39:90 00:1a  a2  fa:39:92 00:1a  a2  fa:39:94 00:1a  a2  fa:39:95 rssi -63 -62 -64 -64 -72 -72 -42 -43 -43 -43 table 7 sample database on signal strengths on two different locations the following information is available about the location itself  the table has been truncated in comparison to the actual table for this purpose   fid 3001 3002 building address otb jaffalaan 9 otb jaffalaan 9 place delft delft floor 0 0 wing 3 3 access 0 0 locprop_01 emergency exit showers table 8 sample database on location information the following information is available about the rooms  the table has been truncated in comparison to the actual table for this purpose   rid fid room_name 3001 3001 room 0.010  pieter groetelaerszaal  3002 3001 room 0.020 3003 3001 room 0.030  shower  3004 3002 room 0.040 3005 3002 room 0.050  shower  3006 3002 room 0.060 wing floor office 3 0 commission room 3 0 work office 3 0 shower 3 0 work office 3 0 shower 3 0 work office room_type restricted room 1 office shower office shower office 1 0 1 0 1 table 9 sample database on room information note that one node  fid  contains several navigable spaces  rid   as the level of detail allows this  if it is desirable to make the rooms separate navigable as well  for instance  two specific points of interests are located inside a room   then separate fingerprints and thus nodes will need to be added to the database  now  step by step the algorithm will be explained  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 83 step 1  pick up signal strength during the receiving phase  the following signals are retrieved  as displayed in table 10  mac 00:1a  a2  c0:0e:85 00:1a  a2  c0:0e:82 00:1a  a2  fa:0f  a0 00:1a  a2  fa:0f  a2 00:1a  a2  fa:0f  a4 00:1a  a2  fa:0f  a5 00:1a  a2  fa:25:40 00:1a  a2  fa:25:45 00:1a  a2  fa:39:90 00:1a  a2  fa:39:92 00:1a  a2  fa:39:94 00:1a  a2  fa:39:95 rssi -78 -78 -61 -61 -61 -61 -75 -75 -43 -50 -50 -49 table 10 example of received signal strengths step 2  create range for the signal strength with n dbm after filtering the weak and unstable rssis  an average rssi can be calculated  however  since the rssis fluctuate over time and space  a snapping tolerance is necessary to determine a position  therefore  a standard deviation has been calculated over all measurements  which was an average of 2.5 dbm  without filtering  this was 2.4 dbm   as a result  a rounding off to 3.0 dbm has been accepted as the snapping tolerance  to make sure at least a signal was being recognized  an additional 1.0 dbm has been added  resulting in a 4 dbm search space margin  if the received signal strength in the online phase is within a range of 4 dbm  then the measured signal matches the location recorded signal  this is illustrated in figure 27 figure 27 matching live fingerprints with recorded fingerprints using snapping tolerances the values in this figure are purely indicative and do not represent actual values  nor snapping values m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 84 from the received signal strengths  n dbm has to be added and subtracted to get a range  for example  if a snapping value of 3 dbm has been used  the result is the following table 11  mac 00:1a  a2  c0:0e:85 00:1a  a2  c0:0e:82 00:1a  a2  fa:0f  a0 00:1a  a2  fa:0f  a2 00:1a  a2  fa:0f  a4 00:1a  a2  fa:0f  a5 00:1a  a2  fa:25:40 00:1a  a2  fa:25:45 00:1a  a2  fa:39:90 00:1a  a2  fa:39:92 00:1a  a2  fa:39:94 00:1a  a2  fa:39:95 lower value -75 -75 -58 -58 -58 -58 -72 -72 -40 -47 -47 -46 upper value -81 -81 -64 -64 -64 -64 -78 -78 -46 -53 -53 -52 table 11 example of determination of range signal strengths step 3  comparison and matching the database this step exists of four sub steps  a from the existing database table_mac  compare if the recorded value is within the range of received signal strengths table  b if this is being the case  accept the value  if this is not being the case  discard the value  c count the number of matches per fingerprint fid ; accept the fid from the recorded database  d if multiple ids were matching  then probably the user finds itself at a location between two recorded places  both ids can be returned  if no fids were matching  the statement location not found can be returned  first  the received signal strengths are now being compared with the recorded signal strengths and the signals are being rejected or accepted  step a and b  table 12   mac received 00:1a  a2  c0:0e:85 -78 00:1a  a2  c0:0e:82 -78 00:1a  a2  fa:0f  a0 -61 00:1a  a2  fa:0f  a2 -61 00:1a  a2  fa:0f  a4 -61 00:1a  a2  fa:0f  a5 -61 00:1a  a2  fa:25:40 -75 00:1a  a2  fa:25:45 -75 00:1a  a2  fa:39:90 -43 00:1a  a2  fa:39:92 -50 00:1a  a2  fa:39:94 -50 00:1a  a2  fa:39:95 -49 lower -75 -75 -58 -58 -58 -58 -72 -72 -40 -47 -47 -46 upper fid=3001 accepted fid=3002 accepted -81 -74 no -81 -75 yes -64 -59 yes -63 yes -64 -60 yes -62 yes -64 -60 yes -64 yes -64 -59 yes -64 yes -78 -72 yes -78 -72 yes -46 -41 yes -42 yes -53 -49 yes -43 no -53 -49 yes -43 no -52 -48 yes -43 no table 12 example of comparing recorded and received signal strengths m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 85 then  the number of matches needs to be counted  the result is 9 and 7 out of 10  respectively  step c and d   fid=3001 is being accepted as the location  fid=3002 is being rejected  the user finds itself near fid=3001  step 4  returning the information the user has no information to extract from solely fid=3001  as soon as the matching took place  information has to be returned  if the user is located near fid=3001  information from table 8 and table 9 can be returned  such as  you are near the emergency exit  or you are near room 0.010  room 0.020 and room 0.030  at wing 3  floor 0 the location information can also be used to monitor the actual location and from there recalculate a route  if necessary  the procedure steps 1-4 have been visualized in a flow scheme  as visible in figure 28 figure 29 shows a visualization of the process upon walking from one end to another  as the number of matches are being counted  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 86 figure 28 flow scheme of location determination for count method with search space figure 29 is purely illustrative  it is not to scale and not linear  and simulates how the detection and counting of correct fingerprints should take place upon walking around  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 87 figure 29 visual representation of count method upon walking around  desirable simulation  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 88 method 2  least sum of square method for location determination it is also possible to make use of a least sum of square  ss  method as proposed by shum et al   2011   instead of counting the number of matches  the differences between the actual and surveyed are being used  similar to taking a physical distance into account  the lower the ss value  the most likely it is the user finds itself at the predicted location  an example has been showed in table 13 below to the far right the outcome of the ss method can be seen  fid 3001 3001 3001 3001 3001 3001 3001 3001 3001 3001 3002 3002 3002 3002 3002 3002 3002 3002 3002 3002 3003 3003 3003 3003 3003 3003 3003 3003 3003 3003 3004 3004 3004 3004 3004 3004 3004 3004 3004 3004 mac 00:1a  a2  c0:0e:82 00:1a  a2  c0:0e:85 00:1a  a2  fa:0f  a0 00:1a  a2  fa:0f  a2 00:1a  a2  fa:0f  a4 00:1a  a2  fa:0f  a5 00:1a  a2  fa:39:90 00:1a  a2  fa:39:92 00:1a  a2  fa:39:94 00:1a  a2  fa:39:95 00:1a  a2  fa:0f  a0 00:1a  a2  fa:0f  a2 00:1a  a2  fa:0f  a4 00:1a  a2  fa:0f  a5 00:1a  a2  fa:25:40 00:1a  a2  fa:25:45 00:1a  a2  fa:39:90 00:1a  a2  fa:39:92 00:1a  a2  fa:39:94 00:1a  a2  fa:39:95 00:1a  a2  fa:0f  a0 00:1a  a2  fa:0f  a2 00:1a  a2  fa:0f  a4 00:1a  a2  fa:0f  a5 00:1a  a2  fa:25:42 00:1a  a2  fa:25:44 00:1a  a2  fa:39:90 00:1a  a2  fa:39:92 00:1a  a2  fa:39:94 00:1a  a2  fa:39:95 00:1a  a2  fa:0f  a0 00:1a  a2  fa:0f  a4 00:1a  a2  fa:0f  a5 00:1a  a2  fa:25:40 00:1a  a2  fa:25:42 00:1a  a2  fa:25:44 00:1a  a2  fa:25:45 00:1a  a2  fa:39:90 00:1a  a2  fa:39:92 00:1a  a2  fa:39:95 rssi o m -75 -78 -74 -78 -59 -63 -60 -62 -60 -62 -59 -63 -41 -45 -49 -45 -49 -46 -48 -47 -63 -63 -62 -62 -64 -62 -64 -63 -72 -77 -72 -75 -42 -45 -43 -45 -43 -46 -43 -47 -61 -63 -60 -62 -61 -62 -61 -63 -63 -62 -62 -62 -62 -45 -62 -45 -61 -46 -61 -47 -64 -63 -63 -62 -64 -63 -59 -77 -57 -62 -59 -62 -59 -75 -64 -45 -64 -45 -64 -47 l -78 -77 -62 -63 -63 -62 -44 -52 -52 -51 -66 -65 -67 -67 -75 -75 -45 -46 -46 -46 -64 -63 -64 -64 -66 -65 -65 -65 -64 -64 -67 -66 -67 -62 -60 -62 -62 -67 -67 -67 range 3 h -72 -71 -56 -57 -57 -56 -38 -46 -46 -45 -60 -59 -61 -61 -69 -69 -39 -40 -40 -40 -58 -57 -58 -58 -60 -59 -59 -59 -58 -58 -61 -60 -61 -56 -54 -56 -56 -61 -61 -61 1 1 0 0 1 1 0 0 0 1 1 1 1 1 1 0 1 1 1 1 0 1 1 1 1 1 1 0 0 0 0 1 1 1 0 0 1 0 0 0 0 l -80 -79 -64 -65 -65 -64 -46 -54 -54 -53 -68 -67 -69 -69 -77 -77 -47 -48 -48 -48 -66 -65 -66 -66 -68 -67 -67 -67 -66 -66 -69 -68 -69 -64 -62 -64 -64 -69 -69 -69 range 5 h -73 -72 -57 -58 -58 -57 -39 -47 -47 -46 -61 -60 -62 -62 -70 -70 -40 -41 -41 -41 -59 -58 -59 -59 -61 -60 -60 -60 -59 -59 -62 -61 -62 -57 -55 -57 -57 -59 -59 -59 1 1 1 1 1 1 1 1 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 1 1 1 0 1 1 0 0 0 0 range 10 l h -85 -65 -84 -64 -69 -49 -70 -50 -70 -50 -69 -49 -51 -31 -59 -39 -59 -39 -58 -38 -73 -53 -72 -52 -74 -54 -74 -54 -82 -62 -82 -62 -52 -32 -53 -33 -53 -33 -53 -33 -71 -51 -70 -50 -71 -51 -71 -51 -73 -53 -72 -52 -72 -52 -72 -52 -71 -51 -71 -51 -74 -54 -73 -53 -74 -54 -69 -49 -67 -47 -69 -49 -69 -49 -74 -54 -74 -54 -74 -54 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 1 1 1 0 1 1 0 0 0 0 dif 3 4 4 2 2 4 4 -4 -3 -1 0 0 -2 -1 5 3 3 2 3 4 2 2 1 2 -1 0 -17 -17 -15 -14 -1 -1 -1 18 5 3 16 -19 -19 -17 ss method dif ss 9 107 16 16 4 4 16 16 16 9 1 0 77 0 4 1 25 9 9 4 9 16 4 1013 4 1 4 1 0 289 289 225 196 1 1628 1 1 324 25 9 256 361 361 289 table 13 localization methods  count method versus sum of squares method o = original  observed surveyed value  m = measured value  l = low  o-range value   h = high  o+range value   1 = true  0 2 = false  dif = m-o  ss = dif  values are in dbm  fid 3001 3002 3003 3004 range 3 5 8 6 4 number of trues range 5 range 10 8 10 10 10 6 6 5 5 table 14 outcome of counts and sum of squares ss ss 107 77 1013 1628 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 89 at a specific location  a certain amount of signal strength is received from the various routers  m   these are being compared with the original  surveyed signal strengths  o   in the count method  first a range of search space is being created  the larger the search space is  the more matches can be found  which leads to possible duplicate locations  in this example  if a range of 10 dbm would be used  one can not tell anymore if the person finds itself at location fid=3001 or fid=3002  as can be seen in table 14 count method and least ss method compared in the least sum of squares method  large differences are contributing significantly to the elimination of unlikely locations  since they add up to the total value due to their large value  for a lower ranging value  there is no clear preference in which method can be used  however  for larger ranges  it appears that the least sum of square methods prevails  since it is capable of distinguishing locations  in the event of equal true counts  in this project  the ss method has been chosen to ensure a certain degree of certainty  two major weaknesses can be noted  however  a first weakness of both methods is that it requires all identifiable nodes to have an equal amount of access points  as both the count method as the sum of squares method would be disproportional to each other  in this project for example  each fingerprint must contain 10 mac addresses  if there are only 4 mac addresses in one fingerprint  the maximum matching value would be 4  in which this can be easily overpassed  this requires smart router placing to counter  one example includes the use of threshold and ratio counting  if  for instance  from 6 detectable routers  4 routers are within range  then a score of 3 out of 6  50,0 %  would seem to be worse than 3 out of 5  60,0 %   despite there were more routers detectable  a second weakness is the sensitivity of fingerprints with bad reception  if  for instance  recorded signal strengths at a certain fingerprint are bad  by default  the difference to the weakest assumed detectable signal strength  -100 dbm  is only 10 dbm  in table 15  this is being shown  the algorithm will detect the user then at fid=3001  because of the lower ss value  although in reality  the user may find itself somewhere else  rssi fid 3001 3001 3001 3001 3001 3001 3001 3001 3001 3001 3002 3002 3002 3002 3002 3002 3002 3002 3002 3002 mac 00:1a  a2  c0:0e:82 00:1a  a2  c0:0e:85 00:1a  a2  fa:0f  a0 00:1a  a2  fa:0f  a2 00:1a  a2  fa:0f  a4 00:1a  a2  fa:0f  a5 00:1a  a2  fa:39:90 00:1a  a2  fa:39:92 00:1a  a2  fa:39:94 00:1a  a2  fa:39:95 00:1a  a2  fa:0f  a0 00:1a  a2  fa:0f  a2 00:1a  a2  fa:0f  a4 00:1a  a2  fa:0f  a5 00:1a  a2  fa:25:40 00:1a  a2  fa:25:45 00:1a  a2  fa:39:90 00:1a  a2  fa:39:92 00:1a  a2  fa:39:94 00:1a  a2  fa:39:95 o -75 -74 -59 -60 -60 -59 -41 -49 -49 -48 -63 -62 -64 -64 -72 -72 -42 -43 -43 -43 m -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 dif -25 -26 -41 -40 -40 -41 -59 -51 -51 -52 -37 -38 -36 -36 -28 -28 -58 -57 -57 -57 table 15 scenario for bad reception for ss method ss method dif ss 625 19250 676 1681 1600 1600 1681 3481 2601 2601 2704 1369 20084 1444 1296 1296 784 78 3364 3249 3249 3249 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 90 alternatively  if from a specific mac no signal can be detected at all  it is possible to assign a blank value  but that would result in least sum of squares based on unequal amounts of macs  this effectively means that unless it can be guaranteed all macs per location are within reach  a fifth step  sub selecting it is therefore an additional step can then be followed  which deals with the prediction of future locations  it is implied that users do not appreciate false location information  providing false location information when using fingerprinting is most likely to occur when unstable signal strengths are being received  for instance  a user might be prompted to be located at a floor lower or higher than he or she is  or that the device places the user at the end of the hallway  while the user has not reached that location yet  there are possible ways to cater these  by doing the following  include only fingerprints of the locations along the determined route  o the application can be programmed in such way  only location determination can take place using the nodes  fingerprints  along the calculated route  for example  for the route 2004-2003-2002-2007-2009-2011-2012  the programme only needs to check the access points coupled to these fingerprints  in the figure 30 below  from origin to destination  the user receives a list of direction for a route  this route does not contain any signal strengths from routers b and d  so they should be eliminated  however  this leads to solely filtering of routers  in the event that a locations fingerprint contains signal strengths from distant routers  the signal strengths from the excluded router will never be picked up  decreasing the probability in a correct location  figure 30 exclusion of access points to narrow down search space m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 91 exclude fingerprints and location information that are beyond the users current location  o if the fingerprints are named in such way it is recognizable which fingerprint belongs to which section or floor  it is possible to remove any access points for an area  for example  upon surveying  it has been predetermined nodes are numbered in the convention < 1-digit wing > < 1-digit floor > < 2-digit location >  for the route 2004-2003-2002-2007-2009-2011-2012 again  the nodes tells that these nodes are located in wing 2  at the ground floor  0   by excluding all location information below the numbers 2000 and higher than 2100  it can be certain the user will not be promptly allocated on a wrong floor  if  despite the above actions have been undertaken  complete different sets are obtained than predicted as derived from the calculated route  the application has to say the user is off route  in which re-calculation of the route is proposed  however  due to time restrictions and capability constraints  this fifth step has not been implemented in the prototype  it is therefore highly recommended that a further narrowing down of the location detection can take place  this includes one  or a combination of  the methods above described  16.2 geocoding and reverse geocoding when the signal strengths and fingerprints are determined  the device can look up the id of the fingerprint  which is coupled to both a general  navigable database  the table table_location   and a rooms database  table_rooms   the inverse occurs upon entering a room when a user selects a room  this room is being geocoded in a fingerprint id  which is being used to calculate a route  in this project  one room can only have one fingerprint id  whereas one fingerprint id can have multiple rooms  in the example of fingerprint id  node  3208  see also figure 22  page 72   rooms 2.150-2.180 all have this fingerprint  when a user would like to navigate from the entrance/exit to room 2.180  the following happens  the user selects entrance/exit as departure the user selects room 2.180 as destination the user presses start navigation the application looks up the fingerprint node for entrance/exit  2001 the application looks up the fingerprint node for room 2.180  3208 the application calculates the route between nodes 2001 and 3208 the application provides information which nodes are required to traverse upon going from node 2001 to 3208 the application recodes the node numbers to location information  such as reception and stairs  in the prototype  the fingerprint ids are displayed along with the to be selected room ; these can be left out in future developments  16.3 location determination and geocoding in java box ap  6 in the annex  a.5  contains some of the code of the location determination algorithm  first  the wi-fi needs to set up  which is done in lines 36-39 and lines 152-189 this allows the application to search for wi-fi signal strengths  along with their macs  or base ssids  second  the to be searched m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 92 macs have to be declared  which has been done in lines 42-43  in box ap  6  only two have been displayed ; one can add as many macs as desirable   third  the lines 47-50 creates the search space for which the received signal strength should match the recorded database  which is done in lines 209-214 the fourth step is to retrieve information from that looked up location  this can also be done via a database search  which is being carried out in lines 219-231 in fact  the query itself exists of three parts  a first part  which includes the selection of the mac addresses and locations  line 196  also displayed below in box 7   the middle part  in which the recorded signal strength is being compared with the lower and upper boundaries of the search space  and the closing part  which counts the matching nodes  lines 203-216   and groups it by node number  or fingerprint id  the fid  line 197   the query is being put together  and from this new query  the fid with the maximum matches has to be the designated location  lines 229-231 to be precise   finally  this has to be displayed on screen  but this has to be sent in a message  rather than independent parameters  which are carried out in lines 236-256 first the parameters are being looked up and packed as a message  then the message is being decoded into visible texts again  which is carried out in lines 102-147  189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 public void onruleachieved  ruleevent event   wifimanager wifimanager =  wifimanager  activity.getsystemservice  context.wifi_service  ; wifimanager.startscan   ; list < scanresult > ls = wifimanager.getscanresults   ; //a loop to customize the query according to the measured values string queryhead = `` select fid  count  *  from table_mac where `` ; string querytail = `` group by fid '' ; //vector < string > vquery = new vector < string >   ; int counter = 0 ; string querymid = `` '' ; if  ls.size   > 0   for  scanresult sr  ls   //prepare string mac = sr.bssid ; int ss = sr.level ; if  counter == 0   querymid = ``  mac = ' '' +mac+ '' ' and rssi_avg < `` +  ss+4  + '' and rssi_avg > `` +  ss-4  + ''  '' ; // first mac with upper and lower  else  querymid += `` or  mac = ' '' +mac+ '' ' and rssi_avg < '' +  ss+4  + '' and rssi_avg > `` +  ss-4  + ''  '' ; // subsequent mac with upper and lower  counter++ ;  //end of loop scan results string finalquery = queryhead + querymid + querytail ; // query buildup int max = 0 ; int selectedfid = 0 ; cursor cursor = db.rawquery  finalquery  null  ; if  cursor.getcount   > 0   while  cursor.movetonext     int fid = cursor.getint  0  ; int count = cursor.getint  1  ; if  count > max   max = count ; selectedfid = fid ;  //if some records are equal  top one is selected box 7 snippet overview of queries for searching for nodes within the search space m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 93 16.4 navigation algorithm the user is able to determine a route before traveling  a simple insertion of both departure and destination can be fulfilled without the sensor technique  similar to the classic route planners before gps was being utilized   a dijkstra route is being implemented in the application  to preserve the simplicity of general navigation  the dijkstra algorithm is being used to compute the shortest path between to nodes in an edge  the algorithm searches for the shortest path from one node to all connected nodes and eliminates the paths that are longer than the currently calculated value  the algorithm will stop until the destination has been reached  in which the shortest path can be displayed  vogel  2009  has developed a simplistic java code  in the sense that the dijkstra algorithm will be used inversely for the purpose of preserving overview in the codes  the codes from vogel  2009  are displayed in annex a.6  in order to let the algorithm work  another java code has to be written  in which all nodes and edges are being loaded  and from which the origin and destination nodes are being selected  this is visible in box 8 first  the nodes have to populate the vertex.java  this is being done with the database recall functions  visible in lines 12-35  the fid  the fingerprint ids  the navigable nodes  is thus being retrieved  the second step is to populate the edges for edge.java  which is being done in lines 37-66 ; in this case the near entire database table is being looked up  further processing to build the graph itself is being done in a separate class  in lines 96-105 the third step is using the information from the nodes and edges to the graph  graph.java   which can be seen in lines 70-93  a path is being calculated using the graph  which in turns makes use of the dijkstraalgorithm.java  line 72-75   regarding intelligence in route calculation  it is possible to add extra edges between distant nodes  if they nodes follow the same route  for instance  if on a straight line between node a and b  the nodes c  d  e and f are located  this would be normally a line between a-c  c-d  d-e  e-f and f-b  it is possible to add an extra node between a and b directly  with a slightly lower impedance value assigned to it  so that upon a continuous path  directly the direction a-b can be provided  however  as the aim is to check whether the user is on route or not  this might not be the most efficient way to do so  as there can be only false checks for the intermediate points  even though in reality the user traverses those points  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 94 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 public class routecalc  protected sqlitedatabase db ; protected cursor cursor ; private list < vertex > nodes ; private list < edge > edges ; public routecalc  context c   db =  new databasehelper  c  .getwritabledatabase    ;  public linkedlist < vertex > findroute  int fromnode  int tonode   nodes = new arraylist < vertex >   ; edges = new arraylist < edge >   ; arraylist < integer > nodesfids = new arraylist < integer >   ; cursor cursor = db.rawquery  `` select fid  locprop from table_location ''  null  ; // log.i  `` roomlist ''  cursor.getcount   + '' amount found ''  ; if  cursor.getcount   > = 1   while  cursor.movetonext     vertex location = new vertex  cursor.getint  0   cursor.getstring  1   null  ; nodes.add  location  ; nodesfids.add  cursor.getint  0   ; log.d  `` routecalc ''  cursor.getstring  0  + `` added  = '' + location.getroomname   + ``  ''  ;   cursor.close   ; cursor cursor2 = db .rawquery  '' select cid  fid_link_01  fid_link_02  length  direction  restricted  stairs  elevator  ramp  door  objects_left  objects_right from table_connectivity ''  null  ; // log.i  `` roomlist ''  cursor.getcount   + '' amount found ''  ; if  cursor2.getcount   > = 1   while  cursor2.movetonext     addlane  cursor2.getint  0   nodesfids.indexof  cursor2.getint  1    nodesfids.indexof  cursor2.getint  2    cursor2.getint  3   cursor2.getstring  4   cursor2.getstring  5   false  false  false  false  cursor2.getstring  10   cursor2.getstring  11   ; log.d  `` routecalc ''  `` connection `` + cursor2.getstring  0  + `` added  length = '' + cursor2.getint  3   ; log.i  `` routecalc ''  ``  from `` + cursor2.getint  1  + `` = '' + nodesfids.indexof  cursor2.getint  1   + `` to `` + cursor2.getint  2  + `` = '' + nodesfids.indexof  cursor2.getint  2    ;   else  log.e  `` routecalc ''  `` no connections ? ? ``  ;  cursor2.close   ; db.close   ; graph graph = new graph  nodes  edges  ; dijkstraalgorithm dijkstra = new dijkstraalgorithm  graph  ; dijkstra.execute  nodes.get  nodesfids.indexof  fromnode    ; linkedlist < vertex > path = dijkstra.getpath  nodes.get  nodesfids.indexof  tonode    ; log.e  `` routecalc ''  `` planning route from node m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 95 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 '' +fromnode+ '' = '' +nodesfids.indexof  fromnode   ; log.e  `` routecalc ''  `` planning route to node '' +tonode+ '' = '' +nodesfids.indexof  tonode   ; if  path.size   == 0   log.e  `` routecalc ''  `` no route found =  ``  ;  for  vertex vertex  path   final string tag = `` test '' ; log.v  tag  `` route  `` + vertex.getroomname    ; system.out.println  `` route  `` + vertex.getroomname    ;  return path ;  private void addlane  int cid  int fid_link_01  int fid_link_02  int length  string direction  string restriction  boolean stairs  boolean elevator  boolean ramp  boolean door  string object_left  string object_right   edge lane = new edge  cid  nodes.get  fid_link_01   nodes.get  fid_link_02   length  direction  restriction  stairs  elevator  ramp  door  object_left  object_right  ; edges.add  lane  ;   box 8 snippet overview of routecalc.java m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 96 17 layout and results now the database and location determination algorithms have been established  the application itself can be constructed regarding the interface  and upon completion  tests can be performed  chapter 17.1 deals with the design issues  finally  in chapter 17.2  investigations of the test runs are discussed  and chapter 17.3 provides provisory remarks  which are further to be discussed in part iv  17.1 layout configuration the interface consists of three screens  a screen where the user has to insert departure and destination via an autocompletetextview  a screen in which the user can set route preferences  such as walker or wheelchair user  or unrestricted access   and a screen with the display of the route in descriptions  the interface is designed in xml  as shown in box 9 for example for the main screen  the colour schemes are determined based on the literature recommendations as stated in chapter 12  in particularly  sub sections 12.4 and 12.5  as the application is a prototype  the user can only insert rooms or points of interests  poi  from the otb building in the first insertion screen  figure 31   if multiple building were available  another screen would be necessary to define this  the user can insert rooms by typing in a text field  which autocompletes the to be typed location  this shows the user directly what is available  and is applicable for all insert parameters  departure  destination  include via-point  exclude via-point   in the upper part of this same view  the user gets automatically to see to which room or poi he or she is located at  so he or she can use this to insert this for a departure parameter  figure 31 main screen  input and autocompletetextview in the codes below in box 9  by default  string texts as @ string/noinfo have been placed  as soon as a location from the gateway service has been provided  these strings will be replaced by this location information  caused by the java code  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 97 textview textfid =  textview  findviewbyid  r.id.currenttype  ; textfid.settext  `` near  `` + locprop + ``  node  `` + fid + ``  ''  ; in this example  a node number  fid  and a location property  locprop  will be provided to replace the string with no info  < ? xml version= '' 1.0 '' encoding= '' utf-8 '' ? > < linearlayout xmlns  android= '' http  //schemas.android.com/apk/res/android '' android  orientation= '' vertical '' android  layout_width= '' fill_parent '' android  layout_height= '' fill_parent '' android  background= '' # ffc000 '' > < textview android  layout_height= '' wrap_content '' android  layout_width= '' match_parent '' android  text= '' @ string/currentlocation '' android  textstyle= '' bold '' android  textcolor= '' # 0070c0 '' android  id= '' @ +id/currentlocation '' > < /textview > < tablelayout android  padding= '' 3dip '' android  layout_height= '' wrap_content '' android  layout_width= '' match_parent '' android  id= '' @ +id/tablelayout1 '' android  stretchcolumns= '' 1 '' > < tablerow android  id= '' @ +id/tablerow1 '' android  layout_width= '' wrap_content '' android  layout_height= '' wrap_content '' > < textview android  text= '' = '' @ string/noinfo `` android  layout_width= '' wrap_content '' android  textcolor= '' # 0070c0 '' android  layout_height= '' wrap_content '' android  id= '' @ +id/currentbuilding '' > < /textview > < textview android  layout_width= '' wrap_content '' android  layout_height= '' wrap_content '' android  textcolor= '' # 0070c0 '' android  text= '' = '' @ string/noinfo `` android  id= '' @ +id/currentaddress '' > < /textview > < /tablerow > < tablerow android  id= '' @ +id/tablerow2 '' android  layout_width= '' match_parent '' android  layout_height= '' wrap_content '' > < /tablerow > < tablerow android  id= '' @ +id/tablerow3 '' android  layout_width= '' match_parent '' android  layout_height= '' wrap_content '' > < textview android  text= '' @ string/noinfo '' android  layout_width= '' wrap_content '' android  textcolor= '' # 0070c0 '' android  layout_height= '' wrap_content '' android  id= '' @ +id/currentwing '' > < /textview > < textview android  text= '' @ string/noinfo '' android  layout_width= '' wrap_content '' android  textcolor= '' # 0070c0 '' android  layout_height= '' wrap_content '' android  id= '' @ +id/currentfloor '' > < /textview > < /tablerow > < tablerow android  id= '' @ +id/tablerow3 '' android  layout_width= '' match_parent '' android  layout_height= '' wrap_content '' > < textview android  text= '' @ string/noinfo '' android  layout_width= '' wrap_content '' android  textcolor= '' # 0070c0 '' android  layout_height= '' wrap_content '' android  id= '' @ +id/currenttype '' > < /textview > m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 98 < textview android  text= '' @ string/noinfo '' android  layout_width= '' wrap_content '' android  textcolor= '' # 0070c0 '' android  layout_height= '' wrap_content '' android  id= '' @ +id/currentroom '' > < /textview > < /tablerow > < /tablelayout > < textview android  id= '' @ +id/textdeparture '' android  layout_height= '' wrap_content '' android  layout_width= '' match_parent '' android  textcolor= '' # 0070c0 '' android  text= '' @ string/departure '' android  textstyle= '' bold '' > < /textview > < autocompletetextview style= '' @ style/faketextfield '' android  id= '' @ +id/inputdeparture '' android  background= '' @ drawable/textlines '' android  clickable= '' true '' android  textcolor= '' # 0070c0 '' > < /autocompletetextview > < textview android  id= '' @ +id/textdestination '' android  layout_height= '' wrap_content '' android  layout_width= '' match_parent '' android  textcolor= '' # 0070c0 '' android  text= '' @ string/destination '' android  textstyle= '' bold '' > < /textview > < autocompletetextview style= '' @ style/faketextfield '' android  id= '' @ +id/inputdestination '' android  background= '' @ drawable/textlines '' android  clickable= '' true '' android  textcolor= '' # 0070c0 '' > < /autocompletetextview > < textview android  id= '' @ +id/textexample '' android  layout_width= '' wrap_content '' android  layout_height= '' wrap_content '' android  textcolor= '' # 0070c0 '' android  text= '' @ string/specificationexample '' android  textsize= '' 10sp '' android  paddingbottom= '' 10sp '' > < /textview > < button android  layout_height= '' wrap_content '' android  layout_width= '' match_parent '' android  id= '' @ +id/buttonnavigationstart '' android  text= '' @ string/startnavigation '' > < /button > < button android  layout_height= '' wrap_content '' android  layout_width= '' match_parent '' android  id= '' @ +id/buttonsettings '' android  text= '' @ string/settingslabel '' > < /button > < /linearlayout > box 9 xml file of the main screen in the second screen  the user is able to define the route parameters  this is being done with radio buttons for the type of user  and an enabler button for the restriction level  enhanced features can be placed here as well  such as a text-to-speech engine  or the display of the graph structures  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 99 figure 32 settings screen in the third and final screen  the user should see the route  along with the current location  as the application involves a non-geometry feature  no maps are to be displayed  however  the user gets to see if he or she is at the correct place according to the provided route  in the prototype  the node number is being displayed as reference  because the android emulator does not support wi-fi measuring  figure 33 below shows no information about the current position  figure 33 navigation screen  output of a route m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 100 17.2 testing the application upon completion of the application  test runs have been performed  of which the methodology and results are discussed in this sub chapter  the testing includes application validation  17.2.1   the location check  17.2.2  and the navigation itself  17.2.3   17.2.1 application validation the functioning of the application itself is the first part of testing  where wi-fi does not necessarily have to be used  this includes the input  processing and output mechanisms without wi-fi  as well as the layout and the interface  for instance  a user might plan ahead and use the application to plan a journey from the entrance to room 2.250 the application validation is the major part of the development  and has to work in advance  before a location check comes in  the prototype has been configured in such way that the node numbers are still visible  that means that the user can search for the fid number of the nodes/locations  a built-in feature is that it will also check for empty or incorrect fields  it is not possible to calculate a route between points that do not exist  further extensions have been taken into account  such as the possibility to calculate routes based on user preferences  but are not operational as it is not the aim of the research to look at various outcomes of user profiles  but rather on localization of the user  17.2.2 criteria of location check and test performances in the prototype  the user first sees what the current location is  this is displayed in the top of the screen  at various locations  this has been tracked at twenty different timestamps  the location is considered correct  if the application states that the user is exactly at the right place  or at the place adjacent to it  with a maximum of two nodes   since the signal strengths may vary over time and space  this does not apply for a wrong placement on the vertical dimension  since the signal strengths are significantly different from each other at different heights  the filtering of search space by 4 dbm has been maintained in the next scan results  the first scan compromised the registration of 12 location nodes  in 20 consecutive time stamps  the results have been distinguished by  close matches  o location has an exact match with the database o location was within one node away  at the same floor e.g  if the actual location is node 3109  then 3108 and 3110 are valid  o location was within two nodes away  at the same floor e.g  if the actual location is node 3109  then 3107  3108  3110 and 3111 are valid  bad matches  o location was within two nodes away  but at a different floor e.g  if actual location is 3109  then 3008-3011  3208-3211 are valid o location was more than two nodes away  but at the same floor o location was more than two nodes away  and at a different floor o location was physically within two nodes away  but at different part of the building this occurs in places with many complex building parts  in which the user is prompted to be near a location close to another wing  for example  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 101 two major scans have been performed  in the first series  location information was being retried based on fingerprints composed by the ten strongest signal strengths at that point  as originally proposed  this also includes routers that are on a different floor than where the users are  the second series of scan results were based on eight mac addresses  whose access points located on the same floor  in this extent  the physical space of the router is being combined with the physical location of the fingerprint  this has been made possible  since the routers at the otb contain four mac addresses  to illustrate the routers locations and their reaching space on that same floor  see figure 34  figure 34 new database method  using coverage areas instead of storing best signals next  at 12 distinctive locations  scans were performed  the following locations were chosen  table 16   node 2002 2005 2008 3002 3007 3011 3101 3105 3110 3203 3209 3211 location wing 2  ground floor  near main exit wing 2  ground floor  near back exit wing 2  ground floor  corner of two rooms wing 3  ground floor  near emergency exit wing 3  ground floor  centre point wing 3  ground floor  end of hallway wing 3  floor 1  end of hallway wing 3  floor 1  near kitchen wing 3  floor 1  second staircase wing 3  floor 2  primary staircase wing 3  floor 2  next to glass doors of corr  wing 3  floor 2  near end of hallway table 16 overview of test nodes for location checks remark open area near nodes 2006-2007-2008 small corridor near end open area near nodes 2002-2006-2007 end of hallway  near router a near router b  centre of corridor near router c near router d far away from router d and e between routers e and f between routers g and h near router h near router i m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 102 results on overall scan out of the 240 obtained values  only 14 of them had exact matches  which is a mere 5.8 % of the scan results  moreover  66 were within two nodes of the actual location  which compromises a 27.5 % of the scan results  this compromises that the user was in one third  33.33 %  at or near the appropriate location  in 47 cases  19.6 %   the user was located within two nodes of the actual location  although it was on a different floor  this was mostly being the case when the user was at the ground or first floor  this suggests that signal strengths were matched from the floor or below the user  as this rarely happened on the second floor  where only one floor below could be matched  still  26.3 % was matched on the same floor  but beyond two nodes of where the user actually was  70 60 3211 3209 50 3203 3110 40 3105 3101 30 3011 3007 20 3002 2008 10 2005 2002 0 exact match within 1 places within 2 places beyond 2 beyond 2 within 2 within 2 places  same places  other places  other places  floor floor floor behind area figure 35 first scan results  grouped by match  specified by location  fingerprint  node  12 nodes  wing 2+3  if a closer look is being taken on the results of solely wing 3 in the test case  it seems that the wrong allocation on the wrong floor has been affected by the scan results of the locations in wing 2 simultaneously  the total cases of a near correct match dropped to an exact 25 %  45 out of 180 ; with wing 2 included  which compromised 80 out of 240   this is caused by the near correct placements of node 2002 and 2005  15 out of 20 time intervals  the user was located within 2 places away of node 2002  whereas it happened 17 out of 20 time intervals the user was located within 1 place away of node 2005 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 103 50 45 40 3211 35 3209 30 3203 25 3110 20 3105 3101 15 3011 10 3007 5 3002 0 exact match within 1 places within 2 places beyond 2 beyond 2 within 2 within 2 places  same places  other places  other places  floor floor floor behind area figure 36 first scan results  grouped by match  specified by location  wing 3 nodes the outcomes are also displayed in table 17 below  and further specified for wing 3 only in table 18 node close matches  % from total observations exact match 3002 3007 3011 3101 3105 3110 3203 3209 3211 2002 2005 2008 2 1 7 1 0 0 14 5 15 16 17 2 total 80 0,8 % 0,4 % 2,9 % 0,4 % 0,0 % 0,0 % 5,8 % 2,1 % 6,3 % 6,7 % 7,1 % 0,8 % 33,3 % 0 1 1 0 0 0 0 4 8 0 0 0 14 0,0 % 0,4 % 0,4 % 0,0 % 0,0 % 0,0 % 0,0 % 1,7 % 3,3 % 0,0 % 0,0 % 0,0 % 5,8 % within 1 places 2 0 5 0 0 0 0 0 3 1 17 1 29 within 2 places 0 0 1 1 0 0 14 1 4 15 0 1 37 0,8 % 0,0 % 2,5 % 0,4 % 0,0 % 0,0 % 5,8 % 0,4 % 2,9 % 6,7 % 7,1 % 0,8 % 27,5 % % from total observations % from total observations out of match  % from total observations beyond 2 places  same floor 18 19 13 19 20 20 6 15 5 4 3 18 160 7,5 % 7,9 % 5,4 % 7,9 % 8,3 % 8,3 % 2,5 % 6,3 % 2,1 % 1,7 % 1,3 % 7,5 % 66,7 % 2 12 11 3 0 0 3 7 0 4 3 18 63 0,8 % 5,0 % 4,6 % 1,3 % 0,0 % 0,0 % 1,3 % 2,9 % 0,0 % 1,7 % 1,3 % 7,5 % 26,3 % beyond 2 places  other floor 0 0 0 14 16 4 1 0 0 0 0 0 35 within 2 places  other floor 1 7 2 2 4 16 2 8 5 0 0 0 47 % from total observations within 2 places  behind area % from total observations 15 0 0 0 0 0 0 0 0 0 0 0 15 6,7 % 2,9 % 0,8 % 6,7 % 8,3 % 8,3 % 1,3 % 3,3 % 2,1 % 0,0 % 0,0 % 0,0 % 40,4 % table 17 scan results attempt 1 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 104 node close matches  % from total observations exact match 3002 3007 3011 3101 3105 3110 3203 3209 3211 2 1 7 1 0 0 14 5 15 total 45 1,1 % 0,6 % 3,9 % 0,6 % 0,0 % 0,0 % 7,8 % 2,8 % 8,3 % 25,0 % 0 1 1 0 0 0 0 4 8 14 0,0 % 0,6 % 0,6 % 0,0 % 0,0 % 0,0 % 0,0 % 2,2 % 4,4 % 7,8 % within 1 places 2 0 5 0 0 0 0 0 3 10 within 2 places 0 0 1 1 0 0 14 1 4 21 1,1 % 0,0 % 3,3 % 0,6 % 0,0 % 0,0 % 7,8 % 0,6 % 3,9 % 17,2 % % from total observations % from total observations out of match  % from total observations beyond 2 places  same floor 18 19 13 19 20 20 6 15 5 135 10,0 % 10,6 % 7,2 % 10,6 % 11,1 % 11,1 % 3,3 % 8,3 % 2,8 % 75,0 % 2 12 11 3 0 0 3 7 0 38 1,1 % 6,7 % 6,1 % 1,7 % 0,0 % 0,0 % 1,7 % 3,9 % 0,0 % 21,1 % beyond 2 places  other floor 0 0 0 14 16 4 1 0 0 35 within 2 places  other floor 1 7 2 2 4 16 2 8 5 47 within 2 places  behind area 15 0 0 0 0 0 0 0 0 15 8,9 % 3,9 % 1,1 % 8,9 % 11,1 % 11,1 % 1,7 % 4,4 % 2,8 % 53,9 % % from total observations % from total observations table 18 scan results attempt 1  wing 3 only second test run in the second test run  the same locations in were being compared  but this time the focus was only on wing 3 in addition  the database was reconfigured and remeasured  new database  with the same device as that it is being read  to marginalize the errors in the database caused by using a highend receiver  instead of an average scan for the best 10 mac addresses  only the routers on the same floor as the location node has been used  see figure 34   to limit the search space  the rationale is that it will reduce the probability of placing the user on the wrong floor  as the signals that come through ceilings and floors have been much weakened as such  from the 9 x 20 = 180 scan results  81 times the user was located near the appropriate location  from which 46 times was at the exact location as predicted  =25.6 % of the total 180  or 56.8 % from all 81 good matches  see also table 19   this is an increase of 20 % for all  near  correct nodes  the exact matches have been increased from 7.8 % to 25.6 %  the results at locations which are situated near the end of the hallway or at open spaces are prone to false location conversions  when taking a closer look at the direct results  see annex c.1   this is most likely being the cause of the availability of only the strong signals from a nearby router  whereas the weaker signals of faraway routers are hard to obtain  in open spaces  it is possible that many other signals from floors below are easier to receive  as the signals elsewhere need to penetrate ceilings and floors first  which results in much weaker signals to be interfering the scanning results  for example  it has been found that there were no fingerprints recorded at the intermediate floor levels in the staircases  making comparisons not possible  being halfway  the device picks up signal strengths and compares it with the database  and places the user on a floor  while the user finds itself between floors   or in a wrong wing if the location is not too far away from a different wing  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 105 50 45 40 3211 35 3209 30 3203 25 3110 20 3105 3101 15 3011 10 3007 5 3002 0 exact match within 1 places within 2 places beyond 2 places  same floor beyond 2 within 2 places  other places  other floor floor figure 37 second scan results grouped by match  specified by location  wing 3 nodes node close matches  % from total observations exact match 3002 3007 3011 3101 3105 3110 3203 3209 3211 8 12 8 3 10 10 10 13 7 total 81 4,4 % 6,7 % 4,4 % 1,7 % 5,6 % 5,6 % 5,6 % 7,2 % 3,9 % 45,0 % 3 11 8 1 10 0 0 8 5 46 1,7 % 6,1 % 4,4 % 0,6 % 5,6 % 0,0 % 0,0 % 4,4 % 2,8 % 25,6 % within 1 places 5 0 0 2 0 8 9 5 2 31 within 2 places 0 1 0 0 0 2 1 0 0 4 2,8 % 0,6 % 0,0 % 1,1 % 0,0 % 5,6 % 5,6 % 2,8 % 1,1 % 19,4 % % from total observations % from total observations out of match  12 8 12 17 10 10 10 7 13 99 6,7 % 4,4 % 6,7 % 9,4 % 5,6 % 5,6 % 5,6 % 3,9 % 7,2 % 55,0 % beyond 2 places  same floor 0 2 0 0 10 5 10 4 13 44 beyond 2 places  other floor 5 6 10 17 0 4 0 3 0 45 within 2 places  other floor 7 0 2 0 0 1 0 0 0 10 6,7 % 4,4 % 6,7 % 9,4 % 5,6 % 5,6 % 5,6 % 3,9 % 7,2 % 55,0 % % from total observations % from total observations table 19 scan results attempt 2  wing 3 only m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 106 17.2.3 indoor wi-fi navigation testing the navigation  with the wi-fi fingerprints as location check  is the core of the application  the user has planned a journey  and the position is being monitored with the wi-fi fingerprints  the user has to follow the rules and directives provided and should receive a message whether the user is on or off route  routes are being calculated with the graph and dijkstra algorithm  neutral directions are provided  along with the node numbers  if the device picks up the signals and translates that into a node id  this is being compared with the list of nodes in the calculated route  if this id is within the list  the message on route is being displayed  if not  off route is being displayed  within wing 3 of the otb building  various routes have been traversed using the application  five different type of routes have been travelled upon in different travel directions  as displayed in table 20 for each route  the number of off route messages have been registered  as well as all node numbers that the device picks up during the journey  which is being compared with the provided list  upon registration of the correctness of the information provided  the following scenarios are being used  the application detects the user at a location that is provided in the list  and the user finds himself at the location that should match the list ; o example  user is at location fid=3001 ; the device provides message user is at fid=3001  o this will be registered as fully correct  in table 20 denoted as on on route   the application detects the user at a location that is provided in the list  but the user is not at the location that he should be at ; o example  user is at location fid=3001 ; the device provides message user is at fid=3002  o this will be registered as partly correct  in table 20 denoted as on/off   the application detects the user at a location that is not provided in the list  and the user does not find himself at that location ; o example  user is at location fid=3001 ; the device provides message user is at fid=2004  o this will be registered as incorrect  in table 20 denoted as off off route   as expected  the results in correct route confirmation are similar to those as the general location confirmation  since the checks are based on location  although in this case  the test run involved a swift fid acquisition  maximum of 1 second waiting at a location   instead of waiting for a long acquisition time  20 seconds as in the previous section   in 41.3 % of all route confirmation provisions  a correct message has been given  upon examining the variations between the different routes  it seems that the results were poor on the route that was fully from one end to another on the first floor  route 2   as well as the route that dealt with travelling within the north end  route 5   from the former  this can be explained that despite using routers within the same physical space  the device still picks up signal strengths from floors above or below the user  since the probability a signal strength from a floor below the bottom most or above the top most floor is nil  that comes in no surprise  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 107 series 1 route 1 2 3 4 5 series 2 route 1 2 3 4 5 series 3 route 1 2 3 4 5 total route 1 2 3 4 5 total characteristic south end 0f  north end 2f south end 1f  north end 1f south end 2f  north end 1f south end 0f  south end 2f north end 2f  north end 0f from 3005 3101 3201 3001 3212 via 3009 3107 3110 3103 3110 to 3212 3112 3112 3201 3011 nodes 9 11 12 7 7 on 5 4 6 2 2 on/off 2 3 4 1 3 off 2 4 2 4 2 on 55.6 % 36.4 % 50.0 % 28.6 % 28.6 % on/off 22.2 % 27.3 % 33.3 % 14.3 % 42.9 % off 22.2 % 36.4 % 16.7 % 57.1 % 28.6 % characteristic south end 0f  north end 2f south end 1f  north end 1f south end 2f  north end 1f south end 0f  south end 2f north end 2f  north end 0f from 3005 3101 3201 3001 3212 via 3009 3107 3110 3103 3110 to 3212 3112 3112 3201 3011 nodes 9 11 12 7 7 on 4 4 5 3 4 on/off 3 2 5 0 0 off 2 5 2 4 3 on 44.4 % 36.4 % 41.7 % 42.9 % 57.1 % on/off 33.3 % 18.2 % 41.7 % 0.0 % 0.0 % off 22.2 % 45.5 % 16.7 % 57.1 % 42.9 % characteristic south end 0f  north end 2f south end 1f  north end 1f south end 2f  north end 1f south end 0f  south end 2f north end 2f  north end 0f from 3005 3101 3201 3001 3212 via 3009 3107 3110 3103 3110 to 3212 3112 3112 3201 3011 nodes 9 11 12 7 7 on 3 4 5 4 2 on/off 3 3 1 0 0 off 3 4 6 3 5 on 33.3 % 36.4 % 41.7 % 57.1 % 28.6 % on/off 33.3 % 27.3 % 8.3 % 0.0 % 0.0 % off 33.3 % 36.4 % 50.0 % 42.9 % 71.4 % characteristic south end 0f  north end 2f south end 1f  north end 1f south end 2f  north end 1f south end 0f  south end 2f north end 2f  north end 0f from 3005 3101 3201 3001 3212 via 3009 3107 3110 3103 3110 to 3212 3112 3112 3201 3011 nodes 27 33 36 21 21 138 on 12 12 16 9 8 57 on/off 8 8 10 1 3 30 off 7 13 10 11 10 51 on 44.4 % 36.4 % 44.4 % 42.9 % 38.1 % 41.3 % on/off 29.6 % 24.2 % 27.8 % 4.8 % 14.3 % 21.7 % off 25.9 % 39.4 % 27.8 % 52.4 % 47.6 % 37.0 % table 20 results of route confirmation results within wing 3 a different approach upon testing the route confirmation is not by checking the correct location confirmation  but on the way the route guidance is provided along the way  in this project  a simple topological route network guidance has been provided  without the presence of geometry  it is hard to tell whether the user has to turn left or right  and therefore it is hard to tell whether the users orientation is correct  this can be relieved if information about correctness is involved  for instance  if the user traverses a floor from one end to another  he can get confirmation such as you are doing correct if you see the add office room numbers are adding up  there is still no geometry involved  but still some sort of route confirmation is present  further research is desirable to do so  after a short demonstration  test persons have noted many expansions are worthy  which includes the addition of photos  graphs  images  maps and pictograms  in addition  it was noted that the text output was rather long or confusing  this confirms the weakness of providing neutral text based directions  as there is no geometry involved  it is rather difficult to tell whether the user has to turn left or right  the next step of navigation would indeed be implementing geometric features  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 108 17.3 remarks and conclusions on the application how can wi-fi fingerprinting determine a location which does not utilize geometric features  and how can it be implemented in an application as such ? not utilizing geometric features requires the developer to realize that a navigable graph network must emphasize on the topology and structure that exist between navigable places  first of all  the results are influenced by the type of receiver that was being used to record the data itself  a high-end receiver such as a laptop provides better scan results than the middle-end smartphone receiver  which was visible from the fingerprint database  as a result  the device that is being used for the application might over or underestimate the recorded scan results  it means that the fingerprint database needs frequent updates  and that there are multiple databases necessary  for each class of end receivers  second  the location methodology is a simplified version of map-matching algorithms  in the sense it does not uses geometric features  a least sum of square is hard to use  since android automatically assigns either non-existent values  -100 dbm  or blank values  which are in both cases sensitive to providing false location  the count method location determination itself might not be fair as well  since it only checks the range from the signals that have been recorded and evaluated  as such  stronger signals have an equal weight as weak signals  with that regard  smart localization should be implemented  third  results on the localization is influenced by the database records  better results have been found when only macs from the same physical space have been used in the recording phase  although that is not a guarantee  still less than 50 % provides a correct  or near-correct estimation  a few suggestions about the application and its development are mentioned  first  automatizing the process of surveying can be done with the smartphone itself  in the first place  the signal strengths can be recorded  but by building an application in which the surveyor can add location information to this signal strength  a graph  and thus navigable network  can be created  second  a combination of other techniques could improve the localization method  as well as the navigation module  for instance  an accelerometer  which is also present at present-day smartphones  can help detect orientation aspect  and from there  clearer route descriptions can be given  instead of neutral descriptions  as wi-fi is rather unstable due to the variations in signal strength  see annex c.1 and c.2   further research should be carried out to solve this  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 109 part iv  conclusions contents 18 final conclusion 19 limitations 20 recommendations references annexes in this fourth and final part  the output is being discussed  in chapter 18  the final conclusions are being drawn and the main research question is it possible to develop an indoor navigation service for a mobile platform  with the use of wi-fi fingerprinting technology and open location services standards  but without using geometry ? will be answered  the results are further being evaluated with its limitations and recommendations in the chapters 19 and 20 respectively  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 110 18 final conclusion in this thesis project  attempts have been made to investigate the possibilities of indoor navigation on a smartphone  with the use of wi-fi technology  but without using building geometry  the research question was  is it possible to develop an indoor navigation service for a mobile platform  with the use of only wi-fi fingerprinting technology and the framework of the open location services standards  but without using building geometry ? it is possible to launch an indoor navigation service for a mobile platform  with wi-fi fingerprinting technology  the framework of the open location services were provided as a guideline to set up the application  but they remained unused  as they can not be combined with a project which does not use geometric features such as maps  since the parameters are focussed on that aspect  however  the location predictions are too unreliable to be used  caution has to be taken upon fingerprinting  since fingerprinting assumes that the characteristic signal strengths are  1  dependent on physical objects present in the navigable space due to multipath and  2  are changing over time  in addition  their transmitters  the routers or media access control units  mac   can be replaced as well  upon site surveying  it is highly recommended to store at least a variety of macs  along with their respective signal strength  at specific locations  in addition  great care has to be taken upon registering the macs themselves  since they have to be combined with location information  which indirectly leads to identifiable persons  this  in turn  can be prohibited by law in countries such as the netherlands  indoor navigation should thus be limited to public buildings only  two types of location determination have been proposed  a count method  and the least sum of squares method  in android  both methods are constrained by how access points out of reach are being treated  non-detectable access points are either assigned with a value of -100 dbm  or as a blank value  regarding the least sum of squares  ss  method  in the former case this will lead to the promotion of recorded weak signal strengths at certain locations  in the latter case  this will lead to unequal ss value to compare  as one location might have a ss value based on five access points  and another location might have a ss value based on seven access points  in which it is most likely the location with the fewest access points prevails  the count method will solely check for matches in a defined search space  this includes a search margin of roughly 3-5 dbm  in this project the value of 4 dbm as a search space margin has been used  it has been seen that upon using recorded values from the ten best access points within reach  often false locations have been provided  in a short live scanning survey  only 25.0 % of all 180 measurements were within an acceptable predicted location  which equals the location being perceived within a maximum of two nodes away  at the same floor  in only 7.8 % of all 180 cases  the location was exactly the same  in 53.9 % of all cases  the location estimation was on the wrong floor and far away  when the database is being replaced with only mac addresses from access points in the same physical space  = same floor  as the fingerprint/node  the results seems to improve  45.0 % of all 180 measurements was now within the acceptable predicted location  and 25.6 % of all measurements were perceived at the exact same spot as where the device was  this has been at the expense of the estimations far away on wrong floors  this percentage has been decreased to 30.5 % of all cases  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 111 further conclusions can be drawn regarding the localization algorithm and the database  first of all  it is desirable that the results obtained from the site surveying should be done with the same device as the live scanning results  which has been done in the second test runs  this is to prevent the database to be filled with recordings that are too high or too low  in which the amount of over and underestimation can be diminished  second  certain locations are highly likely to provide false location information  as they are dependent on the building structure  and thus highly influent by multipath effects  these locations where fingerprints are stored  includes locations at staircases  or near the end of the hallway  however  it is rather difficult to realize stable location detection  the navigation algorithm being used  the dijkstra algorithm  can be further expanded  with options regarding user profiles  the navigation output itself has to be improved  since it now uses neutral descriptions  as there is no orientation aspect  except for recognizable objects that are being used to provide directions  this is clearly one of the weaker aspects of the project  since it does not use building geometry at all  it is recommended that previous or future locations  should also be used to provide route guidance to the user  furthermore  paths that are in the same direction of extension are now all treated as single paths  smart routing in the sense of providing directions such as go to the end of the hallway near point e instead of go towards point a  b  c  d  e is highly recommended  with that respect  the integration of additional technologies  such as a accelerometer could provide a useful extension  as it will help to incorporate geometry after all  the representation is also difficult to improve when one considers solely text-based navigation  enhances in the application interface are desirable  such as enabling text-to-speech  routing by user profiles  displaying graphs and active maps  and estimated times of arrival  includes better route handling and narrowing down location determination algorithms and  this prototype checks whether the determined location matches with a calculated route  and states whether the user is on or off route  ideally  the route has to be recalculated if the user does not find itself at its path predicted  in addition  by narrowing the location determination  such as only looking in the search space at the same floor or look at only three nodes away from me further upgrades the prototype  the incorporation of other localization techniques  along with its enhancements  such as an accelerometer   would be helpful  to answer the main research question  a simple no would suffice  as summed up  wi-fi signals are instable and fluctuate significantly ; quality of fingerprinting depends on quality of receiver for recording versus live reading ; fingerprinting databases requires frequent updating ; emphasis on topology is possible without geometric features  but orientation aspects are difficult to solve ; parameters of the openls can not be used  since they are dependent on geometric features  although their framework can be used ; localization methodologies dependent on how android treats out of reach routers  and on the how the amount of mac addresses being read are treated equally ; it is proven that despite changing the received signal strengths in favour of the device  below 50 % of all location estimations were correct  making the reliability of the whole application poor  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 112 19 reflection  discussion  limitations and recommendations in this chapter  limitations and recommendations are being discussed  first  limitations are addressed in section 19.1  followed by recommendations in section 19.2 regarding the application itself  and in section 19.3 regarding localization methods  19.1 limitations in general logging  as in recording the users complete path  not to be confused with tracking  which is following the users path  and the maintenance are not included in this research  since it is not the goal to allow users to track their progress  but rather navigating them from one end to another  however  tracking could be useful in combination with pedometer-like application for instance  finally  since it is the purpose to create a prototype  no maintenance is required either  unlike the outdoor navigation  data on indoor locations is not widely available  there are no vendors for networks such as falkplan and teleatlas  and not all companies are willing to provide floor plans for public use  or even if there is a provision  it might be possible that not everything is covered to keep it secret  this might cause less accuracy  or missing data  on the other hand  since the nongeometry is the keyword to this thesis  it might be possible not to work with maps at all  therefore limiting the data usage in an advantageous way  fingerprinting requires a lot of pre-processed work  in the form of site surveying  also  the fact that it is capable of handling multi-path makes it a burden at the same time  as soon as large objects  including people  are moved  the fingerprints will surely be affected  the same applies for the fixation of mac addresses  since the received signal strengths are dependent on the mac address  patterns might not be found  as soon as an access point has been replaced by another  an application thus has to be constantly updated  and from time to time a new survey has to take place  warnings about imprecise location estimation as such should be present  text descriptions itself are useful  as they are capable of steering the user on what he or she has to do  however  as hsu  2011  already pointed out  is that the attention of users is in the visualization  photos  pictograms and maps are in that sense better options  the application can thus further enhanced with visual media as such  yet  when maps are being used  the concept of localization with fingerprinting must be changed to the concept of positioning with map matching  which requires different implementation algorithms  ideally  the reverse geocoding from fingerprints to location information can be re-geocoded again  to known  absolute locations  in that sense  indoor navigation can be further enhanced  and it is highly recommended to do so in future research  the aim of this thesis was to investigate possibilities regarding indoor wi-fi without building geometry  it was not the intention to develop a full and complete product  but rather on how to use the various aspects of navigation  as such  the result is that the location determination  and the navigation are standalone versions as well  ideally  those two have to be combined for real live navigation as one is known for car navigation  with the addition of the confirmation of where the user is either on route  or off route  if this incentive can be reached  the use of maps or graphs can be further enhanced  as the device might show the user where the location on the graph is  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 113 19.2 regarding the application more recommendations can be discussed for the prototype itself  a first recommendation is that the database should be stored on a remote server  so that users will not need to update the application constantly regarding changes of macs and signals  the downside however  is that it requires at least a 3g wireless connection  in case the user can not establish a data connection via the wi-fi access points  3g can not be guaranteed in rooms which blocks the signals of mobile telecommunication  in this occasion  it is likely that wi-fi signals can not reached either  further recommendations are suggested for the user interface  enhancements not related maps  but to the input and output  can be done in certain ways  a few are named below  1 only a departure and destination can be selected  but it is possible to include via waypoints  or to exclude via waypoints  for instance  a user would like to go from one point in the building  to another point  but the user would like to have a copy machine on his way  and the user would like to avoid a certain section  since there are ongoing refurbishments in that particular part of the building  2 the inclusion of routes for impaired users  such as wheelchair users  in the database  it has been taken into account which routes are navigable for wheelchairs  as for each edge  information is stored whether a ramp is available  or where the elevators are located  in the prototype  there has been room left for this  as in the settings screen this has already been created  3 the inclusion of text-to-speech  android has a text-to-speech engine  in which the user can hear the directions the application provides  this might help the user  when the user prefers to have his smartphone socketed in his pocket for instance  there are also limitations and recommendations regarding privacy and legal issues  which are explained in the next chapter  19.3 regarding the localization methodologies in this project  two localization methodologies have been proposed  in which one has been used  the count method was the preferred method over the least sum of squares due to issues in the way how android treats weak and bad signals  aside from that  the number of entries per location node influences the outcome of the least sum of squares  as well as the maximum number of valid records  further research on both methodologies in thus necessary  these methods behave different than the map-matching algorithms as discussed in the literature research  since there is no geometry to match with  this assumes that there is a given location  in which both location information and signal strength characteristics can be stored  by combining this information  a node can be created  and eventually  a graph  in which various network algorithms can be applied  this can be further extended by explicitly stating which adjacent rooms belong to which node  this way  geometry is not being used  but rather the connectivity and topology is preserved  the importance of topology must be emphasized in further research  since in route guidance  no left/right can be distinguished  alternative solutions must be found  user awareness plays a role here  route confirmation can also made possible by using logics from the real environment  such as you are still on route  if you can see the signs of the office room numbers are adding up  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 114 in addition  mac addresses themselves are dynamic and can be changed at will  this leads to unstable databases in time  it is recommended that upon up-scaling to larger coverage areas  updates should occur frequently  aside from that  the signal strength characteristics still remain prone to multipath effects  which results in false location information  this can be countered by effectively using the macs  for instance  only use macs that are at the same floor as the fingerprint  this prevents looking for outlying signal strengths  which can be unstable anyway  the search space in which the signal strengths have to be looked up from  can be changed at will as well  the larger the search space  the more problems are foreseen with matching locations  as the larger it is  the more locations can be made available  moreover  it is recommended that the locations to be registered should not be too far away from each other  as otherwise  intermediate locations are being detected as somewhere else  while that has not be the case per say  on the other hand  the to be fingerprinted locations should not be too close to each other  since it is then difficult to perceive which location belongs to what  it is noteworthy  that the intention of this project was to map locations and not map each single possible position there is simply too much differentiation in signal strength to do so  further automatizing is possible by developing an application  which is capable of directly registering average signal strengths from macs  in which location information can be assigned  by repeating this for several spots  and by adding information about which spots are connected in physical space  it is easy to build up a graph  finally  the databases are dependent from the device being used  a high-end receiver  such as a laptop provides different outcomes than using the smartphone directly for both recording as receiving  a clear disadvantage however  is that multiple databases are needed  each database that should be adapted to the quality of the wi-fi receiver  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 115 20 additional remarks on privacy and legal issues the application faces multiple issues regarding privacy and legal aspects  which are addressed below  in this chapter a mac  media access control  refers to the address from a transmittable access point  routers   as non-transmittable devices  such as computers also contain macs  20.1 personal information originally  the intention was to include personal information in the application  this is related to the available cataloguing options in the application  in the case a user is looking for the office of a certain person  the user can search for the name of the person  in which the proper room is being given  thus  the name of a staff member was available in combination with the room  however  this implies that a significant amount of personal information has to come with the application  resulting in an application which can be data intensive  and is vulnerable to hacking as well  yet  if not too much effort can be done to retrieve personal information via one information channel  such as the office rooms of personnel  which can be browsed by a corporate website   it is probably not too sensitive  hence  it can be used in the application  20.2 mac as personal information late april 2011  google was fined 250,000 by a dutch lawsuit  as google deliberately recorded all mac addresses they detected during their coverage of google street view  nrc  2011   recording the mac address  the base ssid  or bssid  itself is not punishable by law  as long as personal information is not combined with it  according to the college bescherming persoonsgegevens  cbp   a quasi-non-governmental organization in the netherlands  which concerns about the protection of personal data and privacy  however  google combined the mac address with a wgs84 coordinate  along with street names  postal codes  places and more information  in which then the mac address itself turns into personal data  cbp  2010 ; cbp  2011   thus a mac address can be considered as proprietary data  this resulted in a forced deletion of the acquired information  as demanded by the cbp  the law  wbp article 8.f  is roughly translated  cbp  2011   data about persons may only be processed when data processing is crucial for the  representation of  the justifiable interest for the responsible person  institute or third member to whom the data will be issued  unless the interest or fundamental rights and freedom of the involved person prevails  with special attention regarding the right to the private life  this issue is strongly related with the application  since it utilizes mac information  which is being correlated with the received signal strengths  to avoid lawsuits  the application should not be coupled with other personal information  20.3 coverage correlated with the mac as personal information depicted and personal information in general in the previous sections  the coverage area itself is prone to privacy and legal issues as well  since macs are proprietary  as they can be bought for a specific individual or group   it is reasonable to limit the coverage of a service deployment to public buildings  such as hospitals  conference centres  shopping malls and governmental buildings  this will reduce the amount of personal and sensitive information  finally  it is most unlikely a user is trying to navigate through very small and refined rooms such as in private objects as houses and apartments  as required by the cbp  upon site surveying  the m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 116 persons/institutions who own or work with their mac  should be informed their mac is being used for location information  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 117 references albrecht-buehler  c  b watson & d.a  shamma  2005   visualizing live text streams using motion and temporal pooling  ieee computer society  pp  52 59 android developers  2011   developers guide  using databases  retrieved  august 18 2011  http  //developer.android.com/guide/topics/data/data-storage.html # db  bipm  bureau international des poids et mesures  2008   international vocabulary of metrology basic and general concepts and associated terms  vim   retrieved  february 24 2011  http  //www.bipm.org/utils/common/documents/jcgm/jcgm_200_2008.pdf  boguslawski  p  c.m  gold & h ledoux  2011   modelling and analysing 3d buildings with a primal/dual data structure  isprs journal of photogrammetry and remote sensing  66   pp  188-197 bowditch  n  2002   the american practical navigator an epitome of navigation  2002 bicentennial edition  bethesda  md  national imagery and mapping agency  chiou  y  c wang  s yeh & m su  2009   design of an adaptive positioning system based on wifi radio signals  computer communications 32  pp  1245-1254 cbp  college bescherming persoonsgegevens  2010   definitieve bevindingen  onderzoek cbp naar de verzameling van wifi-gegevens met street view autos door google  z2010-00582  openbare versie  retrieved  april 19 2011   http  //www.cbpweb.nl/downloads_rapporten/rap_2011_google.pdf cbp  college bescherming persoonsgegevens  2011   last onder dwangsom / opdracht tot vernietiging payload data  retrieved  april 19 2011   http  //www.cbpweb.nl/downloads_pb/pb_20110419_brief_google_lod.pdf dawes  b  & k chin  2011   a comparison of deterministic and probabilistic methods for indoor localization  the journal of systems and software 84  pp  442-451 de koning  m  2010   quality assessment of gsm positioning  gsm fingerprinting versus cell-id positioning  msc thesis made available upon request  de la roche  g  p flipo  z lai  g villemaud  j zhang & j gorce  2010   implementation and validation of a new combined model for outdoor to indoor radio coverage predictions  journal on wireless communications and networking  pp  1-9 dllner  j  b hagedorn & s schmidt  2007   an approach towards semantics-based navigation in 3d city models on mobile devices  lecture notes in geoinformation & cartography 2  4   pp  357-368 dovis  f  r lesca  g boiero & g ghinamo  2010   a test-bed implementation of an acquisition system for indoor positioning  gps solutions 14  pp  241-253 etsi  european telecommunication standard institute   2010   on-demand base maps on the web generalized according to user profiles  internal document submitted  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 118 foerster  t  2010   web-based architecture for on-demand maps integrating meaningful generalization processing  retrieved  august 18 2011  http  //www.itc.nl/library/papers_2010/phd/foerster.pdf haenselmann  t  2005   lecture on sensor networks  retrieved  february 24 2011  http  //www.slideshare.net/netfet/localization-presentation  hsu  c.c   2011   factors affecting webpages visual interface design and style  procedia computer science 3  pp  1315-1320 ibrahim  a  & d ibrahim  2010   real-time gps based outdoor wifi localization system with map display  advances in engineering software 41  pp  1080-1086 ieee  2011   ieee standard for information technology telecommunications and information exchange between systems local and metropolitan area networks specific requirements part 11  wireless lan medium access control  mac  and physical layer  phy  specifications  retrieved  march 1 2011  http  //standards.ieee.org/about/get/802/802.11.html  intini  a.l   2000   orthogonal frequency division multiplexing for wireless networks  standard ieee 802.11a  retrieved  march 16 2011  http  //www.create.ucsb.edu/aton/01.01/ofdm.pdf  jan  s  l hsu & w tsai  2010   development of an indoor location based service test bed and geographic information system with a wireless sensor network  sensors 10  pp  2957-2974 kessler  b   2006   direct sequence spread spectrum and you  presentation retrieved  march 14 2011  http  //www.eecs.tufts.edu/~bkesslr/ee194sdr/final/dsss.ppt  klukas  r  o julien  l dong  e cannon & g lachapelle  2004   effects on building materials on uhf ranging signals  gps solutions 8  1   pp  1-8 kolodziej  k & j hjelm  2006   local positioning systems  lbs applications and services  boca raton  fl  usa  crc press taylor & francis group  kraak  m.j & f.j ormeling  2003   cartography visualization of geospatial data  second edition  harlow  uk  pearson education limited  le  m.h.v  d saragas & n webb  2009   indoor navigation system for handheld devices  a major qualifying project report  retrieved  may 20 2011  http  //www.wpi.edu/pubs/e-project/available/eproject-102209-164024/unrestricted/indoor_navigation_system_for_handheld_devices.pdf  lee  k.-c  2007   localization systems using signal strength fingerprinting  retrieved  july 11 2011  https  //circle.ubc.ca/bitstream/handle/2429/28750/ubc_2010_fall_lee_kungchung.pdf  lim  h l kung  j.c hou & h luo  2010   zero-configuration indoor localization over ieee 802.11 wireless infrastructure  wireless networks 16  pp  405-420 lu  f & p lai  2006   a shortest path algorithm based on limited search heuristics  lecture notes on computer science  3967   pp  487-497 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 119 manodham  t  l loyola & t miki  2008   a novel wireless positioning system for seamless internet connectivity based on the wlan infrastructure  wireless personal communications 44  pp  295-309 mehmood  h  n.k  tripathi & t tipdecho  2010   indoor positioning system using artificial neural network  journal of computer science 6  10   pp  1219-1225 milioris  d  l kriara  a papakonstantinou  g tzagkarakis  p tsakalides & m papadopouli  2010   empiral evaluation of signal-strength fingerprint positioning in wireless lans  publication from institute of computer science  retrieved  july 11 2011  http  //www.ics.forth.gr/mobile/publications/mswim2010.pdf  nagi  r.s   2004   cartographic visualization for mobile applications  thesis  retrieved  march 11 2011  http  //www.itc.nl/library/papers_2004/msc/gfm/nagi.pdf  nrc  2011   dwangsom voor google om verzamelen wifi-gegevens  news article retrieved  april 19 2011   http  //www.nrc.nl/nieuws/2011/04/19/dwangsom-voor-google-om-verzamelen-wifigegevens/ ogc  open geospatial consortium   2008   open gis location services  openls   core services  retrieved  january 29 2011  http  //www.opengeospatial.org  ogc  open geospatial consortium   2008   open gis location services  openls   part 6-navigation service  retrieved  march 10 2011  http  //www.opengeospatial.org  ogc  open geospatial consortium   2010   requirements and space-event modeling for indoor navigation  how to simultaneously address route planning  multiple localization methods  navigation contexts and different locomotion types  retrieved  january 11 2011  http  //www.opengeospatial.org  reichenbacher  t  2005   chapter 10  adaptive egocentric maps for mobile users  in  l meng  a zipf & t reichenbacher  2005   map-based mobile services  theories  methods and implementations  pp  141-158 springer berlin  heidelberg  roos  t  p myllymki  h tirri  p misikangas & j sievnen  2002   a probabilistic appraoch to wlan user location estimation  international journal of wireless information networks 9  3   pp  155-163 roto  v & a kaikkonen  2003   perception of narrow web pages on a mobile phone  proceedings of the 19th international symposium on human factors in telecommunication  hft 2003   pp  205-212 sarjakoski  l.t  t koviula & t sarjakoski  2007   a knowledge-based map adaptation approach for mobile map services  lecture notes in geoinformation & cartography 2  3   pp  247-264 shum  k.c.y  q.j  cheng  j.k.y ng & d ng  2011   a signal strength based location estimation algorithm with a wireless network  2011 international conference on advanced information networking and applications  pp  509-516 sturgeon  t et al   2011   wi-fi virtual laboratory  retrieved  march 11 2011  http  //wifi.cs.standrews.ac.uk/wififrame.html  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 120 swangmuang  n & p krishnamurthy  2008   an effective location fingerprint model for wireless indoor localization  pervasive and mobile computing 4  pp  836-850 usher  j.m  & l strawderman  2010   simulation operational behaviors of pedestrian navigation  computer & industrial engineering  59   pp  736-747 vogel  l  2009   dijkstras shortest path algorithm in java  retrieved  may 1 2011  http  //www.vogella.de/articles/javaalgorithmsdijkstra/index.html wang  a.h & c.h  chen  2003   effects of screen type  chinese typography  text/background color combination  speed  and jump length for vdt leading display on users reading performance  international journal of industrial ergonomics 31  pp  249-261 wi-fi alliance  2009   wi-fi certified n  longer-range  faster throughput  multimedia-grade wi-fi networks  retrieved  march 1 2011  http  //www.wi-fi.org/register.php ? file=wp_wifi_certified_n_industry.pdf winter  2002   modeling costs of turns in route planning  geoinformatica 6  4   pp  345-361 woo et al   2011   application of wi-fi-based indoor positioning system for labor tracking at construction sites  a case study in guangzhou mtr  automation in construction 20  pp  3-13 wu  z  q zeng & x hu  2009   mining personalized user profile based on interesting points and interesting vectors  information technology journal 8  6   pp  830-838 yim  j   2008   introducing a decision tree-based indoor positioning technique  expert systems with applications 34  pp  1296-1302 yim  j  s jeong  k gwon & j joo  2010   improvement of kalman filters for wlan based indoor tracking  expert systems with applications 37  pp  426-433 zhang  d et al   2010   localization technologies for indoor human tracking  paper submitted to the 5th international conference on future information technology  futuretech   may 2010  busan  korea  retrieved  january 26 2011  http  //arxiv.org/ftp/arxiv/papers/1003/1003.1833.pdf  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 121 annexes m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 122 a tables and scripts a.1  table of overview possible sensor technologies for location based services technique  assisted  global positioning system range anywhere outdoor accuracy 6.0 m  12.0 m remarks satellite based positioning + low barrier entry  energy consumptive  assisted gps in a lesser extent   slow computation and processing time  very susceptible to reflectance and multi-paths allocation methods trilateration global system for mobile communication  gsm  / universal mobile telecommunication system  umts  infrared  ir  35.0 km cell-based standard data and telephone communication radio waves  + globally available  cell-based accuracy cell-id signal strength 0.7 m 2.5 m dependent on range of application device tagging with ids  short range of detection limits infrastructure  no penetration of materials / multipath  line of sight  signal can be disturbed easily cell-id infrared data association  irda  2.5 m 1.0 m 2.0 m same method as ir  yet with higher speed cell-id radio waves exchange between reader and tag  using a transmitter  transceiver with decoder and unique information  + real-time location systems + high-speed response time + read/write capabilities  no communication network  no positioning information  manual programming cell-id radio frequency identification  rfid  active rfid < 100 m tags contain internal power source  signalling upon entering range  toll boots  passive rfid 1.5 m 2.0 m no internal power source  only reading/writing upon entering range/connection  smartcards  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 123 technique range accuracy remarks allocation methods ultrasound dependent on environment 3.0 cm 1.0 m pulse  radar  emittance  no penetration of materials / multipath  line of sight  excessive manual intervention  bad reception with intervening noises extremely sensitive to environment trilateration bluetooth < 100 m 10 m 20m frequency hopping for connecting devices and creating personal area networks  pan   with high security + high speed data transfer  explicit links between devices required  its mobility also limits positioning and topology trilateration signal strength ultra wide band  uwb  50 m  with reduced accuracy  normal  chips about 9 m  due to cap of power amount  15 cm 4 m extremely short emittance of pulses + multipath immunity + inherent precision for toa/tdoa + low power + high speed data  nearly 10xwi-fi   large uncertainty about health effects  not everywhere legal  economically expensive trilateration signal strength ieee 802.11  wi-fi  32 m  indoor  95 m  outdoor  1m5m radio waves transfer at the 2.4 ghz band + large scale available over the world + economical viable  high power consumption  security can be weak  slightly multipath susceptible + 802.11n at 5 ghz band  range indoor 91m  outdoor 182m trilateration signal strength table ap  1 extended overview of sensor techniques used for allocation of receiver  table based on manodham et al   2008  and kolodziej & hjelm  2006  and lim et al   2010   m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 124 a.2  navigation flows the ogc  2008b  has listed a set of 30 possible cases  flows  which determines or influences the navigation  they are listed below  flow main flow 1 2 3 flow description user specifies routing preferences  user requests a route from the client a route from origin to destination  client requests current position  client returns network link  s   and possibly locations along  as origin  5 user specifies destination  6 client notes the returned network link  s   and possibly locations along  as the destination  7 client requests navigation service to provide a route from origin to destination  8 client informs user and guidance function route has been generated  9 client displays route  extension  navigation request detour 10 user requests detour re-route after starting route guidance 11 user requests traffic information and client makes the request of navigation or traffic server remark in this project detection of fingerprint 4 user supplies detour information  avoidances  client request navigation or route service to provide a new route based on detour 14 navigation client displays new route on the map 15 user accepts new route 16 client informs route guidance function a detour route has been generated extension  rerouting with new waypoints 17 while route guidance is underway  user sets additional waypoint  s  18 client returns location  s  as additional waypoint  s  19 client requests navigation  or route  service to provide a new route  from current location to original destination  including the new waypoints not yet visited 20 client informs user and route guidance function a waypointed route has been generated 21 client displays the new route extension  recovery reroute 22 user travels off current guided route geocoding service in general not applicable for indoor navigation  unless in crowded buildings  such as supermarkets 12 13 can be done to include certain points to the route m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 125 flow 23 flow description client detects user is off-route 24 client request navigation service to provide a recovery route from the current user position back onto the current route 25 client informs user and route guidance recovery route has been generated 26 client displays the recovery route extension  change of routing preference 27 user requests change of routing preferences 28 client provides list of preferences supported 29 user selects items and submits 30 client verifies selection and establish them as new current settings  and to re-plan route if necessary table ap  2 ogc navigation flows source  ogc  2008b  remark assumes that fingerprints does no longer correlate m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 126 a.3  database contents the relations of the tables can be found in figure 26 the fields are explained in the tables below  table  table_location  nodes  field fid type_exit type_room type_junction type_stairs type_elevator type_aisle building address place floor wing useraccess locprop type number boolean boolean boolean boolean boolean boolean string string string string string boolean string description fingerprint location id exit available at id ? room  s  available at id ? junction  s  available at id ? staircase  s  available at id ? elevator  s  available at id ? aisle  s  available at id ? name of building fingerprint measured address of building fingerprint measured place of building fingerprint measured floor of building fingerprint measured wing of building fingerprint measured restricted or unrestricted at point measured objects to be seen at fingerprint table ap  3 database  fingerprint locations table  table_connectivity  edges  field cid fid_link_01 fid_link_02 length direction restricted stairs elevator ramp door objects_left objects_right type number number number number string boolean boolean boolean boolean boolean string string description number of connectivity link id link between fid  1  link between fid  2  length of link in metres movement of link in reality  straight  up  down restricted or unrestricted movement movement along stairs possible ? movement along elevator possible ? movement along ramp possible ? movement through door possible ? description of objects left of the node description of objects right of the node type number number string string string string string string string boolean string description number of room id proximity of fingerprint id name of room  browsable  room in wing of building room on floor of building building name department present in room office present in room type of room  office  kitchen  toilet etc   restricted or unrestricted to staff orientation regarding topology table ap  4 database  connectivity table  table_rooms  directory  field rid fid room_name wing floor building department office room_type restricted orientation table ap  5 database  room information m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 127 table  table_poi  directory  unused  field type poid number poigroup number poisubgroup number fid number poispecification string table ap  6 database  poi information description number of poi category of poi sub category of poi poi located at fingerprint id comments on poi m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 128 a.4  database samples the tables below provide examples of the sqlite database in the form of statements in xml files  the full files can be found in the attached xml files  to be found under indoor nav/res/raw  < sql > < statement > create table if not exists table_location  fid integer primary key  type_exit boolean  type_room boolean  type_junction boolean  type_stairs boolean  type_elevator boolean  type_aisle boolean  building varchar  50   address varchar  100   place varchar  100   floor integer  wing varchar  50   useraccess varchar  50   locprop_01 varchar  200   locprop_02 varchar  200   locprop_03 varchar  200   < /statement > < statement > insert into table_location values  2001,1,0,0,0,0,0  'otb '  'jaffalaan 9 '  'delft',0,2  'unrestricted '  'outside entrance '  ''  ''  ; < /statement > < statement > insert into table_location values  2002,1,0,1,0,0,1  'otb '  'jaffalaan 9 '  'delft',0,2  'unrestricted '  'entrance '  ''  ''  ; < /statement > < statement > insert into table_location values  2003,0,0,1,0,0,1  'otb '  'jaffalaan 9 '  'delft',0,2  'unrestricted '  'path to students affairs and back exit '  ''  ''  ; < /statement > < statement > insert into table_location values  2004,0,0,0,0,0,1  'otb '  'jaffalaan 9 '  'delft',0,2  'unrestricted '  'hall to back exit '  ''  ''  ; < /statement > box ap  1 sample database for table_location < sql > < statement > create table if not exists table_mac  fid integer  mac varchar  20   rssi_avg integer  constraint table_mac primary key  fid  mac   < /statement > < statement > insert < statement > insert < statement > insert < statement > insert into into into into table_mac table_mac table_mac table_mac box ap  2 sample database for table_mac values  2001  '00:1a  a2  c0:0d:70 '  -76  ; < /statement > values  2001  '00:1a  a2  c0:0d:72 '  -78  ; < /statement > values  2001  '00:1a  a2  c0:0d:74 '  -76  ; < /statement > values  2001  '00:1a  a2  c0:0d:75 '  -77  ; < /statement > m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 129 < sql > < statement > create table if not exists table_connectivity  cid integer primary key  length integer  fid_link_01 integer  fid_link_02 integer  direction varchar  10   restricted boolean  stairs boolean  elevator boolean  ramp boolean  door boolean  objects_left varchar  200   objects_right varchar  200   < /statement > < statement > insert into table_connectivity values  20001,5,2001,2002  'straight',1,0,0,0,1  ''  ''  ; < /statement > < statement > insert into table_connectivity values  20002,5,2002,2001  'straight',1,0,0,0,1  ''  ''  ; < /statement > < statement > insert into table_connectivity values  20003,5,2002,2003  'straight',1,0,0,0,0  ''  ''  ; < /statement > < statement > insert into table_connectivity values  20004,5,2002,2006  'straight',1,0,0,0,0  ''  'info pillar  sofas '  ; < /statement > box ap  3 sample database for table_connectivity < sql > < statement > create table if not exists table_rooms  rid integer primary key  fid integer  room_name varchar  50   wing integer  floor integer  building varchar  50   department varchar  50   office varchar  50   room_type varchar  50   restricted boolean   < /statement > < statement > insert into table_rooms values  2002,2008  'survey room',2,0  'otb '  ''  'room '  'computer room',1  ; < /statement > < statement > insert into table_rooms values  2004,2008  'grote vergaderzaal',2,0  'otb '  ''  'room '  'commission',1  ; < /statement > < statement > insert into table_rooms values  2006,2009  'anneke van kootenzaal',2,0  'otb '  ''  'room '  'commission',1  ; < /statement > < statement > insert into table_rooms values  2007,2010  '0.070  secretary  ',2,0  'otb '  ''  'work office '  'office',1  ; < /statement > box ap  4 sample database for table_rooms < sql > < statement > create table if not exists table_poi  poid integer primary key  poigroup varchar  50   poisubgroup varchar  50   fid integer  poispecification varchar  50   < /statement > < statement > insert into table_poi cootenzaal '  ; < /statement > < statement > insert into table_poi board '  ; < /statement > < statement > insert into table_poi board '  ; < /statement > < statement > insert into table_poi board '  ; < /statement > values  99901  'commission rooms '  '',2009  'anneke van values  99902  'information '  '',3006  'bulletin values  99903  'information '  '',3106  'bulletin values  99904  'information '  '',3112  'bulletin box ap  5 sample database for table_poi  unused  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 130 a.5  codes for location determination the code below contains the location determination as described in section 16.3.4 the numbers to the left represents the number of lines  which are being described in the main thesis  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 public class mainscreen extends activity implements onclicklistener  string departure ; string destination ; private sqlitedatabase db ; @ override public void oncreate  bundle savedinstancestate   super.oncreate  savedinstancestate  ; setcontentview  r.layout.main  ; autocompletetextview dep1 =  autocompletetextview  findviewbyid  r.id.inputdeparture  ; roomlist roomlist = new roomlist  this  ; arraylist < string > items1 = roomlist.getallrooms   ; toast.maketext  this  `` amount of rooms loaded  `` + items1.size    toast.length_short  .show   ; arrayadapter < string > adapter1 = new arrayadapter < string >  this  r.layout.list_item  items1  ; dep1.setadapter  adapter1  ; autocompletetextview des1 =  autocompletetextview  findviewbyid  r.id.inputdestination  ; arrayadapter < string > adapter2 = new arrayadapter < string >  this  r.layout.list_item  items1  ; des1.setadapter  adapter2  ; button startnavigationbutton =  button  findviewbyid  r.id.buttonnavigationstart  ; startnavigationbutton.setonclicklistener  this  ; button startsettingsbutton =  button  findviewbyid  r.id.buttonsettings  ; startsettingsbutton.setonclicklistener  this  ; genericservice gs = new genericservice   ; // this line initiates an object  gs  for wi-fi service gs.setactivitiy  this  ; // this line lets the object know about your activity gs.addaccesspoint  `` 00:1a  a2  c0:0d:70 ''  '' 00:1a  a2  c0:0d:70 ''  ; gs.addaccesspoint  `` 00:1a  a2  c0:0d:72 ''  '' 00:1a  a2  c0:0d:72 ''  ; //add ap to listen  you can add multiple aps by using this method many times gs.addrule  `` 00:1a  a2  c0:0d:70 ''  '' 00:1a  a2  c0:0d:70 ''  rule.rule_type_wifi  90  -35  1  null  ; gs.addrule  `` 00:1a  a2  c0:0d:72 ''  '' 00:1a  a2  c0:0d:72 ''  rule.rule_type_wifi  90  -35  1  null  ; db =  new databasehelper  this  .getwritabledatabase    ; // set rules to be informed when given criteria is satisfied by using  listenwifi listener= new listenwifi  db  handler  this  ; // create listeners to catch the events thrown by the service  gs.addwifilistener  listener  ; //  and let the object know where your listener is gs.start   ; //and start to wait events  public void onclick  view v   if  v.getid   == r.id.buttonnavigationstart   edittext inputdeparture =  edittext  findviewbyid  r.id.inputdeparture  ; edittext inputdestination =  edittext  findviewbyid  r.id.inputdestination  ; if  inputdeparture.gettext   .length   == 0   toast.maketext  this  `` please input departure ''  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 131 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 toast.length_short  .show   ; return ;  else if  inputdestination.gettext   .length   == 0   toast.maketext  this  `` please input destination ''  toast.length_short  .show   ; return ;  else if  inputdeparture == inputdestination   toast.maketext  this  `` departure and destination equals ''  toast.length_short  .show   ; return ;  intent n = new intent  this  navigation.class  ; n.putextra  `` departure ''  inputdeparture.gettext   .tostring    ; n.putextra  `` destination ''  inputdestination.gettext   .tostring    ; startactivity  n  ;  else if  v.getid   == r.id.buttonsettings   intent s = new intent  this  settings.class  ; startactivity  s  ;   @ override protected void ondestroy    db.close   ; super.ondestroy   ;  //this is the place where we handle messages coming to the gui thread private final handler handler = new handler    @ override public void handlemessage  message msg   //gets parameter is the type of the message string comingmsg =  string  msg.getdata   .get  `` 2 ''  ; if  comingmsg == null   comingmsg =  string  msg.getdata   .get  `` 1 ''  ; //if there is such a message if  comingmsg ! = null   //try to separate the message again string fid  floor  wing  building  address  place  locprop ; //separation process string delims = ``  ;  '' ; //split the message into array of strings string   data = comingmsg.split  delims  ; fid = data  0  ; floor = data  1  ; wing = data  2  ; building = data  3  ; address = data  4  ; place = data  5  ; locprop = data  6  ; //use this variables to set the text now textview textbuilding =  textview  findviewbyid  r.id.currentbuilding  ; textbuilding.settext  `` at  `` + building + ``  `` + address + ``  `` + place  ; textview textfid =  textview  findviewbyid  r.id.currenttype  ; textfid.settext  `` near  `` + locprop + ``  node  `` + fid + ``  ''  ; textview textwing =  textview  findviewbyid  r.id.currentwing  ; textwing.settext  `` wing  `` + wing + ``  floor  `` + floor  ;  else  //no fid is matched !   super.handlemessage  msg  ;  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 132 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225  ; class listenwifi implements wifilistener  public static final string msg_wififound = `` wififound '' ; public static final string msg_wifilost = `` wifilost '' ; public static final string msg_wifirule = `` wifirule '' ; public static final string msg_wifilevelchanged = `` wifichange '' ; sqlitedatabase db ; handler handler ; activity activity ; listenwifi  sqlitedatabase db  handler handler  activity activity   this.db = db ; this.handler = handler ; this.activity = activity ;  private void sendmessage  string type  string str   bundle b = new bundle   ; b.putstring  type  str  ; message msg = new message   ; msg.setdata  b  ; handler.sendmessage  msg  ;  @ override public void onstatechange  wifievent event    @ override public void onapfound  wifievent event   event.getaccesspoint   .getname   ;  @ override public void onaplost  wifievent event    @ override public void onruleachieved  ruleevent event   wifimanager wifimanager =  wifimanager  activity.getsystemservice  context.wifi_service  ; wifimanager.startscan   ; list < scanresult > ls = wifimanager.getscanresults   ; //a loop to customize the query according to the measured values string queryhead = `` select fid  count  *  from table_mac where `` ; string querytail = `` group by fid '' ; //vector < string > vquery = new vector < string >   ; int counter = 0 ; string querymid = `` '' ; if  ls.size   > 0   for  scanresult sr  ls   //prepare string mac = sr.bssid ; int ss = sr.level ; if  counter == 0   querymid = ``  mac = ' '' +mac+ '' ' and rssi_avg < `` +  ss+4  + '' and rssi_avg > `` +  ss-4  + ''  '' ; // first mac with upper and lower  else  querymid += `` or  mac = ' '' +mac+ '' ' and rssi_avg < '' +  ss+4  + '' and rssi_avg > `` +  ss-4  + ''  '' ; // subsequent mac with upper and lower  counter++ ;  //end of loop scan results string finalquery = queryhead + querymid + querytail ; // query buildup int max = 0 ; int selectedfid = 0 ; cursor cursor = db.rawquery  finalquery  null  ; if  cursor.getcount   > 0   while  cursor.movetonext     m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 133 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 int fid = cursor.getint  0  ; int count = cursor.getint  1  ; if  count > max   max = count ; selectedfid = fid ;  //if some records are equal  top one is selected   if  selectedfid > 0   string query = `` select fid  floor  wing  building  address  place  locprop from table_location where fid = `` + selectedfid ; //new cursor is defined to handle new query results cursor cursorfid = db.rawquery  query  null  ; if  cursorfid.getcount   > 0   cursorfid.movetonext   ; string msg = cursorfid.getstring  0  + `` ; '' +cursorfid.getstring  1  + '' ; '' + cursorfid.getstring  2  + `` ; '' + cursorfid.getstring  3  + `` ; '' + cursorfid.getstring  4  + `` ; '' + cursorfid.getstring  5  + `` ; '' + cursorfid.getstring  6  ; sendmessage  `` 1 ''  msg  ;  else  string msg = `` ! `` ; sendmessage  `` 2 ''  msg  ;     @ override public void onaplevelchanged  wifievent event     // end of listener class box ap  6 overview of code for location determination  mainscreen.java and navigation.java  source  m yildirim  2011  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 134 a.6  codes for navigation algorithm  dijkstras algorithm  the tables/codes below provide an overview on how the scripts work  nodes and edges are being loaded via vertex.java and edge.java  in which a graph will be constructed in graph.java  finally  those three inputs are being used in dijkstraalgorithm.java  in which the calculation of the shortest path is being made  public class dijkstraalgorithm  private final list < vertex > nodes ; private final list < edge > edges ; private set < vertex > settlednodes ; private set < vertex > unsettlednodes ; private map < vertex  vertex > predecessors ; private map < vertex  integer > distance ; public dijkstraalgorithm  graph graph   // create copy of array this.nodes = new arraylist < vertex >  graph.getvertices    ; this.edges = new arraylist < edge >  graph.getedges    ;  public void execute  vertex fid_link_01   settlednodes = new hashset < vertex >   ; unsettlednodes = new hashset < vertex >   ; distance = new hashmap < vertex  integer >   ; predecessors = new hashmap < vertex  vertex >   ; distance.put  fid_link_01  0  ; unsettlednodes.add  fid_link_01  ; while  unsettlednodes.size   > 0   vertex node = getminimum  unsettlednodes  ; settlednodes.add  node  ; unsettlednodes.remove  node  ; findminimaldistances  node  ; // fid_link_01 = source  fid_link_02 = destination   private void findminimaldistances  vertex node   list < vertex > adjacentnodes = getneighbors  node  ; for  vertex target  adjacentnodes   if  getshortestdistance  target  > getshortestdistance  node  + getdistance  node  target    distance.put  target  getshortestdistance  node  + getdistance  node  target   ; predecessors.put  target  node  ; unsettlednodes.add  target  ;    private int getdistance  vertex node  vertex target   for  edge edge  edges   if  edge.getfid_link_01   .equals  node  & & edge.getfid_link_02   .equals  target    return edge.getlength   ; // length = weight in this case   throw new runtimeexception  `` should not happen ''  ;  private list < vertex > getneighbors  vertex node   list < vertex > neighbors = new arraylist < vertex >   ; for  edge edge  edges   if  edge.getfid_link_01   .equals  node  & & ! issettled  edge.getfid_link_02      neighbors.add  edge.getfid_link_02    ;   return neighbors ;  private vertex getminimum  set < vertex > vertices   m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 135 vertex minimum = null ; for  vertex vertex  vertices   if  minimum == null   minimum = vertex ;  else  if  getshortestdistance  vertex  < getshortestdistance  minimum    minimum = vertex ;    return minimum ;  private boolean issettled  vertex vertex   return settlednodes.contains  vertex  ;  private int getshortestdistance  vertex fid_link_02   integer d = distance.get  fid_link_02  ; if  d == null   return integer.max_value ;  else  return d ;   /* * returns path from source  fid_link_01  to selected target and null if no path */ public linkedlist < vertex > getpath  vertex target   linkedlist < vertex > path = new linkedlist < vertex >   ; vertex step = target ; // check if a path exists if  predecessors.get  step  == null   return null ;  path.add  step  ; while  predecessors.get  step  ! = null   step = predecessors.get  step  ; path.add  step  ;  // put it into the correct order collections.reverse  path  ; return path ;  box ap  7 code for dijkstraalgorithm.java edited after  l vogel  2009  public class graph  public final list < vertex > vertices ; public final list < edge > edges ; public graph  list < vertex > vertices  list < edge > edges   this.vertices = vertices ; this.edges = edges ;  public list < vertex > getvertices    return vertices ;  public list < edge > getedges    return edges ;   box ap  8 code for graph.java edited after  l vogel  2009  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 136 public class final final final vertex  private integer fid ; private string room_name ; private arraylist < room > rooms ; public vertex  integer fid  string room_name  arraylist < room > rooms   this.fid = fid ; this.room_name = room_name ; this.rooms = rooms ;  public int getfid    return fid ;  public string getroomname    return room_name ;  public arraylist < room > rooms    return this.rooms ;  @ override public int hashcode    final int prima = 31 ; int result = 1 ; result = prima * result +   fid == null  ? 0  fid.hashcode    ; return result ;  @ override public boolean equals  object obj   if  this == obj  return true ; if  obj == null  return false ; if  getclass   ! = obj.getclass    return false ; vertex other =  vertex  obj ; if  fid == null   if  other.fid ! = null  return false ;  else if  ! fid.equals  other.fid   return false ; return true ;  @ override public string tostring    return room_name ;   box ap  9 code for vertex.java edited after  l vogel  2009  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 137 public class edge  private final private final private final private final private final private final private final private final private final private final private final private final int cid ; vertex fid_link_01 ; vertex fid_link_02 ; int length ; string direction ; string restriction ; boolean stairs ; boolean elevator ; boolean ramp ; boolean door ; string object_left ; string object_right ; public edge  int cid  vertex fid_link_01  vertex fid_link_02  int length  string direction  string restriction  boolean stairs  boolean elevator  boolean ramp  boolean door  string object_left  string object_right   this.cid = cid ; this.fid_link_01 = fid_link_01 ; this.fid_link_02 = fid_link_02 ; this.length = length ; this.direction = direction ; this.restriction = restriction ; this.stairs = stairs ; this.elevator = elevator ; this.ramp = ramp ; this.door = door ; this.object_left = object_left ; this.object_right = object_right ;  public int getcid    return cid ;  public vertex getfid_link_01    return fid_link_01 ;  public vertex getfid_link_02    return fid_link_02 ;  public int getlength    return length ;  public string getdirection    return direction ;  public string getrestriction    return restriction ;  public boolean getstairs    return stairs ;  public boolean getelevator    return elevator ;  public boolean getramp    return ramp ;  public boolean getdoor    return door ;  public string getobject_left    return object_left ;  public string getobject_right    return object_right ;  @ override public string tostring    return fid_link_01 + `` `` + fid_link_02 ;   box ap  10 code for edge.java edited after  l vogel  2009  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 138 b background literature b.1  background information on pedestrian movements and navigation algorithms another difference with outdoor navigation  is that  indoor  pedestrian movement is often not variable in speed  making the shortest path the fastest path  usher and strawderman  2010  investigated the pedestrian movement  in where they noticed some remarkable properties   1  people move with an average speed of 1.57 m/s  5.7 km/h  for fair open places and 1.47 m/s  5.3 km/h  for narrow places  depending on the preferred walking speed  and depending on how crowded a place can be ;  2  people try to change the angular movement as limited as possible  keeping their route as smooth as possible  this implies that not always the shortest  fastest  path in indoor environments will be followed  in addition  winter  2002  researched the modelling of turn costs in route planning for the outdoor navigation  this includes the disallowance of turning in some situations  where a modality need to look for alternatives  such as driving to the nearest roundabout  make a u-turn and still drive in the desired direction  pedestrian movements are in general not restricted to such features  as they freely move from one point to another  beside physical constraints  a pedestrian is not allowed to turn when the designated space is constrained by authority  such as opening hours  the information above can be used to determine estimated times of arrival  figure ap  1 summarizes the above contents  in building a  it takes 20 units from a pedestrian to walk from one end to another end  if the building was structured as a u-shape  b   then it would take 30 units to walk  if there would be suspended corridor on another floor in this same building  c   one could consider taking the staircases  however  the travel costs for using the staircase  might depend on how the pedestrian perceives such vertical movement  for instance  if the pedestrian does not bother using the stairs  a value of 1 for one vertical movement can be assigned  ending up in a total of 3+1+12+1+3=20 units  if the pedestrian finds it annoying  a value of 5 could be assigned  ending up in a total of 3+5+12+5+3=28 units  in addition  the risk of getting lost  the second comment of usher & strawderman  2010   as stated above   might be incorporated as well  with the result that this shortest path might be inconvenient  a possible inclusion of the exterior to be used for indoor positioning and the shortest paths is recently mentioned by boguslawski  gold & ledoux  2011   sometimes  it might pay off to leave the building  and enter the same building through another door at another side  this could be the case in figure ap  1b if this would be located on the ground floor  and if exits/entrances would exist at the northern edges  one could easily walk from on and to another  if the wi-fi access points could reach that area  then it is surely possible to use such outdoor fingerprints in the model  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 139 figure ap  1 shortest paths in buildings m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 140 b.2  mobile cartography and the user the user profile has influence on the visualization and use of maps sarjakoski et al   2007   underlines the importance of user adaptive maps  according to them  the final map on mobile phones is dependent on the following parameters  use case  also to be considered for which purpose the map should serve ; level of detail  expressed in the resolution of the map ; time  the maps time stamp  the up-to-datedness  ; age  as in the age group of the user ; device  related to the capabilities and constraints of the mobile device ; centre  as in the centre point of the map ; scale  which is the display scale ; and position  which is the position of the user on the map  this assumes there is a strong correlation of the users knowledge of maps and map usage in general  it also determines which data should be displayed on the map first  sarjakoski et al   2007   proposes to use a map specification knowledge base  mskb  to store all kinds of combinations and possibilities  so the actual map representation can be adjusted accordingly  these will affect the placement and layout of  topographic features to be displayed ; points/areas/lines of interest ; level of detail ; other visualization operators  such as icon placement ; and other map visualization  such as colours and line widths  in fact  these ideas are similar as described by reichenbacher  2005   who made the following graphic interpretation  figure ap  2   on how user  information  situation  activities and the device are interrelated  figure ap  2 reichenbacher 's context model for mobile cartography as can be seen in the number of links  the user again largely defines the cartography  adaption of the application  in particular activities  information and situation  to the user is considered to be the key m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 141 factor in mobile  geographic applications  these adaptations must fit within the original intended designed application and maps  focus on specific elements on maps can be further extended by highlighting it in colour  centring the object  emphasize it with outlines  increasing the sharpness  while making the rest blurry   enhancing the level of detail of the object and by animating the object  such as blinking  size increase and rotation   reichenbacher  2005   in this project  the same interpretation and visualization can be used for texts instead  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 142 b.3  background information on cartographic rules kraak & ormeling  2003  provided renewing interesting in the cartographic rules set by bertin in 1967  which assembled existing conventionalities and practices of centuries of cartographic habits in a logical structure  the phrase how do i say what to whom and is it effective ? is the underlying principle upon successful map designing  using cartographic rules  aside from visualization of backgrounds and the map structure itself  the how involves the use of maps  symbology  texts or charts ; the what resembles the data ; the whom is the target audience ; and the effective implies to in what extent the three have to be combined for understanding  the what and the effective is being emphasized in this section  not only symbology and cartography changes with its scale  e.g  a city can be represented as a point  but also as a polygon   but the data variable itself is largely influencing how symbols should be used  data can be nominal  classification  categorical   ordinal  when a ranking can be made   interval  where variables are distinguishable from each other by numeric values  or ratio  same as interval  except with a fixed zero point   from here  six graphical variables can be used on top of the data classification  to distinguish areas  namely by differences size  lightness/colour  value   grain/texture  hue/colour  differentiation   orientation and shape  kraak & ormeling  2003  seefigure ap  3   bertin related the graphical variables with the data variables to see how effective the representation is  as shown in table ap  7 and table ap  8 figure ap  3 bertin 's geographic variables source  kraak & ormeling  2003  dashes patches x x x dots x x x ratio interval size colour value grain/texture colour dif  orientation shape ordinal nominal m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 143 x 4 3 2 7 4  4 4 4 7 2  5 5 5 8  x x x table ap  7 relation of graphic variables and visual isolation source  kraak & ormeling  2003  ratio interval ordinal nominal overall impression selection differentiation proportional distance order differentiation high middle low size colour value grain/texture colour dif  orientation shape definition  characteristic definition  implicit definition  possible perception  strong perception  weak table ap  8 information perception of cartographic information source  kraak & ormeling  2003  from the above figures  kraak & ormeling  2003  emphasizes on the constraints of human perception in cartographic visualization  for example  there is a maximum of colours humankind can perceive to easily distinguish data values  if this maximum is exceeded  it becomes much harder to do so  in the case of colour  extra psychological and cultural associations play a fundamental role in judging a map  a red colour is usually associated with something negative  except for temperatures  where this implies higher  positive  temperatures  it can also be associated with political parties or other cultural references  m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 144 c results c.1  scan results for location estimation the tables below provide information which location nodes have been obtained  the table headers indicate at which location the user/device was actually located  node remark t01 t02 t03 t04 t05 t06 t07 t08 t09 t10 t11 t12 t13 t14 t15 t16 t17 t18 t19 t20 3002 scan all 2013 3003 2013 2013 2013 2014 3201 2013 2014 2013 2014 2013 3003 2014 2013 2011 2011 2013 2013 2013 3007 scan all 3107 3007 3005 3107 3107 3005 3004 3107 3005 3010 3004 3107 3004 3107 3010 3005 3004 3005 3107 3005 3011 scan all 2001 3006 2001 3112 3009 2001 2001 3009 2001 2001 3112 2001 2014 3009 3009 3011 3009 2001 2001 3010 3101 scan all 3105 2014 2012 2011 2012 3105 2014 2012 2012 2011 2014 2012 2011 2014 3105 2014 2012 3103 3202 3001 3105 scan all 2011 2011 2011 2011 2011 2011 2011 2011 2011 2011 2011 3206 2011 3206 2011 2011 3206 2011 2011 3206 3110 scan all 2001 3009 3009 3009 3011 3010 3211 3009 3011 2001 3011 3010 2001 3011 3211 3211 3009 3211 2001 3209 3203 scan all 3205 3205 3105 3209 3209 3104 2011 3205 3205 3206 3205 3205 3205 3205 3205 3205 3205 3205 3205 3205 3209 scan all 3209 3111 3108 3206 3206 3111 3108 3206 3206 3108 3111 3111 3209 3206 3111 3209 3207 3206 3209 3206 3211 scan all 3209 3211 3111 3211 3211 3111 3209 3211 3111 3212 3211 3212 3211 3212 3211 3211 3111 3209 3209 3111 2002 scan all 2004 2004 2004 2003 2004 2004 2004 2004 2004 2004 2011 2004 2004 2004 2011 2004 2004 2011 2011 2004 2005 scan all 2011 2004 2011 2004 2004 2004 2004 2004 2004 2004 2004 2004 2011 2004 2004 2004 2004 2004 2004 2004 2008 scan all 2006 2003 2004 2003 2002 2003 2002 2003 2003 2003 2003 2004 2003 2003 2003 2003 2003 2003 2007 2002 table ap  9 scan results for all locations  best 10 macs in vicinity node remark t01 t02 t03 t04 t05 t06 t07 t08 t09 t10 t11 t12 t13 t14 t15 t16 t17 t18 t19 t20 3002 scan floor 3104 3103 3101 3003 3104 3104 3101 3101 3003 3003 3101 3104 3001 3103 3002 3104 3002 3003 3101 3002 3007 scan floor 3007 3003 3101 3013 3007 3007 3007 3105 3007 3007 3104 3007 3009 3104 3105 3007 3103 3007 3007 3007 3011 scan floor 3011 3011 3011 3011 3005 3011 3003 3003 3003 3112 3108 3108 3112 3002 3002 3108 3011 3011 3011 3002 3101 scan floor 3102 3204 3101 3003 3004 3102 3004 3207 3204 3205 3204 3004 3205 3204 3204 3204 3206 3204 3004 3204 3105 scan floor 3105 3105 3105 3105 3102 3101 3105 3102 3105 3105 3102 3105 3102 3101 3101 3105 3102 3101 3105 3101 3110 scan floor 3010 3108 3106 3109 3003 3109 3109 3003 3104 3109 3105 3109 3109 3204 3204 3104 3112 3109 3107 3109 3203 scan floor 3207 3207 3204 3207 3207 3204 3206 3205 3207 3207 3204 3206 3204 3204 3204 3206 3206 3204 3204 3204 table ap  10 scan results for wing 3 locations  only routers from same floor registered 3209 scan floor 3210 3209 3208 3209 3209 3209 3209 3205 3205 3209 3102 3205 3209 3002 3205 3209 3001 3208 3208 3210 3211 scan floor 3212 3211 3211 3201 3211 3204 3212 3211 3211 3206 3206 3204 3204 3204 3206 3201 3204 3206 3206 3203 m s c t h e s i s i n d o o r n a v i g a t i o n w i t h w i  f i f i n g e r p r i n t i n g | 145 c.2  scan results for route prediction the table below shows the outcomes for the locations provided by the device upon walking a specific route  which has been repeated three times  route 1 nodes 1 3005 3006 3007 3008 3009 3110 3210 3211 3212 located 3005 3004 3007 3009 3007 3109 3210 3211 3212 2 3101 3102 3103 3104 3106 3107 3108 3109 3110 3111 3112 located 3101 3105 3103 3101 3005 3203 3004 3109 3109 3112 3112 3 3201 3202 3203 3204 3206 3207 3208 3209 3210 3110 3111 3112 located 3105 3202 3203 3105 3206 3207 3208 3206 3107 3108 3112 3112 4 3001 3002 3003 3103 3203 3202 3201 located 3002 3002 3101 3103 3205 3101  5 3212 3211 3210 3110 3009 3010 3011 located 3212 3212 3211 3211 3009 3108 3010 route 9 11 7 7 2 nodes 1 3005 3006 3007 3008 3009 3110 3210 3211 3212 located 3007 3007 3007 3008 3006 3109 3107 3211 3212 2 3101 3102 3103 3104 3106 3107 3108 3109 3110 3111 3112 located 3101 3102 3104 3105 3106 3004 3109 3109 3204 3208 3007 3 3201 3202 3203 3204 3206 3207 3208 3209 3210 3110 3111 3112 located 3202 3202 3203 3203 3206 3207 3207 3206 3108 3108 3112 3112 4 3001 3002 3003 3103 3203 3202 3201 located 3001 3002 3003 3102 3204 3204 3101 5 3212 3211 3210 3110 3009 3010 3011 located 3212 3211 3108 3108 3009 3009 3011 route 12 9 11 12 7 7 3 nodes 1 3005 3006 3007 3008 3009 3110 3210 3211 3212 located 3006 3006 3006 3008 3007 3109 3210 3107 3107 9 2 3101 3102 3103 3104 3106 3107 3108 3109 3110 3111 3112 located 3002 3006 3102 3104 3106 3106 3006 3109 3105 3110 3112 3 3201 3202 3203 3204 3206 3207 3208 3209 3210 3110 3111 3112 located 3205 3202 3203 3203 3206 3208 3108 3108 3108 3108 3111 3112 4 3001 3002 3003 3103 3203 3202 3201 located 3001 3002 3003 3104 3204 3202 3202 5 3212 3211 3210 3110 3009 3010 3011 located 3212 3211 3107 3109 3101 3003 3002 table ap  11 scan results for 3 series of 5 different routes in wing 3 11 12 7 7 on on/off off 5 2 2 55,6 % 22,2 % 22,2 % 4 3 4 36,4 % 27,3 % 36,4 % 6 4 2 50,0 % 33,3 % 16,7 % 2 1 4 28,6 % 14,3 % 57,1 % 2 3 2 28,6 % 42,9 % 28,6 % on on/off off 4 3 2 44,4 % 33,3 % 22,2 % 4 2 5 36,4 % 18,2 % 45,5 % 5 5 2 41,7 % 41,7 % 16,7 % 3 0 4 42,9 % 0,0 % 57,1 % 4 0 3 57,1 % 0,0 % 42,9 % on on/off off 3 3 3 33,3 % 33,3 % 33,3 % 4 3 4 36,4 % 27,3 % 36,4 % 5 1 6 41,7 % 8,3 % 50,0 % 4 0 3 57,1 % 0,0 % 42,9 % 2 0 5 28,6 % 0,0 % 71,4 % 