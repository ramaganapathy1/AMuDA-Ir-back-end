evaluation of indoor positioning based on bluetooth smart technology r master of science thesis in the programme computer systems and networks erik dahlgren  hasan mahmood chalmers university of technology department of computer science and engineering goteborg  sweden  june 2014 the author grants to chalmers university of technology and university of gothenburg the non-exclusive right to publish the work electronically and in a non-commercial purpose make it accessible on the internet  the author warrants that he/she is the author to the work  and warrants that the work does not contain text  pictures or other material that violates copyright law  the author shall  when transferring the rights of the work to a third party  for example a publisher or a company   acknowledge the third party about this agreement  if the author has signed a copyright agreement with a third party regarding the work  the author warrants hereby that he/she has obtained any necessary permission from this third party to let chalmers university of technology and university of gothenburg store the work electronically and make it accessible on the internet  evaluation of indoor positioning based on bluetooth smart technology erik dahlgren hasan mahmood erik dahlgren  june 10  2014 hasan mahmood  june 10  2014 examiner  lars bengtsson chalmers university of technology department of computer science and engineering se-412 96 gteborg sweden telephone + 46  0  31-772 1000 illustration of bluetooth radio based positioning in action  bluetooth figure mark used by courtesy of bluetooth sig  the bluetooth word mark and logos are registered trademarks owned by bluetooth sig  inc department of computer science and engineering gteborg  sweden june 10  2014 abstract nowadays  positioning technologies are used in a wide variety of areas such as providing driving directions and tracking valuable goods to name a few  since the introduction of the global positioning system  gps   it has become a de facto standard for outdoor positioning applications  in contrast to this  no similar widespread technique is available for indoor positioning or in areas where gps is unavailable  extensive research have been devoted to exploring the topic based on a variety of technologies such as wi-fi  bluetooth  zigbee and ultra wideband radio  none of these have successfully made it into a widely accepted standard  although significant progress has been made  in 2010 a completely new bluetooth technology  referred to as bluetooth low energy or bluetooth smart was released that promises among other things ultra low power consumption  changed radio frequency properties and a completely new software stack  no academic work can be found that explores the usability of this new technology in the context of indoor positioning  this master thesis is the first project to evaluate the suitability and the applicability of this new technology in the context of indoor positioning  a selection of algorithms and approaches are explored  tested  evaluated and compared in a testbed scenario designed for this purpose  furthermore  the results of these tests are analyzed by examining the received signal strength indicator  rssi  behaviour  which is the parameter used as basis for the positioning approaches  the evaluation shows that bluetooth smart is a viable alternative for indoor positioning which offers widespread availability in society  reasonable accuracy and low cost deployment  the report also provides essential advice on some important pitfalls when using the technology for positioning applications  acknowledgements we would like to thank our examiner at chalmers university of technology  lars bengtsson  for his support and guidance in this work  a special thanks goes to our supervisors at cybercom sweden ab  ulf karlsson and sigursteinn reynisson for their advice and support  gratitude is also directed to tom stromberg for his support to the project  hans forsberg for introducing the idea and providing interesting discussion and expertise  and all other skilled and supporting colleagues at cybercom sweden ab  we would also like to genuinely express our deepest appreciation and gratitude to our families for their encouragement and support  finally  a big thanks goes out to everyone not mentioned by name who has ever helped directly or indirectly in this work  the authors  gothenburg 2014-06-10 abbreviations aoa  angle of arrival api  application programming interface ber  bit error rate bf  bayesian fusion ble  bluetooth low energy bse  bayes static estimation ess  effective sample size gfsk  gaussian frequency shift keying glonass  globalnaya navigatsionnaya sputnikovaya sistema gnss  global navigation satellite system grpr  golden receiver power range gps  global positioning system hci  host controller interface id  identification irr  inquiry response rate ism  industrial scientific and medical ld  laying down los  line of sight lq  link quality mac  media access control pdu  protocol data unit pkf  point kalman filter estimation rf  radio frequency rss  received signal strength rssi  received signal strength indicator sig  special interest group soc  system on chip su  standing up tdoa  time difference of arrival tof  time of flight tpl  transmit power level ttl  time to live tx  transmission contents 1 introduction 1.1 background     1.2 motivation     1.3 research questions 1.4 limitations     1.5 outline                                                                                                      1 1 2 2 3 3 2 bluetooth technology 2.1 classic bluetooth               2.1.1 discovery and pairing        2.1.2 bluetooth range           2.2 bluetooth smart               2.2.1 bluetooth smart stack        2.2.2 bluetooth smart modes       2.2.3 discovery and pairing        2.2.4 bluetooth smart range        2.3 signal parameters               2.3.1 received signal strength indicator 2.3.2 link quality              2.3.3 transmitted power level       2.3.4 inquiry response rate         2.3.5 parameters in bluetooth smart                                                                                                                                                                                                                                                               5 5 6 6 7 7 8 9 9 10 10 11 11 12 12       13 13 14 14 15 16 16                                                   3 positioning techniques 3.1 trilateration using rssi        3.2 filter technology            3.2.1 particle filter for positioning 3.3 fingerprinting              3.4 cell based positioning         3.5 triangulation              i                                                                                                                                   contents 3.6 time of flight                                   18 4 theory 4.1 trilateration                     4.1.1 positioning using rssi and triangulation 4.1.2 wi-fi and trilateration positioning     4.2 particle filters                     4.2.1 robot indoor localization          4.2.2 bayesian filtering positioning        4.3 fingerprinting                     4.3.1 fingerprinting localization for zigbee   4.3.2 bayesian fusion using fingerprints     4.4 cell based positioning                4.4.1 low-latency cell based positioning     4.5 triangulation                     4.5.1 ad hoc positioning system using aoa  4.6 signal parameters                  4.6.1 the reliability of rssi            4.6.2 inquiry response rate fingerprinting    4.7 commercial systems                 4.7.1 ibeacon                    4.7.2 estimote                   4.7.3 senionbeacon                 4.7.4 indoo.rs                    4.7.5 quuppa-haip                4.7.6 insiteo                     4.8 justifying choices                                           19 19 19 20 21 21 23 24 24 25 26 26 27 27 28 28 29 29 30 30 31 31 31 32 32           34 34 35 36 36 38 39 39 41 42 42 6 positioning results 6.1 system results                                  6.2 small area scenario                                6.3 large area scenario                                47 47 47 49 5 testbed 5.1 evaluation criteria         5.2 test environment          5.3 testbed setup            5.3.1 hardware          5.3.2 software           5.4 positioning algorithms       5.4.1 trilateration algorithm   5.4.2 iterative trilateration    5.4.3 particle filter algorithm  5.4.4 fingerprinting algorithm            ii                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           contents 6.4 characterization results        6.4.1 accuracy            6.4.2 calibration complexity     6.4.3 scalability            6.4.4 liveliness and response time 6.4.5 robustness and adaptability                                                                                                                               51 52 52 53 54 55 7 rssi analysis 7.1 rssi characteristics for bluetooth smart 7.2 static rssi measurement         7.3 rssi vs distance in bluetooth smart   7.4 rssi vs angle                7.5 rssi variance over distance        7.6 rssi conclusions                                                                                                                                57 57 58 59 64 68 68           70 70 70 72 73 74 74 75 76 77 77 8 discussion 8.1 advantages and disadvantages      8.1.1 advantages             8.1.2 disadvantages           8.2 suggested improvements          8.2.1 machine learning/self adjustment 8.2.2 additional data sources      8.2.3 hybrid solution           8.2.4 hardware considerations      8.3 proximity applications           8.4 privacy aspects of positioning                                                                                                                                                                                           9 conclusion and future work 79 9.1 conclusion                                    79 9.2 future work                                    80 bibliography 84 iii 1 introduction 1.1 background since the introduction of gps technology  services that rely on positioning and localization data have emerged in a rapid pace  today positioning technologies are used in a variety of areas such as providing driving directions  recording running routes during training and tracking valuable goods in real-time to name a few  while gps has become a de facto standard for outdoor positioning applications  no similar widespread technique is present for indoor positioning or in areas where gps is not available  the topic of indoor positioning does not lack research  several approaches and suggestions based on different technologies have been developed and introduced over the last two decades  what is common for all of them is that no approach has made any big impact within the area  a number of systems have been commercialized  produced and installed in different quantities but none of these have yet made a big penetration into society  the systems are usually proprietary and used in very small scale installations based on requirements of the specific use case  resulting in that no common universal standard such as gps exists in the area of indoor positioning  one proposed radio frequency-based  rf  technique for indoor positioning is to use bluetooth technology and provide positioning based on signal strength parameters that can be easily obtained  a major advantage of using bluetooth is that it is a technology with high penetration in society  devices such as cellphones  tablets and computers normally come equipped with the technology as standard  the large penetration rate also means that the required hardware is produced in large quantities  resulting in a very low unit cost  a bluetooth chip combined with a microcontroller is typically available for less than 5 $  research on positioning based on bluetooth has also made some progress in the past years  possibly making it a viable candidate for large scale deployment in several scenarios and applications  1 1.2 motivation chapter 1 introduction in june 2010  the specification for the bluetooth 4.0 technology was released  1   this specification introduced a new technology  named bluetooth low energy  ble  or bluetooth smart  the new technology contains some major differences compared to traditional bluetooth  a variety of new services and roles are introduced  the rf-band usage is changed  a new software stack is introduced and as can be guessed from the name  power consumption is greatly reduced to between 50-99 % of the classic bluetooth power consumption  2   a bluetooth smart device could potentially operate for years powered by a single coin cell battery  1.2 motivation indoor positioning based on traditional bluetooth has been both carefully evaluated and improved  however according to the best of our knowledge  no academic work can be found which characterises and evaluates bluetooth low energy in a positioning setting  meanwhile  commercial systems using the technology are rapidly emerging on the market promising different performance and properties  the technology and algorithms behind the commercial systems are often vaguely described and kept secret due to competition  this project thoroughly evaluates and investigates the properties of bluetooth smart and describes its suitability and applicability for providing inexpensive widely available indoor positioning  the project is based upon related theory about rf based positioning techniques and systems  the relevant techniques and approaches are evaluated within a bluetooth smart setting in a testbed scenario set up to imitate a real world practical scenario  the collected results are carefully investigated  analyzed and explained with regard to properties of the bluetooth smart technology  in addition the project provides ideas and pointers for future work within the area  1.3 research questions based on the motivation above  the following questions have been established for describing what the project depicts  when is bluetooth smart a viable choice for indoor positioning systems ? what algorithms/technologies are best suited for indoor positioning based on bluetooth smart with requirements on the following properties  accuracy ease of use/ease of installation scalability response time robustness 2 1.4 limitations chapter 1 introduction does using bluetooth smart for indoor positioning achieve more or less benefits compared to related existing systems based on wi-fi or bluetooth technology ? examples of benefits could be performance increase of the aforementioned properties  does using bluetooth smart for indoor positioning introduce more limitations compared to related existing systems based on wi-fi or bluetooth technology ? examples of limitations could be performance decrease of the aforementioned properties  what level of accuracy and precision can be expected from a positioning system relying on bluetooth smart technology ? 1.4 limitations the project has a number of limitations on the depth of the evaluation and analysis  the project does not provide an extensive analysis of antenna design or antenna characteristics  the basic antenna properties of the testbed system are briefly mentioned but no extensive investigation nor evaluation is performed  the evaluation of positioning is limited to a 2-dimensional setting considering x and y-axes for coordinates in space  meaning that multi-storey applications requiring a z-axis to describe the height of an object is not considered  the evaluations are performed in a static setting where environment and objects do not change position or setting during measurements  the measurements are performed in real life scenarios with furniture  competing rf technologies and other sources of obstacles or interference present  the evaluation does however not take people into account in the scenario  this means that a human body will never be in the way of a measurements during the evaluation  although this would most likely be the case in an actual real life scenario  furthermore  no power measurements or evaluation have been performed to investigate the improvement in the power consumption  all mentioned statements regarding power consumption efficiency have been found in related material covering the bluetooth smart technology  1.5 outline the rest of the report is structured in the following manner  chapter 2 bluetooth technology  this chapter is allocated to give an overview of bluetooth technology  bluetooth smart technology  and applicable bluetooth signal parameters suitable and unsuitable for use in rf-based positioning systems  chapter 3 positioning techniques  presents and explains the most commonly used approaches and techniques for indoor positioning  chapter 4 theory  describes related work and literature on indoor positioning and does also present information regarding related commercial systems  3 1.5 outline chapter 1 introduction chapter 5 testbed  this chapter describes the evaluation criteria used for positioning experiments  the test environment  and the hardware and software with which the testbed is implemented  chapter 6 positioning results  presents results from the positioning system evaluation described in chapter 5 chapter 7 rssi analysis  describes an investigation of the underlying rssi parameter and how it is affected by distance  angle and environmental properties  chapter 8 discussion  this chapter contains a discussion about the obtained results  and what effect they would have on an indoor positioning system  chapter 9 conclusion and future work  presents the conclusion of the evaluation and also provides pointers and advice for future work within the area  4 2 bluetooth technology 2.1 classic bluetooth bluetooth is a wireless technology allowing electronic devices to perform short range wireless communication between each other  the technology operates between 2400 to 2485 mhz divided into different channels  the specified frequencies lie within the globally unlicensed industrial scientific and medical  ism  2.4ghz band  traditionally 79 different channels have existed with 1 mhz spacing  but the specification for bluetooth smart introduces the use of 40 channels with 2mhz spacing instead  3   while the ism frequency band is unlicensed  the usage and development of bluetooth technology are regulated by the bluetooth special interest group  or bluetooth sig  the group  which has over 20 000 member companies is responsible for defining the bluetooth specification as well as to certify that developed products conforms to these specified standards  the latest specification is currently at version 4.1  released december 3  2013   previously adopted specifications can be found in  4   the specification defines a set of protocols and properties that devices may use to communicate  some are mandatory and producers of bluetooth technology enabled equipment or software must support them  while other properties are optional and manufacturers may freely choose if they want to implement them in their products  on top of the bluetooth technology protocols  different application specific profiles are implemented  the profiles are standardized and described with requirements in the bluetooth specification  a few examples of defined and commonly used profiles are  advanced audio distribution profile  a2dp   a2dp profile defines how audio streaming is performed between two devices  for example playing mp3 files from a cellphone in a wireless bluetooth enabled headset  phone book access profile  pbap   this profile defines how contact infor5 2.1 classic bluetooth chapter 2 bluetooth technology mation are transferred from one device to another  examples include transferring phone-book contacts between a cellphone and an infotainment system in a car  a/v remote control profile  avrcp   defines a profile to remotely control audio and video devices  for example sending and receiving commands such as play  pause  fast-forward  next track etc  all profiles defined in the bluetooth specification are listed in  4   2.1.1 discovery and pairing for two devices to be able to communicate a pairing is necessary to set up a bond between them  in the bluetooth technology  two device modes are supported  slave or master  a device in master role can potentially support up to 7 simultaneous connections with different slaves  although supporting that many connections is not a mandatory requirement  before a connection is established  devices must discover each other and specify what profiles are to be used  devices typically only support a small subset of all available profiles in the specification  to initiate a pairing  a master device will continuously broadcast inquiry messages which will be picked up by nearby devices that allow connections to be established  the devices that allow a connection to be made are named discoverable and they will answer to any inquiry message with a response message containing their name  what profiles they support as well as other technical information  with this information the master device can continue and initiate a pairing and establish the desired profiles  in addition connected devices can potentially change their roles from master to slave and vice versa upon agreement  2.1.2 bluetooth range bluetooth was designed to be used in short-range applications typically reaching a few meters  the effective range that can be practically achieved depends on several factors  for instance parameters such as propagation  interference  attenuation  signal reflection  antenna characteristics  transmit power  fading and obstacles  bluetooth devices are divided into three different classes which specify their maximum allowed output power which in turn significantly affect the range  the different classes  power limits and theoretical ranges are listed in table 2.1  5   class max range max transmitter output power class 1 100 m  300 ft  100 mw  20 dbm   class 2 10 m  33 ft  2.5 mw  4 dbm   class 3 1 m  3 ft  1 mw  0 dbm   table 2.1  ranges and output power of different bluetooth classes 6 2.2 bluetooth smart 2.2 chapter 2 bluetooth technology bluetooth smart in june 2010 the specification for bluetooth 4.0 was released  the specification did not only introduce improvements to the already well established bluetooth technology  it also introduced a completely new technology  bluetooth low energy or bluetooth smart  this new standard is not backwards compatible with the classic bluetooth and introduces an entirely new stack  the new standard was introduced to facilitate communication within a short range for devices that do not require large amount of data transfer  instead the main idea was to provide an efficient technology for monitoring and control applications where data amounts are typically very low  such as sending sensor values or control commands  2.2.1 bluetooth smart stack the bluetooth smart stack is as mentioned in the previous paragraph entirely new and is not compatible with the traditional bluetooth stack  it is however common that new bluetooth enabled devices support both the traditional bluetooth as well as bluetooth smart  these are commonly referred to as dual mode or smart ready devices  6   the bluetooth smart stack does inherit a number of characteristics from its predecessor  the stack is composed of two parts  the host and the controller  the controller represents the physical layer and the link layer  it is typically a small chip with a radio  which is quite commonly implemented in a system-on-chip  soc  solution  7   the host consists of the the upper layer protocols and software and runs the following services  logical link control and adaption protocol  l2cap   the l2cap layer is responsible for multiplexing data between the higher host layers and the lower control link layer  it has similarities with the l2cap protocol used in traditional bluetooth but has been optimized and streamlined for bluetooth smart  the bluetooth smart-l2cap protocol works in a best-effort manner providing no retransmission or flow control as opposed to traditional bluetooth  furthermore it does not provide segmentation or reassembly since in bluetooth smart  the higher layers are required to only send packets with sizes that fit into the l2cap maximum payload size  attribute protocol  att   the att protocol is used to send attributes between two devices communicating with each other  an attribute can be described as a sort of data-structure which gatt profiles use to send and receive data  security manager protocol  smp   the smp protocol handles key exchange and encryption tasks when links are set up  the procedure to establish a connection is done in a number of steps that require several key exchanges to take place  generic attribute profile  gatt   gatt is a framework that describes different services and profiles  the profiles are standardized by bluetooth-sig and provides specifications for data formatting when communicating with the application layer  each gatt-profile is designed for a specific functionality  some 7 2.2 bluetooth smart chapter 2 bluetooth technology examples of profiles adopted by bluetooth-sig are glucose profile  heart rate profile and proximity profile  a full list of adopted profiled is listed in  4   the gatt profiles use attribute/value pairs which are predefined for each profile  the attributes are then handled by the att protocol  generic access protocol  gap   defines procedures used for pairing and linking with other devices  the procedures are generic and the application layer can then implement different bluetooth smart modes  see paragraph 2.2.2 an illustration of the entire bluetooth smart stack is presented in figure 2.1 the communication between the host and the controller is similarly to classic bluetooth performed by a standardized host controller interface  hci  protocol  figure 2.1  block diagram picturing the bluetooth smart stack 2.2.2 bluetooth smart modes a new addition in the bluetooth smart stack compared to traditional bluetooth is the support for a completely new mode  when using bluetooth smart for certain applications it is no longer necessary to do a pairing to be able to exchange data  instead  a broadcast mode is supported where data can be sent in the advertisement channels without establishing a connection  in bluetooth smart a total of 4 different modes are supported  central  peripheral  broadcaster and observer  a complementary mode to the already mentioned broadcaster role is the observer role that receives the data that the broadcaster transmits  the central role which is similar to the traditional bluetooth master role is designed for more sophisticated devices which initiate and manage several 8 2.2 bluetooth smart chapter 2 bluetooth technology connections  the bluetooth smart specification states that a central role device may support up to infinite simultaneous connections against different peripheral devices  this is an improvement of the specification compared to traditional bluetooth which supports maximum 7 connections  although in reality  typically only a small number of simultaneous connections are supported  a peripheral device is typically a simple device that can only handle one active connection at a time against some central device  the peripheral and central device roles mean that the bluetooth smart controller must provide support for both master and slave roles  although a specific device does not have to support both of them  the different roles allow segmentation of the stack which allows for small lightweight devices to be created  which could for example only support the peripheral role  a device may support a single  several or all of the specified roles  but only one can be active at a time  2.2.3 discovery and pairing the bluetooth smart specification defines two different approaches to perform discovery of connectable nodes  active and passive scanning  in passive scanning  a central device passively listens on the advertisement channels to capture advertisement pdu packets transmitted by connectable devices  in active scanning  the central device similarly to passive scanning listens for advertisement pdu packets  when receiving a pdu packet  the device may examine what modes the advertising device supports  if the pdu packet indicates that the device is connectable or scannable  it may send a scan request packet to the device asking for more information  in bluetooth smart  three dedicated advertisement channels have been defined  37  38  and 39  8   which have been specifically allocated in the frequency spectrum to minimize collision with the most commonly used wi-fi channels 1  6 and 11 this change in advertisement behaviour means that discovery of devices may complete much faster since it is no longer necessary to scan the entire frequency spectrum  in addition to this improvement  the bluetooth smart technology also allows to define how frequently advertisement is set to take place  devices may advertise as seldom as once every 10 seconds or as fast as every 20 millisecond  this means that the time it takes to discover a device is related to the advertisement interval  a complete overview of the bluetooth smart frequencies and channels is presented in figure 2.2 similarly to traditional bluetooth  an adaptive frequency hopping mechanism is used to counter interference and fading  a gaussian frequency shift keying  gfsk  modulation is used to select which data channels are to be utilized  2.2.4 bluetooth smart range the range of bluetooth smart is similarly to traditional bluetooth dependent on transmit power as well as different interference and obstacles in the environment  although bluetooth smart was primarily designed for low energy usage  transmit power up to +10dbm is supported  typically bluetooth smart devices operate on 0db or less resulting in a peak current consumption of < 15ma  using the maximum +10dbm transmitting power gives a theoretical range of > 300m  while the more commonly used 0dbm transmit power 9 2.3 signal parameters chapter 2 bluetooth technology figure 2.2  overview of bluetooth smart channel spectrum gives a theoretical range of about 50m  9   the effect of this power classification actually means that  despite its name claiming low-energy consumption  bluetooth smart has a longer effective range than traditional bluetooth in the maximal power mode  10   this is mainly explained by the simpler modulation scheme used by the radio combined with a more restricted packet size  2.3 signal parameters in order to perform rf-based positioning  some form of characteristic is required for providing reference values  this section presents the various signal parameters available within classic bluetooth and/or bluetooth smart technology  other applicable technologies to perform indoor positioning are discussed in chapter 3  2.3.1 received signal strength indicator the received signal strength indicator  rssi  is an indication of the signal strength experienced by the receiver of a bluetooth pdu  the value is a signed 8-bit integer value which for bluetooth smart varies between -127 to 20dbm  where an increasing value indicates a stronger signal  the value can be retrieved both while scanning for devices as well as during an active connection with another device  an important difference between classic bluetooth and bluetooth smart related to this parameter is how the rssi can be obtained  in classic bluetooth two different variants was possible  the very early versions of bluetooth only allowed to retrieve the parameter during an active connection between two devices  later specifications  1.2 and later  allowed to retrieve the param 10 2.3 signal parameters chapter 2 bluetooth technology eter during inquiries  e.g without establishing a connection beforehand  in bluetooth smart this is further improved by providing rssi also when passively receiving advertisements  the possibility to retrieve it during an active connection is still preserved  to convert rssi to distance  several algorithms have been proposed  where almost all of them rely on the fact that some reference value is known beforehand  examples of this could be tx-power level of the transmitter or measured rssi at a fixed known distance  2.3.2 link quality link quality  lq  is a parameter that is available in traditional bluetooth when a connection between two devices is active  the parameter is an bit unsigned integer which is most commonly related to the average bit error rate  ber   the parameter spans the entire space of the integer and thus varies between 0 to 255 where a higher number corresponds to a better link  the value is updated continuously as packets are received  meaning that the parameter is available at the receiving end  in practice  this means that both ends will have access to it since communication usually goes both ways  there is however no guarantee that both ends experience the same lq  the bluetooth specification documents do not specify how the ber is mapped to a lq-value  the implementation of this is defined as vendor specific  2.3.3 transmitted power level class 1 bluetooth devices with a maximum power level of +20dbm provide the foundation for yet another possible parameter to link against distance called transmitted power level  tpl   the bluetooth specification mandates that devices with tx power between +4 to +20 dbm compulsorily have to perform power control  the reason for this is twofold  partly the power control is used to conserve energy when the transmitter is capable of using high power for radio output  partly the power control is used to mitigate interference  similar to rssi  tpl is represented by an 8-bit signed integer  the tpl is measured in dbm and will as a result have a maximum value of +20dbm  the minimum value is not defined  rather it is vendor specific  however  the bluetooth specification does advice that class 1 devices use power control even for values below -30dbm  11   the core of this tpl variable is thus that bluetooth chips with high output power scale down the tx effect to save power when the link is good  example of such a case could be when the communicating devices are close to each other-when the distance later grows the device will increase its tpl to compensate  based on this  it could be possible to derive a distance metric  a factor that negatively impacts the precision of tpl as parameter is that it has different step sizes for adjustment between 2 to 8 dbm  this means that if a device performs power control between +20 to -60 dbm and has a step size of 4  only 20 unique identifiers will be available for mapping to a distance   60+20  /4   11 2.3 signal parameters 2.3.4 chapter 2 bluetooth technology inquiry response rate a suggested parameter for performing indoor positioning based on bluetooth is the inquiry response rate  irr   12   the parameter is not something defined by the bluetoothspecification or received in bluetooth messages  instead the suggestion is to use the characteristic of bluetooth where inquiries are made to discover nearby devices  the nearby devices  which are set to discoverable mode will respond to such a request with an inquiry response message  the idea is that  in each location the inquiring device will receive responses from different nodes and also receive different number of responses from each node  together these two parameters form an attribute that should possibly be unique for each position in the area where positioning is to be deployed  a positioning system employing this methodology is described in more detail in paragraph 4.6.2  2.3.5 parameters in bluetooth smart in this section a number of signal parameters that could serve as potential candidates for a positioning system were described  the listed parameters are mainly based on traditional bluetooth since no studies of bluetooth smart in the context of positioning exist to this date  when it comes to bluetooth smart  the choices immediately become more limited since the protocols and stack have changed significantly  in bluetooth smart it is still possible to set up a connection between devices but this active connection is different from a traditional bluetooth connection  while in classic bluetooth the connection is always up and connected  in bluetooth smart the taken approach is to put devices in sleep or passive mode whenever possible  the master device has control of how and when the slave is allowed to transmit  this means that neither lq or tpl are normally available parameters  lq is not defined for bluetooth smart and will thus never be available for a positioning system based on the technology  tpl is not necessarily available either  instead it is quite common that devices use a fixed tx power level  it is however still possible for a user application to perform tpl if it is desirable  bluetooth smart hardware will typically support reprogramming the tx power during operation  resulting in the possibility for users to implement a tpl mechanism manually if needed  a good parameter to decide on what power level to use is however required  rssi is still available and easily accessible in bluetooth smart  both during a connection as well as when receiving broadcasts or performing scanning  it is also the parameter within bluetooth that has received the most attention and consensus to be the one best suited for positioning applications even though it is not optimal  especially in more recent research where inquiry rssi is available  13   the connection based rssi in classic bluetooth proved to be an unfavourable parameter  11  since power control mechanisms adjusted tx power during active connections  causing the value to almost always return the value 0 dbm  since the devices aimed to always stay within an optimal power range called golden receiver power range  grpr   14   this is however a factor no longer used for bluetooth smart  here the grpr is not used and rssi will reflect the power that the receiver experiences without interference from power adjustments  12 3 positioning techniques in this chapter  the most commonly used algorithms and approaches for indoor positioning systems are presented and reviewed  rf-based positioning techniques can roughly be divided into six approaches  trilateration  filter based technologies  fingerprinting  cell based positioning  triangulation and time of flight  tof   in trilateration  distances to at least three beacon nodes have to be obtained in order to estimate a position  in filter based technologies  multiple positions are generated continuously and filtered based on observations from different inputs to the system  in fingerprinting  a map is divided into a grid and different attributes are associated with each grid-cell  in cell based positioning  a specific sub-set of beacon nodes is discoverable in each interesting area segment of the environment  the triangulation approach is based on getting angles to or from some known references and use them to calculate a position  tof is used for measuring the time a signal takes for travelling to or from a reference point to the device being positioned and the distance is estimated accordingly  similar to trilateration  at least three reference points are needed  all of these techniques are explained in an easy to understand fashion in this chapter  3.1 trilateration using rssi trilateration is one of the most old and renown methods used in determining or estimating locations  it requires measurements of distances between the object for which a position is to be determined and a minimum of three reference points  the three or more reference points are considered as centers of three/several circles and the distances are treated as radii of these circles  the relative or absolute position then becomes the intersection point between these circles  as a result  an overdetermined system of at least three circle equations and two common unknown values  x  y  is obtained  thus  least square approach is employed to estimate the position of least squared error  13 3.2 filter technology chapter 3 positioning techniques in the context of wireless based positioning  the first step toward positioning is to measure distances to at least three known reference positions  in most positioning systems these reference points are made up of beacon nodes or access points  the distances can be estimated based on conversion of wireless signal parameters  popular examples of such a parameter are rssi or tof  these measurements combined with knowledge of the beacons coordinates can form the basis for trilateration  3.2 filter technology filter based technologies are a mathematical methods used for predicting or estimating a hidden or unknown variable given some observations from the system known as observable variables  the hidden variable in the context of positioning is the position of the mobile node  while the observable variables for example can consist of  measured distances to references  previously estimated position  sensor inputs such as compass or gyroscope and reference data such as orientation or movement  while the approach is not a concept dedicated to positioning  but rather used in a great variety of applications  it is very well suited for usage in positioning applications  the really useful property of the method is that it has the ability to fuse together several different data sources as input to estimate the hidden variable for output  a good example of this is presented in  15   an approach relying on an ultrasound positioning system combined with odometry readings achieves great accuracy and tracking abilities by combining data from both observable reference systems  several different mathematical concepts implementing filters exist where the two most commonly used are kalman filter  16  and monte carlo filter  17   which is usually referred to as just particle filter  in this report the emphasis is put on particle filters mainly because its advantage of being simpler to implement  it also has other advantages not directly specific to this work such as ability to represent multi-modal distributions and reduction of memory usage requirements compared to grid based approaches  14   3.2.1 particle filter for positioning within particle filters  thousands of particles are randomly and continuously generated during runtime  which in the context of indoor positioning are representations of positions  thus  the distances or differences to each of the reference beacons or reference values/data can be calculated  based on the observable variables  the particles that are unlikely to represent the current position are filtered out while particles likely to be true representations of the position are selected for calculating the estimation  the filtering process is achieved by giving weights to all particles based on how reasonable the particles values are taking observable variables into account  gradually  most of the particles will assume negligible weights and will thus no longer contribute to the estimation  while few particles will have significant weights and contribute largely in the system  to mitigate this problem  the particles with high weight are resampled while those of negligible 14 3.3 fingerprinting chapter 3 positioning techniques weights are not  meaning that probable particles are duplicated while unlikely particles are removed from the system  at initiation  no observed data is available and the first generated particles will as a consequence often be uniformly randomly distributed all over the map  later  particles are generated based on the weights of earlier particles by duplicating those of high weights only  when the number of different particles decreases significantly  new particles are generated as in the first sampling step  formally speaking  the objective of a particle filter is to compute the density of the posterior as p  xk |z1  k   it means  computing the position xk =  x y  t at time t  given the estimated positions z1  k at times prior to t this is done recursively in two steps  position prediction and position updating  in the position prediction step  if the previous estimation p  xk1 |z1  k1  is available  the current prediction can be calculated as in equation  3.1  and  3.2  z p  xk |z1  k1  = p  xk |xk1  z1  k1  p  xk1 |z1  k1  dxk1  3.1  if a markov model of order one is assumed  then p  xk |xk1  z1  k1  = p  xk |xk1   and the equation  3.1  becomes  3.2  z p  xk |z1  k1  = p  xk |xk1  p  xk1 |z1  k1  dxk1  3.2  the predicted position is the probability density function or the current likelihood of the particle xk including the coordinates and the orientation  given the previous estimated position  its orientation  and the previous trilaterated position  assuming distances to reference nodes are used   while in the position update step  the position is updated to be available for use in the estimation of next iteration  this is done based on equation  3.3  p  xk |z1  k  = 1 p  zk |xk  p  xk |zk1   3.3  where = p  zk |z1  k1  is a normalizing constant  3.3 fingerprinting this approach is performed by dividing a map into segments or grids  the approach consists of two phases  at first  a training phase or offline phase is performed to associate each segment or grid cell in the map with some unique attributes to break the symmetry among them  in the context of wireless positioning  these attributes can be signal parameters  such as rssi  irr or lq  in this phase  attributes are measured and 15 3.4 cell based positioning chapter 3 positioning techniques assigned to each segment or grid cell  for example  if rssi is used as an attribute  an average of rssi values per beacon node is computed in each segment  each fingerprint then consists of several rssi averages and the position of the map segment or the grid cell that the fingerprint belongs to  in this way  a fingerprint database is constructed  in stage two  an online phase is carried out where the actual position estimation is performed  within which  a mobile node tries to determine its position based on the database values  every time a mobile node wants to find its position  it collects measurements of the same kind of attributes stored in the offline phase and compare them against the values that are stored in the database  for example  in case when the rssi parameter is used as attribute  the mobile node collects rssi values from all the beacon nodes in its range and compares them to the fingerprints that are stored in the database  the position in question will be the one that is associated with the fingerprint of the best match or the geometric median of the positions of the k-closest n fingerprints  3.4 cell based positioning similar to the previous approach  this method consists of two phases  a training phase and an online phase  the beacon nodes are deployed in a way that makes each segment of the map covered by a different set of beacon nodes  in the training phase  the beacon nodes that cover each segment are registered and associated with it in a database  while in the online phase  the mobile node scans for any beacon node in range and stores the identifications of the discovered beacons  the discovered set is compared to other sets stored in the database and the best match is selected  in this approach  signal parameters can be utilized to break the symmetry among several segments that are covered by the same set of nodes  as an example  if two segments are covered by the same beacon nodes but with different signal strengths  the symmetry between these segments can be broken based on the signal strength  the database search can be optimized by setting up some roles and conditions  for instance  if the coverage area of a beacon node is known to be within a bigger coverage area of another beacon node  then both nodes must be in the discovered set given that the first beacon is discoverable  on the other hand  if it is known for two beacon nodes that their coverage areas do not intersect  then they can not be in the same discovered set  thus  having this information about the network and the discovered set  the search can be optimized  3.5 triangulation another approach of positioning estimation is determining the position of an object or a mobile node based on the angle of arrival  aoa  of wireless signals  there are several methods of determining aoa by a receiving node  for instance  by equipping the nodes 16 3.5 triangulation chapter 3 positioning techniques with a directional antenna  an antenna array  a compass model  or two ultrasound receivers  measuring the angle of arrival at the receiver requires that the receiver has to be aware of a reference axis  against which  the angle of an estimated straight line passing through the sender and the receiver is measured  assuming that the angles of two incoming signals from two beacons of known positions can be determined  the position can be calculated by some mathematical effort  the simplest way of calculating a position in two dimensional environment is as follows  after determining the angle of arrival from two beacons of known positions  x1  y1  and  x2  y2   the position  x  y  can be solved by equations 3.4 and 3.5  where 1 and 2 are the angles of arrival from beacons 1 and 2 respectively  18   y y1 x x1 y y2 tan  2  = x x2  3.4  yi xi tan  i  = y x tan  i   3.5  tan  1  = another triangulation method involves three beacon nodes  which are assumed as vertices of a triangle  knowing the positions of the three beacon nodes and the angles of arrival of their signals at a mobile node located inside the triangle  the mobile node can determine its position  in comparison to trilateration  triangulation measures angle of arrival of beacon nodes signals instead of measuring distances to the beacon nodes  after knowing the beacon nodes position and measuring the angle of arrival of the received signals at the mobile node  what remains is to calculate the position  the position can be determined as the intersection point of three circles where each of them passes through a pair of adjacent beacon nodes and the mobile node  least square error is also an effective tool in this kind of triangulation since in most cases angle of arrival measurements are not exact  triangulation can be reduced to trilateration in the following manner  for any pair of adjacent beacons of the three beacons that form the triangle  the angle of intersection at an interior node that is formed by two lines where each of them passes through a node of the adjacent nodes can be calculated based on the angles of arrival at the interior node  then  the position of the interior node can be determined somewhere on a circle that passes though the two adjacent beacons and the interior node  given that the positions of the beacons are known  the circles center can be determined  finally  the distance between the interior node and the center node can be calculated and utilized in trilateration  thus  three distances and beacon positions are calculated  which is exactly what is required for executing the trilateration method  19   to make triangulation applicable in indoor localization where rf-technologies such as 17 3.6 time of flight chapter 3 positioning techniques wi-fi or bluetooth are used  customizing the hardware  or more specifically the antenna is necessary  it is important to mention that los between the mobile node and each of the respective beacons against which angle of arrival is to be calculated is necessary  by using a compass  angle of arrival can be calculated more accurately since the orientation of a mobile node can be determined  3.6 time of flight this approach utilizes the propagation time of electromagnetic signals between two nodes  tof works by estimating the distance between two nodes by counting the time required for a signal to travel from a node to the other  the travel time is the difference between the time when the signal is sent and the time when the signal arrives  having in mind that rf-signal speed is close to the speed of light in vacuum  29.98cm/ns   the distance can be calculated as the speed and travel time are known/can be determined  using this approach in a time of arrival fashion requires synchronizing the transmitters and receivers clocks with very high precision since each nanosecond difference will introduce an error of 0.3m  if time difference of arrival  tdoa  is used  two transmitters sends their signals to a receiver that wants to determine its position  clock synchronization between the transmitters and the receiver is not required  instead  the clocks of the transmitters have to be synchronized as tight as possible and for as long as possible  18   another way of using tdoa is by having the node that wants to calculate its position as the transmitter and the beacons as receivers  also in the latter case  the receivers  beacons  need their clocks to be synchronized  after calculating the distances to at least three beacons  this approach can be followed by the trilateration method to determine a position  18 4 theory in order to evaluate bluetooth smart as a solution for indoor localization  several academic reports  scientific papers  and articles that focus on indoor positioning using wifi and classic bluetooth with different approaches have been extensively studied  this chapter is devoted to describe and discuss this related material  they are categorized based on the underlying positioning theory and approach in use by respective work  the chapter is concluded by presenting the choices made for this project based on the results discovered herein  4.1 trilateration with regard to the trilateration based positioning  two high quality related scientific reports  20  and  21  have been selected  they are described respectively in detail in the following subsections  4.1.1 positioning using rssi and triangulation in this subsection a bluetooth based positioning system  20  is presented  in the presented system a new addition to the bluetooth 2.1 specification was utilized  the addition is a new host controller interface  hci  command called inquiry with rssi  the new hci command allows for retrieval of rssi values of all discoverable bluetooth devices in range without the need to perform connection establishment beforehand  in the report  this interface command is called by an android os device that is to be positioned  the testing area is defined as a 6x8 meter rectangular room and the reference beacon nodes consist of four bluetooth enabled android mobile phones positioned in the four corners of the room  to obtain distances based on the measured rssi the mathematical model in equation  4.1  is used  rssi =  10n log10 d + a  19  4.1  4.1 trilateration chapter 4 theory d = 10 arssi 10n  4.2  a is here the absolute energy in dbm  which is the average rssi value measured at the distance of one meter in los to the node  the n-variable is the propagation constant which is environment dependent  by estimating a as the average of several reads  coupled with reading the rssi at predefined distances d  the propagation constant n can be solved  because of the fluctuations in rssi values  the average of several rssi reads in each distance is substituted in  4.1  to get the propagation constant n in the event that different values of n are obtained for each distance  n is calculated as the average of all obtained n values  after determining the necessary constants  the distances to the beacon nodes can be obtained by rewriting the equation as equation  4.2  and using it for trilateration to solve the position of the mobile node  in the paper  three position estimation methods are used and compared  firstly positioning based on a mathematical concept of least square estimation using matrices is used  secondly  three-border positioning  which is referred to in most books and scientific papers simply as trilateration as explained in 3.5 is used  finally  we have centroid positioning  which calculates the center of a polygon surrounded by the circles when there is more than a single intersection point between circles  in the last mentioned method  the mobile node is assumed to be outside the intersecting circles but in an area surrounded by them  this area forms a polygon  in which the vertices indicate the intersection points and the center of the polygon becomes the estimated position of the mobile node  according to the results and the plotted values  an accuracy of about 0.6 meter is achieved without considering the effect of the human body  a separate test in the work concluded that rssi values drops by about 6-8 dbm when the los is obstruted by a human body  4.1.2 wi-fi and trilateration positioning a wi-fi trilateration based indoor positioning system is presented in  21   the distance is calculated based on the percentage of signal strength from beacon nodes experienced by a mobile node  higher percentage indicates that the position of the mobile node is close to a beacon node  while lower percentage indicates the distance to the beacon node is farther away  the mathematical model shown in  4.3  is used to calculate distances based on the percentage of received signal strength  di = p  1 mi   4.3  where di and mi are the distance and the percentage for beacon node i the variable p is the maximum range of beacon i  20 4.2 particle filters chapter 4 theory after calculating distances between the mobile node and each of the beacon nodes in range respectively  trilateration is used to estimate the position in two dimensions  thus a system of linear equations for two variables can be established  this system consists of at least three circle equations  where radii and center points are the calculated distances and the positions of the beacon nodes respectively  the circle equations are linearized before solving the position  4.2 particle filters particle filters are a recurring mathematical concept that is often used in different positioning applications and scenarios  in this section two high quality scientific papers presenting positioning performed with the aid of particle filters are described  4.2.1 robot indoor localization a robot localization system that includes trilateration combined with a particle filter is presented in  14   moreover  the report uses a novel approximation method called iterative trilateration  for solving overdetermined systems  the distances are similar to previously described work calculated based on rssi and equation  4.2   the system consists of four online steps  the trilateration approach means that no training phase is required but some signal parameters are needed for calibration  in the first step  the mobile nodes that should be positioned obtain rssi measurements from beacons in range using inquiry with rssi  in step two  the system estimates distances to the beacons based on rssi to distance conversion  then in the third step  using a trilateration method referred to as iterative trilateration  the position of the mobile node is estimated  finally in the last step  a particle filter is executed taking into account the estimated trilateration positions from the previous steps with a motion model derived from the robot  in more detail  iterative trilateration consists of several steps and the goal is to solve an overdetermined system of equations iteratively  where the error is expected to be minimized in each iteration  the first step is to construct circle equations based on data from at least three beacons  this is done mathematically as described in equation  4.4    x xi  2 +  y yi  2 = d2i  4.4  di  xi  and yi are the estimated distance based on rssi to distance conversion and the coordinates of beacon i respectively  then matrices are constructed based on these equations  where the hidden variables are  s =  x2 + y 2   x  and y ignoring the first variable results in a linear system of equations which is simpler to solve for retrieving the estimated coordinates xe  and ye of the position  then the absolute error vector of the calculation can be obtained based on equation  4.5   this vector is recalculated after 21 4.2 particle filters chapter 4 theory each iteration in the iterative trilateration but divided by di  p |fi | = di  xi xe  2 +  yi ye  2  4.5  by using the error vector and taylor series approximation  the step size of the adt 1 t justments  x  y  can be calculated as x y =  b b  b f where b is calculated as in equation  4.6   the error vector together with a reduction factor s are used to update the estimated coordinates after each iteration  the reduction factor is used for convergence purpose and is decided based on practical results  which in  14  is determined to be 0.05 thus  new xe and ye are calculated by xe = xe +sx and ye = ye +sy respectively  b=  x1 xe   x1 xe  2 +  y1 ye  2    y1 ye   x1 xe  2 +  y1 ye  2    xi xe   xi xe  2 +  yi ye  2  yi ye   xi xe  2 +  yi ye  2  4.6  the theory of particle filtering is applied by using monte-carlo localization iteratively  first  an initial set of samples or particles are generated randomly  then weights are given to the particles based on how close they are to the trilateration position  the weights are normalized after every update step so that the sum of all weights is equal to one  this followed by a prediction step  where each particle is moved based on the previous position and a control vector from the robots motion model  it is important to mention that the motion model predicts the next position based on a control vector of  d 1 2   that is  rotation of 1 units followed by d number of steps then rotation of 2 units  after that  the weights are recalculated in the same way as in the first time  as a result  some particles lose weight when their probability of being likely the actual position decreases  if a particle weight becomes negligible  it will not be resampled or contribute to the position estimation in the system  to reduce the computational load on the system and to overcome the problem when the number of particles contributing to estimating the position becomes very small a threshold on the number of different particles that contribute in the system is set  when the number of these particles becomes less than the threshold  the system generates new particles by duplicating particles of high weights and discarding particles of negligible weights  an accuracy of 0.427 0.229 meters is claimed to be achieved in a scenario measuring 6x8 meters  22 4.2 particle filters 4.2.2 chapter 4 theory bayesian filtering positioning an indoor bluetooth positioning system based on particle filter and rssi with the title bayesian filtering for a bluetooth positioning system is introduced in  22   in the system a mobile node collects rssi values from several beacons within range  followed by calculation of distances to the beacons using the mathematical relationship from equation  4.7   rssi  d  = rssi  d0  + 10n log  d  + x d0  4.7  rssi  d  and rssi  d0  are here the rssi values at distances d and d0 respectively  d0 is a reference distance  n is the propagation constant  and x is a normal distributed noise with zero mean and standard deviation of  the first step within the particle filter is as always initialization  n particles are generated with random states and equal weights wi for each particle i the state consists of position  velocity  and direction  the initial weights are calculated as wi = 1/n  as the particle filter is run iteratively  weights are updated in each iteration based on a dynamic model  two different dynamic models are tested  one without velocity and another which takes into account the velocity of a human being  each particles position is updated by a gaussian distribution random number generator and a time interval  in addition  the velocity is considered when updating the direction  for instance  when a person using the system begins to walk  any direction is possible  whereas when the velocity increases to finally reach 1.3m/s  which in the article is considered the maximum velocity of a human  the trajectory is forced to follow a straight line  the motion model step is followed by an update step  where the weight wi  t  of each particle i at time instance t is updated based on the normalized weights at t 1 and the likelihood of the current estimated position using equation  4.7   after that the weights are normalized to wi  t  based on the current calculated weights  the mathematical models for weighting and normalizing steps are performed according to equations 4.8 and 4.9 respectively  wi  t  = wi  t 1  p  z  t  |xi  t    4.8  wi  t  wi  t  = pnp j=1 wj  t   4.9  these steps are followed by a resampling step  during resampling  the same number 23 4.3 fingerprinting chapter 4 theory of particles generated at the beginning will be regenerated  this step is required since when the system runs  most of the particles will gradually lose their weights and will thus no longer contribute usefully in the position estimation  possibly leading to erroneous estimation  resampling is done by duplicating particles of high weight and ignoring particles of very low weight  to determine whether resampling is necessary or not  the concept of effective sampling size described in equation  4.10  is applied to calculate and compare the size of effective samples to a threshold  if the result ne f f is less than the threshold  resampling is required  after this step  the position  the orientation  and the velocity are estimated by recalculating the weighted sum of the positions  orientations and velocity respectively that are given by the particles  np ne f f = pnp 2 i=1 w i  t  4.3  4.10  fingerprinting two fingerprinting based localization systems which both rely on signal strength data as characteristic  23   24  are reviewed in this section  4.3.1 fingerprinting localization for zigbee in  23   an indoor localization system based on zigbee wireless sensor networks and fingerprinting is presented  the system consists of three phases  a fingerprinting database creation phase  a feature identification phase  and the actual position estimation phase  in the first phase  received signal strength  rss  values are collected in each position where a fingerprint is desired  each fingerprint consists of x and y coordinates and rss values of the beacons within range  then the whole area is divided into subareas  in the second phase  a unique rss based feature is associated with each subarea  for instance  a feature of a subarea is the range of rss values of the nodes within this subarea  finally  in the estimation phase the mobile node collects rss values to select the most similar subarea based on the subarea feature  for instance  a subarea is selected if the collected rss values are within a certain rss range if we choose the selected feature to be rss range  after selecting the subarea  three fingerprints with least difference to the collected rss measurements within the subarea are selected  then the position is calculated based on the positions of the three selected fingerprints  the system is tested in two environments with three beacons in each  one of them is  41.5 x 11.5  meters with walls and obstacles  and the other is a sport hall with dimensions of  30.5 x 11.3  meters  fingerprints are collected in 70 and 60 distinct locations in the first and the second mentioned environments respectively  then  the area is divided into subareas either manually or autonomously  in the manual way  a subarea is 24 4.3 fingerprinting chapter 4 theory selected manually and the system is designed to check for a common feature  whereas if the division is autonomous  the area is divided randomly into several subareas  the last mentioned method is applicable only in open environments and can not be used in complex environments where obstacles and non-uniformly distributed objects exist  if a common feature exists  the selected area will be accepted and considered as subarea  if no common feature exists  the selected area will be reduced and analysis to find a common feature starts again  the report concludes that an accuracy between 1 to 3.5 meters is possible to achieve  4.3.2 bayesian fusion using fingerprints a method called bayesian fusion for indoor localization using bluetooth and fingerprinting is proposed in  24   as the proposed method utilizes fingerprinting  it consists of two phases  training or offline phase  and position estimation or online phase  in addition  it utilizes a motion model  in the same manner as other rssi based approaches  rssi measurements are collected at several reference points in the training phase to build the fingerprint database  each fingerprint that refers to a position consists of the coordinates of the center of that position together with beacon information for all the beacons in range  each beacon information entry consists of the rssi value of that particular beacon  the statistical mean and the variance obtained from the rssi values of that beacon  in this way  a radio map is constructed for the area that should be enabled for positioning  in the online phase  a mobile node powered by a usb connection connected to a laptop by a serial port is used  the mobile node collects rssi measurements while moving and sends them to the laptop via the serial port  the sent information is processed by an application on the laptop that estimates the positions based on the mentioned methods  when calculating the position  two approaches are used  static bayesian estimation and estimation with a motion model  in static bayesian estimation  the position is estimated based only on the current rssi measurements that are collected from beacon nodes in range  when the motion model is utilized  earlier positions and the velocity are applied in the calculations  when initializing the estimation a uniformly distributed prior such is used since no previous data is available in the firs iteration the proposed method of bayesian fusion  bf  is compared to both bayes static estimation  bse  and point kalman filter estimation  pkf   these estimations are based on gaussian distributions and the results become gaussian density functions  to use bf and pkf  an initial position is required  which is supplied by using the first obtained position from bse  in the experiment  the estimated positions in each of the three aforementioned methods are compared to the real position that is obtained by a high accuracy gps system for evaluation purposes  according to the attained results  the accuracy of using bse is about 5 meters  when using pkf  an improvement of 0.1 meters is observed  whereas  the accuracy of the proposed bf method is 4.7 meters on average  in comparison between all methods  the accuracy of bf is better than both bse and pkf with about 0.4 meters and 0.3 meters respectively  25 4.4 cell based positioning 4.4 chapter 4 theory cell based positioning in this section a cell based localization system  25  is reviewed and explained  4.4.1 low-latency cell based positioning in  25  an indoor positionung system that is based on the visibility of beacons is presented  the system consists of several short-range beacons that are deployed in an indoor environment in a way such that each beacon covers a specific segment  the coverage range of the beacons is very limited  typically reaching only a few meters  making it very likely that a moving user will discover different beacons in a short time while moving  in addition  geometric and topological relations are represented in the system as a location graph  where vertices represent locations and edges represent connectivity or neighborly features between locations and associated with weights equal to the distance between the adjacent vertices  two vertices are connected by an edge if there is a direct route between their locations that does not pass through any other location  in addition  the ranges of the beacons are expressed as sets of vertices that represent locations that the beacons cover and are connected by hyperedges  thus a beacon hypergraph is constructed  by combining the location graph and the beacon hypergraph  a beacon map is generated  furthermore  a path between two locations is represented as a sequence of locations at a sequence of discrete time points  with fixed time intervals between them  thus each two locations that are separated by only one time interval are adjacent  each mobile device contains a map of interesting locations and beacon identifications  determining the location of a device is done by using the beacon map  the previous position  and the visibility of the beacons  by taking into consideration the adjacency relationship between the locations on the map  earlier position fixes are utilized in current position estimation and the current estimated position is utilized in the subsequent estimations  in order to optimize the beacon visibility probing time and cost  a probing plan is introduced and expressed as a binary tree that is arranged based on the probability of traveling from a location to another and the probability of a location being in range of a beacon given that it is in the range of another beacon  several approaches to design the binary tree are presented in the report  based on the example used by the authors  the most optimized approach is something based on so called balanced plans  related work on the optimization of cell based positioning systems is presented in  26   the cited report focuses on the problem of beacon placement decision and presents a solution based on a greedy approach  26 4.5 triangulation 4.5 chapter 4 theory triangulation determining the position of a node using triangulation requires measuring the angle of the arrived signal  referred to as angle of arrival  one related paper using the concept has been selected  the selected paper is described and explained in the following subsection  4.5.1 ad hoc positioning system using aoa one of the triangulation based positioning systems that utilizes angle of arrival in a ad-hoc network is presented in  19   the network in this system consists of ad-hoc nodes that are able to communicate directly only with their immediate neighbor nodes within their range  further  at each node  angles can be determined against the nodes reference axis  which identifies the heading or orientation  landmarks are nodes that are aware of their positions and headings based on external references such as manual configuration  two angle measures are used in the report at each node  bearing and radial  bearing is the angle of arrival that is determined at the receiver  or in which angle the receiver sees the sender  whilst  radial is the reverse of bearing but at the sender  in other words  in what angle the sender sees the receiver  in this system  not all of the nodes are aware of their positions and their orientation  for a node to be able to calculate its position  it needs to determine the angle of arrival of signals from its direct neighbours  neighbors may also be assessed by their neighbors to calculate their positions and orientation by getting information about neighbours orientations  a node can determine the angle of arrival from two neighbours and find out one angle of the triangle constructed by the node and its two neighbours  also  a node can find out its orientation if it is aware of the orientation of one of its neighbors  as a result  nodes will find their orientations and positions gradually by propagating landmarks information  for a measurement of bearing at a node to be forwarded  the node needs two neighbors that are neighbors of each other to be present  some error avoidance is also applied  for instance  applying ttl on the propagation of packets that contain orientation information  a node determines its position by calculating the intersection point of three circles that are determined by the angle of arrival and the landmarks  more details about triangulation is presented in 3.5 the evaluated system  an ad-hoc network consisting of 1000 nodes was evaluated  all of the nodes were capable of measuring aoa and only a small part of them had initial awareness of their positions  to make the experiment more realistic  gaussian noise was applied to aoa measurements  worthwhile to mention is that the system was tested with static nodes  where the nodes were fixed or moved a negligible distances  27 4.6 signal parameters 4.6 chapter 4 theory signal parameters this section reviews two different articles regarding what parameters are suitable to use for a bluetooth based positioning system  more sources and parameters are described in paragraph 2.3 4.6.1 the reliability of rssi valuable effort has been put on evaluating the reliability and applicability of using the rssi parameters for indoor positioning  in  27  a thorough evaluation is performed examining the suitability of using rssi as parameter for positioning  the hardware that was used in the evaluation is a texas instruments cc2420 chip  the mathematical model used is in fact the same as  4.1   the a and n constants were calculated using two approaches  in the first approach  the constant a was calculated in the same way as before  namely by measuring rssi at a distance of one meter  by using a in the mathematical model with different pairs of measured rssi values and distances  several values of n could be obtained  the average of them was inserted in the mathematical model when calculating distances based on rssi  when a and n were calculated  a reference curve of the relation between rssi and distance was established  in the second approach  a linear relationship between rssi and a distance dependent value x =  10  log10 d was established and inserted in equation  4.11  rssi = nx a  4.11  later  for different rssi and x pairs  a polynomial curve fitting model was used to compute the values of n and a a test of the effect of human body on rssi was also carried out and showed that the sensitivity of rssi increased as the relative distance decreased  moreover  the rssi value was also examined while moving away from a beacon node with an average speed of 1.4m/s up to a maximum distance of 27.5m  then a mathematical relation between rssi and the distance was established  this relation was applied when calculating distances based on rssi values  the relation took into account the time when the test began and ended and the time when the rssi was read as shown in  4.12   having in mind  tmax  tmin  t  i   and rssi were known  distance d  i  could be calculated  d  i  = rssi t  i  tmax tmin  4.12  several rssi values were read at different distances and points in time  whereafter distances were calculated and compared to the actual distances in order to evaluate the reliability of rssi  four approaches were carried out to process and analyze the collected 28 4.7 commercial systems chapter 4 theory data  at first  by plotting the raw sampled data  it was shown that the rssi could not be used as a distance indication due to its high fluctuation  secondly  by taking at each time point the average of all the previously collected rssi values  the result of this approach showed that the collected data samples were smoothed  but result was still not accurate enough  in the third approach  the previous method was used but instead of treating all the previous collected samples evenly  different weights were given to the sampled rssi values  higher weights were given to previous samples which were closer to the sample that is to be calculated  the result of this approach showed that the distance could not be determined based only on rssi due to large differences between the calculated distances and the actual distances  finally  by predicting the sample at the next time point using curve fitting of all the previous collected samples  according to the outcome of this approach  the error margin of the calculated distances is minimized as the time went by and the mobile node moved further away  in the end  the authors concluded that it is unsuitable to determine distance based only on rssi measurements due to the high and unpredictable fluctuation in the calculated distances vs rssi and the large errors obtained for calculated distance vs actual distance  4.6.2 inquiry response rate fingerprinting another parameter which does not have connection to signal strength is inquiry response rate  irr   in  12  bargh et al describe a system which provides room level precision with an irr-fingerprinting approach  the irr is defined by the authors as  the percentage of inquiry responses to total inquiries  the nature of bluetooth is that a device scanning for nearby devices continuously broadcasts inquiry messages as described in section 2.1.1 a number of these inquiries will be responded to by different discoverable devices in the vicinity  this functionality is then utilized to create a map of the area that shall support positioning where the unique fingerprint is based on the fact that this irr will be different for different positions  when calibration is performed  an online phase is carried out to do the actual position estimation  during the positioning phase  inquiries are again performed to get measurements  these measurements are compared to the fingerprints in the database and the difference is calculated and used with kullbackleibler divergence  28  and the related but modified jensen shannon divergence  29  to get a position estimation  the result of the system is a positioning approach which achieves a 98 % accuracy of providing the correct position on a room level  the mentioned accuracy is achieved provided that the room in question is fully covered by nearby bluetooth beacons and that the device being positioned remains stationary for a duration of 3 minutes  4.7 commercial systems the development of bluetooth smart and related applications has made a big leap in the past two years  currently there exist commercial products on the market that at least partly rely on bluetooth smart technology to perform indoor positioning  the 29 4.7 commercial systems chapter 4 theory commercial systems are divided  both with respect to which technology is used to provide positioning but also with respect to the use case  some are focused on providing a positioning system with the aim to provide good characteristics for such an application  while other systems are more concerned with proximity rather than actual positioning  in these systems  it it not strictly necessary to provide an exact position with x and y coordinates  or latitude/longitude   instead  focus is put on location awareness  for example if a user is near a store  or if the user are standing right next to an article inside the store  in either case  the technology can then be used to provide the user with relevant information  for instance  popping up a message offering some discount to attract the user into the store  or if the user is standing next to some article  provide the user with detailed technical data/video/reviews to enhance the shopping experience  some of the existing systems also combine both these applications  as well as adding others  such as customer movement tracking  and offer a complete solution with both positioning  location aware services as well as tracking  4.7.1 ibeacon ibeacon is the name of apple incs trademarked positioning technology based on bluetooth smart technology  30   the system is not only concerned with location estimation but also interaction and engagement for retail applications as the most commonly cited use case  the system can detect when a user carrying another bluetooth smart enabled device such as a smartphone is in the vicinity  it can also send a notification or a message to the device  for example to offer a special discount depending on what department in a store the user resides in  the technology is not only designed for retail purposes and can be used in a variety of other contexts such as museums  airports  and sport events to name a few  the beacons are not primarily designed to provide high precision localization  instead distance estimation to each beacon is considered  the system defines three different range areas  immediate  a couple of centimeters   near  a few meters  and far  10+ meters   the positioning is typically made against a single beacon and will thus provide an approximate position in a large area if several ibeacons are deployed  the technology is also used as basis in systems that aim to provide high precision positioning  examples of such systems are listed in paragraphs below  although developed  trademarked and patented by apple  the technology is also available for use with googles competing android operating system as well as other systems with support for bluetooth smart  the only requirement  so far  might be subject to change  is that a registration has to be made with apples mfi-program  31   4.7.2 estimote estimotes  32  is similar to the ibeacon system and does in fact use the licensed ibeacon technology  the system consists of bluetooth smart-chips wrapped in waterproof soft silicon casing  with the motes come an application programming interface  api  which developers can use to easily develop their own tailored applications and use cases  the motes have the same properties as described for ibeacons and are mainly marketed 30 4.7 commercial systems chapter 4 theory towards retail solutions  the vendor does state that high precision localization is not the primary goal  instead the range areas defined for ibeacon are used to give an estimate location of where in a building a user is located given that the beacon position is known  4.7.3 senionbeacon senionbeacon is a positioning product from senionlab  33   the company provides indoor positioning systems which rely on sensor fusion  the senionbeacon is a bluetooth smart chip which a user installs in the area that shall support indoor positioning  then a calibration app is used by the customer to collect data samples within the area  the data together with a map are sent to senionlab which provides the customer with an api and an indoor positioning app that customers can further develop to suit their needs  the senionbeacon  although built on ibeacon technology  the beacon  much like estimote uses ibeacon technology   has focus on providing high precision real-time positioning  this is achieved by a combination of a fingerprinting-based localization system using bluetooth smart or wi-fi combined with sensor data obtained from sources such as accelerometer and compass  the calibration app which the customer uses collects a database of fingerprints that senionlabs uses to create calibration data for the positioning system  4.7.4 indoo.rs indoo.rs provides a similar system as senionbeacon with a number of differences  all of the tools needed to create  maps  positioning  etc  are already built and the customers will use the tools themselves to create a positioning system  much like the senionbeacon  the system depends on either ibeacons for a bluetooth smart implementation or wi-fi  it does also rely on the fingerprinting approach where sampling and measurements are required before the system can be used for positioning  indoo.rs guarantees an accuracy of < 5m radius in 95 % of the cases  34   the company also adds that accuracy can be inexpensively improved by adding more beacons and states 2m as a potentially achievable accuracy  4.7.5 quuppa-haip haip is an indoor positioning system that uses bluetooth smart as the core technology and exists in two different variants  35   the first is a mobile-centric system that analyze rssi parameters to determine a position  an app developed for cellphones broadcasts a special bluetooth smart request  which causes all nearby haip-locators  bluetooth smart beacons  to respond to the inquiry  when the app receives the response  a request is sent to a locator database server that responds with the position of the discovered beacons  the information about the locator position together with the rssi parameters which were received in the broadcast response allow the app to estimate a position  quuppa  the company behind the products claims an accuracy of 5-10m is achieved by the system  31 4.8 justifying choices chapter 4 theory the second variant of the system  is a network-centric solution which also uses bluetooth smart for sending radio packets and offers much better accuracy  quuppa states that customers can expect 0.3-1m accuracy which is significantly better than all related systems as of today  this technology  however  is not standardized yet and requires special tags to be functional  the system does not rely on signal strength  instead angular estimation is used where the locators beacon is equipped with an antenna capable of determining the angle of arrival of incoming radio packets  this angle together with information about locator position and the known height of the tag allow the system to estimate a position with good accuracy  the only requirement for the positioning to work is that the tag should not deviate in height of more than 1m  4.7.6 insiteo insiteo is a french company which has been working with indoor localization since 2009 the company has several interesting technology approaches pipelined  where the newest addition is an indoor-gnss  global navigation satellite system  with hardware that retransmits gps and galileo signals indoor  the new system requires almost no setup and calibration work while providing high precision accuracy better than 1 meter  36   the system will also work without these gnss repeaters and is then similar to systems like indoo.rs and senionlab  rf-signals such as wifi and bluetooth smart are fused together with internal sensors such as accelerometer  compass and gyro in a smartphone to provide indoor positioning with high precision and responsiveness  the system supports multi-storey buildings and insiteo claims to achieve an accuracy of 2 meters or better  insiteo also combines the positioning service with several other business oriented use cases such as geofencing  location aware push-messages and visitor monitoring  4.8 justifying choices this section explains and motivates the decisions and choices that have been taken based on the literature review including scientific papers  bluetooth smart documentation  and commercial products  the area of rf based indoor localization is rich with respect to documented studies and information although not in the context of bluetooth smart  the only references of bluetooth smart based positioning are the several existing commercial systems promising different properties  based on the information presented in chapter 2 it is appropriate to conclude that using rssi as parameter is the most suitable selection  of the available parameters  rssi is the one with the most examined relation to distances  rssi is also obtainable in bluetooth smart by simply receiving a broadcasted message  in other words  the choice of rssi will allow connectionless positioning possibly supporting multiple nodes without increasing rf spectrum demands  32 4.8 justifying choices chapter 4 theory when it comes to the matter of selecting positioning approaches it seems like a reasonable decision to pick trilateration as one of the approaches since it is one of the simplest  further  the literature review reveals that the concept of iterative trilateration could be an interesting choice  no literature uses the approach straightforwardly  instead it is combined with a particle filter  which fuses it with other sensor data  it would therefore be interesting to test it alongside traditional trilateration and see how much improvement it possibly adds  when it comes to the other approaches  two of them stand out when it comes to usage and presented results  namely particle filters and fingerprinting  both of the concepts are used in a wide variety of systems and implementations  of which some are mentioned in the literature review  thus fingerprinting and particle filter are added to the list of interesting positioning approaches to be evaluated in a bluetooth smart setting  another advantage of selecting these systems is that comparison against similar systems that uses other technologies such as traditional bluetooth or wi-fi is simplified  some algorithms of course have to be eliminated for the evaluation  some are eliminated because they do not offer adequate performance such as cell based approaches and irr-fingerprinting  which both only target room level accuracy  others are eliminated since they would be infeasible to actually implement in a bluetooth smart testbed  specifically the aoa and tof approaches approaches are left out  the motivation behind this is that aoa requires advanced hardware modifications adding a directional antenna or an array of antennae which is beyond the scope of this work  when considering tof  the distance between two objects is calculated based on the time the signal takes to travel from one object to the other by multiplying it by the signal speed  since signal speed is similar to the speed of light traveling in vacuum  which is about 0.3m/ns an extremely precise clock synchronization would be required  something which is not expected to be feasible using inexpensive bluetooth smart hardware in the price range of a few us dollars per unit  how the aforementioned approaches are implemented  tested and evaluated is described in chapter 5  33 5 testbed this chapter describes the evaluation criteria for evaluating bluetooth smart based positioning systems as well as the configuration and architecture for the testbed setup used for evaluation  four different positioning algorithms are evaluated  trilateration  iterative trilateration  a particle filter  and a fingerprinting approach  technical details and explanations are provided for each approach  5.1 evaluation criteria to evaluate positioning based on bluetooth smart technology  we define a set of evaluation criteria which positioning will be evaluated against  a number of important characteristics can be defined in the context of indoor localization and different types of systems comply in different degree with these characteristics  the characteristics selected as important for indoor positioning in this report are listed below  accuracy and precision  a positioning system should provide good accuracy  where the user with high probability and precision can locate himself in the environment  we emphasize that the definition of accuracy is not synonymous with the definition of precision  definitions of both concepts can be found in  37   calibration complexity  the system should be as easy as possible to install and setup  if a lot of effort is required for the system to be operational  it is not deemed to have good calibration complexity  scalability  the system should allow for easy expansion into several rooms and areas  for example if the system is installed in a certain room or area  it should require as little effort as possible to expand the area  this criterion also governs 34 5.2 test environment chapter 5 testbed the ability for the system to support several simultaneous users  e.g if the system supports expanding from 5 to 50 simultaneous users  liveliness and response time  defines how responsive the system is  for real time tracking the update rate for the positioning needs to be quite high with at most a few seconds between each update  robustness and adaptability  a positioning system should preferably be able to cope with changes in the environment without requiring extensive reconfiguration or experiencing performance degradation  examples include when furniture is moved or when an empty configured area is filled with a lot of people  accuracy and precision can be measured quantitatively by calculating the exact error for each estimation  in the evaluation of bluetooth smart in a positioning context the following data will be presented  average error for each approach in each scenario  standard deviation of estimation errors in each approach and scenario  largest error in estimation  smallest error in estimation  precision confidence  e.g with what precision is a certain accuracy achieved  the defined errors in accuracy presented is < 2m  < 3m  < 4m  < 5m and > 5m  the other four characteristics are more difficult to evaluate strictly with numbers and statistics  each of them will instead be analyzed individually based on the perceived performance in relation to the relevant characteristic  each score will be analyzed and motivated in relation to properties of bluetooth smart technology and/or relation between properties of the positioning approach and properties of bluetooth smart  it is important to emphasize that all the characteristics listed are treated independently from each other  this means that even though the system provides poor accuracy  it could still achieve high performance for all the other characteristics  it is therefore important to specify and reflect on which characteristics that are important to consider for a specific system  this project does not perform evaluation for a specific use case  rather it performs evaluation on a broad level with several characteristics  a use case may after all hold all of these criteria  or only a subset in high regard  5.2 test environment the evaluation is performed in a typical office environment at the premises of cybercom abs gothenburg office  two different scenarios are tested  a small scale scenario in a rectangular open plan office environment measuring 8x11 meters and a larger scenario 35 5.3 testbed setup chapter 5 testbed consisting of an entire wing of the office in the shape of a triangle measuring 20.5x16x25.5 meters  in both scenarios the areas is furnished although the type of furniture differs somewhat  the open plan office contains desks  chairs and filing cabinets while the wing consists of a large kitchen and an adjacent living room furnished with couches  stand tables  a conference table and kitchen furniture  a picture of each test area is presented in figure 5.1 the overview floor plans are presented in figure 5.8 the radio spectrum in the area is not free from competing technologies  a number of wi-fi networks are active in the area and it is possible that other bluetooth enabled devices are active within the premises  the environment that in no way is free from noise or obstacles represents a typical real life scenario in which an indoor positioning system could be deployed where furniture and radio transmitters are expected to in a non-negligible way affect the system performance  5.3 testbed setup the system used for evaluating the positioning approaches can be divided into two parts  hardware components and software components  this section provides a description of the components and decisions on implementing each of the two parts  5.3.1 hardware the main hardware required for evaluation is the reference bluetooth smart nodes to be deployed as beacons in the test environment and a mobile node to gather data to be used for positioning algorithms  both these components are described below  5.3.1.1 bluetooth smart beacons to facilitate the beacons  bluetooth smart chips combined with microcontrollers  software stacks and rf-components including antennae are required  currently several different system on chip  soc  solutions including all the required parts are available from electronic component vendors  the reason to use dedicated embedded systems hardware instead of using easily accessible bluetooth smart enabled smartphones is that smartphones do not yet support the bluetooth smart broadcast mode which is particularly suitable for usage as beacons  the choice of bluetooth smart-chip fell on bluegigas ble112  38  chip with an integrated 8051 microcontroller complete with an assembled 0.7mm ceramic antenna  the reason for choosing this particular soc was threefold   1  it enables really easy development of simple applications with a proprietary script language called bgscript  while several of the competing socs require a proprietary compiler from iar systems  39    2  the size of the chip is  18.15x12.05 mm  which makes it relatively easy to work with in respect to soldering and assembly   3  the chip comes with excellent documentation and support  to be able to work effectively with the relatively small soc  the decision was made to construct a printed circuit board  pcb  to allow easy access and handling  the pcb 36 5.3 testbed setup chapter 5 testbed  a  open plan office scenario  b  office wing scenario figure 5.1  visual representaion of the two test areas 37 5.3 testbed setup chapter 5 testbed figure 5.2  breakout circuit board schematic  a  circuit board design  b  printed circuit board figure 5.3  breakout board for ble112 also allowed to mount capacitors in recommended places to improve battery performance  38   the schematics of the pcb and a figure demonstrating a completely assembled beacon can be seen in figures 5.2  5.3  a   and 5.3  b   5.3.1.2 mobile node to collect data broadcasted by the beacons  a mobile node is necessary for retrieving the desired rssi measurements  the easiest solution was determined to be using a smartphone with bluetooth smart support  by coincidence  one of the authors had a sony xperia zr  c5503  running android 4.3 with support for bluetooth smart  it was decided early that calculations and evaluation should be performed on a pc  the reason for this is described further in the paragraph below but as a result of this decision  a pc is also a necessary hardware component in the testbed  5.3.2 software the software in use by the testbed can be divided into three parts  bluetooth smart beacon application  mobile node application  s  and pc applications implementing positioning approaches combined with data gathering code  the beacons application is implemented using bgscript  the same application is used throughout all evaluations in this report  the objective of the application is simple  broadcast advertisements peri 38 5.4 positioning algorithms chapter 5 testbed odically with a customized time interval which in the tests performed is set to every 0.25s  the mobile node application is an android application which exists in two simple variants  its task is to scan for bluetooth smart beacons within range  register the measured rssi value for each beacon and forward the data via wi-fi to a pc for analysis and estimation  the reason why several versions exist is because the gathering of rssi values are different for different applications in the testbed  the first version of the application simply scans for devices within range for a specific time interval  when the scan time interval is reached  data consisting of all discovered beacons mac addresses together with the measured rssi for each one is sent in a packet to a pc  a second version of the application does almost the same thing as the first  except that instead of sending data when the scan completes  the application performs several scans and then sends the average of the gathered rssi for each node based on all the scans in a packet  how many scans to perform when constructing the average value is configurable  but will typically be 20 for offline/configuration purposes and 5 for online/positioning purposes  the last part of the software suite is the program running in the pc which is used to perform the actual positioning estimations and calculations  the software tool used for data collection  implementing algorithms  evaluation and visualizing results is matlab  matlab receives udp packets sent from the mobile node containing beacon ids and associated rssi values and then runs the applicable code  the reason for using matlab instead of executing algorithms and evaluations directly in the android device is due to implementation complexity  matlab is a high level tool with extensive support for implementation of complex systems  support for saving data in several formats  api calls for common mathematical functions and competent tools to create visual reports and elements such as graphs or defining maps with coordinate systems  5.4 positioning algorithms this section presents the four implementations of positioning algorithms that are evaluated  5.4.1 trilateration algorithm the simplest approach to do positioning is to use the trilateration algorithm to estimate a position  the algorithm requires knowledge of the beacons positions to be known by the mobile node or the application that performs positioning  it also depends on measuring the distance to each beacon to be able to determine the position  the theory behind this approach is described in paragraph 3.1 and a flowchart of the algorithm is shown in figure 5.4 to estimate distance against a node based on measured rssi  equation 5.1 is used  39 5.4 positioning algorithms chapter 5 testbed rssi =  10n log10 d + a   5.1  a and n are the absolute energy in dbm and the propagation constant respectively  the equation 5.1 is rewritten to get the distance as output since we will be able to measure the rssi value  the resulting equation 5.2 is written as  d = 10 arssi 10n  5.2  which is the same equation seen in 4.1.1 and several other related reports  trilateration in this approach is combined with least square error estimation since trilateration generates an overdetermined system that is recommended to be solved precisely using the least square error method  figure 5.4  rssi based trilateration algorithm  distances are calculated based on rssi  a  and n using equation 5.2 x is the number of pairs  which is a customized value 40 5.4 positioning algorithms 5.4.2 chapter 5 testbed iterative trilateration as a further step towards a possibly more accurate positioning approach is to use the principle of iterative trilateration  to use this method  an initial estimation is required as the first input in the first iteration  which can be calculated using trilateration a single time  in each iteration the previous estimated position is updated  in addition  the difference between the rssi based distance measurement and the distance calculated based on the estimated coordinates is calculated for each beacon  based on these differences and by using taylor series approximation  the adjustment to the previous estimation can be calculated  the calculated adjustment is multiplied by a reduction factor before calculating the new estimation for convergence purpose  the steps of iterative trilateration are shown in figure 5.5 all details regarding iterative trilateration and the mathematics behind it are described in paragraph 4.2.1 figure 5.5  iterative trilateration 41 5.4 positioning algorithms 5.4.3 chapter 5 testbed particle filter algorithm a matlab implementation of a particle filter based on the theory and the concepts explained in chapter 4 has been utilized  the observable variables are the distances to the beacons that are calculated based on rssi  at the other end  the hidden variable is the position of the mobile node  compared to other related work that utilizes compasses or motion model that give observation about the orientation  the orientation information is generated randomly without utilizing a compass or a motion model  by randomly generating several thousands of particles and then testing each particle for likelihood of being accurate or not based on the observation variables  weights are given to each particle  particles that are likely to be accurate given the observations are awarded high weights  whilst those that are unlikely to be accurate given the observations are awarded low weights  the likelihood is determined as follows  the mobile node collects rssi from each beacon and calculates the distance to each beacon based on rssi  at the same time  distances between each particle and each beacon are calculated  by comparing the distances of each particle to each beacon with the distances calculated based on rssi the weight is determined  a small difference in distances will result in high weight  while a large difference will result in low weight  the filter is executed recursively over time and as a result most of the particles lose almost all their weight  which leads to the effect that they do not contribute to the positioning estimation  on the other hand  some particles gain more weight  which results in making them contribute significantly in the estimation process  consequently  the system may end up in a situation where there are very few contributing particles  by deciding a threshold on the number of contributing particles and weights  the aforementioned issue can be resolved  when the number of the significant particles decreases below a certain limit  new particles can be generated and old ones discarded  this step is called re-sampling  equally importantly  no re-sampling is required if the number of particles is above the threshold  which attenuates the load  in addition  gaussian noise is applied on the measurement estimation and move processes to account for uncertainty  a flow chart that illustrates the general steps of the particle filter in this project is presented in figure 5.6 in each recursion step  the quantity of particles of considerable weight is tested to check whether to generate new samples or not  each sampling or re-sampling step is followed bya weighting step and a normalization step  where weights are normalized for comparison purpose  in addition  in each recursion step  particles are moved in random directions and get new positions  later  the most probable particles to be accurate are considered as basis for determining the position of the mobile node  5.4.4 fingerprinting algorithm indoor positioning using fingerprinting is similar to a look up process  a mobile node collects some rssi values and then searches a database for some data that satisfies the 42 5.4 positioning algorithms chapter 5 testbed figure 5.6  particle filter same characteristics as the measured data  a database needs to be available before any positioning is performed  thus  this approach requires two phases  a training phase and a positioning phase  before the database can be created  the map of the indoor environment where the system will be deployed must be divided into several segments  it can be divided symmetrically into grids  or asymmetrically by selecting some interesting locations on the map  by deploying the beacons in a way that guarantees best coverage and signal strength diversity  the performance in terms of accuracy and precision can be increased  a description of the fingerprint algorithm for both training and positioning phases is presented in figure 5.7 in the training phase  at each segment or cell the rssi values of all the beacons in range are collected  a fingerprint thus consists of the coordinates of the center of the segment or the cell and the rssi values  where each of them is the average value of several reads and associated with a mac address or id that belongs to different beacons  as a result  a database that consists of the fingerprints is constructed  this is done simply by placing a mobile node at the center of these locations or cells for a reasonable period of time while an application that is run on the mobile node collects rssi values  the mobile 43 5.4 positioning algorithms chapter 5 testbed  a  training phase  b  positioning phase figure 5.7  fingerprinting flowchart node is an android device explained in 5.3.1.2 a flowchart that illustrates the general steps of the training phase is shown in figure 5.7  a   the number of fingerprints and the number of beacons in each fingerprint depend on the environment  on the laptop a matlab application receives the sent data and appends them to the database  the database is located in a text file that can be updated by the matlab application  whenever the training phase is completed and the database is constructed  the online phase and the positioning process can be started  in the positioning phase  a mobile node that wants to estimate its position needs to 44 5.4 positioning algorithms chapter 5 testbed collect rssi values of all the beacons in range in the same way as in the training phase  the rssi collection can be done in two ways  collecting single a rssi value per beacon  or computing the average of several measurements per beacon  choosing which method to be used depends on the real-time requirements and the update interval requirement  a flowchart that illustrates the general steps of positioning phase is shown in figure 5.7  b    a  office room  b  living room figure 5.8  environments where fingerprinting has been deployed to determine the position of the mobile node  the gathered data and each of the fingerprints in the database are compared  figures 5.8  a  and 5.8  b  show where fingerprints have been recorded in the two different environments  the comparison is done by computing the total difference between the gathered data in the online phase with each of the fingerprints in the database according to equation  5.3   n q x dif fi =  rssikonline rssikof f line  2  5.3  k=1 where diffi is the difference between a fingerprint i and the online gathered data  n is the number of rssi values in each fingerprint  which is a common value for all of the fingerprints in the database  and k is the beacon unique identifier  the next step is to calculate the coordinates of the mobile node  this is done by selecting the nearest 45 5.4 positioning algorithms chapter 5 testbed x neighbours among the fingerprints  which gives the least x diff s in the event that each fingerprint contains the coordinates of the cell or the segment that it is associated with  the position of the mobile node will be determined as the position of least total of distances to the positions of the selected fingerprints  more specifically  the x and y coordinates of the mobile node are the geometric median of the x s and ys of the selected fingerprints respectively  46 6 positioning results 6.1 system results this chapter presents the results from the testbed evaluations described in chapter 5 two different scenarios was tested  one small 8x11m office room and one large 20.5x16x25.5m triangle lounge inside the office building  6.2 small area scenario the four selected positioning approaches have been tested in 10 different positions in the office scenario  see figure 5.8  a   in each position  20 positioning estimations are done where each estimation is calculated based on the average rssi value from all beacons in the vicinity  to calculate each single estimation  the average rssi is based on 5 single measurements  this means that each average error  avgerr  and standrad error deviation  sterde  is derived from 100 datapoints  20 unique position estimations   finally the average error and error deviation combining all positions for each approach is calculated  the reason for using the average rssi instead of basing the analysis on single readings is to mitigate the effect of fluctuation in rssi values  the results of the measurements are presented in table 6.1 it is important for analysis purposes to know that los is always guaranteed in this scenario  in addition to the average error in estimations  the least and the worst error for each approach and position are presented and compared to each other  the result of this comparison is presented in table 6.2 to give a view of outliers for each approach  as can be concluded from the tables 6.1 and 6.2  the results differ in accuracy significantly between approaches but also from position to position for the same approach  when it comes to the small office scenario  the conclusion that can be drawn is that the 47 6.2 small area scenario coord  iter  chapter 6 positioning results particle  tril  fp  x  y  sterde avgerr sterde avgerr sterde avgerr sterde avgerr  8.9,3.6  0.318 5.744 0.107 2.446 0.068 2.426 1.285 2.401  8.8,2.1  0.316 7.063 0.064 3.670 0.081 3.230 0.763 4.002  6.9,2.9  0.478 4.209 0.031 1.870 0.152 1.421 0.505 3.037  6.9,5.9  0.616 4.656 0.132 3.356 0.839 3.312 0.620 1.553  5.3,1.3  0.269 3.227 0.137 2.130 0.386 2.417 0.832 2.421  3.7,4.8  0.691 2.481 0.303 1.087 3.130 3.042 0.775 1.914  5.6,6.4  0.346 2.556 0.067 1.813 0.237 1.898 1.042 3.039  1.9,4.8  0.319 1.799 0.168 3.626 1.129 4.758 1.451 3.846  2.9,2.9  0.354 1.030 0.033 1.971 0.215 2.502 0.895 3.023  2.1,7.0  0.876 4.214 0.338 1.404 2.297 3.716 1.111 2.319 total 0.458 3.6980 0.138 2.337 0.853 2.872 0.928 2.756 table 6.1  standard error deviation and average error of 4 approaches in 10 different positions in a room with size of 11x8 meters  where iter means iterative trilateration  particle means particle filter  tril means trilateration  fp means fingerprinting  sterde means standard error deviation  and avgerr means average error  the first two columns are the real x and real y coordinates particle filter approach provides the best accuracy and least estimation error in comparison to the other approaches  the worst approach with quite significant margin is the iterative trilateration approach  finally the confidence of different accuracy intervals are presented in table 6.3 this table confirms the previous conclusion which presented the particle filter approach as the one providing best performance with regard to precision and accuracy  it is worth pointing out that the trilateration and particle filter appraoches provide similar results for the different intervals  48 6.3 large area scenario coord  chapter 6 positioning results iter  particle  trilat  fp  x  y  best worst best worst best worst best worst  8.9  3.6  5.149 6.467 2.307 2.718 2.247 2.503 0.985 4.866  8.8  2.1  6.403 7.720 3.555 3.849 3.072 3.374 1.905 5.218  6.9  2.9  3.276 5.176 1.759 1.905 1.050 1.633 1.782 3.821  6.9  5.9  3.366 5.784 3.020 3.548 2.356 5.479 0.801 3.593  5.3  1.3  2.844 3.910 1.969 2.551 1.194 2.908 2.150 4.854  3.7  4.8  1.359 3.671 0.208 1.361 0.752 13.169 0.880 4.213  5.6  6.4  2.035 3.157 1.737 2.056 1.557 2.275 1.099 3.883  1.9  4.8  0.784 2.344 3.343 3.914 3.527 8.153 0.778 5.459  2.9  2.9  0.316 1.875 1.912 2.032 2.128 2.875 1.819 4.772  2.1  7.0  3.775 7.710 0.878 1.889 0.369 8.825 1.278 6.032 table 6.2  distances between best and worst estimated positions and the actual positions in 10 different positions in a rectangular room with dimensions of 11x8 meters  where iter means iterative trilateration  particle means particle filter  trilat means trilateration  and fp means fingerprinting  the real coordinates are presented in the first column error in estimated position algorithm < 2m < 3m < 4m < 5m > 5m iter 21.4 % 50 % 64.3 78.6 % 21.4 % tril 21.4 % 50 % 71.4 % 85.7 % 14.3 % particle 28.2 % 67,5 % 92.5 % 100 % 0 % fp 21.4 % 50 % 64.3 % 85.7 % 14.3 % table 6.3  confidence for positioning accuracy in 8x11m office scenario 6.3 large area scenario similarly  to the small area scenario tests has also been performed in a larger environment  see figure 5.8  b   the new environment is a triangle shaped room with an area of 202 2 square meters  the room is partially separated by a wall in the middle  the setup is presented in figure5.8  b  where the mentioned wall is marked by a yellow line  five beacon nodes are placed in the positions represented by red circles  similar to the small office scenario in 6.2  the standard error deviation  average error  best and worst estimated positions and accuracy confidence are presented in tables 6.4  6.5 and 6.6 49 6.3 large area scenario chapter 6 positioning results respectively  important to note for analysis purposes is that in this scenario  los is not guaranteed  instead it is often the case that at least one beacon is hidden behind a wall or some other obstacle  according to the the results in this scenario  the fingerprint approach gives with signifcoord  iter  particle  trilat  fp  x  y  sterde avgerr sterde avgerr sterde avgerr sterde avgerr  2.9,14.0  0.424 8.042 0.416 12.888 1.670 7.906 2.837 3.810  1.2,12.0  0.628 8.281 0.205 9.853 0.349 7.571 1.352 3.623  1.3,8.0  0.343 1.127 0.159 7.519 0.191 5.747 0.249 1.936  14.5,3.2  0.251 8.542 0.089 9.053 0.243 6.463 0.856 2.632  4.0,9.0  0.448 3.083 0.139 6.540 0.825 3.176 0.826 1.858  4.0,5.0  0.416 3.322 0.441 3.461 0.364 2.963 0.878 4.202  7.1,9.0  0.298 6.610 0.168 6.378 0.156 1.584 1.110 2.568  10.2,4.1  0.166 4.431 0.088 3.019 1.053 3.360 0.654 1.331  10.3,8.5  0.604 8.425 0.174 7.130 0.598 2.893 1.759 1.815  7.1,4.0  0.401 1.939 0.326 3.164 1.270 3.622 1.949 3.350 total 0.398 5.398 0.221 6.901 0.672 4.529 1.247 2.713 table 6.4  standard error deviation and average error of 4 approaches in 10 different positions in a triangle shaped room with with an area of about 202 square meters  where iter means iterative trilateration  particle means particle filter  trilat means trilateration  fp means fingerprinting  sterde means standard error deviation  and avgerr means average error  the real coordinates are presented in the first column icant margin the best accuracy and precision amongst the tested approaches  the worst approach is no doubt the particle filter which gives an average error in estimation close to 7m  the results are further confirmed looking at the confidence for different accuracy intervals  the particle filter does only provide accuracy better than 5m in 24 % of the estimations while the same accuracy is achieved in 85 % of the estimations for fingerprinting  50 6.4 characterization results coord  iter  chapter 6 positioning results particle  trilat  fp  x  y  best worst best worst best worst best worst  2.9,14.0  7.324 8.744 11.857 13.251 5.738 13.924 0.233 11.281  1.2,12.0  7.296 9.156 9.511 10.168 6.865 7.975 1.147 6.981  1.3,8.0  0.395 1.724 6.986 7.657 5.360 6.044 1.538 2.142  14.5,3.2  8.134 8.895 8.795 9.209 5.911 6.880 1.344 3.870  4.0,9.0  2.411 4.159 6.113 6.655 0.087 3.755 0.745 3.569  4.0,5.0  2.555 3.992 2.042 3.755 2.102 3.422 2.553 6.846  7.1,9.0  5.850 7.064 5.822 6.512 1.366 2.052 0.547 5.548  10.2,4.1  4.054 4.788 2.799 3.171 2.437 6.399 0.477 3.184  10.3,8.5  7.471 9.511 6.822 7.491 1.307 3.905 0.583 6.816  7.1,4.0  1.065 2.579 2.095 3.492 2.034 8.381 0.233 6.893 table 6.5  distances between best and worst estimated positions and the actual position in 10 different positions in a triangle shaped room with an area of about 202 square meters  where iter means iterative trilateration  part means particle filter  tri means trilateration  and fp means fingerprinting  the real coordinates are presented in the first column error in estimated position algorithm < 2m < 3m < 4m < 5m > 5m iter 7.7 % 23.1 % 21.1 % 46.2 % 53.9 % tril 7.7 % 7.7 % 38.5 % 61.5 % 38.5 % particle 7.7 % 21,5 % 22.7 % 23.5 % 76.5 % fp 23.1 % 69.2 % 84.6 % 84.6 % 15.4 % table 6.6  confidence intervals for positioning in 16x20.5m scenario 6.4 characterization results based on the evaluation criteria in chapter 5.1 the following subsections describes the achieved results and conclusions for each of the characteristics  each characteristic is evaluated and motivated based on the properties of bluetooth smart technology and properties connected to each positioning approach  for each category a five-point score system is used  excellent  very good  good  fair  poor  excellent of course means that an approach provides great performance for the characteristic and poor would respond to very bad performance for the characteristic  if further mapping between a score and 51 6.4 characterization results chapter 6 positioning results the characteristic is required  it is defined for each subsection respectively  6.4.1 accuracy several interesting conclusions can be found in the performed measurements  first of all  no single approach provides the best results for both scenarios  in the small scenario with los  the particle filter approach achieved the best performance with regard to accuracy and precision whilst in the large scenario the fingerprint approach outclassed the other tested approaches  interesting to notice is that the fingerprinting approach was the only one who scored a quite consistent performance with an average error of 2.7m in both scenarios  the other approaches experienced significant performance degradation in the larger scenario where los was not guaranteed  interestingly the iterative trilateration approach which was tested mainly for comparison with standard trilateration performed worse in both scenarios  the performance related to particle filter is also interesting  in the small scenario with los it was the best approach while in the large scenario it attained the worst performance  the results on a five-point scale  excellent  very good  good  fair  poor is presented in table 6.7 the mapping are defined as follows  excellent  < 2m  very good < 2.5m  good  < 3m  fair  < 4m and poor  > 5m  accuracy and precision performance algorithm small scenario large scenario iterative trilateration fair poor trilateration good poor particle filter very good poor fingerprinting good good table 6.7  accuracy for different positioning approaches 6.4.2 calibration complexity considering the calibration complexity criteria  a common calibration process among all of the tested approaches except fingerprinting is the fact that they require calculation of the propagation constant and the average rssi in dbm at 1 meter before putting the system into mission  this is because all these approaches are dependent on converting the measured rssi value into a distance  this calibration step can be considered very lightweight and could possibly be automated in production  measuring the rssi at one meter to determine a and later do a couple of more measurements at different distances to find an acceptable value for n both of these values can later be programmed into the advertisement message  putting minimal effort for central configuration of the system or the need for keeping a database to store these values  the only thing the positioning really has to know about the reference beacons is their position in the scenario  since 52 6.4 characterization results chapter 6 positioning results all beacons require manual configuration  the performance is not considered excellent  it would have been more advantageous if all beacons could be deployed with the same configuration  but nevertheless the conformance with the complexity characteristic must be considered very good for all the three approaches requiring the same configuration effort  when it comes to the fingerprinting approach the picture is a bit different  this approach requires quite significant manual effort which not necessarily can be automated very easily  an entire map consisting of unique characteristics  which in this project is average rssi for different locations needs to be created  this configuration step is not considered complex or complicated but it is time consuming  the configuration can be simplified  collecting fingerprints directly in a smartphone and measuring coordinates with for example a laser range finder  as a result the calibration performance for fingerprinting can be considered adequate since even if it is demanding in comparison with the other approaches  it is not a factor that in itself would hinder the deployment of a fingerprinting based positioning system  the calibration performance for all approaches are listed in table 6.8 calibration performance algorithm score iterative trilateration very good trilateration very good particle filter very good fingerprinting fair table 6.8  score related to calibration for different positioning approaches 6.4.3 scalability the scalability characteristic can be divided into two separate parts  one that concerns how the system would be able to scale with regard to the number of users  e.g how complex would it be to scale from 5 to 50 to 500 simultaneous users ? the other part is how well and easy will the system scale if the configured area is to be expanded into multiple rooms or a larger area  the resulting scalability performance for all the approaches and properties are listed in table 6.9 the first property regarding support for an increasing amount of users is the same for all approaches  all approaches relies on reading rssi values from advertisements for position determination  this is done by passively scanning for advertising beacons as described in paragraph 2.2.3 since the scanning is passive  an increasing amount of users will not have any effect on the system or the rf-spectrum  resulting in an excellent compliance with this property for all approaches  53 6.4 characterization results chapter 6 positioning results the second property related to scalability does introduce some differences between approaches  again the fingerprinting approach stands out compared to the others which have common performance also for this characteristic  in the case of fingerprinting  if the covered area should be expanded new beacons will be deployed and the database with fingerprints has to be expanded to also cover the new areas  the problem here comes in the case where beacon coverage areas overlap  this would render the old database entries a poor match  especially if the overlap is large  as a result  it might be the case that the entire configuration would have to be done from scratch  a fact which compensates for this disadvantage  is the fact that expanding the approach to cover several rooms or a larger area instead of only the one already configured will not result in any performance degradation for accuracy and precision  from the tests performed it can be concluded that lack of los will not affect the system negatively  these properties combined for the fingerprinting approach leads to the conclusion that the conformance to the scalability characteristic can be considered fair for fingerprinting  when it comes to expanding the other approaches to cover a larger area than what is already configured  the amount of effort is at first sight minimal  the only operation required would be to update the application with the positions of the newly deployed beacons  there is however a pitfall for this property which is not directly connected to scalability although it has a major impact on this characteristic  the fact that when los is no longer available the accuracy of the system decreases significantly  this means that if beacons are deployed in new neighboring rooms  a device positioning in an existing room will acquire the rssi through the wall resulting in significant performance degradation  something which is exactly what was seen in the large tested scenario in the testbed  as a result  trilateration  iterative trilateration and particle filter can all be considered having poor performance in conforming to the scalability characteristic  scalability performance algorithm increase in number of users area expansion iterative trilateration excellent poor trilateration excellent poor particle filter excellent poor fingerprinting excellent fair table 6.9  score related to scalability for different positioning approaches 6.4.4 liveliness and response time the response time of the system is defined as how fast new position estimations can be generated  since all tested approaches rely on the same data for calculating a position  54 6.4 characterization results chapter 6 positioning results all tested approaches achieve the same conformance with respect to this characteristic  in bluetooth smart  three dedicated advertisement channels are defined  37,38  and 39  8   the time it takes to find all beacons in the vicinity is as a result of this dependent on with what time interval the beacons are programmed to perform advertisement  since the beacons can advertise several times per second  a very good response time can be achieved  collisions in the radio spectrum are handled automatically on a low level by the bluetooth stack described in paragraph 2.2.3 as a result  no issues related to collision was observable in the tests  it was possible to discover all testbed beacons and gather rssi measurements as well as discover other beacons not belonging to the testbed in less than a second  resulting in a very good conformance to the liveliness characteristic  the results are outlined in table 6.10 response time performance algorithm liveliness and response time iterative trilateration very good trilateration very good particle filter very good fingerprinting very good table 6.10  score related to response time for different positioning approaches 6.4.5 robustness and adaptability when it comes to adaptability and robustness  all the approaches again share the same property of relying on rssi  the evaluation of this characteristic is thus completely related to the robustness of rssi  it is worth mentioning that fingerprinting does not rely on rssi exactly in the same way as the other approaches which relies on converting the measured rssi into a distance  but both approaches will be very sensible to eventual fluctuations in the rssi parameter.to be able to draw conclusions for this characteristic it is thus required to further evaluate the rssi properties  the result which is based on the analysis performed chapter 7 is that all approaches has poor conformance with the robustness characteristic  the result is outlined in table 6.11  55 6.4 characterization results chapter 6 positioning results robustness performance algorithm robustness and adaptability iterative trilateration poor trilateration poor particle filter poor fingerprinting poor table 6.11  score related to robustness for different positioning approaches 56 7 rssi analysis this chapter presents the characteristics for measured rssi values which is central when performing localization with bluetooth smart technology  the section begins with a brief description of what characteristics are expected in relation to related work and literature on rf-based positioning  this is followed by measurements and results from several settings  investigating of rssi behaviour in a static setting  rssi in relation to distance  angle and variance over distance  to characterize the rssi readings for bluetooth smart a testbed is set up to measure values for different scenarios  two bluegiga ble112  38  chips powered by coin cell batteries with full power  3.3v  is programmed to send an advertisement packet every 500ms  two different units with mac-addresses 00:07:80:78:8c  ee and 00:07:80:78:8c:3e are used to mitigate any temporal disturbances or chip deficiencies  the packets are received by the sony xperia zr smartphone described in5.3.1.2  the rssi value is sent from the smartphone over wi-fi to a laptop running matlab where data is aggregated and processed  7.1 rssi characteristics for bluetooth smart based on conclusions from related work  it is expected that rssi values are not necessarily a good indicator of distance between a positioning beacon and a ranging device  some literature suggest that rssi in traditional bluetooth is in fact a very poor measure of distance  27   while other work concludes that it is in fact quite acceptable  13   even with the changes introduced in the bluetooth smart stack compared to traditional bluetooth  it is expected that the characteristics could be quite similar  based on results from traditional bluetooth it is expected that rssi values for bluetooth smart will have the following characteristics  1 rssi values for a device in a static setting  device is not moving   are not giving static readings  instead the values differ within a limited interval  57 7.2 static rssi measurement chapter 7 rssi analysis 2 there exists a correlation between distance and the average rssi value measured in a static setting with increasing distance  3 the variation of measured rssi-values increase with distance to the node aginst which measurement are performed  4 a formula of the form  rssi =  10n log10 d + a   7.1  exists where constants a and n can be determined to give a reasonable relation between rssi and distance  7.2 static rssi measurement to be able to draw conclusions from measured values in different settings  a baseline needs to be established to determine how much values differ when measurements are performed in a static setting where no external factors are changed  this will give an approximation of how much multipath propagation  interference in the radio spectrum and similar disturbances affect the measured results  related literature  14  suggests that individual rssi readings tend to vary quite significantly  to counteract this effect  a number of rssi-values are collected and then the average of these values are calculated and presented  measurements are performed at a distance of k meters where k=1,3,7  at each distance 20 average values are calculated where each average value is composed of 30 measurements  the results are presented in figure 7.1 from the results it is observable that average rssi has small variations when no external factors are changed  to get a usable metric  the variance and standard deviation for the measured rssivalues at each distance are calculated  the formula used to calculate the standard deviation is presented in equation 7.2  where x is is obtained using equation 7.3 the observant reader will recognise this as the definition for the corrected sample standard deviation  from the results  it can be observed that the variance and standard deviation are quite small and that the measured average rssi are quite similar even though single measurements vary quite significantly  v u n u 1 x s=t  7.2   xi x  2 n 1 i=1 v u n u1 x x=t  xi  n i=1 58  7.3  7.3 rssi vs distance in bluetooth smartchapter 7 rssi analysis  a  variance of measured rssi at 1m  b  variance of measured rssi at 3m  c  variance of measured rssi at 7m figure 7.1  rssi variance in static settings distance variance standard deviation   1m 0.1541 0.3925 3m 0.2950 0.5431 7m 0.7847 0.8859 table 7.1  variance and standard deviation for static measurements 7.3 rssi vs distance in bluetooth smart to investigate the relation between average rssi and distance  measurements are performed at k meters where k=  0  1  2  3  19  20   at each distance 30 samples are collected for each node  the orientation of the device is kept static during the entire experiment and thus only distance is changed  the measured values are presented in 59 7.3 rssi vs distance in bluetooth smartchapter 7 rssi analysis figure 7.2 here it is observable that 30 unique sample values are not obtained at each distance  instead the same rssi is measured several times at each distance  represented by different edge colors  the collected average for each position k is calculated with equation 7.4 m 1 x xi  7.4  m i=1 where m is the number of collected values and xi is the measured rssi value  the result is presented in figure 7.3 it can be observed that as predicted  each location shows a great variance in measured rssi values  when looking at the calculated average for the different distances  a quite unfavorable result is found  between 1 and 3 respective 4 meters  the curve follows the predicted behaviour where the signal strength is decreasing almost linearly with distance  however after 3 respective 4 meters  the curve makes a sudden veer and the measurements are suddenly increasing and starts flipping up and down  to rule out any chip related problem such as antenna placement  antenna design and similar hardware specific factors  the same measurement are also performed with another chip model  bluegiga ble113  40  which is based on a different core system  texas instrument 2541  compared to ble112s  texas instrument 2540   the measurements of average rssi in relation to distance are presented in figure 7.4 a similar behaviour is observed with different peaks and dips when the distance increases  it is however necessary to emphasize that the characteristics have a slightly better  more positioning friendly slope than what was observed for the ti 2540-chip  it is not necessarily well suitable for accurate positioning resulting in coordinates  but from the graph it is possible to estimate the distance between the beacon and the measuring device at least with coarse precision which can be seen in figure 7.6 similar to the distance classification used by the the estimote system  32   this of course presents a great challenge and means that two of the expected characteristics does not hold  characteristic 2 and 4 does not hold since a nice correlation between distance and rssi will not be possible to find  the measured results allow a rssi value to potentially correspond to two or more locations  for example  an rssi measure of -65dbm could with the ble112 chip correspond to 6.5  7.5  9.3  13.0  14.5  16.1  17.9  and 18.2 meters as shown in figure 7.5 it is easy to conclude that between 5-20 meters there exists no clear correlation between distance and rssi  the rssi reading oscillates between -60 and -75 during the entire distance  this means that in the end  it would be impossible to find constants for a and n in characteristic 4 such that the formula can fit the measured results  60 7.3 rssi vs distance in bluetooth smartchapter 7 rssi analysis  a  variance of measured rssi of node 00:07:80:78:8c  ee  b  variance of measured rssi of node 00:07:80:78:8c:3e figure 7.2  rssi measurements for two bluegiga bluetooth smart nodes 61 7.3 rssi vs distance in bluetooth smartchapter 7 rssi analysis figure 7.3  average rssi versus distance figure 7.4  average rssi for ti2541 bluetooth smart-chip 62 7.3 rssi vs distance in bluetooth smartchapter 7 rssi analysis figure 7.5  diagram showing rssi of -65dbm corresponding to several distances figure 7.6  distinguishably different distance zones can be defined for the ble113 chip 63 7.4 rssi vs angle 7.4 chapter 7 rssi analysis rssi vs angle in the previous section the relation between rssi and distance was explored  during all the measurements  the angle between the beacon and the smartphone was constant at 0  for a positioning system  it is also important to know how much the angle between devices could affect the rssi readings  the beacons are expected to be deployed on walls or in the ceiling inside a building and positioning against them will be performed with 360 of freedom  a report related to this project  41  expresses that the angle does have a non-negligible effect on rssi measurements  to investigate how large variance the angle introduces we use a test area shown in figure 7.7 the ble112 beacon is used with two different orientations  standing up  su  and laying down  ld  as displayed in figures 7.8  b  and 7.8  c   the beacon is placed statically in the test area and the smartphone is moved around the beacon in 360 as shown in figure 7.8  a   the smartphone is always kept at a fixed distance of k meters from the beacon  measurements are performed for k=1,3,7 meters  this results in 8 measurements with different angles for each orientation  su  ld  with a difference in angle of 45 between each position  as the test-setup in previous section  an average of 30 values in each position is calculated  to mitigate any temporal environmental effects  each measurement is performed 3 times  in the results only one of the measurements rounds are presented to save space  but the measurements can easily be repeated with similar results  the measurements are presented in 3 figures  one for each distance in figures 7.9  1m  ,7.10  3m  and 7.11  7m   figure 7.7  test area for orientation measurements looking at figure 7.9 reveals great differences in rssi related to different angles  for su orientation  90 and 270 stand out with much weaker signal than the other angles 64 7.4 rssi vs angle chapter 7 rssi analysis  a  angle orientation  b  ld position  c  su position figure 7.8  chip orientation for angle vs rssi measurement for the same orientation  in ld orientation  0  180 and 135 stand out with much weaker signal strength than other measured angles  comparing the two orientations at the distance of 1m reveals significant differences when the orientation changes  the differences are well above the amplitude of any coincidental variations  the variance and deviation for measured averages have been calculated in table 7.2 the results at a distance of 3 meters are presented in figure 7.10 and show distinctly different values  here the variance and deviation between both angle and orientation are much smaller  no angles significantly stand out for any of the orientations and also the differences between orientations are quite limited  but looking at the calculated variance and deviation in table7.2 still reveals that they are well above the corresponding values for background noise/interference/multihop influences measured in the static setting  it appears that the angle has a considerable impact also at a distance of 3 meter  although it is significantly smaller than what was observed for 1 meter  the results from measurements at a distance of 7 meters confirm the findings from the two previous tests at 1 respective 3 meters  the difference between angle and orientation does have an impact on the rssi reading  the result is presented in figure 7.11 it is necessary to emphasize that the variance between rssi in ld-orientation at 3 meters is 65 7.4 rssi vs angle chapter 7 rssi analysis figure 7.9  rssi results for different orientation and angle at 1m distance significantly smaller than any of the other obtained results and does not position itself far away from background interference measured in the static measurements setup in paragraph 7.2 the difference for su-orientation is in line with the results of the 3 meter measurements  the conclusion that can be drawn from the angle measurement evaluation is that the angle does impact the average rssi measurement  especially for a close distance where the difference in values are large  when the distance increases the difference between values decreases  both between angles and between orientations  they still however make a non-negligible impact on the readings which is in line with expected results based on findings in related literature  distance and orientation variance standard deviation   1m ld 17.3543 4.1658 1m su 37.5078 6.1244 3m ld 5.3501 2.3130 3m su 5.9025 2.4295 7m ld 1.6180 1.2720 7m su 5.4198 2.3281 table 7.2  variance and standard deviation for different angle measurements 66 7.4 rssi vs angle chapter 7 rssi analysis figure 7.10  rssi results for different orientation and angle at 3m distance figure 7.11  rssi results for different orientation and angle at 7m distance 67 7.5 rssi variance over distance 7.5 chapter 7 rssi analysis rssi variance over distance one of the predicted characteristics for rssi was the variance in measured values in static settings increases with distance  to validate whether this is the case we use data collected in paragraph 7.3 and calculate the deviation and variance for each distance  the calculated variance and deviation is presented in table 7.3 a visual representation of the measured values was presented in figure 7.2 from the results it can immediately be established that variance of values does not increase with distance  instead the variance similar to the average rssi oscillates up and down when the distance increases  distance variance standard dev   distance variance standard dev   1m 2.8517 1.6887 11m 19.7023 4.4387 2m 3.4299 1.8520 12m 30.0517 5.4819 3m 11.9644 3.4590 13m 2.3920 1.5466 4m 28.8374 5.3701 14m 6.1946 2.4889 5m 40.5621 6.3688 15m 3.8724 1.9678 6m 9.2057 3.0341 16m 23.3575 4.8330 7m 11.1540 3.3398 17m 2.1609 1.4700 8m 5.4713 2.3391 18m 14.8057 3.8478 9m 14.9437 3.8657 19m 9.9644 3.1566 5.1506 2.2695 20m 2.2862 1.5120 10m table 7.3  variance and standard deviation for different distances 7.6 rssi conclusions the results from the rssi measurement experiments in this chapter reveal several challenging and unfavorable characteristics for rssi as parameter to perform positioning  a relation between distance and rssi is only observable when a beacon and the positioning device are very close to each other  after the first meters  the values oscillate up and down for quite a long distance  the same behaviour is observed when tx power is decreased in the beacons  the same pattern is observable  although the duration is decreased  furthermore properties such as angle and obstacles have major impact on measured values  combining these characteristics means that rssi for positioning is not a very robust parameter  comparing measurements in different scenarios such as paragraph 7.2 and paragraph 7.3 also reveals that even for the same distance  the mea68 7.6 rssi conclusions chapter 7 rssi analysis sured rssi can vary significantly when the environment is changed  meaning that not only will the rssi depend on factors within the positioning system such as angle and distance to beacons  but also if the environment such as walls  furniture and ceiling are changed  e.g one room has walls out of plaster  another room has lots of windows   the measured values will vary greatly  there is also an observable difference in measurement from different devices even if they have exactly the same design  in paragraph 7.3 two different devices show similar trends  but the measurements against the different devices at exactly the same distance vary significantly in amplitude  it is easily observable that different chips with the same design will have difference in measured rssi between them  since rf-devices are highly sensitive to even minimal irregularities in chip construction  42   this means that if two chips of the same type is used  they will likely not give exactly the same results even if all external conditions are the same  the results from the rssi investigation disclose that trilateration based positioning  where a distance is needed to calculate a position in a bluetooth smart system seems to be a poor approach unless the area is very small and the distances fall within the linear distance/relation part of the curve  this explains the results from chapter 5 well  algorithms and approaches which rely on a correlation between rssi and distance are likely to achieve poor results simply because no such correlation when the distance increases exists  coupled with  sensitivity for changes in environment  orientation  and obstacles renders such approaches less favourable  the characteristics  although at a first glance appearing discouraging do however seem to enable fingerprinting based approaches to positioning quite well  it is observable that within an environment where calibration is made  measurements will not vary greatly  this is observed in paragraph 7.2 where measurements could be repeatably performed with similar results  this means  a database of fingerprints could be saved and used for positioning since values at a certain position do not change significantly over time  the approach would still be vulnerable to changes in environment  node failures and broken los  but since positioning is based on a radio map and not conversion of rssi to distance it can be explained why this approach achieves much better and consistent results than trilateration and distance based algorithms  69 8 discussion this chapter provides a discussion of questions related to indoor positioning based on bluetooth smart technology  its pros and cons  its applicable use cases as well as limitations and possible improvements  8.1 8.1.1 advantages and disadvantages advantages from the evaluation it is clear that the use of bluetooth smart technology in the context of indoor positioning brings several advantages compared to previous attempts made with traditional bluetooth  one of the major improvements is the introduction of the new bluetooth smart mode broadcasting or advertisement which was described in chapter 2.2.2 the new feature makes it easy to implement a system which would scale in satisfying manner when the number of clients increases  if the system is supposed to work with a mobile centric architecture  the deployed beacons within the building would simply need to broadcast their messages within a defined interval  all clients in the vicinity can then intercept these messages and base their positioning either directly on the received rssi which is available when the message is received  or combine the rssi with extra data which can be sent in the payload of the message  the mobile nodes perform passive scanning  meaning that the radio spectrum will only contain the advertisement messages from beacons  comparing this with the traditional bluetooth technology that requires all mobile nodes to perform active scanning  and all beacons to explicitly respond to each inquiry trivially  leads to the conclusion that the bluetooth smart technology is a much better suited candidate technology than traditional bluetooth  this development is very convenient in the context of indoor positioning  different approaches and technologies developed with traditional bluetooth started with different connection based solutions where the mobile node had to connect to beacons to get access to parameters for performing positioning  when inquiry based rssi was 70 8.1 advantages and disadvantages chapter 8 discussion available  this presented another improvement since scalability would be better when no connections needed to be set up  also the accuracy was significantly improved since the grpr could be avoided  the new modes and radio definition of bluetooth smart further improve the suitability for a positioning application  another bluetooth smart characteristic which is related to the effect on the radio spectrum is the defined advertisement channels  which are specified to 37  38  39 in the bluetooth smart tecnology  from the experiments conducted in this project it can be concluded that the discovery time for finding reference beacons can be considerably shortened compared to traditional bluetooth  with traditional bluetooth requiring 10.25 seconds for a complete scan and 4-6 seconds in practice for finding most nodes  bluetooth smart can easily be configured allowing mobile nodes to find beacons in less than a second  this is a major advantage if responsiveness and real-time tracking capabilities are desirable within a system  it is also a characteristic which can be used to improve precision of a bluetooth smart positioning system  since the quick update rate allows for a system to collect an average of several individual values and perform positioning on the average value  instead of performing it on single values individually which for bluetooth and other rf technologies has the property of oscillating considerably  another factor speaking for bluetooth smart within an indoor positioning setting is its widespread global penetration in devices and in society  this is not an improvement from traditional bluetooth which has an even deeper penetration in society and devices  bluetooth smart is however a technology which is being rapidly integrated in different areas of society as well as in different devices  a clear example of this is the fact that almost all high and middle end smartphones today  independent of manufacturer or operating system comes equipped with built in bluetooth smart module  this is a major advantage in several ways  first  the fact that the technology is widespread and mass-produced means that unit costs are very low  1-5 $ /unit   even if hundreds or thousands of units are necessary to complete a big indoor positioning installation  the hardware costs could be considered very reasonable or even inexpensive  in addition to the fact that hardware is inexpensive  the fact that the small amount of power required to power the beacon can be provided for years by a coin cell battery  means that  a system could easily be deployed even in areas where supporting infrastructure is missing  such as  power outlets  network equipment  etc  the widespread penetration also imply that deploying a system based on any smartphone platform means that the solution can be quickly deployed and available to almost all users today  furthermore the smartphone approach also means that a number of other sensors will be available to improve the positioning systems performance  smartphones normally come equipped with sensors such as gyroscope  accelerometer and compass which provide data that is very useful in a positioning context  this is in fact something that is widely used in leading commercial systems in the market today  which was previously described in 71 8.1 advantages and disadvantages chapter 8 discussion section 4.7  8.1.2 disadvantages based on the findings in this project  it can be established that bluetooth smart does not add any new disadvantages for usage in a localization context  compared to traditional bluetooth  it seems that only advantages and improvements are added  this does however not mean that there are only advantages of using bluetooth smart as technology for developing indoor positioning solutions  this project does reveal a number of undesirable properties with the technology  which need to be carefully considered if anyone wishes to use it in a positioning context  the two most apparent problems are the lack of relation between rssi and distance and the problems related to robustness  both these properties have a major impact on both accuracy and precision  this implicates  careful consideration is needed when planning to use a system based on bluetooth smart technology  this project has established that an accuracy of a few meters is possible to achieve using only bluetooth smart rssi  meaning that usage in applications requiring very high accuracy  such as robotics  may be unfitting  this is further motivated by the fact that robustness to interference or changes in the surrounding environment are very low  both conducted experiments in this work as well as related work suggests that signal strength parameters in rf-based solutions are very sensitive to obstacles and/or changes in the environment  another problematic factor depending on what technology and algorithms are used to implement a bluetooth smart positioning system is scalability  if a trilateration or distance based approach is used which relies on only knowing positions of reference nodes and presence of los  scalability is after careful consideration not very good as described in paragraph 6.4.3 the fingerprinting/radiomap approach does also suffer from quite serious scalability problems although it was deemed a bit better than the distance based approaches  the problems with the approach are several  the first is how to handle an expansion of a system after initial configuration have been performed  problems are very likely appear in areas where beacons overlap each others coverage areas  an example of this has been constructed in figure 8.1 in 8.1  b   a fingerprinting system has been deployed and reference data has been collected in areas marked with yellow triangles  now looking at 8.1  a   where the plan is to extend the reach of the positioning system  it is notable that several of the newly deployed beacons overlap in their coverage with the old beacons  this means that several of the old fingerprints in the twofold covered area will be quite wasted  the fingerprints in this area is represented in figure 8.1  a  by black triangles  a fingerprint collected at any location in the twofold covered area will now has major differences to any fingerprint in the database  a possible solution could be engineered in two ways  either perform recalibration of most or all of the system  which is resource consuming especially for large systems  or deploy the new beacons in such a way that overlap between old and new beacons are minimized  which is difficult to do in practice  neither of theses approaches are optimal since both imply either significant 72 8.2 suggested improvements chapter 8 discussion  a  after expanding the calibrated area by adding new beacons and deciding new fingerprinting positions  b  the already calibrated area where the training phase is already finished figure 8.1  an illustration of fingerprinting based positioning system before and after expantion where the covered areas by the beacons overlap each others  amounts of manual work or the introduction of significant error vectors  as an example  selecting the second approach of minimizing radio overlap means that an area is introduced between the old and the new area where system performance can be expected to be significantly degraded  see figure 8.1  a   the radiation pattern for an antenna is rarely symmetric  which combined with effects of multihop and reflection  means that it is very difficult to draw a line where a beacon coverage area ends  this means that both uncovered areas as well as twofold covered areas are likely to exist between a new and an old fingerprinting database  resulting in degraded performance in terms of accuracy and precision  the same problem is present also in the case when a reference node fails  this project has demonstrated that different chips with exactly the same design and implementation have small but not insignificant differences  for a system which relies on radiomap/fingerprinting technology  this could result in performance degradation  8.2 suggested improvements in the section above  advantages and disadvantages of a bluetooth smart based positioning system was listed and discussed  in this section some possible improvements and solutions for listed problems are presented  the focus of this project has been entirely on the evaluation of a system based solely on bluetooth smart without any other technologies  furthermore not all possible algorithms and techniques to mitigate potential problems have been discussed in detail since the number of such solutions are immense  in this section  a number of such techniques and suggestions are briefly described to 73 8.2 suggested improvements chapter 8 discussion allow the reader to get an understanding of the available options and opportunities  8.2.1 machine learning/self adjustment one of the major disadvantages of fingerprinting based positioning approaches is the poor scalability  how to handle failed nodes and how to handle changes in the environment  the problem has its root in the fact that the database or map that is the core of the solution is static  it is thus only valid at configuration time and for as long as no changes or failures occur  to mitigate this problem  the suggestion is to make use of machine learning approaches and neural networks  an example of system with redundancy is presented in  43   the system does not really manage all of the mentioned problems but it clearly demonstrates a usable principle for dealing with them  by adding redundant nodes the ability to mitigate node failures naturally improved  a possible extension to this described in several related papers suggests to make a positioning systems selfcalibrated or self-adjusting  by adding a new calibration mode to beacons in addition to the positioning/broadcasting mode used for localization the system can be designed to continuously recalibrate itself  this is not a small technical challenge and will likely require a fully connected infrastructure for all nodes in the system as well as a connection to the database containing all calibration data  the idea is that the system recalibrate itself all the time and updates the database with reference data  the solution could be implemented either by deploying dedicated calibration nodes in the system which will require more nodes  it could also be provided if nodes support the ability to change between modes  which makes it possible for a positioning node to switch into a calibration node temporarily to update the systems database  the idea for a system with these mentioned properties has been suggested in several papers although to the best of our knowledge  no system exists today which satisfies the requirements well  8.2.2 additional data sources a popular approach already extensively used to improve performance of indoor positioning systems is to fuse data from several sources and sensors into the positioning determination  this approach is commonly used by the state of the art commercial systems today and is also a principle widely used in academic projects on indoor positioning  the idea is a viable option for improving the performance of several key characteristics for positioning applications such as accuracy  precision and responsiveness  the topic of sensor fusion and related mathematical foundation and models such as bayesian theory  44   kalman  16  and monte-carlo  17  -filters are already well established and large amount of literature and material is available on the topic  the concept is to use several different data sources to calculate the actual position  even though some of the sources temporarily deliver bad data  an example in the bluetoth smart case could be an obstacle preventing los measurement  the system will still be able to estimate a fairly accurate and precise location since bluetooth smart is only one of several inputs to the system  74 8.2 suggested improvements chapter 8 discussion another advantage of this approach besides increased performance  is the fact that the potential additional data sources are widely available today  wi-fi  which is a commonly used secondary radio parameter or primary when using bluetooth smart as secondary  is widely deployed in todays society  this makes it easy to incorporate it in a positioning system  since the infrastructure is most likely already deployed  other potential and highly available data sources are different kinds of sensor data such as compass  gyroscope and accelerometer  these sensors are available both individually if the plan is to create the positioning system entirely from scratch with construction of both hardware and software  they are also commonly available and already integrated in most modern smartphones today making it easy to access them and obtain the relevant data  the data delivered by the sensors can be used to get information about heading  acceleration and movement which can be useful for calculating and estimating the position  8.2.3 hybrid solution a quite interesting approach which could be worth investigating would be to create a hybrid system of the fingerprinting approach and the particle filter  but instead of using the full fingerprint approach  use a cell based approach  the result would be a system which would use a database and a single beacon with quite low tx power in the middle of each room that should support positioning  the positioning process would work in two phases  first determining a room level position based on the database and weak cell beacons  followed by a more high accuracy position determination by running the particle filter against several powerful deployed beacons in the specific room  this would solve complexity problems for both the fingerprinting approach and the distance based approaches  since no real fingerprints would have to be configured  instead the database would consist of information mapping a specific room to a specific cell beacon  combined with information about which powerful beacons have los for the room in question and should thus be used for position estimation by the particle filter  the complexity for the distance based approaches is solved since the system will now only perform measurements against nodes with los  and not take nearby nodes which transmits through walls or obstacles into account  although the solution might provide a significant performance increase related to both accuracy  precision  complexity and scalability  it is not a quick fix suitable in all applications  there are still some problems since the approach will not work if rooms are very large  the evaluation performed in this report showed that for a 8x11 meter room with los  a particle filter based approach was superior to the fingerprinting approach  however  if the room gets bigger and distances end up beyond the linear relationship found for the first meters when the distance between nodes increases  it would no longer achieve better results since there is a lack of relation between distance and rssi at larger distances  looking at the rssi evaluation in chapter 7  it is possible to at least expect a nice property when tx power is increased  for the ble112 chip with transmit power of 3dbm  a linear relationship existed between 0 to 4 meters  the same relationship was true for the ble113 chip which has a lower tx power of 0dbm  with the difference 75 8.2 suggested improvements chapter 8 discussion that the linear relationship existed only between 0 to 1.5 meters  the bluetooth smart specification allows for tx power up to 10dbm and if the same pattern can be observed  it is possible that the distance with linear or almost linear relationship can be extended several meters  allowing deployment in larger rooms  it is necessary to emphasize that this is a theoretical hypothesis  but it could be an interesting topic to investigate for increasing bluetooth smart positioning performance  8.2.4 hardware considerations a very interesting approach that has been found during this project but not practically evaluated is the possibility to design hardware which would improve bluetooth smart for use in a positioning context  most commercial systems as well as academic research have put a lot of effort on software and algorithm development  during the project two important factors related to hardware was found  at first it was concluded that rssi measurement which is the parameter used in the evaluation varies greatly between different hardware and chips  the difference is not only observable between hardware with different design and configuration  it is also indeed observable between hardware with the same manufacturer and exactly the same design and configuration  this needs to be carefully considered while designing a localization system based on bluetoth smart technology  this is also a characteristic that is actually considered in the ibeacon technology covered in paragraph 4.7.1 the trademarked technology which actually describes a gatt-service  contains the parameter a  which is the measured rssi at 1 meter as described in paragraph 4.1.1 in the payload  which the ibeacon nodes broadcast  the second important factor related to hardware was the fact that a specialized hardware solution seem to outperform all software-heavy solutions which relies on sensor fusion and rssi values  in paragraph 4.7.5 a system able to determine aoa is described which provides performance that exceeds both commercial bluetooth smart solutions as well as academic research based on bluetooth and/or wi-fi  this implicates that a more hardware based solution could be a viable alternative  the knowledge about antenna arrays and the principle of determining aoa has made good progress in the last couple of years  45  and may be an interesting possibility  another more theoretical idea which surfaced during the project is to perform localization based on tof or tdoa  it is important to emphasize that this is only in the idea stage and no practical evaluation of the possibilities with relation to bluetooth smart exists  although other systems exists which successfully relies on tof/tdoa such as gps  the reason why it might be a plausible idea is the fact that high precision embedded atomic clocks are being introduced on the market  46   if the clocks in systems allow for synchronization with precision of a few nanoseconds  tof could  at least in theory be a possible alternative for a high accuracy bluetooth smart indoor positioning system  76 8.3 proximity applications 8.3 chapter 8 discussion proximity applications an application that is related to localization and positioning is the concept of proximity detection and location awareness  it is not really positioning in the sense of providing exact coordinates or an exact position in a reference geographical coordinate system  but it is highly current in the context of the bluetooth smart technology and also rather simple to implement  the application is interesting because in many cases it is not necessary to know an exact location  instead it is fully sufficient to know roughly in which area something is located  this thesis concludes that bluetooth smart is highly suitable for such applications  while using bluetooth smart-rssi for high accuracy positioning has several challenges  using it for coarse distance estimation is simple  in chapter 7  the properties of rssi in relation to distance was thoroughly explored  the result confirms the properties that for example the popular ibeacon technology promises  separation of distances in three zones  immediate  near and far can be easily made no matter which hardware is used  it is also a very popular approach to combine location awareness/positioning with different kinds of information services  this is of course something for which bluetooth smart also is a very suitable technology  with the changes in the stack and the introduction of  for instance  the broadcast mode with voluntary data payload  it becomes easy to think of a location aware application running on a smartphone  depending on distances to beacons and some unique ids embedded in the advertisement messages  the system will present the user with different information or data  which it can fetch online or from a database in the application itself  8.4 privacy aspects of positioning an important topic related to positioning and location awareness is the matter of privacy  with the prospect of including indoor positioning functionality in smartphones and gadgets to enhance and provide services for users in retail  museums  hospitals  industry and airports to name a few  it is important to clearly elaborate on how this data is and can be used or shared  positioning systems can potentially provide users with improved service and experience  but the same data can also be used by others to perform live tracking and monitoring of the users  a distinct example of such a use case is when deploying an indoor positioning system in a shopping mall  the system will help a user navigate within the premises and might also offer advantageous discounts and offers  but the entity controlling the application can potentially also perform real-time tracking of the user and in detail map the users movements and behaviour  the privacy topic is not new and positioning services such as gps and glonass are already able to track users and devices outdoors with high accuracy and precision  a key aspect is thus to make users aware about how positioning data is used  returning to the smartphone scenario  if an application demands access to high precision 77 8.4 privacy aspects of positioning chapter 8 discussion positioning data from gps or coarse position data based on cell tower information  a user can clearly understand that the location will in some way be shared with the entity behind the application  if an application instead just demands access to use the smartphones built-in bluetooth chip  it might not be as clear to understand that this could allow high/coarse precision tracking and monitoring capabilities  the same reasoning can also be further extended  just because the application provides positioning abilities locally for the user  it will not automatically make the user aware that the application at the same time provides both the entity behind the application and potentially third parties with information about movement and behavior  78 9 conclusion and future work this chapter presents the conclusions reached by the evaluation and does also provide some advice for future work that would be of interest in the area  9.1 conclusion indoor positioning based on bluetooth smart technology has been tested and evaluated based on several known algorithms in the area of positioning  the goal was to evaluate the suitability and the applicability of using bluetooth smart technology in the context of indoor positioning  furthermore tests where performed to analyze rssi behaviour in indoor environments  the practical experiments were preceded by a comprehensive study of earlier research in rf based indoor positioning  the conclusion of the evaluation is that bluetooth smart can be considered a viable candidate solution depending on the requirements  the approach can deliver accuracy of a few meters with relatively high precision which is enough to facilitate navigation and tracking of humans and goods  the response time is good or even excellent with the changes done to the rf properties  the deployment is simplified by low cost of beacons combined with the fact that no extra stationary infrastructure needs to be deployed  since beacons run for years on batteries  a couple of pitfalls was also discovered during the evaluation which will be important to consider before deploying a system  in particular  the utilized rssi parameter has poor correlation with distance  making distance dependent approaches unsuitable  this can be surmounted by relying on characteristic based approaches at the cost of deployment complexity  the exhibited sensitivity of rssi also results in low robustness to environmental changes regardless of positioning algorithm  in the end  it can be concluded that bluetooth smart introduces several improvements to inexpensive indoor positioning  faster response time  independence from fixed infrastructure  advertisement support and power efficiency are important and worthy to mention improvements  particularly in static scenarios where the environment does not change and 79 9.2 future work chapter 9 conclusion and future work an expansion of the system is not forthcoming  9.2 future work even though the evaluation was done according to plan  several improvements could be added if the time and the budget would have permitted  some limitations in bluetooth low energy and bluetooth in general are caused by implementations done by vendors  an example of this is the filtering behaviour of discovered nodes by the bluetooth smart module in the android smartphone  in the phone  the onlescan method does not report the same device multiple times in the same scan even if the advertisement interval is really small  a potential improvement in the future is to have a mobile node as an independent module or a customized system rather than a mobile phone which does impose limitations in the lower layers  another potential improvement that can provide significant improvements could be to evaluate a bluetooth smart based positioning system using aoa  this can be achieved by customizing hardware such as using directional antennas or an antenna grid  the performed literature study seems to support such an approach another related topic of great interest would be to evaluate strategies for beacon positioning  we have seen that both the amount of beacons used as references as well as their position affect primarily the accuracy and precision of the positioning  a formal strategy for good beacon positioning would be a helpful tool  a related concept to beacon placement is the hybrid solution discussed in paragraph 8.2.3 it would be interesting to combine a characteristic based approach with the distance based approach  to potentially introduce a significant performance increase for several characteristics in bluetooth smart based positioning  especially if the systems were to be deployed in a scenario with not too many large open areas  finally the topics of scalability and deployment complexity could benefit largely by future evaluation and development  machine learning approaches and data fusion algorithms to allow simple deployment  expansion or repair of deployed systems could improve rf based positioning significantly  80 bibliography  1  specification of the bluetooth system  tech  rep  bluetooth special interest group  version 4.0  may 2010    2  b sig  a look at the basics of bluetooth technology  may 2014   url http  //www.bluetooth.com/pages/basics.aspx  accessed 2014-05-26    3  l e frenzel  bluetooth low energy finally earns some respect  electronic design 59  10   2011  23  copyright  copyright penton business media  inc and penton media  inc aug 11  2011 ; last updated  2012-02-27 ; coden  elodaw ; subjectstermnotlitgenretext  united statesus  url http  //search.proquest.com/docview/923610018 ? accountid=10041  4  bluetooth-sig  specification adopted documents  march 2014   url https  //www.bluetooth.org/en-us/specification/adoptedspecifications/  accessed 2014-03-18    5  i bluetooth sig  radio architecture  url https  //developer.bluetooth.org/technologyoverview/pages/radio  aspx  accessed 2014-05-06    6  j donovan  bluetooth goes ultra-low-power  tech  rep  digi-key corporation   accessed 2014-06-09   december 2011   url http  //www.digikey.com/en/articles/techzone/2011/dec/bluetoothgoes-ultra-low-power  7  c gomez  j oller  j paradells  overview and evaluation of bluetooth low energy  an emerging low-power wireless technology  sensors 12  9   2012  1173411753   8  e mackensen  m lai  t wendt  bluetooth low energy  ble  based wireless sensors  in  sensors  2012 ieee  2012  pp  14   9  m galeev  bluetooth 4.0  an introduction to bluetooth low energypart 1  july 2011   81 bibliography bibliography url hhttp  //www.eetimes.com/document.asp ? doc_id=1278927  accessed 201406-09    10  r nilsson  b saltzstein  bluetooth low energy technology and healthcare  tech  rep  connectblue inc   accessed 2014-06-09   url http  //www.connectblue.com/press/articles/bluetooth-low-energytechnology-and-healthcare/  11  a hossain  w.-s soh  a comprehensive study of bluetooth signal parameters for localization  in  personal  indoor and mobile radio communications  2007 pimrc 2007 ieee 18th international symposium on  2007  pp  15   12  m s bargh  r de groote  indoor localization based on response rate of bluetooth inquiries  in  proceedings of the first acm international workshop on mobile entity localization and tracking in gps-less environments  melt 08  acm  new york  ny  usa  2008  pp  4954   13  f subhan  h hasbullah  a rozyyev  s bakhsh  analysis of bluetooth signal parameters for indoor positioning systems  in  computer information science  iccis   2012 international conference on  vol  2  2012  pp  784789   14  a raghavan  h ananthapadmanaban  m sivamurugan  b ravindran  accurate mobile robot localization in indoor environments using bluetooth  in  robotics and automation  icra   2010 ieee international conference on  2010  pp  43914396   15  h bao  w.-c wong  an indoor dead-reckoning algorithm with map matching  in  wireless communications and mobile computing conference  iwcmc   2013 9th international  2013  pp  15341539   16  m s grewal  dawsonera  e-book collection   kalman filtering  theory and practice using matlab  wiley-blackwell  oxford  2008   17  a haug  bayesian estimation for target tracking  part iii  monte carlo filters  wiley interdisciplinary reviews  computational statistics 4  5   2012  498512   18  s goswami  indoor location technologies  springer new york  2013   19  d niculescu  b nath  ad hoc positioning system  aps  using aoa  in  infocom 2003 twenty-second annual joint conference of the ieee computer and communications  ieee societies  vol  3  2003  pp  17341743 vol.3   20  y wang  x yang  y zhao  y liu  l cuthbert  bluetooth positioning using rssi and triangulation methods  in  consumer communications and networking conference  ccnc   2013 ieee  2013  pp  837842   21  n a mahiddin  n safie  e nadia  s safei  f engku  indoor position detection using wifi and trilateration technique  the international conference on informatics and applications  icia2012   82 bibliography bibliography  22  j rodas  c escudero  d iglesia  bayesian filtering for a bluetooth positioning system  in  wireless communication systems  2008 iswcs 08 ieee international symposium on  2008  pp  618622   23  t alhmiedat  g samara  a o a salem  an indoor fingerprinting localization approach for zigbee wireless sensor networks  corr abs/1308.1809   24  l chen  l pei  h kuusniemi  y chen  t kroger  r chen  bayesian fusion for indoor positioning using bluetooth fingerprints  wireless personal communications 70  4   2013  17351745   25  s chawathe  low-latency indoor localization using bluetooth beacons  in  intelligent transportation systems  2009 itsc 09  12th international ieee conference on  2009  pp  17   26  s chawathe  beacon placement for indoor localization using bluetooth  ieee  2008  pp  980985   27  q dong  w dargie  evaluation of the reliability of rssi for indoor localization  in  wireless communications in unusual and confined areas  icwcuca   2012 international conference on  2012  pp  16   28  j shlens  notes on kullback-leibler divergence and likelihood  corr abs/1404.2000   29  b fuglede  f topsoe  jensen-shannon divergence and hilbert space embedding  in  information theory  2004 isit 2004 proceedings  international symposium on  2004  pp  31   30  ibeacons bible  tech  rep  andy cavallini  gaia-matrix  version 1.0  april 2014    31  i apple  mfi program enrollment frequently asked questions  may 2014   url https  //mfi.apple.com/mfiweb/getfaq.action  accessed 2014-05-13    32  o puchta  estimote rssi  range  zones  and distance accuracy  april 2014   url https  //community.estimote.com/hc/en-us/articles/201029223-rssirange-zones-and-distance-accuracy  accessed 2014-04-16    33  senionlab  senionlab solutions  url http  //www.senionlab.com/solutions  accessed 2014-06-02    34  indoo.rs  frequently asked questions  april 2014   url http  //indoo.rs/questions/  accessed 2014-04-04    35  j caeyman  quuppa  makes high accuracy indoor positioning commercially available  november 2013   url http  //www.in-location-alliance.com/files/ila/ila_munich_quuppa  pdf  accessed 2014-05-28   83 bibliography bibliography  36  a masson  insiteo -towards a fully global system ?  march 2010   url http  //www.application-days.eu/presentations/day2/lbs/8.insitio  pdf  accessed 2014-05-12    37  j nikhilesh  b rupal  accuracy vs precision  url http  //www.diffen.com/difference/accuracy_vs_precision  accessed 2014-03-14    38  ble112 data sheet  tech  rep  bluegiga technologies   accessed 2014-02-10   may 2013   url http  //www.mouser.com/ds/2/52/bluegiga_technologies_ble112_ datasheet-293747.pdf  39  iar-systems  iar embedded workbench for 8051  url http  //www.iar.com/products/iar-embedded-workbench/8051/ cessed 2014-03-14    ac  40  ble113 data sheet  tech  rep  bluegiga technologies   accessed 2014-02-10   nov 2013   url http  //www.mouser.com/catalog/specsheets/bluegiga_technologies_ ble113_datasheet.pdf  41  d scheerens  practical indoor localization using bluetooth  master thesis  2012   university of twente   42  s lucyszyn  advanced rf mems  cambridge university press  2010   43  m altini  d brunelli  e farella  l benini  bluetooth indoor localization with multiple neural networks  in  wireless pervasive computing  iswpc   2010 5th ieee international symposium on  2010  pp  295300   44  h b mitchell  bayesian decision theory  springer berlin heidelberg  berlin  heidelberg  2012  pp  273293   45  l mailaender  s affes  m juntti  m pesavento  advances in angle-of-arrival and multidimensional signal processing for localization and communications  eurasip journal on advances in signal processing 2011  1   2011  12 url http  //dx.doi.org/10.1186/1687-6180-2011-94  46  quantum sa.45s csac  chip scale atomic clock  tech  rep  microsemi corporation   accessed 2014-05-28   january 2014   url http  //www.microsemi.com/document-portal/doc_download/133305quantum-sa-45s-csac 84 