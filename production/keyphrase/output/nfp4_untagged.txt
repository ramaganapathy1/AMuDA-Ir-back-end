localization of mobile users using trajectory matching hyungjune lee  martin wicke  branislav kusy  and leonidas guibas stanford university  stanford  ca  usa  abbado  wicke  kusy  @ stanford.edu  guibas @ cs.stanford.edu abstract methods  12  14  are among the most common  these methods estimate positions from a number of distance or angle measurements to beacon nodes  utilizing models that describe how acoustic or radio signals propagate in space  such as the inverse-square law   even though relatively accurate models  20  for open areas exist  they are of limited use indoors  where model inaccuracies due to reflections and signal fading can lead to significant position errors  since no accurate and efficient models of indoor signal propagation are available  a number of methods pre-compute a signal-strength map of the coverage area  1  10   these methods estimate position of a node by comparing the signal-strength signature of beacon nodes to the map  however  both acoustic and radio signals indoors tend to be highly variable over time  especially so for mobile users  resulting in reduced accuracy of these algorithms  in this paper  we focus on the problem of using received signal strength indicator  rssi  measurements to localize mobile users in indoor environments  as the structure of the environment is unknown  no good transmission model is available  however  in an indoor setting  the users mobility is restricted by the environment  we can not go through walls   and we can assume that not all possible movements within space are actually realized  rather  the users move along a limited set of typical trajectories  suggesting that we can learn the structure of the space of possible movements from repeated observation  we can use this inferred knowledge to locate users  and extrapolate our observations to unknown trajectories  one of the main problems when using signal strength data for localization is the large variance in these measurements  our experimental data shows that the variance due to reflections is particularly severe when either transmitter or receiver are moving  even at low speeds  systems that use rssi readings for localization therefore use averages or require the nodes to be stationary during the measurement  1  9  10   we propose to use a function fitting and interpolation scheme to learn a position function in the high-dimensional space of signal strength measurements  we not only use the current set of rssi values for reachable nodes  but also a number of past samples  thereby matching a trajectory in signal strength space to a position  the learning process handles noisy input data gracefully by computing a smooth approximation to the input samples  after a learning phase which requires position ground truth  queries to the localization subsystem we present an algorithm enabling localization of moving wireless devices in an indoor setting  the method uses only rf signal strength and can be implemented without specialized hardware  the mobility of the users is modeled by learning a function mapping a short history of signal strength values to a 2d position  we use radial basis function  rbf  fitting to learn a reliable estimate of a mobile nodes position given its past signal strength measurements  even though we deal with extremely noisy measurements in a cluttered indoor setting  nodes are not required to be stationary during measurement or learning  we evaluate our algorithm in a real indoor setting using micaz motes  achieving an average localization accuracy of 1.3 m in our experiments  using historical data improves the localization accuracy by almost a factor of two compared to using only the most current measurements  categories and subject descriptors c.2.4  computer-communication networks   distributed systems general terms algorithms  experimentation keywords localization  mobility  rssi  sensor network 1 introduction with the advent of ubiquitous wireless networks  supporting mobility of users has become a key topic in network research  localizing users moving through a network is a fundamental problem in this area  accurate estimates of users locations enable more efficient routing strategies in the presence of mobile nodes  locationdependent network services  with application examples ranging from building automation to targeted advertising or augmented reality  first and foremost require reliable localization techniques  the field of localization has therefore been studied in a wide variety of research communities  triangulation permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page  to copy otherwise  to republish  to post on servers or to redistribute to lists  requires prior specific permission and/or a fee  melt08  september 19  2008  san francisco  california  usa  copyright 2008 acm 978-1-60558-189-7/08/09  $ 5.00  123 reduce to a simple function evaluation  we evaluate several versions of this algorithm  exploring different tradeoffs between the memory requirements  communication overhead  and localization accuracy  our results clearly indicate benefits of user movement history  almost cutting the position error in half compared to using current measurements only  we also compare the accuracy of our algorithm for three different link quality estimators  received signal strength indicator  rssi   link quality indicator  lqi   and packet reception ratio  prr   even though rssi measurements are clearly superior  other link quality measures perform reasonably well  the rest of this paper is organized as follows  after giving an overview of related work in sec  2  we formally define the problem that we are solving in sec  3 sec  4 describes our solution  we evaluate the performance of our algorithm in sec  5 before concluding in sec  6 of nearby beacons to this empirical model  this process was shown capable of eliminating multipath and shadowing effects  achieving meter-level localization accuracy  ladd et al   9  proposed an indoor localization algorithm achieving an average error of 1.5 m similarly to our approach they sense rf signal strengths using standard hardware  ethernet cards   however  their approach suppresses mobility related variation of radio signals  rather than utilizing it to its benefit  the training algorithm requires a person to stand still for a few moments or requires filtering to calibrate mobile users  the locadio system  7  explicitly models moving vs stationary users in a probabilistic framework  our method goes one step further  we are interested in mobile users and therefore explicitly use the history of the users movement in the localization algorithm  2 this paper describes an approach to the indoor localization problem using signal strength measurements as input  given information about the connection quality to close-by infrastructure nodes  we infer the position of a mobile device  in our experiments  connection quality is measured by rssi values that are provided by the wireless hardware  as some radio chips do not support rssi measurements  e g  the nordic nrf903 used in  16    it is important to note that our approach does not depend on the presence of this specific type of measurement  packet reception ratios  which can be extracted in all wireless networks  can be used instead  see sec  5   we assume that a mobile user moves through a network spanned by a set n  |n | = n cooperating infrastructure nodes  the mobile node regularly broadcasts radio packets allowing for rssi measurements  we assume that these packets are dedicated beacon packets  however  we believe that aggressive suppression of beacon packets will enable virtually zero-cost localization and tracking in practical applications  if regular network traffic to and from the mobile node is present  whenever such a beacon packet is received by the infrastructure nodes  we extract rssi information  yielding values ri  t  that measure the signal strength of the packet sent at time t  received by the infrastructure node with id i for localization  we will not only consider the most recent rssi values  but utilize historical data as well  for our computations  we assemble these values into a vector t t r1  t 0t  rn  t 0t    r  t  =      1  r1  t kt  rn  t kt  3 related work the problem of localization and tracking has been extensively studied in robotics literature  several variants of the localization or tracking problem with or without landmarks  with or without access to a map  and using various forms of sensor input have been explored  a good overview of the field is given in the introduction of  19   while most of these approaches use visual or range finding sensors  some are applicable to the problem of locating users within a wireless network  spatial relations between nodes can be found using a number of techniques  such as time of flight  14   angle of arrival of a signal  13   walking gps  17   ultrawideband  15   or doppler shift ranging  8   the localization problem is then solved using optimization techniques  for example  2  4   however  these techniques often require sophisticated hardware  in contrast  we assume that nodes are equipped with very basic hardware that only allows us to measure some kind of radio link quality estimate  approximate point in triangle  apit   6  and dvhop  11  are two representatives of range free algorithms  these algorithms estimate locations using simple radio connectivity information from multiple beacon nodes located in the proximity of the unknown node  apit localizes nodes at an intersection of triangular regions defined around beacon nodes  whereas dv-hop triangulates the location using hop counts that estimate distances between nodes  these approaches  however  were designed for static networks and thus do not support mobility well  moreover  their accuracy is often limited by requiring dense deployment of sensor nodes  rssi pattern matching algorithms  radar  1   motetrack  10   are closely related to our approach  users are localized inside a building using rssi measurements from fixed beacon nodes  as no reliable radio propagation model is available  these techniques do not estimate euclidean distances from the measured rssi values  instead  they learn the properties of radio signals for a particular position  the location of the unknown node is found by matching the current rssi signature problem formulation r  t  defines a point in the space xk  n of sampled trajectories through rssi space  in which most of our computations will take place  the localization problem can then be described as finding a function l  xk  n r2 which maps a trajectory from xk  n to its end position in world space  124 4 localization algorithm our approach learns function l defined in the previous section from examples that we obtain in a training phase  during the training phase  ground truth locations of the mobile user are required  however  locations of infrastructure nodes are not needed  we use radial basis function fitting to compute a function that approximates the  noisy  input examples and is able to extrapolate from those examples in a smooth fashion in the localization phase  4.1 training phase in a training phase  a mobile node explores the physical space that is covered by the network  while moving around in space  both world space position p  t  =  px  t   py  t   t and signal strength measurements ri  t  are recorded at discrete times tj  we then assemble the sampled trajectories r  tj   and form ns pairs  r  tj   p  tj   that we use as training data  these pairs are samples of the function l that we are trying to find  and impose constraints of the form l  r  tj   = p  tj    2  we use rbf fitting to compute a smooth function that approximates these constraints  4.1.1 rbf fitting due to space constraints  we will only briefly review rbf fitting here  and refer the reader to  3  for an indepth treatment of the subject  we express the function l =  lx  ly  t as a weighted sum of kernel functions plus a polynomial p in r l  r  = nc x wi  kr ci k  + p  r   figure 1  a map of the experiment area  its size is approximately 30 m 25 m shown are the infrastructure node locations  areas that were accessible to us are shaded  training data is very noisy  and a smoother  approximate solution is desirable  the optimal number of centers depends on the complexity of l  in our case  3000 centers were optimal  see sec  5.2   since our kernel functions have global support and no singularities  the exact position of the centers ci has little impact on the quality of the solution as long as the relevant parts of xk  n are well sampled  we place the centers along the path by using a subset of the training sample positions as centers  4.2 localization once training is complete  we can use l to compute the position of the mobile node given measured data r  t  along the trajectory of the node  the rssi measurements that are the components of r  t  are noisy  and therefore the computed position p = l  r  t   is not reliable enough  we remedy this by prefiltering the rssi measurements  in particular  by replacing r  t  by a lowpass filtered version r  t   however  this introduces a bias in the localization  the computed position trails the true position as changes in the rssi values r  t  gradually impact the low-pass filtered version r  t   we solve this by requiring the mobile node to send a burst of b packets in a rapid succession  we use b = 5 packets in 50 ms  and using low-pass filter of width b in our implementation  we use a simple box filter  this ensures that r  t  is rapidly updated  keeping the position bias to a minimum   3  i=1 where =  x  y   the number  nc  and the placement of the kernel centers ci are free parameters  in our implementation  we use a linear polynomial p  r  = ha |ri+b  the kernel function determines properties of the solution  such as its smoothness  we use the p common multiquadric  d  = 1 + d2 / 2  with = 1 to compute weights wi  we minimize the quadratic error at the constraints  2  by solving two linear systems of equations for the variables  w  a  b  t 0,0    0  nc r  t0  t 1 p  t1     `` w #          a =  t ns ,0    ns  nc r  tns  1 p  t    4  b ns 1  1 0 0 c1    cnc 5 evaluation we have validated our localization method in a small indoor testbed  fig  1 shows a map of the space  we distributed 11 micaz motes  5  in the area  a mobile mote sends beacon packets in regular intervals  infrastructure nodes receive these packets and record sequence numbers  timestamps  and various signal strength indicators  micazs cc2420 radio chip  18  allows us to measure rssi and lqi for each received packet  additionally  we compute a packet reception ratio  prr  by counting the number of received packets in each burst  in a least-squares sense  here  i  j =  kri cj k  and t w =  w1      wn   if the number of constraints c equals the number of degrees of freedom  the computed solution is exact and the function l interpolates the training values  for nc < ns  a least-squares approximation the training data is computed  in our case  the 125 -0.6 -0.7 -0.8 -0.9 -1 0 20 40 t  s  60 -0.5 rssi  102 dbm  1   2  3   4  n 5   6  7  + 8   9:4 10  rssi  102 dbm  -0.5 -0.6 -0.7 -0.8 -0.9 -1 0 20 40 60 80 t  s  figure 2  localization for routes  f  and  g   figures on the left show recorded rssi measurements for all nodes  figures on the right show estimated and ground truth locations  blue and red dots  respectively   corresponding pairs connected by a line  where p is the ground truth path that we are testing against  this error measure does not contain errors due to imperfect timing information used for ground truth computation  it also contains information on how accurately a world-space trajectory can be reconstructed using the localization data  as mentioned before  our method can be applied to any indicator  as long as it gives some information about the distance between transmitter and receiver  to study the effect of measurement noise on the localization accuracy  the mobile node transmits a burst of 30 packets  rather than a single beacon packet  this allows us to experiment with different filtering techniques to improve the input signal  further  we chose t=0.6 s in our experiments  i e  the mobile node transmits one burst of packets every 0.6 s in the training phase  we require pairs  r  t   p  t   as described in sec  4.1 therefore  we move the mobile node along a predefined route through the experiment area  we store timestamps for predefined waypoints  while continually recording rssi and lqi at all nodes  the training positions p  t   which will also be used as ground truth  are estimated using linear interpolation between the waypoints  fig  2 shows some of the routes and associated rssi measurements  in our experiments  we never use the same route for both training and evaluation  5.1 5.2 our algorithm accepts several parameters that can be tuned for optimal performance  the number of past measurements k determines how much historical information about the trajectories is available  as can be seen in fig  3  a   a value of k = 4 is optimal in our case  note that this significantly outperforms the case k = 0  in which our algorithm reduces to a traditional localization method based on averaged rssi measurements  the properties of the fitted rbf function depend on the number of kernel functions  centers  used  varying the number of kernel functions  we see that using around 3000 kernels is optimal in our setting  fig  3  b    decreasing the number of centers degrades the quality of the rbf approximation  while increasing it further yields a function that interpolates the constraints too faithfully  since the input data is very noisy  interpolation is not desirable  the optimal number of rbf centers depends on the complexity of the environment in which localization is attempted  as described in sec  4.2  the function l is queried with a low-pass filtered rssi vector r fig  3  c  shows the influence of the width b of the box filter on the local error measures in order to evaluate our algorithm  we compute two error measures along the path  the position error epos  ti  = kl  r  ti   p  ti  k  5  gives us information about the general performance of the localization algorithm  we also compute the distance to the closest point on the path e  ti  = min kl  r  ti   pk  pp parameters  6  126  m  4 position error path error 2 0 0 1 2 3 4 5  a  6 7 8 9 k  m  2 figure 4  routes used   a   e  for training   f   i  for testing  1 1000 2000 3000  b  4000 ization results  our experiments show that a moderate filter width of b = 5 performs best  while lower values of b yield noisy measurements  high values of b smooth out important details and degrade the localization accuracy  unless otherwise noted  all results were obtained using k = 4  nc = 3000  and b = 5  as described above  5000 nc  m  2 5.3 we use a training set of 5 routes  a    e   each of which we recorded 5 times  all errors are computed for 4 different routes  f    i   each recorded several times to obtain a total of 24 test routes  although the routes used for testing are composed of path segments seen during training  none of the testing and training routes are the same  see fig  4   table 1 summarizes the localization results  overall  our method is able to localize a mobile node with a mean position error of less than 1.3 m if radio contact is lost entirely  we do not predict a location  note that by linearly interpolating position values between waypoints  we implicitly assume that the motion of the mobile node is of constant speed between waypoints  this assumption is generally not true in our experiments  we moved the mobile device by carrying it while walking  and the routes involved opening doors  and at one point  entering a 6 digit access code  given perfect ground truth  our results would probably improve further  we can see in the experimental data that errors are more likely to be along the path than perpendicular to the path  c f fig  2   we attribute this in part to the systematic timing errors in the ground truth  table 1 also contains the path error e  which is not affected by timing problems with the ground truth  however  it is also invariant to other errors  as mentioned above  our algorithm does not require rssi measurements  and can operate using lqi or approximate prr measurements  see fig  3  d    using these measures  the mean position error  measured across all test routes  then increases to 1.7 m and 2 m respectively  comparing the three measures  the reason 1 0 1 5 10 15  c  20 25 30 b  m  3 2 1 0 rssi lqi  d  results prr figure 3  position error  epos  red  and path error  e  blue  depending on algorithm parameters  the graphs show the mean error  error bars represent 75 % and 25 % quantiles   a  history size k  b  the number nc of rbf centers   c  low-pass filter width b   d  measurement type  rssi  lqi  or prr with 5 burst packets  127 epos  f   g   h   i  all e  f   g   h   i  all 2.5 % 0.18 0.14 0.19 0.20 0.18 2.5 % 0.09 0.07 0.09 0.08 0.08 25 % 0.67 0.58 0.68 0.58 0.64 25 % 0.30 0.23 0.28 0.26 0.26 50 % 1.07 0.98 1.09 0.97 1.03 50 % 0.52 0.34 0.47 0.38 0.43 75 % 1.64 1.58 1.70 1.64 1.65 75 % 0.86 0.51 0.74 0.65 0.71 97.5 % 4.40 3.40 3.76 4.30 4.09 97.5 % 2.24 1.46 1.75 2.47 2.13 max 5.63 4.88 6.92 8.22 8.22 max 4.97 4.03 3.03 4.36 4.97 avg 1.32 1.20 1.32 1.25 1.28 avg 0.68 0.44 0.57 0.56 0.58 performance computing research cluster ta3  martin wicke is a postdoctoral fellow of the max planck center for visual computing and communication  8 table 1  summary of localization results  in meters   for the inferior performance of lqi and prr measurements is easy to see  the lqi values remain high whenever there is radio coverage and drop sharply as soon as connectivity is about to be lost  therefore  these measurements are good as an indicator for link quality  but contain only little information about distance of the neighboring node  prr measurements have similar problems  as long as no packets are lost  prr provides limited information about distance  as packets start being lost  the measurement is necessarily discrete  in our case  we used averaging over only five packets  giving us only a very rough idea of how good  or bad  the link really is  in this light  the results for prr are astonishingly good  6 conclusion and future work we have presented a novel method for locating mobile users within a network using rssi measurements  the algorithm uses not only the current rssi measurement for localization  but takes advantage of past values  using historical values significantly increases the stability of the localization  this is particularly important in indoor settings  where rssi measurements are extremely noisy  in particular for mobile nodes  using trajectory information in rssi space allows us to locate mobile users even while they are moving  this research leaves ample room for future work  the dimension of the rssi trajectory space grows linearly with the number of nodes  therefore  exploiting locality is crucial to ensure the scalability of the algorithm  local  overlapping localization areas can be used to solve this problem  since we use past measurements at fixed time intervals  we implicitly assume that the speed of the mobile user at a given position is similar during training and localization  although the method can be trained for different speeds  explicitly handling speed differences  for example using dynamic time warping  would be an interesting extension  7 references  1  p bahl and v n padmanabhan  radar  an in-building rf-based user-location and tracking system  in proc  infocom  volume 2  pages 77584  2000   2  p biswas and y ye  semidefinite programming for ad hoc wireless sensor network localization  in ipsn 04  proceedings of the third international symposium on information processing in sensor networks  2004   3  m d buhmann  radial basis functions  theory and implementations  cambridge university press  2003   4  m w carter  h h jin  m a saunders  and y ye  spaseloc  an adaptive subproblem algorithm for scalable wireless sensor network localization  siam j optimization  17  4  :11021128  2006   5  crossbow technology inc  http  //www.xbow.com  micaz wireless measurement system  june 2004   6  t he  c huang  b m blum  j a stankovic  and t f abdelzaher  range-free localization and its impact on large scale sensor networks  trans  on embedded computing sys  4  4  :877906  2005   7  j krumm and e horvitz  locadio  inferring motion and location from wi-fi signal strengths  in proc  mobiquitous  2004   8  b kusy  a ledeczi  and x koutsoukos  tracking mobile nodes using rf doppler shifts  in proc  sensys  pages 2942  2007   9  a m ladd  k e bekris  a p rudys  d s wallach  and l e kavrati  on the feasibility of using wireless ethernet for indoor localization  ieee trans  robotics and automation  20  3  :555559  2004   10  k lorincz and m welsh  motetrack  a robust  decentralized approach to rf-based location tracking  personal ubiquitous comp  11  6  :489503  2007   11  d niculescu and b nath  dv based positioning in ad hoc networks  j comm  sys  22  1  :267280   12  n patwari  a iii  m perkins  n correal  and r odea  relative location estimation in wireless sensor networks  ieee trans  on sig  proc  51  8  :21372148   13  r peng and m l sichitiu  angle of arrival localization for wireless sensor networks  in proc  conf  sensor and ad-hoc comm  and networks  2006   14  n b priyantha  h balakrishnan  e d demaine  and s teller  mobile-assisted localization in wireless sensor networks  in proc  infocom  pages 172183  2005   15  z sahinoglu  s gezici  and i guvenc  ultra-wideband positioning systems theoretical limits  ranging algorithms  and protocols  cambridge university press  2008   16  p sikka  p corke  and l overs  wireless sensor devices for animal tracking and control  in lcn 04  proceedings of the 29th annual ieee international conference on local computer networks  pages 446454  2004   17  r stoleru  t he  and j a stankovic  walking gps  a practical solution for localization in manually deployed wireless sensor networks  in proc  lcn  pages 480489  2004   18  texas instruments  data sheet  rev  1.4 chipcon cc2420 2.4 ghz ieee 802.15.4 / zigbee-ready rf transceiver   19  s thrun  d fox  w burgard  and f dellaert  robust monte carlo localization for mobile robots  artificial intelligence  128  1-2  :99141  2001   20  g zhou  t he  s krishnamurthy  and j a stankovic  models and solutions for radio irregularity in wireless sensor networks  acm trans  sen  netw  2  2  :221262  2006 acknowledgments the authors would like to acknowledge their funding sources  hyungjune lee is funded by a samsung scholarship  branislav kusy is a member of the army high 128 